- en: <!--yml
  id: totrans-0
  prefs: []
  type: TYPE_NORMAL
  zh: <!--yml
- en: 'category: æœªåˆ†ç±»'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: ç±»åˆ«ï¼šæœªåˆ†ç±»
- en: 'date: 2024-05-27 14:42:04'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: æ—¥æœŸï¼š2024-05-27 14:42:04
- en: -->
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: -->
- en: You canâ€™t follow me
  id: totrans-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä½ æ— æ³•å…³æ³¨æˆ‘
- en: æ¥æºï¼š[https://so.nwalsh.com/2024/01/06-mastodon](https://so.nwalsh.com/2024/01/06-mastodon)
  id: totrans-5
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: æ¥æºï¼š[https://so.nwalsh.com/2024/01/06-mastodon](https://so.nwalsh.com/2024/01/06-mastodon)
- en: A few days ago, I stumbled over a couple of weblog posts that talked about adding
    [Mastodon](https://en.wikipedia.org/wiki/Mastodon_(social_network)) to (mostly)
    static sites. I thought that sounded kind ofâ€œKind of cool.â€ Always a bad sign!
    cool.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: å‡ å¤©å‰ï¼Œæˆ‘å¶ç„¶å‘ç°äº†å‡ ç¯‡å…³äºå°†[Mastodon](https://en.wikipedia.org/wiki/Mastodon_(social_network))æ·»åŠ åˆ°ï¼ˆä¸»è¦æ˜¯ï¼‰é™æ€ç½‘ç«™çš„åšå®¢æ–‡ç« ã€‚æˆ‘è§‰å¾—é‚£å¬èµ·æ¥æœ‰ç‚¹â€œæœ‰ç‚¹é…·ã€‚â€è¿™æ€»æ˜¯ä¸€ä¸ªä¸å¥½çš„è¿¹è±¡ï¼é…·ã€‚
- en: So, I poked at things a bit. If I was serious about implementing a full-fleged
    [ActivityPub](https://en.wikipedia.org/wiki/ActivityPub) client or server, Iâ€™d
    dig in and work out what other implementors use for testing environments, Iâ€™d
    read the specifications, etc.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€ä»¥ï¼Œæˆ‘ç¨å¾®æ‘¸äº†ä¸€ä¸‹ã€‚å¦‚æœæˆ‘è®¤çœŸè€ƒè™‘è¦å®ç°ä¸€ä¸ªå®Œæ•´çš„[ActivityPub](https://en.wikipedia.org/wiki/ActivityPub)å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ï¼Œæˆ‘ä¼šæ·±å…¥æŒ–æ˜å¹¶äº†è§£å…¶ä»–å®æ–½è€…åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨çš„å·¥å…·ï¼Œæˆ‘ä¼šé˜…è¯»è§„èŒƒç­‰ç­‰ã€‚
- en: 'But this looked like low(er) hanging fruit, and I thought I might get it working
    with just a bit of fun hacking. I think the problem can be broken down into just
    a few steps:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: ä½†è¿™çœ‹èµ·æ¥åƒæ˜¯ä½é£é™©çš„æˆæœï¼Œæˆ‘æƒ³æˆ‘å¯ä»¥é€šè¿‡ä¸€ç‚¹æœ‰è¶£çš„é»‘å®¢æŠ€æœ¯ä½¿å®ƒèµ·ä½œç”¨ã€‚æˆ‘è®¤ä¸ºé—®é¢˜å¯ä»¥åˆ†è§£ä¸ºå‡ ä¸ªæ­¥éª¤ï¼š
- en: Publish a â€œ[WebFinger](https://en.wikipedia.org/wiki/WebFinger)â€ endpoint (easy).
  id: totrans-9
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å‘å¸ƒä¸€ä¸ªâ€œ[WebFinger](https://en.wikipedia.org/wiki/WebFinger)â€ç«¯ç‚¹ï¼ˆå®¹æ˜“ï¼‰ã€‚
- en: Support a user, with an inbox and an outbox.
  id: totrans-10
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ”¯æŒç”¨æˆ·ï¼Œå¸¦æœ‰æ”¶ä»¶ç®±å’Œå‘ä»¶ç®±ã€‚
- en: Handle â€œfollowâ€ and â€œunfollowâ€ messages on the inbox.
  id: totrans-11
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å¤„ç†æ”¶ä»¶ç®±ä¸­çš„â€œå…³æ³¨â€å’Œâ€œå–æ¶ˆå…³æ³¨â€æ¶ˆæ¯ã€‚
- en: Publish posts to followers in the outbox.
  id: totrans-12
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å°†å¸–å­å‘å¸ƒåˆ°å‘ä»¶ç®±çš„å…³æ³¨è€…ã€‚
- en: I assume that replies get sent back to the inbox as posts, though I canâ€™t actually
    prove that to myself with a few minutes of casual web searching.
  id: totrans-13
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æˆ‘å‡è®¾å›å¤ä¼šä½œä¸ºå¸–å­å‘é€å›æ”¶ä»¶ç®±ï¼Œå°½ç®¡æˆ‘ä¸èƒ½é€šè¿‡å‡ åˆ†é’Ÿçš„éšæ„ç½‘é¡µæœç´¢æ¥è¯æ˜è¿™ä¸€ç‚¹ã€‚
- en: The first hurdle is that all of the communcations have to be HTTPS, which [is
    inconvenient](/2023/12/31-https) for testing purposes. Then there was a fair bit
    of effort necessary to get [better isolation](/2024/01/06-isolation) for the test
    rig.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: ç¬¬ä¸€ä¸ªéšœç¢æ˜¯æ‰€æœ‰é€šä¿¡éƒ½å¿…é¡»æ˜¯ HTTPSï¼Œè¿™å¯¹äºæµ‹è¯•ç›®çš„æ¥è¯´[ä¸æ–¹ä¾¿](/2023/12/31-https)ã€‚ç„¶åï¼Œä¸ºäº†è·å¾—[æ›´å¥½çš„éš”ç¦»](/2024/01/06-isolation)ï¼Œéœ€è¦è¿›è¡Œç›¸å½“å¤§çš„åŠªåŠ›ã€‚
- en: Once I had that up and running, I could fire up [a Mastodon server](https://github.com/martinheinz/mastodon-local)
    on my laptop. But could it follow my test weblog?
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦æˆ‘æå®šäº†è¿™ä¸ªï¼Œæˆ‘å°±å¯ä»¥åœ¨æˆ‘çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šå¯åŠ¨ä¸€ä¸ª[Mastodon æœåŠ¡å™¨](https://github.com/martinheinz/mastodon-local)äº†ã€‚ä½†å®ƒèƒ½å…³æ³¨æˆ‘çš„æµ‹è¯•åšå®¢å—ï¼Ÿ
- en: Pointing my Mastodon instance at `@so@sotest.nwalsh.com` was fine. It hit the
    webfinger endpoint, hit the user endpoint, and posted something to the inbox.
    Fantastic! Next, I edited a few things to get some more debugging details about
    the messages being sent to my endpoints, deployed those changes, went back to
    the Mastodon instance and tried again.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: å°†æˆ‘çš„ Mastodon å®ä¾‹æŒ‡å‘ `@so@sotest.nwalsh.com` æ²¡é—®é¢˜ã€‚å®ƒå‡»ä¸­äº† webfinger ç«¯ç‚¹ï¼Œå‡»ä¸­äº†ç”¨æˆ·ç«¯ç‚¹ï¼Œå¹¶ä¸”å‘æ”¶ä»¶ç®±å‘å¸ƒäº†ä¸€äº›å†…å®¹ã€‚å¤ªæ£’äº†ï¼æ¥ä¸‹æ¥ï¼Œæˆ‘ç¼–è¾‘äº†ä¸€äº›å†…å®¹ï¼Œä»¥è·å–æœ‰å…³å‘é€åˆ°æˆ‘çš„ç«¯ç‚¹çš„æ¶ˆæ¯çš„æ›´å¤šè°ƒè¯•è¯¦ç»†ä¿¡æ¯ï¼Œéƒ¨ç½²äº†è¿™äº›æ›´æ”¹ï¼Œç„¶åå›åˆ°
    Mastodon å®ä¾‹å¹¶å†æ¬¡å°è¯•ã€‚
- en: Nothing happened. I mean, the Mastodon instance was happy to show me the user
    to follow, but it didnâ€™t actually hit the endpoints again.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: ä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿã€‚æˆ‘çš„æ„æ€æ˜¯ï¼ŒMastodon å®ä¾‹å¾ˆé«˜å…´åœ°å‘æˆ‘å±•ç¤ºäº†è¦å…³æ³¨çš„ç”¨æˆ·ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰å†æ¬¡å‡»ä¸­ç«¯ç‚¹ã€‚
- en: I spent *a long time* poking about at the various places in the Mastodon server
    were caching could be performed. I ran the â€œcache clearâ€ tasks, I fussed with
    the `nginx` configuration to turn off proxy caching, I did everything I could
    think of. To no avail.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘èŠ±äº† *å¾ˆé•¿æ—¶é—´* åœ¨ Mastodon æœåŠ¡å™¨ä¸­å„ä¸ªåœ°æ–¹è¿›è¡ŒæŒ å¤´ï¼Œè¿™äº›åœ°æ–¹å¯èƒ½è¿›è¡Œäº†ç¼“å­˜ã€‚æˆ‘è¿è¡Œäº†â€œæ¸…é™¤ç¼“å­˜â€ä»»åŠ¡ï¼Œæˆ‘åœ¨ `nginx` é…ç½®ä¸­å¿™äºå…³é—­ä»£ç†ç¼“å­˜ï¼Œæˆ‘åšäº†æˆ‘èƒ½æƒ³åˆ°çš„ä¸€åˆ‡ã€‚ä½†æ¯«æ— ç»“æœã€‚
- en: I was frustrated, but I discovered that I could make something happen by clicking
    â€œFollowâ€ so I dug in there a bit.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘å¾ˆæ²®ä¸§ï¼Œä½†æˆ‘å‘ç°é€šè¿‡ç‚¹å‡»â€œå…³æ³¨â€æˆ‘å¯ä»¥è®©ä¸€äº›äº‹æƒ…å‘ç”Ÿï¼Œæ‰€ä»¥æˆ‘ç¨å¾®æ·±å…¥ç ”ç©¶äº†ä¸€ä¸‹ã€‚
- en: 'Next up: weâ€™ve got all these digital signatures to deal with. There are examples
    on the web of the sorts of things that need to be done, but all the ones I could
    find were in [TypeScript](https://en.wikipedia.org/wiki/TypeScript). Thatâ€™s a
    hurdle I didnâ€™t feel like trying to overcome today.'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: æ¥ä¸‹æ¥ï¼šæˆ‘ä»¬æœ‰æ‰€æœ‰è¿™äº›æ•°å­—ç­¾åè¦å¤„ç†ã€‚ç½‘ä¸Šæœ‰ä¸€äº›éœ€è¦åšçš„äº‹æƒ…çš„ç¤ºä¾‹ï¼Œä½†æˆ‘æ‰¾åˆ°çš„æ‰€æœ‰ç¤ºä¾‹éƒ½æ˜¯ç”¨[TypeScript](https://en.wikipedia.org/wiki/TypeScript)å†™çš„ã€‚è¿™æ˜¯æˆ‘ä»Šå¤©ä¸æƒ³å…‹æœçš„éšœç¢ã€‚
- en: And then I realized that to validate the signature, Iâ€™d have to hit the endpoint
    of the user attempting to follow me, e.g., `https://localhost/user/admin`, to
    get the userâ€™s public key.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åæˆ‘æ„è¯†åˆ°ï¼Œä¸ºäº†éªŒè¯ç­¾åï¼Œæˆ‘å¿…é¡»å‡»ä¸­å°è¯•å…³æ³¨æˆ‘çš„ç”¨æˆ·çš„ç«¯ç‚¹ï¼Œä¾‹å¦‚ï¼Œ`https://localhost/user/admin`ï¼Œä»¥è·å–ç”¨æˆ·çš„å…¬é’¥ã€‚
- en: Well ğŸ¤¬! ğŸ¤¬! ğŸ¤¬! ğŸ¤¬!
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: å¥½æ°”å•Šï¼ğŸ¤¬ï¼ğŸ¤¬ï¼ğŸ¤¬ï¼ğŸ¤¬ï¼
- en: Thereâ€™s no way thatâ€™s going to work from my `sotest` server on a different host.
    So to test this, Iâ€™d need *both* ends of the communcation to be on the public
    internet with proper certificates. And Iâ€™d have to work out how to disable caching.
    And Iâ€™d have to reverse-engineer some TypeScript (or work out how to use TypeScript).
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: ä»æˆ‘çš„`sotest`æœåŠ¡å™¨ä¸Šåˆ°ä¸åŒä¸»æœºçš„æ–¹å¼è¡Œä¸é€šã€‚æ‰€ä»¥ä¸ºäº†æµ‹è¯•è¿™ä¸ªï¼Œæˆ‘éœ€è¦*é€šä¿¡çš„ä¸¤ç«¯*éƒ½åœ¨å…¬å…±äº’è”ç½‘ä¸Šï¼Œå¹¶ä¸”æœ‰é€‚å½“çš„è¯ä¹¦ã€‚è€Œä¸”æˆ‘è¿˜å¾—æƒ³åŠæ³•ç¦ç”¨ç¼“å­˜ã€‚æˆ‘è¿˜å¾—é€†å‘å·¥ç¨‹ä¸€äº›
    TypeScriptï¼ˆæˆ–è€…å­¦ä¼šå¦‚ä½•ä½¿ç”¨ TypeScriptï¼‰ã€‚
- en: I gave myself a day to see if I could make progress. I did not. (At least, not
    the kind of progress I was hoping to make.)
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ç»™äº†è‡ªå·±ä¸€å¤©æ—¶é—´ï¼Œçœ‹çœ‹æˆ‘èƒ½å¦å–å¾—è¿›å±•ã€‚æˆ‘æ²¡æœ‰ã€‚ï¼ˆè‡³å°‘ï¼Œä¸æ˜¯æˆ‘å¸Œæœ›å–å¾—çš„é‚£ç§è¿›å±•ã€‚ï¼‰
- en: I officially give up. (At least for now.)
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘æ­£å¼æ”¾å¼ƒäº†ã€‚ï¼ˆè‡³å°‘æš‚æ—¶æ”¾å¼ƒã€‚ï¼‰
