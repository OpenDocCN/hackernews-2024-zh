- en: <!--yml
  id: totrans-0
  prefs: []
  type: TYPE_NORMAL
  zh: <!--yml
- en: 'category: æœªåˆ†ç±»'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: ç±»åˆ«ï¼šæœªåˆ†ç±»
- en: 'date: 2024-05-27 14:51:46'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: æ—¥æœŸï¼š2024-05-27 14:51:46
- en: -->
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: -->
- en: 'Deploying a Cloudflare R2-Backed Nix Binary Cache (Attic!) on Fly.io :: LGUG2Z'
  id: totrans-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 'åœ¨ Fly.io ä¸Šéƒ¨ç½²åŸºäº Cloudflare R2 çš„ Nix äºŒè¿›åˆ¶ç¼“å­˜ï¼ˆAtticï¼ï¼‰:: LGUG2Z'
- en: æ¥æºï¼š[https://lgug2z.com/articles/deploying-a-cloudflare-r2-backed-nix-binary-cache-attic-on-fly-io/](https://lgug2z.com/articles/deploying-a-cloudflare-r2-backed-nix-binary-cache-attic-on-fly-io/)
  id: totrans-5
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: æ¥æºï¼š[https://lgug2z.com/articles/deploying-a-cloudflare-r2-backed-nix-binary-cache-attic-on-fly-io/](https://lgug2z.com/articles/deploying-a-cloudflare-r2-backed-nix-binary-cache-attic-on-fly-io/)
- en: I have tried running the [Attic Nix Binary Cache](https://github.com/zhaofengli/attic)
    on my Hetzner dedicated server in Germany a few times in the past, but the peering
    issues and the latency to Xfinity in Seattle have always made me throw my hands
    up in frustration.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘æ›¾è¯•è¿‡åœ¨æˆ‘ä½äºå¾·å›½çš„ Hetzner ä¸“ç”¨æœåŠ¡å™¨ä¸Šè¿è¡Œ [Attic Nix äºŒè¿›åˆ¶ç¼“å­˜](https://github.com/zhaofengli/attic)
    å‡ æ¬¡ï¼Œä½†æ˜¯ä¸è¥¿é›…å›¾çš„ Xfinity çš„è¿æ¥é—®é¢˜å’Œå»¶è¿Ÿæ€»æ˜¯è®©æˆ‘æ„Ÿåˆ°æ²®ä¸§ã€‚
- en: This morning I noticed [a comment](https://github.com/zhaofengli/attic/issues/1#issuecomment-1368527062)
    by Zhaofeng on the repo issue tracker.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: ä»Šå¤©æ—©ä¸Šæˆ‘æ³¨æ„åˆ° [ä¸€ä¸ªè¯„è®º](https://github.com/zhaofengli/attic/issues/1#issuecomment-1368527062)ï¼Œæ˜¯
    Zhaofeng åœ¨å­˜å‚¨åº“é—®é¢˜è·Ÿè¸ªå™¨ä¸Šçš„è¯„è®ºã€‚
- en: As a NixOS aficionado myself, I begrudgingly admit that Iâ€™ve been running my
    instance on fly.io ğŸ˜›
  id: totrans-8
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: ä½œä¸ºä¸€ä¸ª NixOS çˆ±å¥½è€…ï¼Œæˆ‘ä¸æƒ…æ„¿åœ°æ‰¿è®¤æˆ‘ä¸€ç›´åœ¨ fly.io ä¸Šè¿è¡Œæˆ‘çš„å®ä¾‹ ğŸ˜›
- en: Iâ€™m not sure if this is comment is still current, but hey, if Zhaofeng is/was
    running his binary cache on [fly.io](https://fly.io/), thereâ€™s no reason why we
    canâ€™t too, right?
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä¸ç¡®å®šè¿™æ¡è¯„è®ºæ˜¯å¦ä»ç„¶æœ‰æ•ˆï¼Œä½†æ˜¯å˜¿ï¼Œå¦‚æœ Zhaofeng æ­£åœ¨æˆ–æ›¾ç»åœ¨ [fly.io](https://fly.io/) ä¸Šè¿è¡Œä»–çš„äºŒè¿›åˆ¶ç¼“å­˜ï¼Œé‚£æˆ‘ä»¬ä¹Ÿæ²¡ç†ç”±ä¸èƒ½ï¼Œå¯¹å§ï¼Ÿ
- en: Storage[âŒ—](#storage)
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å­˜å‚¨[âŒ—](#storage)
- en: While Attic does support local storage, I figured Iâ€™d use Cloudflareâ€™s R2 as
    a storage backend, both as an excuse to try out the [free tier](https://developers.cloudflare.com/r2/pricing/)
    (10GB), and because itâ€™ll be easy enough to lift-and-shift if I ever decide to
    move the server from fly.io.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: è™½ç„¶ Attic æ”¯æŒæœ¬åœ°å­˜å‚¨ï¼Œä½†æˆ‘æƒ³æˆ‘ä¼šä½¿ç”¨ Cloudflare çš„ R2 ä½œä¸ºå­˜å‚¨åç«¯ï¼Œæ—¢æ˜¯å°è¯• [å…è´¹å¥—é¤](https://developers.cloudflare.com/r2/pricing/)ï¼ˆ10GBï¼‰çš„å€Ÿå£ï¼Œä¹Ÿå› ä¸ºå¦‚æœæˆ‘å†³å®šå°†æœåŠ¡å™¨ä»
    fly.io è¿ç§»ï¼Œè¿™å°†å¾ˆå®¹æ˜“æ¬è¿ã€‚
- en: Itâ€™s easy enough to create a new R2 bucket and grab a read-write API token scoped
    to the bucket on the [Cloudflare Dashboard](https://dash.cloudflare.com).
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: åˆ›å»ºæ–°çš„ R2 å­˜å‚¨æ¡¶å¹¶åœ¨ [Cloudflare æ§åˆ¶å°](https://dash.cloudflare.com) ä¸Šè·å–é’ˆå¯¹å­˜å‚¨æ¡¶çš„è¯»å†™ API
    ä»¤ç‰Œéå¸¸ç®€å•ã€‚
- en: Server Configuration[âŒ—](#server-configuration)
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[æœåŠ¡å™¨é…ç½®](#server-configuration)'
- en: Once we have our credentials, we can put together a configuration file for the
    Attic server based on the [example config](https://github.com/zhaofengli/attic/blob/e6bedf1869f382cfc51b69848d6e09d51585ead6/server/src/config-template.toml).
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦æˆ‘ä»¬æœ‰äº†å‡­æ®ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ® [ç¤ºä¾‹é…ç½®](https://github.com/zhaofengli/attic/blob/e6bedf1869f382cfc51b69848d6e09d51585ead6/server/src/config-template.toml)
    ä¸º Attic æœåŠ¡å™¨ç»„è£…ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚
- en: '[PRE0]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: One thing to note is that we are storing our SQLite database file at `/data/attic.db`
    - this is going to be a fly volume that weâ€™ll create soon.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘ä»¬æ­£åœ¨å°† SQLite æ•°æ®åº“æ–‡ä»¶å­˜å‚¨åœ¨ `/data/attic.db` - è¿™å°†æ˜¯æˆ‘ä»¬å³å°†åˆ›å»ºçš„ä¸€ä¸ª fly å·ã€‚
- en: You should probably `git-crypt` this file (or encrypt it with `sops` or `age`)
    in your configuration repo since it has sensitive credentials.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ åº”è¯¥åœ¨ä½ çš„é…ç½®å­˜å‚¨åº“ä¸­ `git-crypt` è¿™ä¸ªæ–‡ä»¶ï¼ˆæˆ–ä½¿ç”¨ `sops` æˆ– `age` åŠ å¯†ï¼‰ï¼Œå› ä¸ºå®ƒåŒ…å«æ•æ„Ÿå‡­æ®ã€‚
- en: '**Not sure about how to handle secrets in NixOS configuration repos? I have
    a big old article all about [handling secrets in NixOS](https://lgug2z.com/articles/handling-secrets-in-nixos-an-overview/)!**'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '**ä¸ç¡®å®šå¦‚ä½•å¤„ç† NixOS é…ç½®å­˜å‚¨åº“ä¸­çš„æœºå¯†ï¼Ÿæˆ‘æœ‰ä¸€ç¯‡å…³äº[åœ¨ NixOS ä¸­å¤„ç†æœºå¯†](https://lgug2z.com/articles/handling-secrets-in-nixos-an-overview/)çš„å¤§æ–‡ç« ï¼**'
- en: Dockerfile[âŒ—](#dockerfile)
  id: totrans-19
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Dockerfile[âŒ—](#dockerfile)
- en: Luckily, there is an automatically published Docker image available for us to
    extend. There isnâ€™t much to do here except bring in our configration file, reference
    it when we start `atticd` and ensure itâ€™s running in `monolithic` mode.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æ‰©å±•çš„è‡ªåŠ¨å‘å¸ƒçš„ Docker é•œåƒå¯ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚è¿™é‡Œæ²¡ä»€ä¹ˆè¦åšçš„ï¼Œé™¤äº†å¼•å…¥æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ï¼Œå½“æˆ‘ä»¬å¯åŠ¨ `atticd` æ—¶å¼•ç”¨å®ƒï¼Œå¹¶ç¡®ä¿å®ƒä»¥
    `monolithic` æ¨¡å¼è¿è¡Œã€‚
- en: '[PRE1]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Fly Config[âŒ—](#fly-config)
  id: totrans-22
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Fly é…ç½®[âŒ—](#fly-config)
- en: The last piece of the deployment puzzle is to put together a `fly.toml` file
    for our `atticd` instance.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: éƒ¨ç½²æ‹¼å›¾çš„æœ€åä¸€å—æ˜¯ä¸ºæˆ‘ä»¬çš„ `atticd` å®ä¾‹ç»„è£…ä¸€ä¸ª `fly.toml` æ–‡ä»¶ã€‚
- en: Letâ€™s start by ensuring we have a volume created in our desired region.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬é¦–å…ˆç¡®ä¿æˆ‘ä»¬åœ¨æ‰€éœ€åŒºåŸŸåˆ›å»ºäº†ä¸€ä¸ªå·ã€‚
- en: '[PRE2]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The volume can be called whatever we want, we just need to make sure to update
    the `source` in the `[mounts]` section in our `fly.toml` file.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: å·å¯ä»¥è¢«æˆ‘ä»¬éšæ„å‘½åï¼Œæˆ‘ä»¬åªéœ€è¦ç¡®ä¿åœ¨æˆ‘ä»¬çš„ `fly.toml` æ–‡ä»¶çš„ `[mounts]` éƒ¨åˆ†æ›´æ–° `source`ã€‚
- en: '[PRE3]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Thatâ€™s pretty much it, time to `fly deploy`! (I do this with `--ha=false` since
    I donâ€™t want to create more than one machine)
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: å°±è¿™æ ·äº†ï¼Œè¯¥æ˜¯ `fly deploy` çš„æ—¶å€™äº†ï¼ï¼ˆæˆ‘ä½¿ç”¨ `--ha=false`ï¼Œå› ä¸ºæˆ‘ä¸æƒ³åˆ›å»ºå¤šå°æœºå™¨ï¼‰
- en: Generating an Attic token[âŒ—](#generating-an-attic-token)
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç”Ÿæˆä¸€ä¸ªé˜æ¥¼ä»¤ç‰Œ[âŒ—](#generating-an-attic-token)
- en: Weâ€™ll need to execute a command on the newly deployed fly.io machine to generate
    a â€œgodmodeâ€ token for ourselves. Letâ€™s start by getting the machine ID.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬éœ€è¦åœ¨æ–°éƒ¨ç½²çš„ fly.io æœºå™¨ä¸Šæ‰§è¡Œä¸€ä¸ªå‘½ä»¤æ¥ç”Ÿæˆä¸€ä¸ªâ€œgodmodeâ€ä»¤ç‰Œä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚è®©æˆ‘ä»¬ä»è·å–æœºå™¨ ID å¼€å§‹ã€‚
- en: '[PRE4]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Then we can call the `atticadm` command on the fly.io machine via `fly machine
    exec` to generate our token.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `fly machine exec` åœ¨ fly.io æœºå™¨ä¸Šè°ƒç”¨ `atticadm` å‘½ä»¤ç”Ÿæˆæˆ‘ä»¬çš„ä»¤ç‰Œã€‚
- en: '[PRE5]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: We need to keep this token somewhere safe and preferably encrypted. I keep mine
    encrypted with `sops-nix` in my NixOS configuration monorepo and have it decrypted
    and mounted to `/run/secrets/attic/token` on machines that have been given access
    to decrypt it.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªä»¤ç‰Œä¿å­˜åœ¨ä¸€ä¸ªå®‰å…¨çš„åœ°æ–¹ï¼Œæœ€å¥½æ˜¯åŠ å¯†çš„ã€‚æˆ‘å°†æˆ‘çš„åŠ å¯†ä»¤ç‰Œå­˜å‚¨åœ¨æˆ‘çš„ NixOS é…ç½® monorepo ä¸­ï¼Œä½¿ç”¨ `sops-nix` è¿›è¡ŒåŠ å¯†ï¼Œå¹¶åœ¨æˆäºˆè§£å¯†æƒé™çš„æœºå™¨ä¸Šè§£å¯†å¹¶æŒ‚è½½åˆ°
    `/run/secrets/attic/token`ã€‚
- en: Logging into Attic[âŒ—](#logging-into-attic)
  id: totrans-35
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç™»å½•åˆ°é˜æ¥¼[âŒ—](#logging-into-attic)
- en: This part is pretty simple! We can call the server whatever we like in our configuration;
    here â€œflyâ€ will do. The final two arguments are the URL generated for our fly.io
    app and our access token.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™éƒ¨åˆ†éå¸¸ç®€å•ï¼æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®ä¸­éšå¿ƒæ‰€æ¬²åœ°å‘½åæœåŠ¡å™¨ï¼›è¿™é‡Œä½¿ç”¨â€œflyâ€å³å¯ã€‚æœ€åä¸¤ä¸ªå‚æ•°æ˜¯ä¸ºæˆ‘ä»¬çš„ fly.io åº”ç”¨ç”Ÿæˆçš„ URL å’Œæˆ‘ä»¬çš„è®¿é—®ä»¤ç‰Œã€‚
- en: '[PRE6]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Pushing to our Attic cache[âŒ—](#pushing-to-our-attic-cache)
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ¨é€åˆ°æˆ‘ä»¬çš„é˜æ¥¼ç¼“å­˜[âŒ—](#pushing-to-our-attic-cache)
- en: Now that we have the `atticd` cache server running on fly.io and our computer
    authenticated with a token that allows us to push, letâ€™s set up a cache and push
    our entire(!) system configuration.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨ fly.io ä¸Šè¿è¡Œç€ `atticd` ç¼“å­˜æœåŠ¡å™¨ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„è®¡ç®—æœºå·²ç»ä½¿ç”¨å…è®¸æˆ‘ä»¬æ¨é€çš„ä»¤ç‰Œè¿›è¡Œäº†èº«ä»½éªŒè¯ï¼Œè®©æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªç¼“å­˜å¹¶æ¨é€æˆ‘ä»¬çš„æ•´ä¸ª(!)
    ç³»ç»Ÿé…ç½®ã€‚
- en: 'Note: In my case 256MB of RAM was not enough to keep up with everything I wanted
    to push! I suggest scaling the RAM to at least 512MB, if not 1GB with `fly scale
    memory 512`. The snippet below assumes that you have bumped the RAM to 512MB which
    *should* be able to handle three concurrent jobs (`-j 3`) without the machine
    giving â€œout of memoryâ€ errors and restarting the `atticd` process.'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼šåœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼Œ256MB çš„ RAM ä¸è¶³ä»¥è·Ÿä¸Šæˆ‘æƒ³è¦æ¨é€çš„ä¸€åˆ‡ï¼æˆ‘å»ºè®®å°† RAM æ‰©å±•è‡³è‡³å°‘ 512MBï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œç”šè‡³æ‰©å±•è‡³ 1GBï¼Œä½¿ç”¨
    `fly scale memory 512`ã€‚ä¸‹é¢çš„ç‰‡æ®µå‡å®šä½ å·²å°† RAM æ‰©å±•è‡³ 512MBï¼Œ*åº”è¯¥*èƒ½å¤Ÿå¤„ç†ä¸‰ä¸ªå¹¶å‘ä½œä¸šï¼ˆ`-j 3`ï¼‰ï¼Œè€Œä¸ä¼šå› ä¸ºå†…å­˜ä¸è¶³è€Œå¯¼è‡´æœºå™¨é‡æ–°å¯åŠ¨
    `atticd` è¿›ç¨‹ã€‚
- en: '[PRE7]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Configuring NixOS to use our Attic binary cache[âŒ—](#configuring-nixos-to-use-our-attic-binary-cache)
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: é…ç½® NixOS ä½¿ç”¨æˆ‘ä»¬çš„é˜æ¥¼äºŒè¿›åˆ¶ç¼“å­˜[âŒ—](#configuring-nixos-to-use-our-attic-binary-cache)
- en: There are two things that we need to do before we can configure NixOS to use
    our new binary cache.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨é…ç½® NixOS ä½¿ç”¨æˆ‘ä»¬çš„æ–°äºŒè¿›åˆ¶ç¼“å­˜ä¹‹å‰ï¼Œæœ‰ä¸¤ä»¶äº‹æƒ…æˆ‘ä»¬éœ€è¦åšã€‚
- en: First, we need to get the public key of our `system` cache.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è·å–æˆ‘ä»¬ `system` ç¼“å­˜çš„å…¬é’¥ã€‚
- en: 'Next, we need to create a `netrc` file which contains our `attic` token. The
    format looks like this:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å«æˆ‘ä»¬çš„ `attic` ä»¤ç‰Œçš„ `netrc` æ–‡ä»¶ã€‚æ ¼å¼å¦‚ä¸‹ï¼š
- en: '[PRE8]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Since this file once again contains sensitive information, if you want to store
    this in your configuration repo, I recommend encrypting it. In the example below,
    I have added the `netrc` file contents via `sops-nix`, which mounts the decrypted
    contents to `/run/secrets/attic/netrc` for machines that have been given decryption
    access.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äºè¿™ä¸ªæ–‡ä»¶å†æ¬¡åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚æœä½ æƒ³å°†å…¶å­˜å‚¨åœ¨é…ç½®ä»“åº“ä¸­ï¼Œæˆ‘å»ºè®®å¯¹å…¶è¿›è¡ŒåŠ å¯†ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘é€šè¿‡ `sops-nix` æ·»åŠ äº† `netrc` æ–‡ä»¶å†…å®¹ï¼Œå®ƒä¼šå°†è§£å¯†åçš„å†…å®¹æŒ‚è½½åˆ°æˆäºˆè§£å¯†æƒé™çš„æœºå™¨ä¸Šçš„
    `/run/secrets/attic/netrc`ã€‚
- en: '[PRE9]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Now, when our NixOS machines are rebuilt:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œå½“æˆ‘ä»¬çš„ NixOS æœºå™¨é‡æ–°æ„å»ºæ—¶ï¼š
- en: First the official NixOS cache (with a priority of 40) will be checked
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é¦–å…ˆå°†æ£€æŸ¥å®˜æ–¹çš„ NixOS ç¼“å­˜ï¼ˆä¼˜å…ˆçº§ä¸º40ï¼‰
- en: Next, the `nix-community` public cache (with a priority of 41) will be checked
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ¥ä¸‹æ¥ï¼Œå°†æ£€æŸ¥ `nix-community` çš„å…¬å…±ç¼“å­˜ï¼ˆä¼˜å…ˆçº§ä¸º41ï¼‰
- en: Next, the `numtide` public cache (with a priority of 42) will be checked
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ¥ä¸‹æ¥ï¼Œå°†æ£€æŸ¥ `numtide` çš„å…¬å…±ç¼“å­˜ï¼ˆä¼˜å…ˆçº§ä¸º42ï¼‰
- en: Finally, our private cache (with a priority of 43) will be checked
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æœ€åï¼Œæˆ‘ä»¬çš„ç§æœ‰ç¼“å­˜ï¼ˆä¼˜å…ˆçº§ä¸º43ï¼‰å°†è¢«æ£€æŸ¥
- en: If there are no cache hits at all, the package will be built from source
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¦‚æœæ ¹æœ¬æ²¡æœ‰ç¼“å­˜å‘½ä¸­ï¼ŒåŒ…å°†ä»æºä»£ç æ„å»º
- en: What we have at this point is pretty damn cool.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å‰æˆ‘ä»¬æ‰€æ‹¥æœ‰çš„æ˜¯ç›¸å½“é…·çš„ã€‚
- en: '**In the next article weâ€™ll make this even cooler still**, by setting up GitHub
    Actions jobs [to build each of our NixOS system configurations whenever we push
    a new commit, and push the outputs of each those builds to our private `system`
    cache](https://hachyderm.io/@LGUG2Z/111767749455052075)!'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '**åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿è¿™æ›´åŠ é…·ç‚«**ï¼Œé€šè¿‡è®¾ç½® GitHub Actions ä½œä¸š[åœ¨æˆ‘ä»¬æ¨é€æ–°æäº¤æ—¶æ„å»ºæˆ‘ä»¬çš„æ¯ä¸ª NixOS ç³»ç»Ÿé…ç½®ï¼Œå¹¶å°†è¿™äº›æ„å»ºçš„è¾“å‡ºæ¨é€åˆ°æˆ‘ä»¬çš„ç§æœ‰
    `system` ç¼“å­˜](https://hachyderm.io/@LGUG2Z/111767749455052075)!'
- en: If you have any questions or comments you can reach out to me on [Twitter](https://twitter.com/LGUG2Z)
    and [Mastodon](https://hachyderm.io/@LGUG2Z).
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–æ„è§ï¼Œä½ å¯ä»¥é€šè¿‡[Twitter](https://twitter.com/LGUG2Z)å’Œ[Mastodon](https://hachyderm.io/@LGUG2Z)è”ç³»æˆ‘ã€‚
- en: If youâ€™re interested in what I read to come up with solutions like this one,
    you can subscribe to my [Software Development RSS feed](https://notado.app/feeds/jado/software-development).
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ å¯¹æˆ‘é˜…è¯»çš„å†…å®¹ä»¥åŠæå‡ºç±»ä¼¼è¿™æ ·è§£å†³æ–¹æ¡ˆæ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥è®¢é˜…æˆ‘çš„[è½¯ä»¶å¼€å‘ RSS è®¢é˜…](https://notado.app/feeds/jado/software-development)ã€‚
- en: If youâ€™d like to watch me writing code while explaining what Iâ€™m doing, you
    can also [subscribe to my YouTube channel](https://www.youtube.com/channel/UCeai3-do-9O4MNy9_xjO6mg?sub_confirmation=1).
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ æƒ³çœ‹æˆ‘è¾¹å†™ä»£ç è¾¹è§£é‡Šæˆ‘åœ¨åšä»€ä¹ˆï¼Œä½ ä¹Ÿå¯ä»¥[è®¢é˜…æˆ‘çš„ YouTube é¢‘é“](https://www.youtube.com/channel/UCeai3-do-9O4MNy9_xjO6mg?sub_confirmation=1)ã€‚
- en: If you found this content valuable, or if you are a happy user of [`komorebi`](https://github.com/LGUG2Z/komorebi)
    or my [NixOS starter templates](https://github.com/LGUG2Z), please consider sponsoring
    me on [GitHub](https://github.com/sponsors/LGUG2Z) or tipping me on [Ko-fi](https://ko-fi.com/lgug2z).
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä½ è§‰å¾—è¿™ç¯‡å†…å®¹æœ‰ä»·å€¼ï¼Œæˆ–è€…ä½ æ˜¯[`komorebi`](https://github.com/LGUG2Z/komorebi)æˆ–è€…æˆ‘çš„[NixOS
    åˆå§‹æ¨¡æ¿](https://github.com/LGUG2Z)çš„å¿«ä¹ç”¨æˆ·ï¼Œè¯·è€ƒè™‘åœ¨[GitHub](https://github.com/sponsors/LGUG2Z)ä¸ŠèµåŠ©æˆ‘æˆ–åœ¨[Ko-fi](https://ko-fi.com/lgug2z)ä¸Šç»™æˆ‘æ‰“èµã€‚
