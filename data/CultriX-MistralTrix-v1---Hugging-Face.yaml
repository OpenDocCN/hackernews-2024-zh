- en: <!--yml
  id: totrans-0
  prefs: []
  type: TYPE_NORMAL
  zh: <!--yml
- en: 'category: æœªåˆ†ç±»'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: åˆ†ç±»ï¼šæœªåˆ†ç±»
- en: 'date: 2024-05-27 14:31:20'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: æ—¥æœŸï¼š2024-05-27 14:31:20
- en: -->
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: -->
- en: CultriX/MistralTrix-v1 Â· Hugging Face
  id: totrans-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: CultriX/MistralTrix-v1 Â· Hugging Face
- en: æ¥æºï¼š[https://huggingface.co/CultriX/MistralTrix-v1](https://huggingface.co/CultriX/MistralTrix-v1)
  id: totrans-5
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: æ¥æºï¼š[https://huggingface.co/CultriX/MistralTrix-v1](https://huggingface.co/CultriX/MistralTrix-v1)
- en: '[](#edit)EDIT:'
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '[](#edit)ç¼–è¾‘ï¼š'
- en: Always check my space for the latest benchmark results for my models!
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: æ€»æ˜¯æŸ¥çœ‹æˆ‘çš„ç©ºé—´ä»¥è·å–æœ€æ–°çš„æ¨¡å‹åŸºå‡†ç»“æœï¼
- en: '[](#results)Results:'
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '[](#results)ç»“æœï¼š'
- en: 'T: ğŸŸ¦ Model: CultriX/MistralTrix-v1 ğŸ“‘ Average: 73.39 ARC: 72.27 HellaSwag: 88.33
    MMLU: 65.24 TruthfulQA: 70.73 Winogrande: 80.98 GSM8K: 62.77'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 'T: ğŸŸ¦ æ¨¡å‹ï¼šCultriX/MistralTrix-v1 ğŸ“‘ å¹³å‡å€¼ï¼š73.39 ARCï¼š72.27 HellaSwagï¼š88.33 MMLUï¼š65.24
    TruthfulQAï¼š70.73 Winograndeï¼š80.98 GSM8Kï¼š62.77'
- en: '[](#editdisclaimer)Edit/Disclaimer:'
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '[](#editdisclaimer)ç¼–è¾‘/å…è´£å£°æ˜ï¼š'
- en: 'Currently the #1 ranked 7B LLM on the LLM Leaderboards, woah! I did not expect
    that result at all and am in no way a professional when it comes to LLM''s or
    computer science in general, just a guy that likes to nerd about and tinker around.'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®å‰åœ¨ LLM æ’è¡Œæ¦œä¸Šæ’åç¬¬ä¸€çš„ 7B LLMï¼Œå“‡ï¼æˆ‘æ ¹æœ¬æ²¡æƒ³åˆ°ä¼šæœ‰è¿™æ ·çš„ç»“æœï¼Œè€Œä¸”åœ¨ LLM æˆ–è€…è®¡ç®—æœºç§‘å­¦æ–¹é¢æˆ‘å®Œå…¨ä¸æ˜¯ä¸“ä¸šçš„ï¼Œåªæ˜¯ä¸€ä¸ªå–œæ¬¢ç ”ç©¶å’Œæ‘†å¼„çš„å®¶ä¼™ã€‚
- en: 'For those wondering how I achieved this, the answer is that I simply attempted
    to apply the techniques outlined in this amazing article myself: [https://towardsdatascience.com/fine-tune-a-mistral-7b-model-with-direct-preference-optimization-708042745aac](https://towardsdatascience.com/fine-tune-a-mistral-7b-model-with-direct-preference-optimization-708042745aac)
    Therefore, all credit basically goes to the guy who wrote that. He offers the
    exact Colab notebook I used to train this model for free, as well as a really
    nice GitHub page I hope he doesn''t mind me sharing: [https://github.com/mlabonne/llm-course/](https://github.com/mlabonne/llm-course/)
    So huge thank you to him for sharing his knowledge and learning me a thing or
    two in the process!'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹äºé‚£äº›æƒ³çŸ¥é“æˆ‘æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹çš„äººï¼Œç­”æ¡ˆå°±æ˜¯æˆ‘ç®€å•åœ°å°è¯•äº†è‡ªå·±åœ¨è¿™ç¯‡ç²¾å½©æ–‡ç« ä¸­æ¦‚è¿°çš„æŠ€æœ¯ï¼š[https://towardsdatascience.com/fine-tune-a-mistral-7b-model-with-direct-preference-optimization-708042745aac](https://towardsdatascience.com/fine-tune-a-mistral-7b-model-with-direct-preference-optimization-708042745aac)
    å› æ­¤ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„åŠŸåŠ³éƒ½å½’åŠŸäºé‚£ä¸ªå†™è¿™ç¯‡æ–‡ç« çš„å®¶ä¼™ã€‚ä»–æä¾›äº†æˆ‘ç”¨æ¥è®­ç»ƒè¿™ä¸ªæ¨¡å‹çš„ç¡®åˆ‡ Colab ç¬”è®°æœ¬ï¼Œä»¥åŠä¸€ä¸ªéå¸¸å¥½çš„ GitHub é¡µé¢ï¼Œæˆ‘å¸Œæœ›ä»–ä¸ä»‹æ„æˆ‘åˆ†äº«ï¼š[https://github.com/mlabonne/llm-course/](https://github.com/mlabonne/llm-course/)
    æ‰€ä»¥éå¸¸æ„Ÿè°¢ä»–åˆ†äº«ä»–çš„çŸ¥è¯†ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ•™äº†æˆ‘ä¸€ä¸¤ä»¶äº‹æƒ…ï¼
- en: '[](#gguf)GGUF'
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '[](#gguf)GGUF'
- en: 'I attempted to quantisize the model myself, which again I pretty much have
    no clue about, but it seems to run fine for me when I test them: [https://huggingface.co/CultriX/MistralTrix-v1-GGUF](https://huggingface.co/CultriX/MistralTrix-v1-GGUF)'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘å°è¯•äº†è‡ªå·±é‡åŒ–æ¨¡å‹ï¼Œå†æ¬¡å¼ºè°ƒï¼Œæˆ‘å¯¹æ­¤å‡ ä¹ä¸€æ— æ‰€çŸ¥ï¼Œä½†å½“æˆ‘æµ‹è¯•å®ƒä»¬æ—¶ï¼Œå®ƒä»¬ä¼¼ä¹è¿è¡Œè‰¯å¥½ï¼š[https://huggingface.co/CultriX/MistralTrix-v1-GGUF](https://huggingface.co/CultriX/MistralTrix-v1-GGUF)
- en: 'I''ll say it one more time though: "I am a complete beginner to all of this,
    so if these do end up sucking don''t be surprised."'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸è¿‡ï¼Œæˆ‘è¦å†è¯´ä¸€æ¬¡ï¼šâ€œæˆ‘å¯¹è¿™ä¸€åˆ‡å®Œå…¨æ˜¯ä¸ªæ–°æ‰‹ï¼Œæ‰€ä»¥å¦‚æœè¿™äº›ç»“æœä¸å¥½åˆ«æ„Ÿåˆ°æƒŠè®¶ã€‚â€
- en: You have been warned :)
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: ä½ å·²ç»è¢«è­¦å‘Šäº† :)
- en: '[](#description)Description:'
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '[](#description)æè¿°ï¼š'
- en: (trained on a single Colab GPU in less than a few hours)
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: ï¼ˆåœ¨å•ä¸ª Colab GPU ä¸Šè®­ç»ƒï¼Œä¸åˆ°å‡ ä¸ªå°æ—¶ï¼‰
- en: MistralTrix-v1 is an zyh3826/GML-Mistral-merged-v1 model that has been further
    fine-tuned with Direct Preference Optimization (DPO) using Intel's dataset for
    neural-chat-7b-v3-1. It surpasses the original model on several benchmarks (see
    results).
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: MistralTrix-v1 æ˜¯ä¸€ä¸ª zyh3826/GML-Mistral-merged-v1 æ¨¡å‹ï¼Œç»è¿‡ä½¿ç”¨ Intel çš„æ•°æ®é›†è¿›è¡Œäº†è¿›ä¸€æ­¥çš„ç›´æ¥åå¥½ä¼˜åŒ–ï¼ˆDPOï¼‰
    fine-tuneã€‚å®ƒåœ¨å‡ ä¸ªåŸºå‡†æµ‹è¯•ä¸­è¶…è¶Šäº†åŸå§‹æ¨¡å‹ï¼ˆå‚è§ç»“æœï¼‰ã€‚
- en: It is directly inspired by the RLHF process described by Intel/neural-chat-7b-v3-1's
    authors to improve performance. I used the same dataset and reformatted it to
    apply the ChatML template.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: å®ƒç›´æ¥å—åˆ°äº† Intel/neural-chat-7b-v3-1 çš„ä½œè€…æè¿°çš„ RLHF è¿‡ç¨‹çš„å¯å‘ï¼Œä»¥æé«˜æ€§èƒ½ã€‚æˆ‘ä½¿ç”¨äº†ç›¸åŒçš„æ•°æ®é›†ï¼Œå¹¶é‡æ–°æ ¼å¼åŒ–äº†å®ƒä»¥åº”ç”¨
    ChatML æ¨¡æ¿ã€‚
- en: The code to train this model is available on Google Colab and GitHub. Fine-tuning
    took about an hour on Google Colab A-1000 GPU with 40GB VRAM.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: è®­ç»ƒæ­¤æ¨¡å‹çš„ä»£ç å¯åœ¨ Google Colab å’Œ GitHub ä¸Šè·å¾—ã€‚åœ¨ Google Colab A-1000 GPU ä¸Šï¼Œä½¿ç”¨ 40GB VRAM
    çš„ fine-tuning å¤§çº¦éœ€è¦ä¸€ä¸ªå°æ—¶ã€‚
- en: '[](#training-specifications)TRAINING SPECIFICATIONS'
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '[](#training-specifications)è®­ç»ƒè§„èŒƒ'
- en: LoRA configuration peft_config = LoraConfig( r=16, lora_alpha=16, lora_dropout=0.05,
    bias="none", task_type="CAUSAL_LM", target_modules=['k_proj', 'gate_proj', 'v_proj',
    'up_proj', 'q_proj', 'o_proj', 'down_proj'] )
  id: totrans-23
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: LoRA é…ç½® peft_config = LoraConfig( r=16, lora_alpha=16, lora_dropout=0.05, bias="none",
    task_type="CAUSAL_LM", target_modules=['k_proj', 'gate_proj', 'v_proj', 'up_proj',
    'q_proj', 'o_proj', 'down_proj'] )
- en: Model to fine-tune model = AutoModelForCausalLM.from_pretrained( model_name,
    torch_dtype=torch.float16, load_in_4bit=True ) model.config.use_cache = False
  id: totrans-24
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: é€šè¿‡ä»¥ä¸‹ä»£ç  fine-tune æ¨¡å‹ï¼š`AutoModelForCausalLM.from_pretrained( model_name, torch_dtype=torch.float16,
    load_in_4bit=True )`ï¼Œ`model.config.use_cache = False`
- en: Reference model ref_model = AutoModelForCausalLM.from_pretrained( model_name,
    torch_dtype=torch.float16, load_in_4bit=True )
  id: totrans-25
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: å‚è€ƒæ¨¡å‹ ref_model = AutoModelForCausalLM.from_pretrained( model_name, torch_dtype=torch.float16,
    load_in_4bit=True )
- en: Training arguments training_args = TrainingArguments( per_device_train_batch_size=4,
    gradient_accumulation_steps=4, gradient_checkpointing=True, learning_rate=5e-5,
    lr_scheduler_type="cosine", max_steps=200, save_strategy="no", logging_steps=1,
    output_dir=new_model, optim="paged_adamw_32bit", warmup_steps=100, bf16=True,
    report_to="wandb", )
  id: totrans-26
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: è®­ç»ƒå‚æ•° training_args = TrainingArguments( per_device_train_batch_size=4, gradient_accumulation_steps=4,
    gradient_checkpointing=True, learning_rate=5e-5, lr_scheduler_type="cosine", max_steps=200,
    save_strategy="no", logging_steps=1, output_dir=new_model, optim="paged_adamw_32bit",
    warmup_steps=100, bf16=True, report_to="wandb", )
- en: Create DPO trainer dpo_trainer = DPOTrainer( model, ref_model, args=training_args,
    train_dataset=dataset, tokenizer=tokenizer, peft_config=peft_config, beta=0.1,
    max_prompt_length=1024, max_length=1536, )
  id: totrans-27
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åˆ›å»º DPO è®­ç»ƒå™¨ dpo_trainer = DPOTrainer( model, ref_model, args=training_args, train_dataset=dataset,
    tokenizer=tokenizer, peft_config=peft_config, beta=0.1, max_prompt_length=1024,
    max_length=1536, )
