["```\n$ cd gifty  # change to app directory\n$ fly storage create --public\n? Choose a name, use the default, or leave blank to generate one:\n    test-gifty-registry-images\nYour Tigris project (test-gifty-registry-images) is ready. See details and\nnext steps with: https://fly.io/docs/reference/tigris/\n\nSetting the following secrets on gifty:\nBUCKET_NAME\nAWS_ENDPOINT_URL_S3\nAWS_ACCESS_KEY_ID\nAWS_SECRET_ACCESS_KEY\nAWS_REGION\n\nUpdating existing machines in 'gifty' with rolling strategy\n\n-------\n âœ” Machine 4d89601c6e9487 [app] update succeeded\n-------\nChecking DNS configuration for gifty.fly.dev \n```", "```\n$ cd ..  # change out of app directory\n$ fly storage create --public --org ben-hoyt --name test-gifty-registry-images2\nYour Tigris project (test-gifty-registry-images2) is ready. See details and\nnext steps with: https://fly.io/docs/reference/tigris/\n\nSet one or more of the following secrets on your target app.\nAWS_REGION: auto\nBUCKET_NAME: test-gifty-registry-images2\nAWS_ENDPOINT_URL_S3: https://fly.storage.tigris.dev\nAWS_ACCESS_KEY_ID: ***hidden***\nAWS_SECRET_ACCESS_KEY: ***hidden*** \n```", "```\ncfg := aws.NewConfig().WithCredentials(creds).WithRegion(region) \n```", "```\nendpoint := os.Getenv(\"GIFTY_S3_BACKUP_ENDPOINT\")\nif endpoint != \"\" {\n\tcfg = cfg.WithEndpoint(endpoint)\n} \n```", "```\n// Add content-based hash to filename to break caching (12 hex digits).\nhash := sha1.New()\n_, _ = hash.Write(data)\nkey := fmt.Sprintf(\"%d-%x.jpg\", registry.ID, hash.Sum(nil)[:6]) \n```", "```\n// Old version\npath := fmt.Sprintf(\"https://%s.s3-%s.amazonaws.com/%s\",\n    h.config.S3ImageBucket, h.config.S3ImageRegion, key)\n\n// New version; under Tigris, I set S3ImageURLFormat to\n// \"https://fly.storage.tigris.dev/gifty-registry-images/%[1]s\"\npath := fmt.Sprintf(h.config.S3ImageURLFormat, key) \n```", "```\n# Copy the user-uploaded images\n$ mkdir gifty-registry-images\n$ cd gifty-registry-images\n$ aws s3 sync s3://gifty-registry-images .\n...\n$ aws s3 sync . s3://gifty-registry-images --profile gifty-registry-images\n...\n\n# Copy the backup files\n$ cd ..\n$ mkdir gifty-backup\n$ cd gifty-backup\n$ aws s3 sync s3://gifty-backup .\n...\n$ aws s3 sync . s3://gifty-backup --profile gifty-backup\n... \n```", "```\n-- First check how many S3 image URLs there are\nsqlite> SELECT count(*) FROM registry\n        WHERE image_url LIKE 'https://gifty-registry-images.s3%';\n389\n\n-- Perform the update\nsqlite> UPDATE registry SET image_url = replace(image_url,\n        \t'https://gifty-registry-images.s3-us-west-1.amazonaws.com/',\n        \t'https://fly.storage.tigris.dev/gifty-registry-images/')\n        WHERE image_url LIKE 'https://gifty-registry-images.s3%';\n\n-- Ensure there are no more S3 URLs\nsqlite> SELECT count(*) FROM registry\n        WHERE image_url LIKE 'https://gifty-registry-images.s3%';\n0 \n```"]