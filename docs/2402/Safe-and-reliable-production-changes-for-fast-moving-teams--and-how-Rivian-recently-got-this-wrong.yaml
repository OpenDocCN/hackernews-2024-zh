- en: <!--yml
  id: totrans-split-0
  prefs: []
  type: TYPE_NORMAL
  zh: <!--yml
- en: 'category: æœªåˆ†ç±»'
  id: totrans-split-1
  prefs: []
  type: TYPE_NORMAL
  zh: 'category: æœªåˆ†ç±»'
- en: 'date: 2024-05-27 14:52:45'
  id: totrans-split-2
  prefs: []
  type: TYPE_NORMAL
  zh: 'date: 2024-05-27 14:52:45'
- en: -->
  id: totrans-split-3
  prefs: []
  type: TYPE_NORMAL
  zh: -->
- en: Safe and reliable production changes for fast moving teams; and how Rivian recently
    got this wrong
  id: totrans-split-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å¿«é€Ÿç§»åŠ¨å›¢é˜Ÿçš„å®‰å…¨å¯é ç”Ÿäº§å˜æ›´ï¼›ä»¥åŠRivianæœ€è¿‘å¦‚ä½•åšé”™äº†è¿™ä¸€ç‚¹
- en: æ¥æºï¼š[https://blog.substrate.tools/safe-and-reliable-production-changes-for-fast-moving-teams-and-how-rivian-recently-got-this-wrong/](https://blog.substrate.tools/safe-and-reliable-production-changes-for-fast-moving-teams-and-how-rivian-recently-got-this-wrong/)
  id: totrans-split-5
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: æ¥æºï¼š[https://blog.substrate.tools/safe-and-reliable-production-changes-for-fast-moving-teams-and-how-rivian-recently-got-this-wrong/](https://blog.substrate.tools/safe-and-reliable-production-changes-for-fast-moving-teams-and-how-rivian-recently-got-this-wrong/)
- en: Changing production infrastructure can be scary because we donâ€™t want to break
    things for customers, mistakes happen, and there can be many unknowns.
  id: totrans-split-6
  prefs: []
  type: TYPE_NORMAL
  zh: æ›´æ”¹ç”Ÿäº§åŸºç¡€è®¾æ–½å¯èƒ½ä»¤äººæ‹…å¿§ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›ä¸ºå®¢æˆ·å¼•å‘é—®é¢˜ï¼Œé”™è¯¯ä¼šå‘ç”Ÿï¼Œä¸”å¯èƒ½å­˜åœ¨è®¸å¤šæœªçŸ¥å› ç´ ã€‚
- en: In this post Iâ€™ll be discussing a recent over-the-air (OTA) software update
    to Rivian vehicles that went badly. It is speculative; I have no insider knowledge
    of Rivianâ€™s software, systems or practices. However, I do have over 20 years experience
    building, operating and leading teams who build and operate scalable and reliable
    online systems at companies such as Square, Segment and Confluent.
  id: totrans-split-7
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†è®¨è®ºæœ€è¿‘å¯¹Rivianè½¦è¾†è¿›è¡Œçš„ä¸€æ¬¡ç©ºä¸­ï¼ˆOTAï¼‰è½¯ä»¶æ›´æ–°ï¼Œæƒ…å†µå¹¶ä¸ä¹è§‚ã€‚è¿™åªæ˜¯æ¨æµ‹æ€§çš„ï¼›æˆ‘å¯¹Riviançš„è½¯ä»¶ã€ç³»ç»Ÿæˆ–å®è·µæ²¡æœ‰å†…éƒ¨çŸ¥è¯†ã€‚ä½†æ˜¯ï¼Œæˆ‘åœ¨Squareã€Segmentå’ŒConfluentç­‰å…¬å¸æ‹¥æœ‰è¶…è¿‡20å¹´çš„æ„å»ºã€è¿è¥å’Œé¢†å¯¼å›¢é˜Ÿçš„åœ¨çº¿ç³»ç»Ÿç»éªŒã€‚
- en: Iâ€™ve long been a car nerd, too, and modern vehicles, especially EVs are an exciting
    confluence of cars and technology, with software taking an ever greater role in
    the function and experience of the vehicles. I think Tesla and Rivian are doing
    the most to push the state of the art forward in automotive software. I pay particularly
    close attention to whatâ€™s happening with Rivian because thatâ€™s what I drive.
  id: totrans-split-8
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘é•¿æœŸä»¥æ¥ä¹Ÿæ˜¯ä¸€ä¸ªæ±½è½¦è¿·ï¼Œç‰¹åˆ«æ˜¯ç°ä»£è½¦è¾†ï¼Œå°¤å…¶æ˜¯ç”µåŠ¨è½¦ï¼Œæ˜¯æ±½è½¦å’ŒæŠ€æœ¯çš„æ¿€åŠ¨äººå¿ƒçš„äº¤æ±‡ç‚¹ï¼Œè½¯ä»¶åœ¨è½¦è¾†åŠŸèƒ½å’Œä½“éªŒä¸­æ‰®æ¼”ç€è¶Šæ¥è¶Šé‡è¦çš„è§’è‰²ã€‚æˆ‘è®¤ä¸ºç‰¹æ–¯æ‹‰å’ŒRivianåœ¨æ¨åŠ¨æ±½è½¦è½¯ä»¶æŠ€æœ¯çš„å‰æ²¿æ–¹é¢åšå¾—æœ€å¤šã€‚æˆ‘ç‰¹åˆ«å…³æ³¨Riviançš„åŠ¨æ€ï¼Œå› ä¸ºé‚£æ˜¯æˆ‘é©¾é©¶çš„è½¦è¾†ã€‚
- en: I think a very similar methodology can apply to both Rivianâ€™s fleets of cars
    and our large-scale cloud services for doing safe rollouts of changes to a production
    environment serving customers.
  id: totrans-split-9
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘è®¤ä¸ºéå¸¸ç±»ä¼¼çš„æ–¹æ³•å¯ä»¥åŒæ—¶é€‚ç”¨äºRiviançš„è½¦é˜Ÿå’Œæˆ‘ä»¬çš„å¤§è§„æ¨¡äº‘æœåŠ¡ï¼Œä»¥å®‰å…¨åœ°åœ¨ä¸ºå®¢æˆ·æä¾›æœåŠ¡çš„ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²å˜æ›´ã€‚
- en: '**The broken Rivian over-the-air software update**'
  id: totrans-split-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '**ç ´æŸçš„Rivianç©ºä¸­æ›´æ–°è½¯ä»¶**'
- en: On Monday, November 13, 2023, Rivian started rolling out version 2023.42 to
    customer vehicles. [RivianTrackr has a detailed timeline](https://rivian.software/2023-42-timeline/?ref=blog.substrate.tools).
    Typical monthly releases fix bugs, add features, and donâ€™t cause much drama. This
    one did not go so well.
  id: totrans-split-11
  prefs: []
  type: TYPE_NORMAL
  zh: 2023å¹´11æœˆ13æ—¥æ˜ŸæœŸä¸€ï¼ŒRivianå¼€å§‹å‘å®¢æˆ·è½¦è¾†æ¨é€2023.42ç‰ˆæœ¬ã€‚[RivianTrackræœ‰è¯¦ç»†çš„æ—¶é—´è¡¨](https://rivian.software/2023-42-timeline/?ref=blog.substrate.tools)ã€‚å…¸å‹çš„æ¯æœˆå‘å¸ƒç‰ˆæœ¬ç”¨äºä¿®å¤é”™è¯¯ï¼Œæ·»åŠ åŠŸèƒ½ï¼Œå¹¶ä¸”é€šå¸¸ä¸ä¼šå¼•èµ·å¤ªå¤šæ³¢åŠ¨ã€‚ä½†è¿™ä¸€æ¬¡æƒ…å†µå¹¶éå¦‚æ­¤ã€‚
- en: Roughly 3% of vehicles received this update which put their infotainment screen
    into a reboot loop. While the vehicles were still drivable, many of the controls
    were unavailable for several days while Rivian worked on a fix. Many Rivian owners
    (and I think Rivian themselves) worried they might have to visit a service center
    for a fix. Fortunately, Rivian was able to fix it with another over-the-air update
    after several days.
  id: totrans-split-12
  prefs: []
  type: TYPE_NORMAL
  zh: å¤§çº¦æœ‰3%çš„è½¦è¾†æ”¶åˆ°äº†è¿™ä¸ªæ›´æ–°ï¼Œå¯¼è‡´å®ƒä»¬çš„ä¿¡æ¯å¨±ä¹å±å¹•è¿›å…¥äº†ä¸€ä¸ªé‡å¯å¾ªç¯ã€‚è™½ç„¶è¿™äº›è½¦è¾†ä»ç„¶å¯é©¾é©¶ï¼Œä½†è®¸å¤šæ§åˆ¶åŠŸèƒ½åœ¨RivianåŠªåŠ›ä¿®å¤æœŸé—´å‡ å¤©å†…ä¸å¯ç”¨ã€‚è®¸å¤šRivianè½¦ä¸»ï¼ˆæˆ‘è®¤ä¸ºRivianè‡ªå·±ä¹Ÿæ˜¯ï¼‰æ‹…å¿ƒä»–ä»¬å¯èƒ½éœ€è¦å»æœåŠ¡ä¸­å¿ƒè¿›è¡Œä¿®å¤ã€‚å¹¸è¿çš„æ˜¯ï¼Œå‡ å¤©åï¼ŒRiviané€šè¿‡å¦ä¸€ä¸ªç©ºä¸­æ›´æ–°æˆåŠŸè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚
- en: '**Process and Design Flaws**'
  id: totrans-split-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '**è¿‡ç¨‹å’Œè®¾è®¡ç¼ºé™·**'
- en: Rivian appears to make updates available to customers a few at a time, as visualized
    on [electraFiâ€™s](https://electrafi.com/firmwareRivian?ref=blog.substrate.tools)
    Rivian dashboard. These over-the-air updates come approximately monthly, with
    about two weeks of internal testing before starting a phased rollout to customer
    vehicles.
  id: totrans-split-14
  prefs: []
  type: TYPE_NORMAL
  zh: Rivianä¼¼ä¹ä¼šå°†æ›´æ–°é€æ­¥æ¨é€ç»™å®¢æˆ·ï¼Œå¦‚åœ¨[electraFi](https://electrafi.com/firmwareRivian?ref=blog.substrate.tools)çš„Rivianä»ªè¡¨æ¿ä¸Šå¯è§†åŒ–æ˜¾ç¤ºã€‚è¿™äº›ç©ºä¸­æ›´æ–°å¤§çº¦æ¯æœˆè¿›è¡Œä¸€æ¬¡ï¼Œåœ¨å¼€å§‹å‘å®¢æˆ·è½¦è¾†é€æ­¥æ¨é€ä¹‹å‰ï¼Œä¼šè¿›è¡Œå¤§çº¦ä¸¤å‘¨çš„å†…éƒ¨æµ‹è¯•ã€‚
- en: Thanks to these practices, Rivian caught this issue when it was released to
    about 3% of vehicles. But thatâ€™s still around 2,000 vehicles. 2,000 customers.
  id: totrans-split-15
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äºè¿™äº›åšæ³•ï¼ŒRivianåœ¨å‘å¸ƒç»™å¤§çº¦3%çš„è½¦è¾†æ—¶å°±å‘ç°äº†è¿™ä¸ªé—®é¢˜ã€‚ä½†è¿™ä»ç„¶å½±å“äº†çº¦2,000è¾†è½¦ï¼Œ2,000åå®¢æˆ·ã€‚
- en: Rivian could borrow some pages from the web operations playbook to improve their
    process and protect their customers from many such issues in the future..
  id: totrans-split-16
  prefs: []
  type: TYPE_NORMAL
  zh: Rivian å¯ä»¥å€Ÿé‰´ Web è¿ç»´æ‰‹å†Œçš„ä¸€äº›é¡µé¢ï¼Œæ”¹è¿›ä»–ä»¬çš„æµç¨‹ï¼Œå¹¶ä¿æŠ¤ä»–ä»¬çš„å®¢æˆ·å…å—æœªæ¥è®¸å¤šç±»ä¼¼é—®é¢˜çš„å½±å“ã€‚
- en: '**Canary Deploys**'
  id: totrans-split-17
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**è¯•ç‚¹éƒ¨ç½²**'
- en: With the botched 2023.42 update [Rivian explained](https://www.reddit.com/r/Rivian/comments/17usikn/202342_ota_update_issue/?ref=blog.substrate.tools)
    that they pushed the wrong build with the wrong certificates to customer vehicles.
    This made me immediately think they *probably* donâ€™t have a canary fleet of vehicles
    that they roll out to first.
  id: totrans-split-18
  prefs: []
  type: TYPE_NORMAL
  zh: éšç€ 2023.42 ç‰ˆæœ¬çš„å¤±è´¥æ›´æ–° [Rivian è§£é‡Š](https://www.reddit.com/r/Rivian/comments/17usikn/202342_ota_update_issue/?ref=blog.substrate.tools)ï¼Œä»–ä»¬å‘å®¢æˆ·è½¦è¾†æ¨é€äº†é”™è¯¯çš„æ„å»ºå’Œé”™è¯¯çš„è¯ä¹¦ã€‚è¿™è®©æˆ‘ç«‹å³æƒ³åˆ°ä»–ä»¬*å¯èƒ½*æ²¡æœ‰ä¸€ä¸ªé¦–å…ˆæ¨å¹¿ç»™è¯•ç‚¹è½¦é˜Ÿçš„æªæ–½ã€‚
- en: It seems like they have a beta fleet that is Rivian owned and Rivian employee
    owned vehicles. These have the ability to validate their beta certificates and
    get the new releases before customer vehicles. There must be some process where
    they enroll a vehicle in the beta program. Iâ€™m assuming this is similar to Appleâ€™s
    beta program where you have to install a set of certificates to enroll and validate
    beta builds. Production (customer vehicles) canâ€™t validate those certificates.
    So when a beta build got pushed to them, it put the infotainment in a reboot loop.
  id: totrans-split-19
  prefs: []
  type: TYPE_NORMAL
  zh: çœ‹èµ·æ¥ä»–ä»¬æœ‰ä¸€ä¸ªæµ‹è¯•è½¦é˜Ÿï¼ŒåŒ…æ‹¬ Rivian æ‹¥æœ‰çš„è½¦è¾†å’Œå‘˜å·¥æ‹¥æœ‰çš„è½¦è¾†ã€‚è¿™äº›è½¦è¾†æœ‰èƒ½åŠ›éªŒè¯å®ƒä»¬çš„æµ‹è¯•è¯ä¹¦ï¼Œå¹¶åœ¨å®¢æˆ·è½¦è¾†ä¹‹å‰è·å–æ–°çš„å‘å¸ƒç‰ˆæœ¬ã€‚ä»–ä»¬å¿…é¡»æœ‰ä¸€ä¸ªæµç¨‹ï¼Œå…¶ä¸­ä»–ä»¬å°†è½¦è¾†æ³¨å†Œåˆ°æµ‹è¯•è®¡åˆ’ä¸­ã€‚æˆ‘å‡è®¾è¿™ä¸
    Apple çš„æµ‹è¯•è®¡åˆ’ç±»ä¼¼ï¼Œæ‚¨å¿…é¡»å®‰è£…ä¸€ç»„è¯ä¹¦æ¥æ³¨å†Œå’ŒéªŒè¯æµ‹è¯•ç‰ˆæœ¬ã€‚ç”Ÿäº§è½¦è¾†ï¼ˆå®¢æˆ·è½¦è¾†ï¼‰æ— æ³•éªŒè¯è¿™äº›è¯ä¹¦ã€‚æ‰€ä»¥å½“æµ‹è¯•ç‰ˆæœ¬è¢«æ¨é€åˆ°å®ƒä»¬æ—¶ï¼Œè¿™å¯¼è‡´äº†ä¿¡æ¯å¨±ä¹ç³»ç»Ÿé™·å…¥é‡å¯å¾ªç¯ã€‚
- en: If Rivian had a canary fleet of even a single vehicle that had never run a beta
    build, it would have failed the update, and they could have caught this issue
    before it hit customers. There are plenty of problems that only happen in certain
    conditions that canary deploys donâ€™t catch. But I think this particular problem
    could have been caught immediately with a small canary fleet.
  id: totrans-split-20
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœ Rivian æœ‰ä¸€ä¸ªå°å‹çš„è¯•ç‚¹è½¦é˜Ÿï¼Œç”šè‡³åªæœ‰ä¸€è¾†ä»æœªè¿è¡Œè¿‡æµ‹è¯•ç‰ˆæœ¬çš„è½¦è¾†ï¼Œå®ƒä»¬æœ¬å¯ä»¥å‘ç°è¿™ä¸ªé—®é¢˜ï¼Œç„¶åæ‰ä¼šå½±å“åˆ°å®¢æˆ·ã€‚æœ‰è®¸å¤šåªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰ä¼šå‡ºç°çš„é—®é¢˜ï¼Œè€Œè¯•ç‚¹éƒ¨ç½²åˆ™æ— æ³•æ•æ‰åˆ°ã€‚ä½†æˆ‘è®¤ä¸ºè¿™ä¸ªç‰¹å®šé—®é¢˜å¯ä»¥é€šè¿‡ä¸€ä¸ªå°å‹çš„è¯•ç‚¹è½¦é˜Ÿç«‹å³æ•æ‰åˆ°ã€‚
- en: '**Pre-flight checks**'
  id: totrans-split-21
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**é¢„æ£€ç¨‹åº**'
- en: The next problem was that Rivian vehicles downloaded and installed the update
    without validating it first. They seemed to do a full install and then fail at
    90%, which leads me to believe they donâ€™t do the certificate validation until
    the new OS image is booting. This seems like a very unfortunate design decision.
    Reliable systems should have a pre-flight check that aborts any change if certain
    health conditions are not met. In this case Rivian vehicles could have downloaded
    the new OS image, tried to validate the certificates and then aborted the install
    when the validation failed. They could then send telemetry back to Rivian so the
    engineers operating the rollout would have quickly seen their mistake and the
    customer inconvenience could have been little more than a message about the failed
    update, and asking them to try again later.
  id: totrans-split-22
  prefs: []
  type: TYPE_NORMAL
  zh: Rivian çš„ä¸‹ä¸€ä¸ªé—®é¢˜æ˜¯å…¶è½¦è¾†ä¸‹è½½å¹¶å®‰è£…æ›´æ–°æ—¶æœªè¿›è¡ŒéªŒè¯ã€‚å®ƒä»¬ä¼¼ä¹å®Œæˆäº†å…¨é¢å®‰è£…ï¼Œä½†åœ¨ 90% å¤„å¤±è´¥ï¼Œè¿™è®©æˆ‘è®¤ä¸ºå®ƒä»¬ç›´åˆ°æ–°æ“ä½œç³»ç»Ÿé•œåƒå¯åŠ¨åæ‰è¿›è¡Œè¯ä¹¦éªŒè¯ã€‚è¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªéå¸¸ä¸å¹¸çš„è®¾è®¡å†³å®šã€‚å¯é çš„ç³»ç»Ÿåº”è¯¥æœ‰ä¸€ä¸ªé¢„æ£€ç¨‹åºï¼Œåœ¨æŸäº›å¥åº·æ¡ä»¶ä¸æ»¡è¶³æ—¶ä¸­æ­¢ä»»ä½•æ›´æ”¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒRivian
    çš„è½¦è¾†æœ¬å¯ä»¥ä¸‹è½½æ–°çš„æ“ä½œç³»ç»Ÿé•œåƒï¼Œå°è¯•éªŒè¯è¯ä¹¦ï¼Œç„¶ååœ¨éªŒè¯å¤±è´¥æ—¶ä¸­æ­¢å®‰è£…ã€‚ç„¶åå®ƒä»¬å¯ä»¥å‘ Rivian å‘é€é¥æµ‹æ•°æ®ï¼Œä»¥ä¾¿æ“ä½œéƒ¨ç½²çš„å·¥ç¨‹å¸ˆä»¬èƒ½å¤Ÿè¿…é€Ÿå‘ç°ä»–ä»¬çš„é”™è¯¯ï¼Œå®¢æˆ·çš„ä¸ä¾¿å¯èƒ½åªæ˜¯ä¸€æ¡å…³äºæ›´æ–°å¤±è´¥çš„æ¶ˆæ¯ï¼Œå¹¶è¦æ±‚ä»–ä»¬ç¨åé‡è¯•ã€‚
- en: Again, you canâ€™t account for every possible problem in a pre-flight check. But
    validating the certificate of an OS image is about the most fundamental check
    you could do, second only to ensuring the downloaded image matches a known checksum.
  id: totrans-split-23
  prefs: []
  type: TYPE_NORMAL
  zh: å†æ¬¡å¼ºè°ƒï¼Œæ— æ³•åœ¨é¢„æ£€ç¨‹åºä¸­è€ƒè™‘åˆ°æ¯ä¸€ä¸ªå¯èƒ½çš„é—®é¢˜ã€‚ä½†éªŒè¯æ“ä½œç³»ç»Ÿé•œåƒçš„è¯ä¹¦æ˜¯æ‚¨å¯ä»¥è¿›è¡Œçš„æœ€åŸºæœ¬çš„æ£€æŸ¥ä¹‹ä¸€ï¼Œä»…æ¬¡äºç¡®ä¿ä¸‹è½½çš„é•œåƒä¸å·²çŸ¥çš„æ ¡éªŒå’ŒåŒ¹é…ã€‚
- en: '**Rollbacks**'
  id: totrans-split-24
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**å›æ»šæœºåˆ¶**'
- en: Finally, Iâ€™m surprised that Rivian doesnâ€™t have any kind of automatic rollback
    mechanism in place for a failed update. Itâ€™s pretty common for things like enterprise
    routers and switches and various embedded systems to keep the last known good
    OS image. If the new OS fails to boot, the system will auto-rollback to the last
    known good image.
  id: totrans-split-25
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œæˆ‘å¯¹ Rivian æ²¡æœ‰ä»»ä½•å¤±è´¥æ›´æ–°çš„è‡ªåŠ¨å›æ»šæœºåˆ¶æ„Ÿåˆ°æƒŠè®¶ã€‚åƒä¼ä¸šè·¯ç”±å™¨ã€äº¤æ¢æœºå’Œå„ç§åµŒå…¥å¼ç³»ç»Ÿä¸€æ ·ï¼Œä¿ç•™ä¸Šæ¬¡å·²çŸ¥çš„è‰¯å¥½æ“ä½œç³»ç»Ÿé•œåƒæ˜¯ç›¸å½“æ™®éçš„ã€‚å¦‚æœæ–°çš„æ“ä½œç³»ç»Ÿæ— æ³•å¯åŠ¨ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨å›æ»šåˆ°ä¸Šæ¬¡å·²çŸ¥çš„è‰¯å¥½é•œåƒã€‚
- en: This is especially important for devices that are deployed in locations that
    are hard to get to for repair or devices that require higher uptime than any time
    to repair. To me it seems like having roughly 75,000 vehicles all over the US,
    some with customers who may not have a backup vehicle means the time to repair
    is long, and the uptime requirements are high.
  id: totrans-split-26
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹äºéƒ¨ç½²åœ¨éš¾ä»¥ç»´ä¿®çš„ä½ç½®æˆ–éœ€è¦æ¯”ä»»ä½•ç»´ä¿®æ—¶é—´æ›´é«˜æ­£å¸¸è¿è¡Œæ—¶é—´çš„è®¾å¤‡æ¥è¯´ï¼Œè¿™å°¤ä¸ºé‡è¦ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œçœ‹èµ·æ¥å¥½åƒåœ¨ç¾å›½å„åœ°éƒ¨ç½²äº†å¤§çº¦ 75,000 è¾†è½¦ï¼Œå…¶ä¸­ä¸€äº›å®¢æˆ·å¯èƒ½æ²¡æœ‰å¤‡ç”¨è½¦è¾†æ„å‘³ç€ç»´ä¿®æ—¶é—´å¾ˆé•¿ï¼Œè€Œæ­£å¸¸è¿è¡Œæ—¶é—´è¦æ±‚å¾ˆé«˜ã€‚
- en: '**No one root cause**'
  id: totrans-split-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '**æ²¡æœ‰å•ä¸€æ ¹æœ¬åŸå› **'
- en: 'We often like to talk about the â€˜root causeâ€™ of a problem, as if there is a
    single mistake, bug or design flaw that caused the problem to happen. Then we
    can identify that issue, fix or prevent it, and move on. In Rivianâ€™s [limited
    communications](https://www.reddit.com/r/Rivian/comments/17usikn/202342_ota_update_issue/?ref=blog.substrate.tools)
    about the 2023.42 update issues, [Wassym](https://www.reddit.com/user/WassymRivian?ref=blog.substrate.tools),
    Rivianâ€™s VP of Software Development said: â€œWe made an error with the 2023.42 OTA
    update - a fat finger where the wrong build with the wrong security certificates
    was sent out.â€'
  id: totrans-split-28
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ç»å¸¸å–œæ¬¢è°ˆè®ºé—®é¢˜çš„â€œæ ¹æœ¬åŸå› â€ï¼Œå¥½åƒæ˜¯ä¸€ä¸ªå•ä¸€çš„é”™è¯¯ã€ç¼ºé™·æˆ–è®¾è®¡ç¼ºé™·å¯¼è‡´äº†é—®é¢˜çš„å‘ç”Ÿã€‚ç„¶åæˆ‘ä»¬å¯ä»¥è¯†åˆ«å‡ºè¿™ä¸ªé—®é¢˜ï¼Œä¿®å¤æˆ–é¢„é˜²å®ƒï¼Œç„¶åç»§ç»­å‰è¿›ã€‚åœ¨ Rivian
    å…³äº 2023.42 æ›´æ–°é—®é¢˜çš„ [æœ‰é™é€šè®¯](https://www.reddit.com/r/Rivian/comments/17usikn/202342_ota_update_issue/?ref=blog.substrate.tools)
    ä¸­ï¼Œ[Wassym](https://www.reddit.com/user/WassymRivian?ref=blog.substrate.tools)ï¼ŒRivian
    çš„è½¯ä»¶å¼€å‘å‰¯æ€»è£è¡¨ç¤ºï¼šâ€œæˆ‘ä»¬åœ¨ 2023.42 OTA æ›´æ–°ä¸­çŠ¯äº†ä¸€ä¸ªé”™è¯¯ - ä¸€ä¸ªâ€œè‚¥æ‰‹æŒ‡â€ï¼Œå‘é€äº†é”™è¯¯çš„æ„å»ºå’Œé”™è¯¯çš„å®‰å…¨è¯ä¹¦ã€‚â€
- en: This makes it sound like the root cause was someone typed the wrong thing and
    the wrong build with the wrong certificate went out to a percentage of customer
    vehicles.
  id: totrans-split-29
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™è®©äººè§‰å¾—æ ¹æœ¬åŸå› æ˜¯æœ‰äººè¾“å…¥äº†é”™è¯¯çš„å†…å®¹ï¼Œé”™è¯¯çš„æ„å»ºå’Œé”™è¯¯çš„è¯ä¹¦è¢«å‘é€åˆ°äº†éƒ¨åˆ†å®¢æˆ·è½¦è¾†ã€‚
- en: But in my experience that is rarely how it works in practice. There are usually
    multiple contributing factors that cause a significant customer facing issue or
    outage like the one many Rivian owners experienced.
  id: totrans-split-30
  prefs: []
  type: TYPE_NORMAL
  zh: ä½†æ ¹æ®æˆ‘çš„ç»éªŒï¼Œåœ¨å®è·µä¸­å¾ˆå°‘ä¼šè¿™æ ·ã€‚é€šå¸¸ä¼šæœ‰å¤šä¸ªå› ç´ å¯¼è‡´åƒè®¸å¤š Rivian è½¦ä¸»ç»å†çš„é‡å¤§å®¢æˆ·é¢ä¸´é—®é¢˜æˆ–æ•…éšœã€‚
- en: Iâ€™ve explained 3 process and design problems that I suspect combined to allow
    this problem to happen.
  id: totrans-split-31
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘è§£é‡Šäº†ä¸‰ä¸ªæˆ‘æ€€ç–‘ç»“åˆåœ¨ä¸€èµ·å¯¼è‡´æ­¤é—®é¢˜å‘ç”Ÿçš„è¿‡ç¨‹å’Œè®¾è®¡é—®é¢˜ã€‚
- en: No Canary Deploys
  id: totrans-split-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ²¡æœ‰é‡‘ä¸é›€éƒ¨ç½²
- en: No pre-flight checks
  id: totrans-split-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ²¡æœ‰é¢„é£è¡Œæ£€æŸ¥
- en: No Rollbacks
  id: totrans-split-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ²¡æœ‰å›æ»š
- en: If Rivian had any of the above, they could have significantly mitigated the
    impact of this issue.
  id: totrans-split-35
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœ Rivian æ‹¥æœ‰ä»¥ä¸Šä»»ä½•ä¸€é¡¹ï¼Œä»–ä»¬å¯èƒ½ä¼šæ˜¾è‘—å‡è½»æ­¤é—®é¢˜çš„å½±å“ã€‚
- en: And I havenâ€™t even tried to speculate about what tooling lets someone fat finger
    the deploy to push the wrong build and certificate so the tooling itself might
    be a 4th contributing factor.
  id: totrans-split-36
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ç”šè‡³è¿˜æ²¡æœ‰å°è¯•æ¨æµ‹æ˜¯ä»€ä¹ˆå·¥å…·è®©æŸäººæ‰‹æŒ‡è‚¥èƒ–ï¼Œä»¥ä¾¿éƒ¨ç½²æ¨é€é”™è¯¯çš„æ„å»ºå’Œè¯ä¹¦ï¼Œæ‰€ä»¥å·¥å…·æœ¬èº«å¯èƒ½æ˜¯ç¬¬å››ä¸ªè´¡çŒ®å› ç´ ã€‚
- en: What does this have to do with Cloud systems?
  id: totrans-split-37
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è¿™ä¸äº‘ç³»ç»Ÿæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ
- en: Many of the reliability best practices are the same. With Substrate weâ€™re mostly
    concerned with AWS accounts, IAM roles and VPCs. A multi-account strategy on AWS
    allows changes to progress through multiple pre-production environments and even
    to be served by multiple accounts in production to achieve canary and partial
    deployments.
  id: totrans-split-38
  prefs: []
  type: TYPE_NORMAL
  zh: è®¸å¤šå¯é æ€§æœ€ä½³å®è·µæ˜¯ç›¸åŒçš„ã€‚ä½¿ç”¨ Substrate æ—¶ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨ AWS è´¦æˆ·ã€IAM è§’è‰²å’Œ VPCã€‚AWS ä¸Šçš„å¤šè´¦æˆ·ç­–ç•¥å…è®¸å˜æ›´é€šè¿‡å¤šä¸ªé¢„ç”Ÿäº§ç¯å¢ƒå¹¶ä¸”ç”šè‡³é€šè¿‡å¤šä¸ªç”Ÿäº§è´¦æˆ·æä¾›ï¼Œä»¥å®ç°é‡‘ä¸é›€å’Œéƒ¨åˆ†éƒ¨ç½²ã€‚
- en: ğŸ’¡
  id: totrans-split-39
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ’¡
- en: If youâ€™re interested in more reliable and secure cloud systems, check out
  id: totrans-split-40
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨å¯¹æ›´å¯é å’Œå®‰å…¨çš„äº‘ç³»ç»Ÿæ„Ÿå…´è¶£ï¼Œè¯·æŸ¥çœ‹
- en: '[Substrate](https://substrate.tools/?ref=blog.substrate.tools)'
  id: totrans-split-41
  prefs: []
  type: TYPE_NORMAL
  zh: '[Substrate](https://substrate.tools/?ref=blog.substrate.tools)'
- en: .
  id: totrans-split-42
  prefs: []
  type: TYPE_NORMAL
  zh: ã€‚
- en: '****The Right way to AWS****'
  id: totrans-split-43
  prefs: []
  type: TYPE_NORMAL
  zh: '****æ­£ç¡®çš„ AWS æ–¹æ³•****'
- en: Substrate is a CLI tool that helps teams build and operate secure, compliant,
    isolated AWS infrastructure.
  id: totrans-split-44
  prefs: []
  type: TYPE_NORMAL
  zh: Substrate æ˜¯ä¸€æ¬¾CLIå·¥å…·ï¼Œå¸®åŠ©å›¢é˜Ÿæ„å»ºå’Œæ“ä½œå®‰å…¨ã€åˆè§„ã€éš”ç¦»çš„AWSåŸºç¡€è®¾æ–½ã€‚
- en: From developers who have been there.
  id: totrans-split-45
  prefs: []
  type: TYPE_NORMAL
  zh: æ¥è‡ªæ›¾ç»åœ¨é‚£é‡Œçš„å¼€å‘äººå‘˜ã€‚
- en: '**Philosophy**'
  id: totrans-split-46
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '**å“²å­¦**'
- en: 'According to â€œ[Accelerate: The Science of Lean Software and DevOps](https://en.wikipedia.org/wiki/Accelerate_(book)?ref=blog.substrate.tools)â€,
    organizations that deploy changes the most frequently also have the least amount
    of defects and outages in production. This somewhat counterintuitive observation
    happens for a few reasons:'
  id: totrans-split-47
  prefs: []
  type: TYPE_NORMAL
  zh: æ ¹æ® â€œ[åŠ é€Ÿï¼šç²¾ç›Šè½¯ä»¶å’Œ DevOps çš„ç§‘å­¦](https://en.wikipedia.org/wiki/Accelerate_(book)?ref=blog.substrate.tools)â€
    ï¼Œæœ€é¢‘ç¹éƒ¨ç½²å˜æ›´çš„ç»„ç»‡åœ¨ç”Ÿäº§ä¸­ä¹Ÿæœ‰æœ€å°‘çš„ç¼ºé™·å’Œæ•…éšœã€‚è¿™ç§æœ‰äº›åç›´è§‰çš„è§‚å¯Ÿç”±äºå‡ ä¸ªåŸå› å‘ç”Ÿï¼š
- en: Frequent production changes mean smaller changes. Smaller changes are usually
    less complex, easier to understand, and easier to fix if something does go wrong.
  id: totrans-split-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é¢‘ç¹çš„ç”Ÿäº§å˜æ›´æ„å‘³ç€æ›´å°çš„å˜æ›´ã€‚è¾ƒå°çš„å˜æ›´é€šå¸¸æ›´å°‘å¤æ‚ï¼Œæ›´å®¹æ˜“ç†è§£ï¼Œå¦‚æœå‡ºç°é—®é¢˜ä¹Ÿæ›´å®¹æ˜“ä¿®å¤ã€‚
- en: Conversely, infrequent changes tend to be large, complex, and hard to fix when
    something goes wrong.
  id: totrans-split-49
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç›¸åï¼Œä¸ç»å¸¸çš„å˜æ›´å¾€å¾€æ˜¯å¤§è§„æ¨¡çš„ã€å¤æ‚çš„ï¼Œå½“å‡ºç°é—®é¢˜æ—¶éš¾ä»¥ä¿®å¤ã€‚
- en: Teams that deploy frequently have many opportunities to practice deploying to
    and changing production. We tend to get quite good at things we practice regularly.
  id: totrans-split-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é¢‘ç¹éƒ¨ç½²çš„å›¢é˜Ÿæœ‰è®¸å¤šæœºä¼šç»ƒä¹ å‘ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å’Œæ›´æ”¹ã€‚æˆ‘ä»¬å€¾å‘äºåœ¨ç»å¸¸ç»ƒä¹ çš„äº‹æƒ…ä¸Šè¡¨ç°å¾—éå¸¸å¥½ã€‚
- en: These teams are also more likely to automate or smooth out any sharp edges in
    their tooling if they are using it very frequently.
  id: totrans-split-51
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¦‚æœä½¿ç”¨éå¸¸é¢‘ç¹ï¼Œè¿™äº›å›¢é˜Ÿä¹Ÿæ›´æœ‰å¯èƒ½è‡ªåŠ¨åŒ–æˆ–å¹³æ»‘å…¶å·¥å…·çš„ä»»ä½•å°–é”è¾¹ç¼˜ã€‚
- en: Frequently deploys mean less rush to get your code ready for a fixed schedule
    release. With infrequent releases, teams may feel pressure to rush their code
    or testing so they donâ€™t miss the release train and have to wait for the next
    one.
  id: totrans-split-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é¢‘ç¹çš„éƒ¨ç½²æ„å‘³ç€ä¸å¿…èµ¶ç€ä¸ºå›ºå®šæ—¶é—´è¡¨å‘å¸ƒå‡†å¤‡æ‚¨çš„ä»£ç ã€‚ä¸ä¸ç»å¸¸çš„å‘å¸ƒç›¸æ¯”ï¼Œå›¢é˜Ÿå¯èƒ½æ„Ÿåˆ°å‹åŠ›ï¼Œä»¥ä¾¿ä¸é”™è¿‡å‘å¸ƒæ—¶é—´ï¼Œå¿…é¡»ç­‰å¾…ä¸‹ä¸€ä¸ªæ—¶é—´è¡¨ã€‚
- en: The next part of safely changing production is ensuring any changes are well
    tested before they reach production. High functioning software engineering teams
    tend to have some sort of CI (Continuous Integration) testing setup. For the rest
    of this post weâ€™ll assume you have a well functioning CI system or some similar
    testing setup and wonâ€™t be making any recommendations in that area.
  id: totrans-split-53
  prefs: []
  type: TYPE_NORMAL
  zh: å®‰å…¨æ›´æ”¹ç”Ÿäº§çš„ä¸‹ä¸€éƒ¨åˆ†æ˜¯ç¡®ä¿ä»»ä½•æ›´æ”¹åœ¨è¾¾åˆ°ç”Ÿäº§ä¹‹å‰éƒ½ç»è¿‡äº†å……åˆ†æµ‹è¯•ã€‚é«˜æ•ˆçš„è½¯ä»¶å·¥ç¨‹å›¢é˜Ÿå€¾å‘äºæ‹¥æœ‰æŸç§CIï¼ˆæŒç»­é›†æˆï¼‰æµ‹è¯•è®¾ç½®ã€‚åœ¨æœ¬æ–‡çš„å…¶ä½™éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å‡è®¾æ‚¨æ‹¥æœ‰ä¸€ä¸ªè‰¯å¥½è¿ä½œçš„CIç³»ç»Ÿæˆ–æŸç§ç±»ä¼¼çš„æµ‹è¯•è®¾ç½®ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨è¯¥é¢†åŸŸæå‡ºä»»ä½•å»ºè®®ã€‚
- en: We will be focusing on how a change makes its way through various environments
    into production for all of your customers.
  id: totrans-split-54
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†ä¸“æ³¨äºå˜æ›´å¦‚ä½•é€šè¿‡å„ç§ç¯å¢ƒè¿›å…¥æ‰€æœ‰å®¢æˆ·çš„ç”Ÿäº§ç¯å¢ƒã€‚
- en: Weâ€™re convinced most teams building and operating online services are best served
    by frequent small changes to production, and a phased rollout approach where changes
    are tested in a way that minimizes blast radius, including in production.
  id: totrans-split-55
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ç¡®ä¿¡ï¼Œå¤§å¤šæ•°æ„å»ºå’Œè¿è¥åœ¨çº¿æœåŠ¡çš„å›¢é˜Ÿæœ€é€‚åˆé¢‘ç¹å‘ç”Ÿäº§ç¯å¢ƒè¿›è¡Œå°è§„æ¨¡æ›´æ”¹ï¼Œå¹¶é‡‡ç”¨åˆ†é˜¶æ®µæ¨å‡ºçš„æ–¹æ³•ï¼Œåœ¨æµ‹è¯•ä¸­æœ€å¤§ç¨‹åº¦åœ°å‡å°å½±å“èŒƒå›´ï¼ŒåŒ…æ‹¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ã€‚
- en: One of the best ways to achieve this for infrastructure changes is detailed
    in [Terraform best practices for reliability at any scale](https://www.notion.so/RevenueCat-5bc42bbcd05c4a7cac7e897988dced72?pvs=21&ref=blog.substrate.tools).
  id: totrans-split-56
  prefs: []
  type: TYPE_NORMAL
  zh: å®ç°åŸºç¡€è®¾æ–½å˜æ›´çš„æœ€ä½³æ–¹æ³•ä¹‹ä¸€è¯¦è§[Terraformæœ€ä½³å®è·µï¼šåœ¨ä»»ä½•è§„æ¨¡ä¸‹ç¡®ä¿å¯é æ€§](https://www.notion.so/RevenueCat-5bc42bbcd05c4a7cac7e897988dced72?pvs=21&ref=blog.substrate.tools)ã€‚
- en: Take Away
  id: totrans-split-57
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç»“è®º
- en: Designing reliable systems can be complex, but following some key principles
    can make your systems much more likely to survive the inevitable bugs and mistakes.
  id: totrans-split-58
  prefs: []
  type: TYPE_NORMAL
  zh: è®¾è®¡å¯é ç³»ç»Ÿå¯èƒ½å¾ˆå¤æ‚ï¼Œä½†éµå¾ªä¸€äº›å…³é”®åŸåˆ™å¯ä»¥å¤§å¤§å¢åŠ ç³»ç»Ÿç”Ÿå­˜ä¸å¯é¿å…çš„é”™è¯¯å’Œå¤±è¯¯çš„å¯èƒ½æ€§ã€‚
- en: Canary deploys - Deploy your change to a tiny fleet of systems that are exactly
    the same as the rest of production.
  id: totrans-split-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: é‡‘ä¸é›€éƒ¨ç½² - å°†æ‚¨çš„æ›´æ”¹éƒ¨ç½²åˆ°ä¸ç”Ÿäº§ç¯å¢ƒå®Œå…¨ç›¸åŒçš„ä¸€å°éƒ¨åˆ†ç³»ç»Ÿä¸­ã€‚
- en: Phased rollouts - After canary, gradually roll your change out to more and more
    of your server fleet or customers.
  id: totrans-split-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åˆ†é˜¶æ®µæ¨å‡º - åœ¨é‡‘ä¸é›€ä¹‹åï¼Œé€æ¸å°†æ‚¨çš„æ›´æ”¹æ‰©å±•åˆ°æ›´å¤šçš„æœåŠ¡å™¨ç¾¤æˆ–å®¢æˆ·ç«¯ã€‚
- en: Pre-flight checks - At a minimum, your deployment system should verify that
    the artifact itâ€™s deploying passes certain integrity checks. More complex versions
    can also verify downstream dependencies.
  id: totrans-split-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: é£è¡Œå‰æ£€æŸ¥ - è‡³å°‘ï¼Œæ‚¨çš„éƒ¨ç½²ç³»ç»Ÿåº”éªŒè¯å…¶éƒ¨ç½²çš„å·¥ä»¶æ˜¯å¦é€šè¿‡äº†æŸäº›å®Œæ•´æ€§æ£€æŸ¥ã€‚æ›´å¤æ‚çš„ç‰ˆæœ¬è¿˜å¯ä»¥éªŒè¯ä¸‹æ¸¸ä¾èµ–é¡¹ã€‚
- en: Rollbacks - Think through how you would roll back from any change, and practice
    it. When in doubt, roll back! At Square we evangelized this idea so much that
    it was immortalized internally as go/rollback and now exists publicly at [https://outage.party](https://outage.party/?ref=blog.substrate.tools).
  id: totrans-split-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å›æ»š - æ€è€ƒå¦‚ä½•å›æ»šä»»ä½•æ›´æ”¹ï¼Œå¹¶è¿›è¡Œå®è·µã€‚å½“æœ‰ç–‘é—®æ—¶ï¼Œè¯·å›æ»šï¼åœ¨Squareï¼Œæˆ‘ä»¬éå¸¸å€¡å¯¼è¿™ä¸€ç†å¿µï¼Œä»¥è‡³äºåœ¨å†…éƒ¨è¢«æ°¸ä¹…åŒ–ä¸ºgo/rollbackï¼Œå¹¶ä¸”ç°åœ¨åœ¨[https://outage.party](https://outage.party/?ref=blog.substrate.tools)å…¬å¼€å­˜åœ¨ã€‚
