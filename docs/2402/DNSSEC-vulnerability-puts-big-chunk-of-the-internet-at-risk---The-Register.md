<!--yml

类别：未分类

日期：2024-05-27 14:50:56

-->

# DNSSEC漏洞将互联网的大部分内容置于风险之中 • The Register

> 来源：[https://www.theregister.com/2024/02/13/dnssec_vulnerability_internet/](https://www.theregister.com/2024/02/13/dnssec_vulnerability_internet/)

更新 一份单一数据包可以利用DNSSEC规范中20多年的设计缺陷耗尽易受攻击的DNS服务器的处理能力，有效地使其失效。

这将使尚未修补的DNSSEC验证的DNS解析器易受攻击，扰乱所有依赖该服务的客户端，并使网站和应用看似处于离线状态。

发现这一缺陷的学术界人士，来自德国应用网络安全研究国家中心（ATHENE）位于达姆施塔特，称DNS服务器软件制造商已被告知该漏洞被描述为“有史以来对DNS的最严重攻击”。

由法兰克福大学的Haya Schulmann教授和Niklas Vogel、Fraunhofer SIT的Elias Heftrig、以及达姆施塔特技术大学和Fraunhofer SIT的Michael Waidner教授发现，这一安全漏洞被命名为[KeyTrap](https://www.presseportal.de/pm/173495/5713546)，指定为[CVE-2023-50387](https://kb.isc.org/docs/cve-2023-50387)，并被评为10分中的7.5分的CVSS严重性评分。

截至2023年12月，全球约31%的网络客户端使用DNSSEC验证的DNS解析器，像其他依赖这些系统的应用一样，将会感受到KeyTrap攻击的影响：由于这些DNS服务器受到漏洞的影响，依赖它们的客户端将无法解析域名和主机名到IP地址，导致连接丢失。

研究人员称利用KeyTrap的单一DNS数据包可能使Google和Cloudflare等公共DNSSEC验证的DNS服务陷入停滞，通过让它们进行超负荷计算来达到这一目的。

这种DNS中断不仅可能阻止人们访问内容，还可能干扰其他系统，包括垃圾邮件防御、加密防御（PKI）和跨域路由安全（RPKI），研究人员指出。

他们声称：“利用此攻击将对使用互联网的任何应用程序产生严重后果，包括技术不可用，如网页浏览、电子邮件和即时通讯。”“使用KeyTrap，攻击者可以完全禁用全球互联网的大部分内容。”

针对这一漏洞提供给《注册》的一份非公开技术论文，标题为《关于DNS的KeyTrap拒绝服务算法复杂性攻击》，描述了攻击将如何进行。基本上，它涉及请求一个有漏洞的DNSSEC验证DNS解析器查找一个地址，导致服务器联系一个恶意域名服务器发送回复，使解析器消耗大部分或全部CPU资源。

> 使用 KeyTrap，攻击者可以完全禁用全球互联网的大部分。

"为了发起攻击，我们的对手导致受害者解析器在其恶意域名中查找记录，" 即将发布的论文声明。 "攻击者的名称服务器用恶意记录集（RRset）回应 DNS 查询，根据特定的攻击向量和区域配置。"

该文章解释说，这种攻击有效，因为[DNSSEC 规范](https://datatracker.ietf.org/doc/rfc2535/)遵循[Postel 法则](https://www.cs.tufts.edu/comp/117/assts/postel)："域名服务器应发送所有可用的加密材料，而解析器应使用它们接收到的任何加密材料，直到验证成功为止。"

为了确保可用性，DNSSEC 验证的 DNS 递归解析器如果收到必须验证的碰撞密钥标签和碰撞密钥，就会被迫做大量工作。

"我们的复杂性攻击是通过向 DNS 递归解析器提供特制的 DNSSEC 记录来触发的，这些记录是以一种利用加密验证逻辑中的验证漏洞的方式构建的，" 文章解释道。

"当 DNS 递归解析器尝试验证来自我们域名服务器的 DNSSEC 记录时，它们会被搁置。 我们的攻击非常隐蔽，能够通过单个 DNS 响应数据包在 170 秒至 16 小时之间（取决于解析器软件）搁置解析器。"

ATHENE 的专家表示，他们已与所有相关供应商和主要公共 DNS 提供商合作，以私下披露此漏洞，以便可能进行协调的补丁发布。 最后一个补丁今天完成。

"我们知道这个漏洞，并与报告研究人员协调进行了修复，" Google 的一位发言人告诉*The Register*。 "目前没有利用的证据，用户目前不需要采取任何措施。"

网络研究实验室 NLnet Labs 发布了一个补丁，用于其 Unbound DNS 软件，解决了两个漏洞，其中一个是 KeyTrap。 另一个修复的 bug，[CVE-2023-50868](https://nlnetlabs.nl/downloads/unbound/CVE-2023-50387_CVE-2023-50868.txt)，称为 NSEC3 漏洞，还允许通过 CPU 耗尽进行拒绝服务。

"KeyTrap 漏洞通过在恶意区域上使用密钥（也是碰撞密钥）、签名和 RRSET 的数量的组合来工作，" NLnet Labs [写道](https://nlnetlabs.nl/news/2024/Feb/13/unbound-1.19.1-released/)。 "来自该区域的答案可以迫使 DNSSEC 验证器走上非常消耗 CPU 和时间的验证路径。"

PowerDNS 此时有一个更新[这里](https://doc.powerdns.com/recursor/security-advisories/powerdns-advisory-2024-01.html)，以防止 KeyTrap 的利用。

"攻击者可以发布一个包含精心设计的DNSSEC相关记录的区域。当使用RFC规定的算法验证对该区域的查询结果时，递归服务器的资源使用可能会变得非常高，从而影响其他查询的处理，导致服务拒绝，" 团队写道。"请注意，任何遵循RFC的解析器都可能受到影响，这不是特定实现的问题。"

CVE-2023-50387的修复仅仅是[互联网系统联盟的BIND 9 DNS软件](https://seclists.org/oss-sec/2024/q1/125)中解决的六个漏洞之一。其他漏洞包括：

+   [CVE-2023-4408](https://kb.isc.org/docs/cve-2023-4408): 解析大型DNS消息可能导致CPU负载过高；

+   [CVE-2023-5517](https://kb.isc.org/docs/cve-2023-5517): 在启用“nxdomain-redirect”时，查询RFC 1918反向区域可能导致断言失败；

+   [CVE-2023-5679](https://kb.isc.org/docs/cve-2023-5679): 启用DNS64和serve-stale可能在递归解析期间导致断言失败；

+   [CVE-2023-6516](https://kb.isc.org/docs/cve-2023-6516): 特定的递归查询模式可能导致内存不足；

+   [CVE-2023-50868](https://kb.isc.org/docs/cve-2023-50868): 准备NSEC3最接近封闭证明可能会耗尽CPU资源。

KeyTrap漏洞的要求可以追溯到1999年，根据研究团队的说法，这些要求来自现在已废弃的RFC 2535。到2012年，这些元素出现在[RFC 6781](https://datatracker.ietf.org/doc/rfc6781/)和[RFC 6840](https://datatracker.ietf.org/doc/rfc6840/)中，这些是DNSSEC验证的实施要求。

> 只需一个数据包。你不必做更多，就可以断开整个网络的连接

自2000年8月至少 – 超过23年前 – KeyTrap已存在于BIND 9 DNS解析器中，并且七年后出现在Unbound DNS解析器中。

Haya Shulman博士，计算机科学教授之一，也是KeyTrap研究背后的学术界人士之一，在电话采访中告诉《The Register》，这种攻击很简单，可以通过在[区域文件](https://dnsinstitute.com/documentation/dnssec-guide/ch04s02.html#signing-verify-zone-file)中编码来执行。

"这个漏洞实际上是DNSSEC标准中推荐的内容，" Shulman教授解释道。"只需一个数据包。你不必做更多，就可以断开整个网络的连接。"

Shulman教授表示，各种供应商发布的补丁破坏了标准。"问题在于这种攻击不容易解决，" 她说道。"如果我们对已打过补丁的解析器发起攻击，我们仍然会得到100%的CPU使用率，但它仍然可以响应。"

ATHENE团队观察到，虽然这个漏洞数十年来一直未被发现，但其难以理解并不令人意外，因为DNSSEC验证要求非常复杂。减轻这种漏洞的影响，并完全消除它需要对DNSSEC标准进行修订。

### 更新日期为2月16日

您现在可以作为PDF文件下载[技术报告](https://www.athene-center.de/fileadmin/content/PDF/Technical_Report_KeyTrap.pdf)。

此外，Akamai执行官Sven Dummer感谢研究团队不仅发现了漏洞，还与DNS提供商和软件制造商合作，协调补丁的安装和系统重新部署，以避免大规模利用。

"你可能不知道，但全球互联网躲过了一劫：KeyTrap是互联网必不可少的关键基础设施的一个漏洞 —— 也是有史以来发现的最糟糕的漏洞之一，" 他[评论道](https://www.linkedin.com/posts/svenhdummer_cve-2023-50387-and-cve-2023-50868-dns-exploit-activity-7164147641054949377-4qwQ/)。

"使用KeyTrap，攻击者可以完全禁用全球互联网的大部分内容。"
