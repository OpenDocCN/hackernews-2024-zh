- en: <!--yml
  id: totrans-0
  prefs: []
  type: TYPE_NORMAL
  zh: <!--yml
- en: 'category: æœªåˆ†ç±»'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 'category: æœªåˆ†ç±»'
- en: 'date: 2024-05-29 13:24:41'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 'date: 2024-05-29 13:24:41'
- en: -->
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: -->
- en: All you need is Wide Events, not â€œMetrics, Logs and Tracesâ€
  id: totrans-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä½ æ‰€éœ€è¦çš„åªæ˜¯ Wide Eventsï¼Œè€Œä¸æ˜¯â€œæŒ‡æ ‡ã€æ—¥å¿—å’Œè¿½è¸ªâ€
- en: æ¥æºï¼š[https://isburmistrov.substack.com/p/all-you-need-is-wide-events-not-metrics](https://isburmistrov.substack.com/p/all-you-need-is-wide-events-not-metrics)
  id: totrans-5
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: æ¥æºï¼š[https://isburmistrov.substack.com/p/all-you-need-is-wide-events-not-metrics](https://isburmistrov.substack.com/p/all-you-need-is-wide-events-not-metrics)
- en: This quote from Charity Majors is probably the best summary of the current state
    of observability in the tech industry - a total, mass confusion. Everyone is confused.
    What is a trace? What is a span? Is log line a span? Do I need traces if I have
    logs? Why I need traces if I have great metrics? The list of questions like these
    goes on. Charity - together with other great folks from observability system called
    [Honeycomb](https://www.honeycomb.io/) - have been doing a great job shedding
    light on these questions. Yet, per my own experience itâ€™s still extremely hard
    to explain what does Charity meant by â€œlogs are thrashâ€, let alone the fact that
    logs and traces are essentially the same things. Why is everyone so confused?
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: Charity Majors çš„è¿™å¥è¯å¯èƒ½æ˜¯å½“å‰ç§‘æŠ€è¡Œä¸šå¯è§‚å¯Ÿæ€§çŠ¶å†µçš„æœ€ä½³æ‘˜è¦ - å®Œå…¨æ˜¯ä¸€ç‰‡æ··ä¹±ã€‚æ¯ä¸ªäººéƒ½æ„Ÿåˆ°å›°æƒ‘ã€‚ä»€ä¹ˆæ˜¯è¿½è¸ªï¼Ÿä»€ä¹ˆæ˜¯è·¨åº¦ï¼Ÿæ—¥å¿—è¡Œæ˜¯è·¨åº¦å—ï¼Ÿå¦‚æœæˆ‘æœ‰æ—¥å¿—ï¼Œæˆ‘è¿˜éœ€è¦è¿½è¸ªå—ï¼Ÿå¦‚æœæˆ‘æœ‰å¾ˆå¥½çš„æŒ‡æ ‡ï¼Œä¸ºä»€ä¹ˆæˆ‘è¿˜éœ€è¦è¿½è¸ªï¼Ÿç±»ä¼¼è¿™æ ·çš„é—®é¢˜æ¸…å•ä¸èƒœæšä¸¾ã€‚Charity
    - ä¸æ¥è‡ªåä¸º [Honeycomb](https://www.honeycomb.io/) çš„å¯è§‚å¯Ÿæ€§ç³»ç»Ÿçš„å…¶ä»–ä¼˜ç§€äººå£«ä¸€èµ· - ä¸€ç›´åœ¨åŠªåŠ›è§£ç­”è¿™äº›é—®é¢˜ã€‚ç„¶è€Œï¼Œæ ¹æ®æˆ‘çš„ç»éªŒï¼Œè§£é‡Š
    Charity æ‰€è¯´çš„â€œæ—¥å¿—æ˜¯åƒåœ¾â€æ„å‘³ç€ä»ç„¶éå¸¸å›°éš¾ï¼Œæ›´ä¸ç”¨è¯´æ—¥å¿—å’Œè¿½è¸ªæœ¬è´¨ä¸Šæ˜¯ç›¸åŒçš„äº‹ç‰©ã€‚ä¸ºä»€ä¹ˆæ¯ä¸ªäººéƒ½å¦‚æ­¤å›°æƒ‘å‘¢ï¼Ÿ
- en: With the risk of being spicy a little, Iâ€™m going to blame Open Telemetry. Yes,
    itâ€™s powering the modern observability stack and yet I blame it for the mass confusion.
    Not because itâ€™s a bad solution - itâ€™s great! But the presentation and the whole
    approach of explaining what Open Telemetry is and what it does makes the observability
    look tricky and complex.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: å†’ç€æœ‰ç‚¹è¾›è¾£çš„é£é™©ï¼Œæˆ‘è¦è´£æ€ª Open Telemetryã€‚æ˜¯çš„ï¼Œå®ƒæ­£åœ¨ä¸ºç°ä»£å¯è§‚å¯Ÿæ€§å †æ ˆæä¾›åŠ¨åŠ›ï¼Œä½†æˆ‘è¦è´£æ€ªå®ƒé€ æˆäº†ä¸€ç‰‡æ··ä¹±ã€‚ä¸æ˜¯å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªç³Ÿç³•çš„è§£å†³æ–¹æ¡ˆ
    - å®ƒå¾ˆæ£’ï¼ä½†æ˜¯å¯¹äºè§£é‡Š Open Telemetry æ˜¯ä»€ä¹ˆä»¥åŠå®ƒçš„ä½œç”¨çš„æ•´ä¸ªæ–¹æ³•ä½¿å¾—å¯è§‚å¯Ÿæ€§çœ‹èµ·æ¥å¾ˆæ£˜æ‰‹å’Œå¤æ‚ã€‚
- en: 'First, Open Telemetry from the very beginning makes a clear distinctions between
    traces, metrics and logs:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼ŒOpen Telemetry ä»ä¸€å¼€å§‹å°±æ˜ç¡®åŒºåˆ†äº†è¿½è¸ªã€æŒ‡æ ‡å’Œæ—¥å¿—ï¼š
- en: OpenTelemetry is a collection of APIs, SDKs, and tools. Use it to instrument,
    generate, collect, and export telemetry data (metrics, logs, and traces) to help
    you analyze your softwareâ€™s performance and behavior.
  id: totrans-9
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: OpenTelemetry æ˜¯ä¸€ç»„ APIã€SDK å’Œå·¥å…·ã€‚ä½¿ç”¨å®ƒæ¥ä¸ºè½¯ä»¶çš„æ€§èƒ½å’Œè¡Œä¸ºåˆ†ææä¾›é¥æµ‹æ•°æ®ï¼ˆæŒ‡æ ‡ã€æ—¥å¿—å’Œè¿½è¸ªï¼‰ã€‚
- en: Then it goes deeper in explaining each of these 3.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åå®ƒæ›´æ·±å…¥åœ°è§£é‡Šäº†è¿™ä¸‰ä¸ªã€‚
- en: This is screenshot from the part of open telemetry website introducing traces.
    Based on my experience talking to people who work with OpenTelemetry, this presentation
    has indeed become one of the main pictures being associated with observability.
    For some, this IS the observability. And it also sets traces apart from anything
    else. This is clear not a log, is it? This also doesnâ€™t look like a metric, right?
    Itâ€™s something *special,* probably a bit *sacred,* and requiring learning investment.
    Per my experience, once people learned about traces, they only think about them
    in the context of this picture and the whole set of terms like spans, root spans,
    nested spans and the rest. OpenTelemetry site has a [glossary](https://opentelemetry.io/docs/concepts/glossary/)
    page with more than 60 terms! This all is insanely complex!
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯ä» open telemetry ç½‘ç«™ä»‹ç»è¿½è¸ªéƒ¨åˆ†çš„æˆªå›¾ã€‚æ ¹æ®æˆ‘ä¸ä½¿ç”¨ OpenTelemetry çš„äººäº¤è°ˆçš„ç»éªŒï¼Œè¿™ä¸ªä»‹ç»ç¡®å®å·²ç»æˆä¸ºäººä»¬æ‰€å…³è”çš„å¯è§‚å¯Ÿæ€§çš„ä¸»è¦å›¾åƒä¹‹ä¸€ã€‚å¯¹ä¸€äº›äººæ¥è¯´ï¼Œè¿™å°±æ˜¯å¯è§‚å¯Ÿæ€§ã€‚å®ƒè¿˜å°†è¿½è¸ªä¸å…¶ä»–ä»»ä½•ä¸œè¥¿åŒºåˆ†å¼€æ¥ã€‚è¿™æ˜¾ç„¶ä¸æ˜¯æ—¥å¿—ï¼Œæ˜¯å—ï¼Ÿè¿™ä¹Ÿä¸åƒæŒ‡æ ‡ï¼Œå¯¹å§ï¼Ÿè¿™æ˜¯
    *ç‰¹åˆ«çš„ï¼Œ*å¯èƒ½æœ‰ç‚¹ *ç¥åœ£çš„ï¼Œ*å¹¶éœ€è¦å­¦ä¹ æŠ•å…¥ã€‚æ ¹æ®æˆ‘çš„ç»éªŒï¼Œä¸€æ—¦äººä»¬äº†è§£äº†è¿½è¸ªï¼Œä»–ä»¬åªä¼šåœ¨è¿™ä¸ªå›¾ç‰‡å’Œä¸€æ•´å¥—è¯¸å¦‚ spansã€root spansã€nested
    spans ç­‰æœ¯è¯­çš„èƒŒæ™¯ä¸‹è€ƒè™‘å®ƒä»¬ã€‚OpenTelemetry ç½‘ç«™æœ‰ä¸€ä¸ª[æœ¯è¯­è¡¨](https://opentelemetry.io/docs/concepts/glossary/)é¡µé¢ï¼Œåˆ—å‡ºäº†
    60 å¤šä¸ªæœ¯è¯­ï¼è¿™ä¸€åˆ‡éƒ½éå¸¸å¤æ‚ï¼
- en: But whatâ€™s more important - does this focus on â€œlogs, metrics and tracesâ€ represent
    the true power of observability? It does cover some scenarios thatâ€™s true, but
    when it comes to the distributed systems at scale whatâ€™s more important is an
    ability to â€œdigâ€ into data - â€œslice and diceâ€ it, build and analyse various views,
    correlate, search for anomaliesâ€¦ And systems that offer all of this do exist.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: ä½†æ›´é‡è¦çš„æ˜¯ - è¿™ä¸ªâ€œæ—¥å¿—ã€æŒ‡æ ‡å’Œè¿½è¸ªâ€çš„ç„¦ç‚¹æ˜¯å¦ä»£è¡¨äº†å¯è§‚å¯Ÿæ€§çš„çœŸæ­£åŠ›é‡ï¼Ÿè¿™ç¡®å®æ¶µç›–äº†ä¸€äº›æƒ…æ™¯ï¼Œä½†å½“æ¶‰åŠåˆ°å¤§è§„æ¨¡çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œæ›´é‡è¦çš„æ˜¯èƒ½å¤Ÿâ€œæŒ–æ˜â€æ•°æ®
    - â€œåˆ‡ç‰‡å’Œåˆ‡å—â€å®ƒï¼Œæ„å»ºå’Œåˆ†æå„ç§è§†å›¾ï¼Œç›¸å…³æ€§ï¼Œæœç´¢å¼‚å¸¸â€¦â€¦è€Œæä¾›æ‰€æœ‰è¿™äº›åŠŸèƒ½çš„ç³»ç»Ÿç¡®å®å­˜åœ¨ã€‚
- en: When I was working at Meta, I wasnâ€™t aware that I was privileged to be using
    the best observability system ever. This system is called Scuba and itâ€™s the top
    1 thing by a large margin that people miss when they leave Meta.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: å½“æˆ‘åœ¨ Meta å·¥ä½œæ—¶ï¼Œæˆ‘å¹¶æ²¡æœ‰æ„è¯†åˆ°æˆ‘æœ‰å¹¸ä½¿ç”¨çš„æ˜¯æœ€å¥½çš„å¯è§‚å¯Ÿæ€§ç³»ç»Ÿã€‚è¿™ä¸ªç³»ç»Ÿå«åš Scubaï¼Œæ˜¯ç¦»å¼€ Meta åäººä»¬æœ€æ€€å¿µçš„å¤´ç­‰å¤§äº‹ã€‚
- en: 'The basic idea of Scuba is extremely simple and doesnâ€™t require a glossary
    page for people to grasp. It operates with Wide Events. Wide Event is just a collection
    of fields with names and values, pretty much like a json document. If you need
    to record some information - whether itâ€™s the current state of the system, or
    an event caused by an API call, background job or whatever - you can just write
    some Wide Event to Scuba. For instance, if a system serves ads, the natural desire
    would be to record Ad Impressions - the facts that a certain ad has been seen
    by a user. The corresponding Wide Event might be looking like this:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: Scuba çš„åŸºæœ¬æ€æƒ³éå¸¸ç®€å•ï¼Œä¸éœ€è¦ä¸€ä¸ªæœ¯è¯­è¡¨é¡µé¢ä¾›äººä»¬ç†è§£ã€‚å®ƒä½¿ç”¨ Wide Events è¿ä½œã€‚ Wide Event å°±åƒä¸€ä¸ª json æ–‡æ¡£ä¸€æ ·ï¼Œæ˜¯ä¸€ç³»åˆ—å¸¦æœ‰åç§°å’Œå€¼çš„å­—æ®µé›†åˆã€‚å¦‚æœä½ éœ€è¦è®°å½•ä¸€äº›ä¿¡æ¯
    - æ— è®ºæ˜¯ç³»ç»Ÿçš„å½“å‰çŠ¶æ€ï¼Œè¿˜æ˜¯ç”± API è°ƒç”¨ã€åå°ä½œä¸šæˆ–å…¶ä»–åŸå› å¼•èµ·çš„äº‹ä»¶ - ä½ åªéœ€å‘ Scuba å†™å…¥ä¸€äº› Wide Eventã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªç³»ç»Ÿæä¾›å¹¿å‘ŠæœåŠ¡ï¼Œè‡ªç„¶å¸Œæœ›è®°å½•å¹¿å‘Šå±•ç¤º
    - æŸä¸ªå¹¿å‘Šè¢«ç”¨æˆ·çœ‹åˆ°çš„äº‹å®ã€‚ç›¸åº”çš„ Wide Event å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
- en: '[PRE0]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Such events called wide, because itâ€™s encouraged to dump to them all the information
    one can think of. Anything that might be relevant in the context of a certain
    data - just put it there, it might be useful later. This approach is laying the
    groundwork for dealing with *unknown unknowns* - something you canâ€™t think of
    now that may be revealed later during an incident investigation.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ç±»äº‹ä»¶è¢«ç§°ä¸ºå®½æ³›ï¼Œå› ä¸ºé¼“åŠ±å°†æ‰€æœ‰å¯èƒ½è€ƒè™‘åˆ°çš„ä¿¡æ¯éƒ½å€’å…¥å…¶ä¸­ã€‚åœ¨æŸä¸ªç‰¹å®šæ•°æ®ç¯å¢ƒä¸­å¯èƒ½ç›¸å…³çš„ä»»ä½•å†…å®¹ - åªéœ€å°†å…¶æ”¾åœ¨é‚£é‡Œï¼Œä»¥åå¯èƒ½ä¼šæœ‰ç”¨ã€‚è¿™ç§æ–¹æ³•ä¸ºå¤„ç†*æœªçŸ¥æœªçŸ¥*æ‰“ä¸‹äº†åŸºç¡€
    - ä¸€äº›ä½ ç°åœ¨æ— æ³•æƒ³åˆ°çš„ä¸œè¥¿ï¼Œåœ¨äº‹æ•…è°ƒæŸ¥è¿‡ç¨‹ä¸­å¯èƒ½ä¼šåœ¨ä»¥åè¢«æ­ç¤ºã€‚
- en: 'Dealing with unknown unknowns can be better demonstrated on an example. Scuba
    has a nice intuitive interface which is easy to explore and play with. It has
    a section where one can pick a metric to look at, as well as sections for filters
    and groupings - and Scuba would draw a nice time series chart. Firs look for Ad
    Impressions dataset would simply draw a chart with impressions count:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: å¤„ç†æœªçŸ¥æœªçŸ¥å› ç´ å¯ä»¥é€šè¿‡ä¸€ä¸ªä¾‹å­æ›´å¥½åœ°è¿›è¡Œæ¼”ç¤ºã€‚Scuba æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç›´è§‚ç•Œé¢ï¼Œå¾ˆå®¹æ˜“æ¢ç´¢å’Œç©è€ã€‚å®ƒæœ‰ä¸€ä¸ªéƒ¨åˆ†ï¼Œå¯ä»¥é€‰æ‹©è¦æŸ¥çœ‹çš„åº¦é‡æ ‡å‡†ï¼Œä»¥åŠç”¨äºè¿‡æ»¤å’Œåˆ†ç»„çš„éƒ¨åˆ†
    - Scuba ä¼šç»˜åˆ¶ä¸€ä¸ªæ¼‚äº®çš„æ—¶é—´åºåˆ—å›¾è¡¨ã€‚å¯¹äºå¹¿å‘Šå±•ç¤ºæ•°æ®é›†çš„ç¬¬ä¸€ä¸ªçœ‹æ³•åªä¼šç®€å•åœ°ç»˜åˆ¶ä¸€ä¸ªå±•ç¤ºè®¡æ•°å›¾è¡¨ï¼š
- en: If we express whatâ€™s exactly is selected here in terms of SQL, then this is
    something like
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæˆ‘ä»¬ç”¨ SQL æ¥è¡¨è¾¾è¿™é‡Œç¡®åˆ‡é€‰æ‹©çš„å†…å®¹ï¼Œé‚£ä¹ˆè¿™å°±åƒæ˜¯
- en: '[PRE1]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Well, itâ€™s actually not exactly like that. Scuba also has a concept of *native
    sampling.* When a certain event is written to Scuba, it also must write a field
    called **samplingRate** - the rate this particular event is being sampled with.
    Scuba uses this information to properly â€œupscaleâ€ results shown on the charts,
    so there is no need to do this upscaling in the head. This is a really great concept
    because it allows a dynamic sampling - e.g. some type of impressions may be sampled
    more than another, while preserving the â€œrealâ€ values in the UI. So, the actual
    query under the hood is
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: å—¯ï¼Œäº‹å®ä¸Šå¹¶ä¸å®Œå…¨æ˜¯è¿™æ ·ã€‚Scuba è¿˜æœ‰ä¸€ä¸ª*æœ¬åœ°æŠ½æ ·*çš„æ¦‚å¿µã€‚å½“æŸä¸ªäº‹ä»¶è¢«å†™å…¥ Scuba æ—¶ï¼Œå®ƒè¿˜å¿…é¡»å†™å…¥ä¸€ä¸ªç§°ä¸º**samplingRate**çš„å­—æ®µ
    - è¡¨ç¤ºæ­¤ç‰¹å®šäº‹ä»¶çš„é‡‡æ ·ç‡ã€‚Scuba ä½¿ç”¨æ­¤ä¿¡æ¯æ¥æ­£ç¡®â€œå‡çº§â€å›¾è¡¨ä¸Šæ˜¾ç¤ºçš„ç»“æœï¼Œå› æ­¤æ— éœ€åœ¨å¤´è„‘ä¸­è¿›è¡Œæ­¤å‡çº§ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ¦‚å¿µï¼Œå› ä¸ºå®ƒå…è®¸åŠ¨æ€æŠ½æ · -
    ä¾‹å¦‚ï¼ŒæŸäº›ç±»å‹çš„å±•ç¤ºå¯èƒ½æ¯”å¦ä¸€äº›ç±»å‹çš„å±•ç¤ºæ›´å¤šåœ°è¿›è¡ŒæŠ½æ ·ï¼ŒåŒæ—¶åœ¨ UI ä¸­ä¿ç•™â€œçœŸå®â€å€¼ã€‚å› æ­¤ï¼Œå®é™…æŸ¥è¯¢åœ¨å¹•åæ˜¯è¿™æ ·çš„
- en: '[PRE2]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Note that this whole â€œupscalingâ€ is done transparently by the UI and users donâ€™t
    think about it during querying.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œæ•´ä¸ªâ€œå‡çº§â€è¿‡ç¨‹æ˜¯ç”± UI é€æ˜åœ°å®Œæˆçš„ï¼Œç”¨æˆ·åœ¨æŸ¥è¯¢è¿‡ç¨‹ä¸­ä¸ä¼šè€ƒè™‘åˆ°å®ƒã€‚
- en: 'And so assume some alert happened and indicated that our precious Ad Impression
    chart is looking weird:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€ä»¥å‡è®¾å‘ç”Ÿäº†ä¸€äº›è­¦æŠ¥ï¼Œè¡¨æ˜æˆ‘ä»¬çè´µçš„å¹¿å‘Šå±•ç¤ºå›¾è¡¨çœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼š
- en: 'The first instinct of everyone whoâ€™re using Scuba for investigation is to â€œslice
    and diceâ€, i.e. filter or group by, to see if we can learn *something*. We donâ€™t
    know what weâ€™re looking for, but we believe that weâ€™ll find it. So we would group
    by say impression type, or user country, or the placement, until we would find
    something suspicious. Letâ€™s assume itâ€™s CampaignType grouping:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: æ¯ä¸ªä½¿ç”¨ Scuba è¿›è¡Œè°ƒæŸ¥çš„äººçš„ç¬¬ä¸€ç›´è§‰æ˜¯â€œåˆ‡ç‰‡å’Œåˆ‡å—â€ï¼Œå³æŒ‰è¿‡æ»¤æˆ–åˆ†ç»„ï¼Œçœ‹çœ‹æˆ‘ä»¬æ˜¯å¦èƒ½å­¦åˆ°*ä»€ä¹ˆ*ã€‚æˆ‘ä»¬ä¸çŸ¥é“æˆ‘ä»¬åœ¨æ‰¾ä»€ä¹ˆï¼Œä½†æˆ‘ä»¬ç›¸ä¿¡æˆ‘ä»¬ä¼šæ‰¾åˆ°å®ƒã€‚æ‰€ä»¥æˆ‘ä»¬ä¼šæŒ‰å±•ç¤ºç±»å‹ã€ç”¨æˆ·å›½å®¶æˆ–ä½ç½®åˆ†ç»„ï¼Œç›´åˆ°æˆ‘ä»¬æ‰¾åˆ°ä¸€äº›å¯ç–‘çš„ä¸œè¥¿ã€‚å‡è®¾æ˜¯
    CampaignType åˆ†ç»„ï¼š
- en: We see that some campaign type called **in_app_purchases** (just in case want
    to note that this type name is completely made-up by me)seems to look differently
    than others. We donâ€™t really know that does it mean - we donâ€™t need to! - to continue
    our digging. Okay, now we can filter these campaigns only, and continue grouping
    by something else we can think of. For instance, User OS makes sense.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬çœ‹åˆ°ä¸€äº›è¢«ç§°ä¸º**in_app_purchases**çš„æ´»åŠ¨ç±»å‹ï¼ˆåªæ˜¯ä¸ºäº†è¯´æ˜è¿™ä¸ªç±»å‹åæ˜¯æˆ‘å®Œå…¨ç¼–é€ çš„ï¼‰ä¼¼ä¹ä¸å…¶ä»–æ´»åŠ¨ç±»å‹ä¸åŒã€‚æˆ‘ä»¬å¹¶ä¸çœŸæ­£çŸ¥é“è¿™æ„å‘³ç€ä»€ä¹ˆ
    - æˆ‘ä»¬ä¹Ÿä¸éœ€è¦çŸ¥é“ï¼ - ç»§ç»­æˆ‘ä»¬çš„æŒ–æ˜ã€‚å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ä»…ç­›é€‰è¿™äº›æ´»åŠ¨ï¼Œå¹¶ç»§ç»­æŒ‰æˆ‘ä»¬å¯ä»¥æƒ³åˆ°çš„å…¶ä»–æ–¹å¼è¿›è¡Œåˆ†ç»„ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·æ“ä½œç³»ç»Ÿæ˜¯æœ‰æ„ä¹‰çš„ã€‚
- en: Hmmm, Android seems to be in trouble. iOS is OK, which suggests that the problem
    is on the client side - a broken app version maybe?
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: å—¯ï¼ŒAndroid ä¼¼ä¹é‡åˆ°äº†éº»çƒ¦ã€‚iOS æ²¡é—®é¢˜ï¼Œè¿™è¡¨æ˜é—®é¢˜å‡ºåœ¨å®¢æˆ·ç«¯ - å¯èƒ½æ˜¯ä¸€ä¸ªæŸåçš„åº”ç”¨ç¨‹åºç‰ˆæœ¬ï¼Ÿ
- en: Weird. Some are suffering, some others donâ€™t. Check OS Version maybe?
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: å¥‡æ€ªã€‚æœ‰äº›é­å—äº†ï¼Œå…¶ä»–ä¸€äº›æ²¡äº‹ã€‚æ£€æŸ¥æ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¹Ÿè®¸ï¼Ÿ
- en: Ha! Itâ€™s the newest version of the OS, and looks like some of the app versions
    are not doing well on this OS version for this type of campaign. The dedicated
    teams may look deeper now, given this information.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: å“ˆï¼è¿™æ˜¯æœ€æ–°ç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿï¼Œçœ‹èµ·æ¥ä¸€äº›åº”ç”¨ç¨‹åºç‰ˆæœ¬åœ¨è¿™ä¸ªæ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¸Šå¯¹è¿™ç§ç±»å‹çš„æ´»åŠ¨æ•ˆæœä¸ä½³ã€‚é‰´äºè¿™äº›ä¿¡æ¯ï¼Œä¸“é—¨çš„å›¢é˜Ÿç°åœ¨å¯ä»¥æ›´æ·±å…¥åœ°è¿›è¡Œè°ƒæŸ¥ã€‚
- en: What happened? Without any knowledge of the system weâ€™ve narrowed down the scope
    of the issue, and identified the teams to take a lead for further investigation.
    Could we know in advance that this weird combination of OS, OS Version, Campaign
    Type and App Version might lead to some issue, to have a dedicated metric prepared?
    Of course no. This is an example of dealing with *unknown unknowns*. Weâ€™ve just
    dropped all the relevant context into Wide Events, and used it later when needed.
    Scuba made it simple to do the exploration because itâ€™s fast and has a really
    nice easy-to-use UI. Also note that we have never mentioned anything about cardinality.
    Because it doesnâ€™t matter - any field can be of any cardinality. Scuba works with
    raw events and doesnâ€™t pre-aggregate anything, and so cardinality is not an issue.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿåœ¨ä¸çŸ¥é“ç³»ç»Ÿçš„ä»»ä½•çŸ¥è¯†çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å·²ç»ç¼©å°äº†é—®é¢˜çš„èŒƒå›´ï¼Œå¹¶ç¡®å®šäº†è´Ÿè´£è¿›ä¸€æ­¥è°ƒæŸ¥çš„å›¢é˜Ÿã€‚æˆ‘ä»¬èƒ½å¦é¢„å…ˆçŸ¥é“è¿™ç§å¥‡æ€ªçš„ OSã€OS ç‰ˆæœ¬ã€æ´»åŠ¨ç±»å‹å’Œåº”ç”¨ç‰ˆæœ¬çš„ç»„åˆå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œä»¥å‡†å¤‡å¥½ä¸€ä¸ªä¸“é—¨çš„æŒ‡æ ‡ï¼Ÿå½“ç„¶ä¸èƒ½ã€‚è¿™æ˜¯å¤„ç†*æœªçŸ¥æœªçŸ¥*çš„ä¸€ä¸ªä¾‹å­ã€‚æˆ‘ä»¬åˆšåˆšå°†æ‰€æœ‰ç›¸å…³çš„ä¸Šä¸‹æ–‡éƒ½æ”¾å…¥äº†
    Wide Events ä¸­ï¼Œå¹¶åœ¨éœ€è¦æ—¶ä½¿ç”¨äº†å®ƒä»¬ã€‚Scuba ä½¿æ¢ç´¢å˜å¾—ç®€å•ï¼Œå› ä¸ºå®ƒå¿«é€Ÿè€Œä¸”å…·æœ‰éå¸¸å¥½çš„æ˜“äºä½¿ç”¨çš„ç”¨æˆ·ç•Œé¢ã€‚è¿˜è¦æ³¨æ„ï¼Œæˆ‘ä»¬ä»æœªæåŠè¿‡åŸºæ•°çš„ä»»ä½•å†…å®¹ã€‚å› ä¸ºè¿™ä¸é‡è¦
    - ä»»ä½•å­—æ®µéƒ½å¯ä»¥æ˜¯ä»»ä½•åŸºæ•°ã€‚Scuba ä½¿ç”¨åŸå§‹äº‹ä»¶å·¥ä½œï¼Œä¸é¢„å…ˆèšåˆä»»ä½•å†…å®¹ï¼Œå› æ­¤åŸºæ•°ä¸æ˜¯é—®é¢˜ã€‚
- en: Sometimes UI / Visualisation aspect doesnâ€™t get enough attention, and observability
    systems offer some query language - either a proprietary (bad-bad-bad), or SQL
    (slightly better, but still bad). Such an interface makes it close to impossible
    to conduct similar investigations. One important aspect of Scuba that all the
    fields - function, filter, grouping, etc. - are *explorable.* Meaning that there
    is an easy way to see what kind of values we can pick. When the owners of a certain
    field are not lazy, they even included a detailed description for the given field
    with relevant links etc. This is huge. I have successfully investigated a lot
    of incidents myself, without full understanding of either the whole system, or
    the data available in this dataset. And boy I did learn a lot about the system
    during these investigations, simply via playing around with Scuba! This was amazing.
    This was observability paradise.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
- en: Now imagine my level of confusion and disbelief when I left Meta and got to
    know the state of observability systems outside.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: Logs? Traces? Metrics? What the hell? Wide Events, anyone? Can I please not
    learn that 60 terms from the Glossary and just â€¦ explore stuff?
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: 'It took me quite a while to map my Scuba-based mental model to Open Telemetry
    mental model. I realised that Open Telemetryâ€™s Span is, in fact, the Wide Event.
    Actually, Iâ€™m still not quite sure I got it right:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: 'If we take AdImpression example, this impression is not really an operation,
    itâ€™s just some fact we want to recordâ€¦ To be fair, there is some notion of Event
    in Open Telemetry:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: But if we follow the links to dig deeper, we again find out that Event is in
    fact one of Traces, Metrics or Logs ğŸ¤·
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: 'But anyway, Span is the closest concept to Wide Event. The thing is - itâ€™s
    extremely hard to advocate for this mental model when the one suggested by Open
    Telemetry is already learned. Which is really upsetting, because Traces, Metrics
    and Logs are all just special cases of Wide Events really:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: '**Traces and Spans:** These are just wide events having **SpanId, TraceId and
    ParentSpanId** fields. So we can filter all spans with a given TraceId, topologically
    sort them using SpanId â†’ ParentSpanId relation, and draw that distributed tracing
    view everyone loves.'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Logs:** Honestly, Iâ€™m really confused what Open Telemetry means by Logs.
    Looks like [a lot of things](https://opentelemetry.io/docs/specs/otel/glossary/#logs),
    and one of them is Structured Log which is pretty much the Wide Event. Great!
    The problem, however, that â€œa logâ€ is quite a defined concept, and usually people
    mean by it is what is produced by those `logger.info(â€¦)` calls. Anyway, whatever
    is meant, logs can be easily mapped to wide events, of course. In the simplest
    case we can just get the log message, put it to the â€œlog_messageâ€ field, add a
    bunch of metadata, and be happy. In a more complex case, we can try to automatically
    extract a template from a log message via removing tokens that looks like IDs,
    and get a hash of this template. This can allow to quickly get the most frequent
    error, for instance, via grouping by this hash. Meta has such a system, and itâ€™s
    pretty cool.'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Metrics:** Metrics can be easily mapped, too. We just need to emit a Wide
    Event once per some interval containing the state of the system (system metrics
    like cpu, various counters,â€¦). Prometheus, by the way, does exactly that with
    the scraping approach - takes a snapshot of the system once in a while. Unlike
    with prometheus, however, with Wide Events approach we donâ€™t need to worry about
    cardinality.'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: But Wide Events can offer much much more than these â€œ3 pillarsâ€. The aforementioned
    debugging session is already a case which is not really covered by Traces, Logs
    and Metrics - not naturally, at least. There could be other use cases, too - for
    instance, continuous profiling data can be easily represented as a Wide Event,
    and queried to build a [Flame Graph](https://www.brendangregg.com/flamegraphs.html).
    No need to have a separate system for this - a single system working with Wide
    Events can do it all. Imagine the possibilities for cross-correlation & root cause
    analysis when everything in one place, stored together. Especially now, in the
    era of raise of AI-based tools that are pretty good in finding correlations in
    data.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: ä½†æ˜¯ Wide Events å¯ä»¥æä¾›æ¯”è¿™äº›â€œä¸‰å¤§æ”¯æŸ±â€å¤šå¾—å¤šçš„åŠŸèƒ½ã€‚å‰è¿°çš„è°ƒè¯•ä¼šè¯å·²ç»æ˜¯ä¸€ä¸ªå®é™…ä¸Šå¹¶ä¸çœŸæ­£ç”± Tracesã€Logs å’Œ Metrics
    æ‰€è¦†ç›–çš„æ¡ˆä¾‹ - è‡³å°‘ä¸æ˜¯è‡ªç„¶åœ°ã€‚è¿˜å¯èƒ½æœ‰å…¶ä»–ç”¨ä¾‹ - ä¾‹å¦‚ï¼Œè¿ç»­çš„æ€§èƒ½åˆ†ææ•°æ®å¯ä»¥è½»æ¾åœ°è¡¨ç¤ºä¸º Wide Eventï¼Œå¹¶æŸ¥è¯¢ä»¥æ„å»º[ç«ç„°å›¾](https://www.brendangregg.com/flamegraphs.html)ã€‚ä¸éœ€è¦å•ç‹¬çš„ç³»ç»Ÿæ¥å®Œæˆè¿™é¡¹å·¥ä½œ
    - ä¸€ä¸ªå¤„ç† Wide Events çš„å•ä¸€ç³»ç»Ÿå°±å¯ä»¥åšåˆ°ã€‚æƒ³è±¡ä¸€ä¸‹å½“æ‰€æœ‰ä¸œè¥¿éƒ½åœ¨ä¸€ä¸ªåœ°æ–¹å­˜å‚¨åœ¨ä¸€èµ·æ—¶ï¼Œè¿›è¡Œäº¤å‰ç›¸å…³å’Œæ ¹æœ¬åŸå› åˆ†æçš„å¯èƒ½æ€§ã€‚ç‰¹åˆ«æ˜¯åœ¨ç°åœ¨ï¼ŒAI
    å·¥å…·å…´èµ·çš„æ—¶ä»£ï¼Œè¿™äº›å·¥å…·åœ¨æ‰¾åˆ°æ•°æ®ç›¸å…³æ€§æ–¹é¢éå¸¸å‡ºè‰²ã€‚
- en: I donâ€™t knowâ€¦ I just wanted to express my frustration with the level of confusion
    and this focus on â€œ3 pillarsâ€.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä¸çŸ¥é“... æˆ‘åªæ˜¯æƒ³è¡¨è¾¾æˆ‘å¯¹æ··ä¹±ç¨‹åº¦ä»¥åŠå¯¹â€œä¸‰å¤§æ”¯æŸ±â€å…³æ³¨çš„å¤±æœ›ã€‚
- en: I just wish that observability vendors took a stand against confusion, and offered
    a simple and natural way to interact with the system. [Honeycomb](https://www.honeycomb.io/)
    seems is [doing that](https://x.com/mipsytipsy/status/1738048200630792245?s=20),
    as well as some other systems like [Axiom](https://axiom.co/). This is great!
    And hope the others will follow.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘åªå¸Œæœ›å¯è§‚æ€§ä¾›åº”å•†èƒ½å¤Ÿå¯¹æ··ä¹±é‡‡å–ä¸€ç§ç«‹åœºï¼Œå¹¶æä¾›ä¸€ç§ç®€å•è‡ªç„¶çš„ä¸ç³»ç»Ÿäº¤äº’çš„æ–¹å¼ã€‚[Honeycomb](https://www.honeycomb.io/)ä¼¼ä¹æ­£åœ¨[è¿™æ ·åš](https://x.com/mipsytipsy/status/1738048200630792245?s=20)ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–ç³»ç»Ÿåƒ[Axiom](https://axiom.co/)ã€‚è¿™å¤ªæ£’äº†ï¼å¸Œæœ›å…¶ä»–äººä¹Ÿä¼šæ•ˆä»¿ã€‚
