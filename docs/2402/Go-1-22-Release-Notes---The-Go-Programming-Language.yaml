- en: <!--yml
  prefs: []
  type: TYPE_NORMAL
- en: 'category: 未分类'
  prefs: []
  type: TYPE_NORMAL
- en: 'date: 2024-05-27 14:41:22'
  prefs: []
  type: TYPE_NORMAL
- en: -->
  prefs: []
  type: TYPE_NORMAL
- en: Go 1.22 Release Notes - The Go Programming Language
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 来源：[https://go.dev/doc/go1.22](https://go.dev/doc/go1.22)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Go 1.22 Release Notes
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Introduction to Go 1.22
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The latest Go release, version 1.22, arrives six months after [Go 1.21](/doc/go1.21).
    Most of its changes are in the implementation of the toolchain, runtime, and libraries.
    As always, the release maintains the Go 1 [promise of compatibility](/doc/go1compat).
    We expect almost all Go programs to continue to compile and run as before.
  prefs: []
  type: TYPE_NORMAL
- en: Changes to the language
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Go 1.22 makes two changes to “for” loops.
  prefs: []
  type: TYPE_NORMAL
- en: Previously, the variables declared by a “for” loop were created once and updated
    by each iteration. In Go 1.22, each iteration of the loop creates new variables,
    to avoid accidental sharing bugs. The [transition support tooling](/wiki/LoopvarExperiment#my-test-fails-with-the-change-how-can-i-debug-it)
    described in the proposal continues to work in the same way it did in Go 1.21.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '“For” loops may now range over integers. For [example](/play/p/ky02zZxgk_r?v=gotip):'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: See the spec for [details](/ref/spec#For_range).
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Go 1.22 includes a preview of a language change we are considering for a future
    version of Go: [range-over-function iterators](/wiki/RangefuncExperiment). Building
    with `GOEXPERIMENT=rangefunc` enables this feature.'
  prefs: []
  type: TYPE_NORMAL
- en: Go command
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Commands in [workspaces](/ref/mod#workspaces) can now use a `vendor` directory
    containing the dependencies of the workspace. The directory is created by [`go`
    `work` `vendor`](/pkg/cmd/go#hdr-Make_vendored_copy_of_dependencies), and used
    by build commands when the `-mod` flag is set to `vendor`, which is the default
    when a workspace `vendor` directory is present.
  prefs: []
  type: TYPE_NORMAL
- en: 'Note that the `vendor` directory’s contents for a workspace are different from
    those of a single module: if the directory at the root of a workspace also contains
    one of the modules in the workspace, its `vendor` directory can contain the dependencies
    of either the workspace or of the module, but not both.'
  prefs: []
  type: TYPE_NORMAL
- en: '`go` `get` is no longer supported outside of a module in the legacy `GOPATH`
    mode (that is, with `GO111MODULE=off`). Other build commands, such as `go` `build`
    and `go` `test`, will continue to work indefinitely for legacy `GOPATH` programs.'
  prefs: []
  type: TYPE_NORMAL
- en: '`go` `mod` `init` no longer attempts to import module requirements from configuration
    files for other vendoring tools (such as `Gopkg.lock`).'
  prefs: []
  type: TYPE_NORMAL
- en: '`go` `test` `-cover` now prints coverage summaries for covered packages that
    do not have their own test files. Prior to Go 1.22 a `go` `test` `-cover` run
    for such a package would report'
  prefs: []
  type: TYPE_NORMAL
- en: '`? mymod/mypack [no test files]`'
  prefs: []
  type: TYPE_NORMAL
- en: 'and now with Go 1.22, functions in the package are treated as uncovered:'
  prefs: []
  type: TYPE_NORMAL
- en: '`mymod/mypack coverage: 0.0% of statements`'
  prefs: []
  type: TYPE_NORMAL
- en: Note that if a package contains no executable code at all, we can’t report a
    meaningful coverage percentage; for such packages the `go` tool will continue
    to report that there are no test files.
  prefs: []
  type: TYPE_NORMAL
- en: '`go` build commands that invoke the linker now error out if an external (C)
    linker will be used but cgo is not enabled. (The Go runtime requires cgo support
    to ensure that it is compatible with any additional libraries added by the C linker.)'
  prefs: []
  type: TYPE_NORMAL
- en: Trace
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The `trace` tool’s web UI has been gently refreshed as part of the work to support
    the new tracer, resolving several issues and improving the readability of various
    sub-pages. The web UI now supports exploring traces in a thread-oriented view.
    The trace viewer also now displays the full duration of all system calls.
  prefs: []
  type: TYPE_NORMAL
- en: These improvements only apply for viewing traces produced by programs built
    with Go 1.22 or newer. A future release will bring some of these improvements
    to traces produced by older version of Go.
  prefs: []
  type: TYPE_NORMAL
- en: Vet
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: References to loop variables
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: The behavior of the `vet` tool has changed to match the new semantics (see above)
    of loop variables in Go 1.22. When analyzing a file that requires Go 1.22 or newer
    (due to its go.mod file or a per-file build constraint), `vet` no longer reports
    references to loop variables from within a function literal that might outlive
    the iteration of the loop. In Go 1.22, loop variables are created anew for each
    iteration, so such references are no longer at risk of using a variable after
    it has been updated by the loop.
  prefs: []
  type: TYPE_NORMAL
- en: New warnings for missing values after append
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: The `vet` tool now reports calls to [`append`](/pkg/builtin/#append) that pass
    no values to be appended to the slice, such as `slice = append(slice)`. Such a
    statement has no effect, and experience has shown that is nearly always a mistake.
  prefs: []
  type: TYPE_NORMAL
- en: New warnings for deferring `time.Since`
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'The vet tool now reports a non-deferred call to [`time.Since(t)`](/pkg/time/#Since)
    within a `defer` statement. This is equivalent to calling `time.Now().Sub(t)`
    before the `defer` statement, not when the deferred function is called. In nearly
    all cases, the correct code requires deferring the `time.Since` call. For example:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: New warnings for mismatched key-value pairs in `log/slog` calls
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: The vet tool now reports invalid arguments in calls to functions and methods
    in the structured logging package, [`log/slog`](/pkg/log/slog), that accept alternating
    key/value pairs. It reports calls where an argument in a key position is neither
    a `string` nor a `slog.Attr`, and where a final key is missing its value.
  prefs: []
  type: TYPE_NORMAL
- en: Runtime
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The runtime now keeps type-based garbage collection metadata nearer to each
    heap object, improving the CPU performance (latency or throughput) of Go programs
    by 1–3%. This change also reduces the memory overhead of the majority Go programs
    by approximately 1% by deduplicating redundant metadata. Some programs may see
    a smaller improvement because this change adjusts the size class boundaries of
    the memory allocator, so some objects may be moved up a size class.
  prefs: []
  type: TYPE_NORMAL
- en: A consequence of this change is that some objects’ addresses that were previously
    always aligned to a 16 byte (or higher) boundary will now only be aligned to an
    8 byte boundary. Some programs that use assembly instructions that require memory
    addresses to be more than 8-byte aligned and rely on the memory allocator’s previous
    alignment behavior may break, but we expect such programs to be rare. Such programs
    may be built with `GOEXPERIMENT=noallocheaders` to revert to the old metadata
    layout and restore the previous alignment behavior, but package owners should
    update their assembly code to avoid the alignment assumption, as this workaround
    will be removed in a future release.
  prefs: []
  type: TYPE_NORMAL
- en: On the `windows/amd64 port`, programs linking or loading Go libraries built
    with `-buildmode=c-archive` or `-buildmode=c-shared` can now use the `SetUnhandledExceptionFilter`
    Win32 function to catch exceptions not handled by the Go runtime. Note that this
    was already supported on the `windows/386` port.
  prefs: []
  type: TYPE_NORMAL
- en: Compiler
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Profile-guided Optimization (PGO)](/doc/pgo) builds can now devirtualize a
    higher proportion of calls than previously possible. Most programs from a representative
    set of Go programs now see between 2 and 14% improvement at runtime from enabling
    PGO.'
  prefs: []
  type: TYPE_NORMAL
- en: The compiler now interleaves devirtualization and inlining, so interface method
    calls are better optimized.
  prefs: []
  type: TYPE_NORMAL
- en: 'Go 1.22 also includes a preview of an enhanced implementation of the compiler’s
    inlining phase that uses heuristics to boost inlinability at call sites deemed
    “important” (for example, in loops) and discourage inlining at call sites deemed
    “unimportant” (for example, on panic paths). Building with `GOEXPERIMENT=newinliner`
    enables the new call-site heuristics; see [issue #61502](/issue/61502) for more
    info and to provide feedback.'
  prefs: []
  type: TYPE_NORMAL
- en: Linker
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The linker’s `-s` and `-w` flags are now behave more consistently across all
    platforms. The `-w` flag suppresses DWARF debug information generation. The `-s`
    flag suppresses symbol table generation. The `-s` flag also implies the `-w` flag,
    which can be negated with `-w=0`. That is, `-s` `-w=0` will generate a binary
    with DWARF debug information generation but without the symbol table.
  prefs: []
  type: TYPE_NORMAL
- en: 'On ELF platforms, the `-B` linker flag now accepts a special form: with `-B`
    `gobuildid`, the linker will generate a GNU build ID (the ELF `NT_GNU_BUILD_ID`
    note) derived from the Go build ID.'
  prefs: []
  type: TYPE_NORMAL
- en: On Windows, when building with `-linkmode=internal`, the linker now preserves
    SEH information from C object files by copying the `.pdata` and `.xdata` sections
    into the final binary. This helps with debugging and profiling binaries using
    native tools, such as WinDbg. Note that until now, C functions’ SEH exception
    handlers were not being honored, so this change may cause some programs to behave
    differently. `-linkmode=external` is not affected by this change, as external
    linkers already preserve SEH information.
  prefs: []
  type: TYPE_NORMAL
- en: Bootstrap
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As mentioned in the [Go 1.20 release notes](/doc/go1.20#bootstrap), Go 1.22
    now requires the final point release of Go 1.20 or later for bootstrap. We expect
    that Go 1.24 will require the final point release of Go 1.22 or later for bootstrap.
  prefs: []
  type: TYPE_NORMAL
- en: Core library
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: New math/rand/v2 package
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Go 1.22 includes the first “v2” package in the standard library, [`math/rand/v2`](/pkg/math/rand/v2/).
    The changes compared to [`math/rand`](/pkg/math/rand/) are detailed in [proposal
    #61716](/issue/61716). The most important changes are:'
  prefs: []
  type: TYPE_NORMAL
- en: The `Read` method, deprecated in `math/rand`, was not carried forward for `math/rand/v2`.
    (It remains available in `math/rand`.) The vast majority of calls to `Read` should
    use [`crypto/rand`’s `Read`](/pkg/crypto/rand/#Read) instead. Otherwise a custom
    `Read` can be constructed using the `Uint64` method.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The global generator accessed by top-level functions is unconditionally randomly
    seeded. Because the API guarantees no fixed sequence of results, optimizations
    like per-thread random generator states are now possible.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The [`Source`](/pkg/math/rand/v2/#Source) interface now has a single `Uint64`
    method; there is no `Source64` interface.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Many methods now use faster algorithms that were not possible to adopt in `math/rand`
    because they changed the output streams.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The `Intn`, `Int31`, `Int31n`, `Int63`, and `Int64n` top-level functions and
    methods from `math/rand` are spelled more idiomatically in `math/rand/v2`: `IntN`,
    `Int32`, `Int32N`, `Int64`, and `Int64N`. There are also new top-level functions
    and methods `Uint32`, `Uint32N`, `Uint64`, `Uint64N`, and `UintN`.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The new generic function [`N`](/pkg/math/rand/v2/#N) is like [`Int64N`](/pkg/math/rand/v2/#Int64N)
    or [`Uint64N`](/pkg/math/rand/v2/#Uint64N) but works for any integer type. For
    example a random duration from 0 up to 5 minutes is `rand.N(5*time.Minute)`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The Mitchell & Reeds LFSR generator provided by [`math/rand`’s `Source`](/pkg/math/rand/#Source)
    has been replaced by two more modern pseudo-random generator sources: [`ChaCha8`](/pkg/math/rand/v2/#ChaCha8)
    and [`PCG`](/pkg/math/rand/v2/#PCG). ChaCha8 is a new, cryptographically strong
    random number generator roughly similar to PCG in efficiency. ChaCha8 is the algorithm
    used for the top-level functions in `math/rand/v2`. As of Go 1.22, `math/rand`’s
    top-level functions (when not explicitly seeded) and the Go runtime also use ChaCha8
    for randomness.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We plan to include an API migration tool in a future release, likely Go 1.23.
  prefs: []
  type: TYPE_NORMAL
- en: New go/version package
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The new [`go/version`](/pkg/go/version/) package implements functions for validating
    and comparing Go version strings.
  prefs: []
  type: TYPE_NORMAL
- en: Enhanced routing patterns
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: HTTP routing in the standard library is now more expressive. The patterns used
    by [`net/http.ServeMux`](/pkg/net/http#ServeMux) have been enhanced to accept
    methods and wildcards.
  prefs: []
  type: TYPE_NORMAL
- en: Registering a handler with a method, like `"POST /items/create"`, restricts
    invocations of the handler to requests with the given method. A pattern with a
    method takes precedence over a matching pattern without one. As a special case,
    registering a handler with `"GET"` also registers it with `"HEAD"`.
  prefs: []
  type: TYPE_NORMAL
- en: Wildcards in patterns, like `/items/{id}`, match segments of the URL path. The
    actual segment value may be accessed by calling the [`Request.PathValue`](/pkg/net/http#Request.PathValue)
    method. A wildcard ending in “…”, like `/files/{path...}`, must occur at the end
    of a pattern and matches all the remaining segments.
  prefs: []
  type: TYPE_NORMAL
- en: A pattern that ends in “/” matches all paths that have it as a prefix, as always.
    To match the exact pattern including the trailing slash, end it with `{$}`, as
    in `/exact/match/{$}`.
  prefs: []
  type: TYPE_NORMAL
- en: If two patterns overlap in the requests that they match, then the more specific
    pattern takes precedence. If neither is more specific, the patterns conflict.
    This rule generalizes the original precedence rules and maintains the property
    that the order in which patterns are registered does not matter.
  prefs: []
  type: TYPE_NORMAL
- en: This change breaks backwards compatibility in small ways, some obvious—patterns
    with “{” and “}” behave differently— and some less so—treatment of escaped paths
    has been improved. The change is controlled by a [`GODEBUG`](/doc/godebug) field
    named `httpmuxgo121`. Set `httpmuxgo121=1` to restore the old behavior.
  prefs: []
  type: TYPE_NORMAL
- en: Minor changes to the library
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: As always, there are various minor changes and updates to the library, made
    with the Go 1 [promise of compatibility](/doc/go1compat) in mind. There are also
    various performance improvements, not enumerated here.
  prefs: []
  type: TYPE_NORMAL
- en: '[archive/tar](/pkg/archive/tar/)'
  prefs: []
  type: TYPE_NORMAL
- en: The new method [`Writer.AddFS`](/pkg/archive/tar#Writer.AddFS) adds all of the
    files from an [`fs.FS`](/pkg/io/fs#FS) to the archive.
  prefs: []
  type: TYPE_NORMAL
- en: '[archive/zip](/pkg/archive/zip/)'
  prefs: []
  type: TYPE_NORMAL
- en: The new method [`Writer.AddFS`](/pkg/archive/zip#Writer.AddFS) adds all of the
    files from an [`fs.FS`](/pkg/io/fs#FS) to the archive.
  prefs: []
  type: TYPE_NORMAL
- en: '[bufio](/pkg/bufio/)'
  prefs: []
  type: TYPE_NORMAL
- en: When a [`SplitFunc`](/pkg/bufio#SplitFunc) returns [`ErrFinalToken`](/pkg/bufio#ErrFinalToken)
    with a `nil` token, [`Scanner`](/pkg/bufio#Scanner) will now stop immediately.
    Previously, it would report a final empty token before stopping, which was usually
    not desired. Callers that do want to report a final empty token can do so by returning
    `[]byte{}` rather than `nil`.
  prefs: []
  type: TYPE_NORMAL
- en: '[cmp](/pkg/cmp/)'
  prefs: []
  type: TYPE_NORMAL
- en: The new function `Or` returns the first in a sequence of values that is not
    the zero value.
  prefs: []
  type: TYPE_NORMAL
- en: '[crypto/tls](/pkg/crypto/tls/)'
  prefs: []
  type: TYPE_NORMAL
- en: '[`ConnectionState.ExportKeyingMaterial`](/pkg/crypto/tls#ConnectionState.ExportKeyingMaterial)
    will now return an error unless TLS 1.3 is in use, or the `extended_master_secret`
    extension is supported by both the server and client. `crypto/tls` has supported
    this extension since Go 1.20\. This can be disabled with the `tlsunsafeekm=1`
    GODEBUG setting.'
  prefs: []
  type: TYPE_NORMAL
- en: By default, the minimum version offered by `crypto/tls` servers is now TLS 1.2
    if not specified with [`config.MinimumVersion`](/pkg/crypto/tls#Config.MinimumVersion),
    matching the behavior of `crypto/tls` clients. This change can be reverted with
    the `tls10server=1` GODEBUG setting.
  prefs: []
  type: TYPE_NORMAL
- en: By default, cipher suites without ECDHE support are no longer offered by either
    clients or servers during pre-TLS 1.3 handshakes. This change can be reverted
    with the `tlsrsakex=1` GODEBUG setting.
  prefs: []
  type: TYPE_NORMAL
- en: '[crypto/x509](/pkg/crypto/x509/)'
  prefs: []
  type: TYPE_NORMAL
- en: The new [`CertPool.AddCertWithConstraint`](/pkg/crypto/x509#CertPool.AddCertWithConstraint)
    method can be used to add customized constraints to root certificates to be applied
    during chain building.
  prefs: []
  type: TYPE_NORMAL
- en: On Android, root certificates will now be loaded from `/data/misc/keychain/certs-added`
    as well as `/system/etc/security/cacerts`.
  prefs: []
  type: TYPE_NORMAL
- en: A new type, [`OID`](/pkg/crypto/x509#OID), supports ASN.1 Object Identifiers
    with individual components larger than 31 bits. A new field which uses this type,
    [`Policies`](/pkg/crypto/x509#Certificate.Policies), is added to the `Certificate`
    struct, and is now populated during parsing. Any OIDs which cannot be represented
    using a [`asn1.ObjectIdentifier`](/pkg/encoding/asn1#ObjectIdentifier) will appear
    in `Policies`, but not in the old `PolicyIdentifiers` field. When calling [`CreateCertificate`](/pkg/crypto/x509#CreateCertificate),
    the `Policies` field is ignored, and policies are taken from the `PolicyIdentifiers`
    field. Using the `x509usepolicies=1` GODEBUG setting inverts this, populating
    certificate policies from the `Policies` field, and ignoring the `PolicyIdentifiers`
    field. We may change the default value of `x509usepolicies` in Go 1.23, making
    `Policies` the default field for marshaling.
  prefs: []
  type: TYPE_NORMAL
- en: '[database/sql](/pkg/database/sql/)'
  prefs: []
  type: TYPE_NORMAL
- en: The new [`Null[T]`](/pkg/database/sql/#Null) type provide a way to scan nullable
    columns for any column types.
  prefs: []
  type: TYPE_NORMAL
- en: '[debug/elf](/pkg/debug/elf/)'
  prefs: []
  type: TYPE_NORMAL
- en: Constant `R_MIPS_PC32` is defined for use with MIPS64 systems.
  prefs: []
  type: TYPE_NORMAL
- en: Additional `R_LARCH_*` constants are defined for use with LoongArch systems.
  prefs: []
  type: TYPE_NORMAL
- en: '[encoding](/pkg/encoding/)'
  prefs: []
  type: TYPE_NORMAL
- en: The new methods `AppendEncode` and `AppendDecode` added to each of the `Encoding`
    types in the packages [`encoding/base32`](/pkg/encoding/base32), [`encoding/base64`](/pkg/encoding/base64),
    and [`encoding/hex`](/pkg/encoding/hex) simplify encoding and decoding from and
    to byte slices by taking care of byte slice buffer management.
  prefs: []
  type: TYPE_NORMAL
- en: The methods [`base32.Encoding.WithPadding`](/pkg/encoding/base32#Encoding.WithPadding)
    and [`base64.Encoding.WithPadding`](/pkg/encoding/base64#Encoding.WithPadding)
    now panic if the `padding` argument is a negative value other than `NoPadding`.
  prefs: []
  type: TYPE_NORMAL
- en: '[encoding/json](/pkg/encoding/json/)'
  prefs: []
  type: TYPE_NORMAL
- en: Marshaling and encoding functionality now escapes `'\b'` and `'\f'` characters
    as `\b` and `\f` instead of `\u0008` and `\u000c`.
  prefs: []
  type: TYPE_NORMAL
- en: '[go/ast](/pkg/go/ast/)'
  prefs: []
  type: TYPE_NORMAL
- en: 'The following declarations related to [syntactic identifier resolution](https://pkg.go.dev/go/ast#Object)
    are now [deprecated](/issue/52463): `Ident.Obj`, `Object`, `Scope`, `File.Scope`,
    `File.Unresolved`, `Importer`, `Package`, `NewPackage`. In general, identifiers
    cannot be accurately resolved without type information. Consider, for example,
    the identifier `K` in `T{K: ""}`: it could be the name of a local variable if
    T is a map type, or the name of a field if T is a struct type. New programs should
    use the [go/types](/pkg/go/types) package to resolve identifiers; see [`Object`](https://pkg.go.dev/go/types#Object),
    [`Info.Uses`](https://pkg.go.dev/go/types#Info.Uses), and [`Info.Defs`](https://pkg.go.dev/go/types#Info.Defs)
    for details.'
  prefs: []
  type: TYPE_NORMAL
- en: The new [`ast.Unparen`](https://pkg.go.dev/go/ast#Unparen) function removes
    any enclosing [parentheses](https://pkg.go.dev/go/ast#ParenExpr) from an [expression](https://pkg.go.dev/go/ast#Expr).
  prefs: []
  type: TYPE_NORMAL
- en: '[go/types](/pkg/go/types/)'
  prefs: []
  type: TYPE_NORMAL
- en: The new [`Alias`](/pkg/go/types#Alias) type represents type aliases. Previously,
    type aliases were not represented explicitly, so a reference to a type alias was
    equivalent to spelling out the aliased type, and the name of the alias was lost.
    The new representation retains the intermediate `Alias`. This enables improved
    error reporting (the name of a type alias can be reported), and allows for better
    handling of cyclic type declarations involving type aliases. In a future release,
    `Alias` types will also carry [type parameter information](/issue/46477). The
    new function [`Unalias`](/pkg/go/types#Unalias) returns the actual type denoted
    by an `Alias` type (or any other [`Type`](/pkg/go/types#Type) for that matter).
  prefs: []
  type: TYPE_NORMAL
- en: Because `Alias` types may break existing type switches that do not know to check
    for them, this functionality is controlled by a [`GODEBUG`](/doc/godebug) field
    named `gotypesalias`. With `gotypesalias=0`, everything behaves as before, and
    `Alias` types are never created. With `gotypesalias=1`, `Alias` types are created
    and clients must expect them. The default is `gotypesalias=0`. In a future release,
    the default will be changed to `gotypesalias=1`. *Clients of [`go/types`](/pkg/go/types)
    are urged to adjust their code as soon as possible to work with `gotypesalias=1`
    to eliminate problems early.*
  prefs: []
  type: TYPE_NORMAL
- en: The [`Info`](/pkg/go/types#Info) struct now exports the [`FileVersions`](/pkg/go/types#Info.FileVersions)
    map which provides per-file Go version information.
  prefs: []
  type: TYPE_NORMAL
- en: The new helper method [`PkgNameOf`](/pkg/go/types#Info.PkgNameOf) returns the
    local package name for the given import declaration.
  prefs: []
  type: TYPE_NORMAL
- en: The implementation of [`SizesFor`](/pkg/go/types#SizesFor) has been adjusted
    to compute the same type sizes as the compiler when the compiler argument for
    `SizesFor` is `"gc"`. The default [`Sizes`](/pkg/go/types#Sizes) implementation
    used by the type checker is now `types.SizesFor("gc", "amd64")`.
  prefs: []
  type: TYPE_NORMAL
- en: 'The start position ([`Pos`](/pkg/go/types#Scope.Pos)) of the lexical environment
    block ([`Scope`](/pkg/go/types#Scope)) that represents a function body has changed:
    it used to start at the opening curly brace of the function body, but now starts
    at the function’s `func` token.'
  prefs: []
  type: TYPE_NORMAL
- en: '[html/template](/pkg/html/template/)'
  prefs: []
  type: TYPE_NORMAL
- en: JavaScript template literals may now contain Go template actions, and parsing
    a template containing one will no longer return `ErrJSTemplate`. Similarly the
    GODEBUG setting `jstmpllitinterp` no longer has any effect.
  prefs: []
  type: TYPE_NORMAL
- en: '[io](/pkg/io/)'
  prefs: []
  type: TYPE_NORMAL
- en: The new [`SectionReader.Outer`](/pkg/io#SectionReader.Outer) method returns
    the [`ReaderAt`](/pkg/io#ReaderAt), offset, and size passed to [`NewSectionReader`](/pkg/io#NewSectionReader).
  prefs: []
  type: TYPE_NORMAL
- en: '[log/slog](/pkg/log/slog/)'
  prefs: []
  type: TYPE_NORMAL
- en: The new [`SetLogLoggerLevel`](/pkg/log/slog#SetLogLoggerLevel) function controls
    the level for the bridge between the `slog` and `log` packages. It sets the minimum
    level for calls to the top-level `slog` logging functions, and it sets the level
    for calls to `log.Logger` that go through `slog`.
  prefs: []
  type: TYPE_NORMAL
- en: '[math/big](/pkg/math/big/)'
  prefs: []
  type: TYPE_NORMAL
- en: The new method [`Rat.FloatPrec`](/pkg/math/big#Rat.FloatPrec) computes the number
    of fractional decimal digits required to represent a rational number accurately
    as a floating-point number, and whether accurate decimal representation is possible
    in the first place.
  prefs: []
  type: TYPE_NORMAL
- en: '[net](/pkg/net/)'
  prefs: []
  type: TYPE_NORMAL
- en: When [`io.Copy`](/pkg/io#Copy) copies from a `TCPConn` to a `UnixConn`, it will
    now use Linux’s `splice(2)` system call if possible, using the new method [`TCPConn.WriteTo`](/pkg/net#TCPConn.WriteTo).
  prefs: []
  type: TYPE_NORMAL
- en: The Go DNS Resolver, used when building with “-tags=netgo”, now searches for
    a matching name in the Windows hosts file, located at `%SystemRoot%\System32\drivers\etc\hosts`,
    before making a DNS query.
  prefs: []
  type: TYPE_NORMAL
- en: '[net/http](/pkg/net/http/)'
  prefs: []
  type: TYPE_NORMAL
- en: The new functions [`ServeFileFS`](/pkg/net/http#ServeFileFS), [`FileServerFS`](/pkg/net/http#FileServerFS),
    and [`NewFileTransportFS`](/pkg/net/http#NewFileTransportFS) are versions of the
    existing `ServeFile`, `FileServer`, and `NewFileTransport`, operating on an `fs.FS`.
  prefs: []
  type: TYPE_NORMAL
- en: The HTTP server and client now reject requests and responses containing an invalid
    empty `Content-Length` header. The previous behavior may be restored by setting
    [`GODEBUG`](/doc/godebug) field `httplaxcontentlength=1`.
  prefs: []
  type: TYPE_NORMAL
- en: The new method [`Request.PathValue`](/pkg/net/http#Request.PathValue) returns
    path wildcard values from a request and the new method [`Request.SetPathValue`](/pkg/net/http#Request.SetPathValue)
    sets path wildcard values on a request.
  prefs: []
  type: TYPE_NORMAL
- en: '[net/http/cgi](/pkg/net/http/cgi/)'
  prefs: []
  type: TYPE_NORMAL
- en: When executing a CGI process, the `PATH_INFO` variable is now always set to
    the empty string or a value starting with a `/` character, as required by RFC
    3875\. It was previously possible for some combinations of [`Handler.Root`](/pkg/net/http/cgi#Handler.Root)
    and request URL to violate this requirement.
  prefs: []
  type: TYPE_NORMAL
- en: '[net/netip](/pkg/net/netip/)'
  prefs: []
  type: TYPE_NORMAL
- en: The new [`AddrPort.Compare`](/pkg/net/netip#AddrPort.Compare) method compares
    two `AddrPort`s.
  prefs: []
  type: TYPE_NORMAL
- en: '[os](/pkg/os/)'
  prefs: []
  type: TYPE_NORMAL
- en: On Windows, the [`Stat`](/pkg/os#Stat) function now follows all reparse points
    that link to another named entity in the system. It was previously only following
    `IO_REPARSE_TAG_SYMLINK` and `IO_REPARSE_TAG_MOUNT_POINT` reparse points.
  prefs: []
  type: TYPE_NORMAL
- en: On Windows, passing [`O_SYNC`](/pkg/os#O_SYNC) to [`OpenFile`](/pkg/os#OpenFile)
    now causes write operations to go directly to disk, equivalent to `O_SYNC` on
    Unix platforms.
  prefs: []
  type: TYPE_NORMAL
- en: On Windows, the [`ReadDir`](/pkg/os#ReadDir), [`File.ReadDir`](/pkg/os#File.ReadDir),
    [`File.Readdir`](/pkg/os#File.Readdir), and [`File.Readdirnames`](/pkg/os#File.Readdirnames)
    functions now read directory entries in batches to reduce the number of system
    calls, improving performance up to 30%.
  prefs: []
  type: TYPE_NORMAL
- en: When [`io.Copy`](/pkg/io#Copy) copies from a `File` to a `net.UnixConn`, it
    will now use Linux’s `sendfile(2)` system call if possible, using the new method
    [`File.WriteTo`](/pkg/os#File.WriteTo).
  prefs: []
  type: TYPE_NORMAL
- en: '[os/exec](/pkg/os/exec/)'
  prefs: []
  type: TYPE_NORMAL
- en: On Windows, [`LookPath`](/pkg/os/exec#LookPath) now ignores empty entries in
    `%PATH%`, and returns `ErrNotFound` (instead of `ErrNotExist`) if no executable
    file extension is found to resolve an otherwise-unambiguous name.
  prefs: []
  type: TYPE_NORMAL
- en: On Windows, [`Command`](/pkg/os/exec#Command) and [`Cmd.Start`](/pkg/os/exec#Cmd.Start)
    no longer call `LookPath` if the path to the executable is already absolute and
    has an executable file extension. In addition, `Cmd.Start` no longer writes the
    resolved extension back to the [`Path`](/pkg/os/exec#Cmd.Path) field, so it is
    now safe to call the `String` method concurrently with a call to `Start`.
  prefs: []
  type: TYPE_NORMAL
- en: '[reflect](/pkg/reflect/)'
  prefs: []
  type: TYPE_NORMAL
- en: The [`Value.IsZero`](/pkg/reflect/#Value.IsZero) method will now return true
    for a floating-point or complex negative zero, and will return true for a struct
    value if a blank field (a field named `_`) somehow has a non-zero value. These
    changes make `IsZero` consistent with comparing a value to zero using the language
    `==` operator.
  prefs: []
  type: TYPE_NORMAL
- en: The [`PtrTo`](/pkg/reflect/#PtrTo) function is deprecated, in favor of [`PointerTo`](/pkg/reflect/#PointerTo).
  prefs: []
  type: TYPE_NORMAL
- en: The new function [`TypeFor`](/pkg/reflect/#TypeFor) returns the [`Type`](/pkg/reflect/#Type)
    that represents the type argument T. Previously, to get the `reflect.Type` value
    for a type, one had to use `reflect.TypeOf((*T)(nil)).Elem()`. This may now be
    written as `reflect.TypeFor[T]()`.
  prefs: []
  type: TYPE_NORMAL
- en: '[runtime/metrics](/pkg/runtime/metrics/)'
  prefs: []
  type: TYPE_NORMAL
- en: Four new histogram metrics `/sched/pauses/stopping/gc:seconds`, `/sched/pauses/stopping/other:seconds`,
    `/sched/pauses/total/gc:seconds`, and `/sched/pauses/total/other:seconds` provide
    additional details about stop-the-world pauses. The “stopping” metrics report
    the time taken from deciding to stop the world until all goroutines are stopped.
    The “total” metrics report the time taken from deciding to stop the world until
    it is started again.
  prefs: []
  type: TYPE_NORMAL
- en: The `/gc/pauses:seconds` metric is deprecated, as it is equivalent to the new
    `/sched/pauses/total/gc:seconds` metric.
  prefs: []
  type: TYPE_NORMAL
- en: '`/sync/mutex/wait/total:seconds` now includes contention on runtime-internal
    locks in addition to [`sync.Mutex`](/pkg/sync#Mutex) and [`sync.RWMutex`](/pkg/sync#RWMutex).'
  prefs: []
  type: TYPE_NORMAL
- en: '[runtime/pprof](/pkg/runtime/pprof/)'
  prefs: []
  type: TYPE_NORMAL
- en: Mutex profiles now scale contention by the number of goroutines blocked on the
    mutex. This provides a more accurate representation of the degree to which a mutex
    is a bottleneck in a Go program. For instance, if 100 goroutines are blocked on
    a mutex for 10 milliseconds, a mutex profile will now record 1 second of delay
    instead of 10 milliseconds of delay.
  prefs: []
  type: TYPE_NORMAL
- en: Mutex profiles also now include contention on runtime-internal locks in addition
    to [`sync.Mutex`](/pkg/sync#Mutex) and [`sync.RWMutex`](/pkg/sync#RWMutex). Contention
    on runtime-internal locks is always reported at `runtime._LostContendedRuntimeLock`.
    A future release will add complete stack traces in these cases.
  prefs: []
  type: TYPE_NORMAL
- en: CPU profiles on Darwin platforms now contain the process’s memory map, enabling
    the disassembly view in the pprof tool.
  prefs: []
  type: TYPE_NORMAL
- en: '[runtime/trace](/pkg/runtime/trace/)'
  prefs: []
  type: TYPE_NORMAL
- en: The execution tracer has been completely overhauled in this release, resolving
    several long-standing issues and paving the way for new use-cases for execution
    traces.
  prefs: []
  type: TYPE_NORMAL
- en: Execution traces now use the operating system’s clock on most platforms (Windows
    excluded) so it is possible to correlate them with traces produced by lower-level
    components. Execution traces no longer depend on the reliability of the platform’s
    clock to produce a correct trace. Execution traces are now partitioned regularly
    on-the-fly and as a result may be processed in a streamable way. Execution traces
    now contain complete durations for all system calls. Execution traces now contain
    information about the operating system threads that goroutines executed on. The
    latency impact of starting and stopping execution traces has been dramatically
    reduced. Execution traces may now begin or end during the garbage collection mark
    phase.
  prefs: []
  type: TYPE_NORMAL
- en: To allow Go developers to take advantage of these improvements, an experimental
    trace reading package is available at [golang.org/x/exp/trace](/pkg/golang.org/x/exp/trace).
    Note that this package only works on traces produced by programs built with Go
    1.22 at the moment. Please try out the package and provide feedback on [the corresponding
    proposal issue](/issue/62627).
  prefs: []
  type: TYPE_NORMAL
- en: If you experience any issues with the new execution tracer implementation, you
    may switch back to the old implementation by building your Go program with `GOEXPERIMENT=noexectracer2`.
    If you do, please file an issue, otherwise this option will be removed in a future
    release.
  prefs: []
  type: TYPE_NORMAL
- en: '[slices](/pkg/slices/)'
  prefs: []
  type: TYPE_NORMAL
- en: The new function `Concat` concatenates multiple slices.
  prefs: []
  type: TYPE_NORMAL
- en: Functions that shrink the size of a slice (`Delete`, `DeleteFunc`, `Compact`,
    `CompactFunc`, and `Replace`) now zero the elements between the new length and
    the old length.
  prefs: []
  type: TYPE_NORMAL
- en: '`Insert` now always panics if the argument `i` is out of range. Previously
    it did not panic in this situation if there were no elements to be inserted.'
  prefs: []
  type: TYPE_NORMAL
- en: '[syscall](/pkg/syscall/)'
  prefs: []
  type: TYPE_NORMAL
- en: The `syscall` package has been [frozen](/s/go1.4-syscall) since Go 1.4 and was
    marked as deprecated in Go 1.11, causing many editors to warn about any use of
    the package. However, some non-deprecated functionality requires use of the `syscall`
    package, such as the [`os/exec.Cmd.SysProcAttr`](/pkg/os/exec#Cmd) field. To avoid
    unnecessary complaints on such code, the `syscall` package is no longer marked
    as deprecated. The package remains frozen to most new functionality, and new code
    remains encouraged to use [`golang.org/x/sys/unix`](/pkg/golang.org/x/sys/unix)
    or [`golang.org/x/sys/windows`](/pkg/golang.org/x/sys/windows) where possible.
  prefs: []
  type: TYPE_NORMAL
- en: On Linux, the new [`SysProcAttr.PidFD`](/pkg/syscall#SysProcAttr) field allows
    obtaining a PID FD when starting a child process via [`StartProcess`](/pkg/syscall#StartProcess)
    or [`os/exec`](/pkg/os/exec).
  prefs: []
  type: TYPE_NORMAL
- en: On Windows, passing [`O_SYNC`](/pkg/syscall#O_SYNC) to [`Open`](/pkg/syscall#Open)
    now causes write operations to go directly to disk, equivalent to `O_SYNC` on
    Unix platforms.
  prefs: []
  type: TYPE_NORMAL
- en: '[testing/slogtest](/pkg/testing/slogtest/)'
  prefs: []
  type: TYPE_NORMAL
- en: The new [`Run`](/pkg/testing/slogtest#Run) function uses sub-tests to run test
    cases, providing finer-grained control.
  prefs: []
  type: TYPE_NORMAL
- en: Ports
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Darwin
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: On macOS on 64-bit x86 architecture (the `darwin/amd64` port), the Go toolchain
    now generates position-independent executables (PIE) by default. Non-PIE binaries
    can be generated by specifying the `-buildmode=exe` build flag. On 64-bit ARM-based
    macOS (the `darwin/arm64` port), the Go toolchain already generates PIE by default.
  prefs: []
  type: TYPE_NORMAL
- en: Go 1.22 is the last release that will run on macOS 10.15 Catalina. Go 1.23 will
    require macOS 11 Big Sur or later.
  prefs: []
  type: TYPE_NORMAL
- en: Arm
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The `GOARM` environment variable now allows you to select whether to use software
    or hardware floating point. Previously, valid `GOARM` values were `5`, `6`, or
    `7`. Now those same values can be optionally followed by `,softfloat` or `,hardfloat`
    to select the floating-point implementation.
  prefs: []
  type: TYPE_NORMAL
- en: This new option defaults to `softfloat` for version `5` and `hardfloat` for
    versions `6` and `7`.
  prefs: []
  type: TYPE_NORMAL
- en: Loong64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The `loong64` port now supports passing function arguments and results using
    registers.
  prefs: []
  type: TYPE_NORMAL
- en: The `linux/loong64` port now supports the address sanitizer, memory sanitizer,
    new-style linker relocations, and the `plugin` build mode.
  prefs: []
  type: TYPE_NORMAL
- en: OpenBSD
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Go 1.22 adds an experimental port to OpenBSD on big-endian 64-bit PowerPC (`openbsd/ppc64`).
  prefs: []
  type: TYPE_NORMAL
