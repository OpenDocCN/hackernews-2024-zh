<!--yml

category: 未分类

date: 2024-05-27 14:43:17

-->

# 为何臃肿仍然是软件最大的漏洞 - IEEE Spectrum

> 来源：[https://spectrum.ieee.org/lean-software-development](https://spectrum.ieee.org/lean-software-development)

*这篇文章是* [*尼古劳斯·维尔特*](https://ethz.ch/en/news-and-events/eth-news/news/2024/01/computer-pioneer-niklaus-wirth-has-died.html)*的纪念*，一位计算机先驱，于2024年1月1日去世。1995年，他写了一篇有影响力的文章《[*呼吁精简软件*](https://cr.yp.to/bib/1995/wirth.pdf)*》，发表在[Computer](https://ieeexplore.ieee.org/document/348001)*，这是IEEE计算机学会会员的杂志，我在创业和软件开发初期阅读过。接下来的内容中，我尝试以近30年后的视角重新提出同样的论点，针对当今的计算恐怖。这篇文章的一个版本最初发表在我个人博客的[*这里*](https://berthub.eu/articles/posts/a-2024-plea-for-lean-software/)，[Berthub.eu](http://berthub.eu)。

几年前，我在一所当地大学做了一个关于网络安全的演讲，题为“[网络与信息安全：我们都疯了吗？](https://berthub.eu/cyber-mad/Cyber%20and%20information%20security.pdf)”今天依然值得一读，因为我们确实在某种程度上都有些疯狂。

当今我们构建和发布软件的方式大多荒谬可笑，导致一些应用程序需要使用数百万行代码来开启车库门，而其他一些简单的程序则导入了[1,600个外部代码库](https://github.com/SashenJayathilaka/Photo-Sharing-Application)—这些依赖库—来源不明。软件安全性堪忧，这既与代码质量有关，也与其数量庞大有关。我们许多程序员都知道当前的情况是难以持续的。遗憾的是，许多程序员（及其管理层）从未体验过其他方式。而对于我们其余的人来说，很少有时间来做得更好。

我们不仅仅是在怀旧；软件现在确实很奇怪。

让我简要地回顾一下软件安全的可怕状态，然后花些时间分析为什么情况如此糟糕。我还提到了一些正在进行中的监管和立法措施，我们可以利用这些措施再次把软件质量作为优先事项。最后，我谈论了我写的[一个实际有用的软件](https://berthub.eu/articles/trifecta)作为一个概念验证，证明我们仍然可以开发出[简洁而现代的软件](https://berthub.eu/articles/posts/trifecta-technology)。

我希望这篇文章能为那些希望改善情况的程序员和技术人员提供一些精神和道德支持。我们不仅仅是在怀旧；软件现在确实很奇怪。

## 软件安全的可怕状态

不要把所有的[“老人（48岁）对着云喊叫”](https://knowyourmeme.com/memes/old-man-yells-at-cloud)都带入，让我重申一些显而易见的事情。软件安全的状态*十分糟糕*。如果仅仅看过去一年，如果你在运行像[Ivanti](https://www.ncsc.gov.uk/news/exploitation-ivanti-vulnerabilities)、[MOVEit](https://en.wikipedia.org/wiki/2023_MOVEit_data_breach)、[Outlook](https://www.bleepingcomputer.com/news/microsoft/russian-hackers-exploiting-outlook-bug-to-hijack-exchange-accounts/)、[Confluence](https://confluence.atlassian.com/security/cve-2023-22518-improper-authorization-vulnerability-in-confluence-data-center-and-server-1311473907.html)、[Barracuda Email Security Gateway](https://www.mandiant.com/resources/blog/barracuda-esg-exploited-globally)、[Citrix NetScaler ADC和NetScaler Gateway](https://www.mandiant.com/resources/blog/remediation-netscaler-adc-gateway-cve-2023-4966)，你的机会被黑客攻击了。即使是像Apple和[Google](https://spectrum.ieee.org/tag/google)这样拥有近乎无限资源的公司，也犯了[微不足道的“最差实践”安全错误](https://www.schneier.com/blog/archives/2023/09/critical-vulnerability-in-libwebp-library.html)，将[他们的客户置于危险之中](https://www.bleepingcomputer.com/news/security/apple-zero-click-imessage-exploit-used-to-infect-iphones-with-spyware/)。然而，我们继续依赖所有这些产品。

现在软件被（理所当然地）认为是如此危险，以至于我们告诉每个人不要自行运行它。

*现在软件被（理所当然地）认为是如此危险，以至于我们告诉每个人不要自行运行它。相反，你应该把这个工作交给一个“*X*即服务”的提供商，或者可能只是“云”的提供者。将这与一个假设情况进行比较，即汽车很可能自燃，因此建议不要自己驾驶汽车，而是交给总是有专业消防员陪同的专业人士来进行驾驶。*

*然后假设云能够使不安全的软件变得可信任。然而，在过去的一年中，我们了解到Microsoft的[电子邮件平台彻底被黑客攻击](https://thehackernews.com/2023/09/outlook-breach-microsoft-reveals-how.html)，包括机密政府电子邮件。([两次！](https://metacurity.substack.com/p/russian-hacking-group-midnight-blizzard)) 同时，对Azure云的安全性也存在[深思疑虑](https://www.lastweekinaws.com/blog/azures-terrible-security-posture-comes-home-to-roost/)。与此同时，行业宠儿Okta提供基于云的软件，可以使用户登录各种应用程序，也[遭到了全面的攻击](https://www.reuters.com/technology/cybersecurity/okta-says-hackers-stole-data-all-customer-support-users-cyber-breach-2023-11-29/)。这是他们两年内的第二次数据泄露事件。此后，有可疑的Okta用户接连被黑客攻击。

*显然，我们需要更好的软件。*

欧盟推出了三项立法措施：为重要服务制定的[NIS2指令](https://digital-strategy.ec.europa.eu/en/policies/nis2-directive)；几乎所有商业软件和电子设备的[网络韧性法案](https://digital-strategy.ec.europa.eu/en/policies/cyber-resilience-act)；以及修订后的[产品责任指令](https://www.euractiv.com/section/digital/news/eu-updates-product-liability-regime-to-include-software-artificial-intelligence/)，它也包括了软件。立法总是困难的，还有待观察[他们是否做对了](https://berthub.eu/articles/posts/eu-cra-what-does-it-mean-for-open-source/)。但是，软件安全性如此糟糕，以至于需要立法似乎是显而易见的。

## 为什么软件安全性如此糟糕

我想说说激励措施。当前情况显然对商业运营商非常有利。开发更安全的软件需要时间和大量工作，而目前的安全事故似乎并没有影响到公司的利润或股价。你可以通过[削减角度来加快上市时间](https://www.microsoft.com/en-us/research/publication/software-components-only-the-giants-survive/)。因此，从经济的角度来看，我们所看到的情况完全是可以预料的。立法对改变这种局面可能非常重要。

软件安全性取决于两个因素：源代码中的安全问题的*密度*和黑客可访问的文件的*数量*。正如美国国防界在20世纪80年代喜欢指出的那样，[数量本身就蕴含着一种质量](https://www.quora.com/Who-said-Quantity-has-a-quality-all-its-own)。反之亦然应用于软件领域——你拥有的越多，你面临的风险就越大。

作为一个例子，多年来，苹果iPhone用户因iMessage所暴露的巨大攻击面而多次被黑客攻击。可能向苹果用户发送未经请求的iMessage。然后手机立即处理该消息以便预览它。问题在于，苹果在其智慧决定，认为此类未经请求的消息需要支持各种各样的图像格式，不小心地[包括了使用古老格式的奇怪嵌入式压缩字体的PDF](https://googleprojectzero.blogspot.com/2021/12/a-deep-dive-into-nso-zero-click.html)，实际上包括了一种编程语言。因此，有人可以向你的iPhone发送未经请求的消息，以便寻找手机其他部分的弱点。

这样一来，攻击者可以从手机数百万行代码中的安全漏洞中获益。你不需要高密度的错误来发现[一个可以利用的漏洞](https://www.europarl.europa.eu/meetdocs/2014_2019/plmrep/COMMITTEES/PEGA/DV/2023/05-08/REPORTcompromises_EN.pdf)在数百万行代码中。

擦去代码中的所有错误并不能让你摆脱决定在文档中自动执行嵌入代码的功能。

*苹果本可以通过将预览限制在更小范围的图片格式，甚至是一个“已知良好”的图片格式，来避免这种情况。苹果本可以通过将[暴露给攻击者的代码行数减少](https://github.com/berthubert/sbox#sbox)来避免自己遭受巨大的痛苦。顺便说一句，欧盟的网络安全弹性法案[明确告诉供应商要最小化攻击面](https://berthub.eu/articles/posts/eu-cra-secure-coding-solution/)。*

*苹果（迄今为止）在这个领域并不是最糟糕的行为者。但它是一家广受尊敬且资源充足的公司，通常会深思熟虑他们的行为。即使是他们也因为不必要地发布和暴露了太多代码而出现了错误。*

## *难道我们不能写出更好的代码吗？*

*有人认为最大的问题是代码的质量，以代码中的错误密度来表达。在这方面正在发生许多有趣的事情，比如使用[内存安全语言](https://www.nsa.gov/Press-Room/Press-Releases-Statements/Press-Release-View/Article/3608324/us-and-international-partners-issue-recommendations-to-secure-software-products/)如[Rust](https://www.rust-lang.org/)。其他语言也在[提升它们的安全性](https://github.com/google/sanitizers/wiki/AddressSanitizer)。[Fuzzer](https://en.wikipedia.org/wiki/Fuzzing)—自动修改计算机程序输入以查找弱点和错误的测试工具—也变得越来越先进。*

*但许多安全问题是在代码逻辑下的逻辑问题。例如，巴拉库达电子邮件漏洞起源于一个第三方库，在扫描病毒时实际上会在Excel电子表格中[执行代码](https://www.cvedetails.com/cve/CVE-2023-7101/)。消灭代码中所有的漏洞不会拯救你免受决定实现在文档中嵌入的代码自动执行功能的影响。

## *软件发布的状态*

*另一个问题是，我们经常不知道我们实际上正在发布什么代码。软件已经变得*巨大*。1995年，[尼克劳斯·维尔特](https://en.wikipedia.org/wiki/Niklaus_Wirth)对软件已经增长到几兆字节感到痛心。在他的文章“呼吁精简软件”中，他描述了他的[欧柏隆操作系统](https://en.wikipedia.org/wiki/Oberon_(operating_system))，这个操作系统仅有200千字节，包括一个编辑器和一个编译器。现在有些项目仅在配置文件中就有超过200千字节。*

*如今的典型应用程序基于[Electron JS](https://www.electronjs.org/)，这是一个框架，集成了Chromium（“Chrome”）和Node.JS，为JavaScript提供了数以万计的软件包。我估计，仅仅使用Electron JS，如果包括依赖关系，就意味着至少有 5000 万行代码。可能更多。与此同时，该应用程序可能还会引入数百或数千个辅助软件包。许多使用的软件包默认会向广告商和其他数据经纪人告密用户。依赖关系又会引入更多的依赖关系，到底哪些内容会被包含在构建中，每天都可能会有所变化，真正了解的人其实并不多。*

*如果此应用程序控制您家中的任何设备，它还将连接到一个软件堆栈，可能也是由[亚马逊](https://spectrum.ieee.org/tag/amazon)提供支持，可能也是由Node.js驱动，同时还会引入许多依赖项。*

*我们可能需要超过 5000 万行活动代码来打开一个车库门……*

*但是，请等一下，还有更多。我们曾经将软件作为编译器的输出或者可能是一堆文件进行解释。这样的软件然后必须进行*安装*和*配置*才能正常工作。将您的代码打包以像这样进行部署，是一项繁重的工作。但这是一项好工作，因为它迫使人们思考他们“包裹”中包含了什么。然后这个软件包会根据配置与操作系统和本地服务集成。*

*由于软件在不同的计算机上运行，而不是在开发时的计算机上运行，人们确实需要知道他们打包了什么并进行深思熟虑。有时它确实不起作用，这就引出了一个笑话，开发人员告诉运维人员，“在我的系统上可以运行”，然后回应道：“那就备份你的电子邮件，我们要把你的笔记本电脑放到生产环境中！”*

*这曾经是个笑话，但如今我们经常将软件打包为容器进行部署，不仅包括软件本身，还包括操作系统文件，以确保软件在已知环境中运行。这通常意味着实际上要打包一个完整的计算机磁盘镜像。这再次大大扩展了部署的代码量。请注意，你可以利用像 Docker（见下文）这样的容器做一些好事情，但[Docker Hub](https://hub.docker.com/explore)上有很多超过 350 MB 的镜像。*

*把这些加起来，我们可能需要超过 5000 万行活动代码来打开一个车库门，这些代码在多个服务器上运行多个操作系统映像。*

*现在，即使所有包含的依赖项都是黄金标准，我们是否确定它们的安全更新已经到达你的车库门控应用程序？我想知道有多少Electron应用程序仍然在使用去年使Google和Apple赶紧发布更新的[图像处理漏洞](https://www.schneier.com/blog/archives/2023/09/critical-vulnerability-in-libwebp-library.html)。我们甚至不知道。*

*但更糟糕的是，众所周知，所有这些依赖都 *不是* 金子。Node.js 生态系统有一个[滑稽的历史](https://thehackernews.com/2023/02/researchers-hijack-popular-npm-package.html)，包仓库经常被[接管](https://snyk.io/blog/npm-security-preventing-supply-chain-attacks/)、劫持或者由其他人以同样的名字复活，某些人有着对你安全有害的[计划](https://www.theregister.com/2023/06/19/npm_s3_buckets_malware/)。PyPI（Node.js 的 Python 对应物）也遭受了[类似的问题](https://www.theregister.com/2023/01/04/pypi_pytorch_dependency_attack/)。依赖项总是需要仔细审查，但是不可能合理地期望有人经常检查上千个依赖项。但我们宁愿不去思考这些。（请注意，你也不应该过度实现并且无端重新实现所有内容以防止依赖关系。有一些非常好的模块，[可能比你自己输入的更安全](https://sqlite.org/)。）*

*世界上有太多的代码正在被运送，我们甚至不知道我们在运送什么，我们也不够努力（或根本没有）看我们*确切知道*我们在运送什么。*

## *你 *今天可以* 写出精简的代码*

*写作被称为你发现自己不知道自己在谈论什么的过程。与此同时，实际做事是你发现自己也不知道自己在写什么的过程。*

*在 Wirth 的 Oberon 项目的一个小重现中，我也写了一些代码来证明一点，并让自己放心，我仍然知道我在谈论和写作什么。你还能用老方法编写有用的现代软件吗？我决定尝试创建一个简约而功能齐全的图片分享解决方案，我可以信任。*

*结果就是 Trifecta。它是[实际的独立软件](https://berthub.eu/articles/trifecta/)，让您可以使用浏览器轻松拖放图片进行分享。多年来，我一直对我不得不使用[imgur](https://imgur.com/)感到痛苦。Imgur 不仅在我的浏览器中安装了大量的 cookie 和跟踪器，我还强迫那些查看我分享的图片的人使用这些跟踪器。如果你想自托管像这样的 Web 服务，你也不想被黑客攻击。我发现大多数自托管的图片分享解决方案都基于我因上述原因不太信任的庞大框架。*

*因此，为了证明一点，我决定创建一个极简但实用的图片分享解决方案，一个我可以信任的解决方案。更重要的是，其他人也可以信任，因为你可以在几个小时内查看所有Trifecta的代码。它包括[1,600 lines of new source code](https://berthub.eu/articles/posts/trifecta-technology)，以及大约五个重要的依赖项。*

*你最终得到了总共3兆字节的代码。*

*作为对比，[另一个图片分享解决方案](https://github.com/CaramelFur/Picsur/pkgs/container/picsur)以288-MB的Docker镜像的形式发布，虽然看起来更好，功能也更多。但不值285 MB。另一个比较是[这个基于Node的图片分享解决方案](https://github.com/SashenJayathilaka/Photo-Sharing-Application)，它包含1,600个依赖项，显然总计超过4百万行JavaScript代码。*

*世界上运输了太多的代码，其中大部分来自第三方，有时是无意的，大部分是未经检查的。*

**请注意，Trifecta并不打算作为一个随机人们分享图片的公共站点，因为这往往不会有好的结果。但它非常适合公司或个人使用。你可以在这里阅读更多关于该项目的信息[here](https://berthub.eu/articles/trifecta)，还有关于用于提供如此小型自包含解决方案的技术的[页面](https://berthub.eu/articles/posts/trifecta-technology)。*

## **对Trifecta的回应**

**这真是非常有趣。到目前为止，对Trifecta最常见的反应是我应该使用整袋Amazon Web Services来部署它。这对于一个明确表明其目标是提供不依赖外部服务的独立软件项目来说是一个极端奇怪的反应。我不确定这里发生了什么。**

**另一种反应是我不公平地对待Docker，并且你确实可以利用容器做得更好。我完全同意。但我也看看人们实际在做什么（也包括其他形式的容器或虚拟机），效果并不是那么好。**

**我想用[Niklaus Wirth 1995年的一篇论文](https://cr.yp.to/bib/1995/wirth.pdf)结束这篇文章的一些观察。**

> **“对于某些人来说，复杂性等于权力。（…）越来越多的人似乎误将复杂性视为复杂性，这令人困惑——不可理解的应该引起怀疑，而不是赞赏。”**

**我同样观察到一些人更喜欢复杂的系统。正如[Tony Hoare](https://en.wikipedia.org/wiki/Tony_Hoare)很早就指出的那样，“在软件设计中有两种方法。一种是使程序如此简单，显然没有错误。另一种是使其如此复杂，没有明显的错误。”如果你做不到第一种方式，第二种方式看起来可能会非常有吸引力。**

**回到Wirth：**

> **“时间压力可能是致使庞大软件出现的主要原因。设计师们所面临的时间压力阻碍了精细的规划。它还阻碍了改进可接受的解决方案；相反，它鼓励快速构思软件的增加和修正。时间压力逐渐腐化了工程师的质量和完美标准。它对人和产品都有害。"**

**如果可以发布一个完整预安装的操作系统映像，为什么要花几周时间精简软件？**

> **“软件爆炸的灾难并非‘自然法则’。它是可以避免的，而且软件工程师的任务是遏制它。”**

**如果这确实是软件人员的责任，我们或许应该要求更多时间来解决这个问题。**

**世界上发布的代码太多，大部分来自第三方，有时是无意的，大部分没有经过检查。因此，存在一个充满平庸代码的巨大*攻击面*。目前正在努力提高代码本身的质量，但许多漏洞是由于逻辑失误导致的，对这方面的扫描进展较少。与此同时，我们可以通过精简我们向世界公开的代码量来取得巨大进展。这将增加产品上市的时间，但法规即将出台，应该迫使供应商更加认真地对待安全问题。

**正如上文提到的Wirth的奥伯龙项目，Trifecta的目标也是证明即使代码量和依赖有限，也可以提供大量功能。通过努力和立法，也许未来可以再次带来不到五千万行代码的车库门开启器。让我们努力实现这一目标。**

**来自您的网站文章**

**网络相关文章**
