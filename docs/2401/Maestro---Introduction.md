<!--yml

类别：未分类

日期：2024年05月27日 14:28:47

-->

# Maestro - 介绍

> 来源：[https://blog.lenot.re/a/introduction](https://blog.lenot.re/a/introduction)

由于互联网，我可以了解我感兴趣的大多数事物是如何工作的。但是，有一件事长期以来一直是个谜：计算机。

计算机是人类构建的最复杂的工具之一。它们是一种工程奇迹，我们认为理所当然，因为我们在日常生活中使用它们。

我喜欢深入复杂性，并且喜欢通过实践学习。此外，我在电脑上花了很多时间。如果我有一个系统，我会从头到尾了解它，并且可以根据自己的期望进行自定义，这不是很酷吗？

这就是为什么我决定构建[Maestro](https://github.com/llenotre/maestro)。一个类Unix操作系统，旨在轻便且与Linux兼容到足以在日常生活中使用。

## 一点历史

内核的第一次提交可以追溯到2018年12月22日凌晨3:18（当然是写代码的最佳时间）。它起初是一个学校项目。

最初是用**C语言**实现的，大约持续了一年半，直到代码库变得太难以保持清洁为止。

那时，我决定转向**Rust**（这是我在这种语言中的第一个项目），它代表了几个优点：

+   从头开始重新启动项目，利用之前错误的教训。

+   比仅仅在C中编写一个类Linux内核更具创新性。毕竟，在那时只需使用Linux即可。

+   利用Rust语言的安全性来克服内核编程的一些困难。使用Rust的类型系统可以将一些内存安全的责任从程序员转移到编译器身上。

在内核开发中，调试非常困难，原因有几个：

+   文档通常很难找到，BIOS实现可能存在缺陷（比你想象的更频繁）

+   在启动时，内核对内存具有完全访问权限，并允许在不应写入的位置进行写入（例如自身的代码）。

+   解决内存泄漏问题并不容易。诸如*valgrind*之类的工具无法使用。

+   *gdb*可以与*QEMU*和*VMWare*一起使用，但是在不同的仿真器或虚拟机上运行时，内核的行为可能会有所不同。此外，这些仿真器可能不支持gdb（例如*VirtualBox*）。

+   在QEMU或VMWare中对gdb的支持中缺少一些功能，有时甚至可能会导致gdb崩溃

所有这些问题都是使用内存安全语言的理由，尽量避免它们。

总的来说，在内核中使用Rust允许实现许多安全防护措施。我相信这直到今天仍然是我对该项目做出的最佳决定。

### 时间流逝

<https://blog.lenot.re/assets/article/gource.mp4>

使用[Gource](https://gource.io/)创建。音乐：*Many Moons of Saturn, Mike Cole*

## 项目的当前状态

Maestro是一个单片内核，目前仅支持x86（32位）架构。

在撰写时，大约**135**个Linux系统调用中的**437**个（大约31%）被更多或更少地实现了。该项目跨**615**个文件拥有**48,800**行代码（所有仓库合并后，使用`cloc`命令进行计数）。

该操作系统目前除了内核外还包含以下组件：

+   [Solfège](https://github.com/llenotre/solfege)：引导系统和守护程序管理器（有点类似于systemd，但更轻）

+   [maestro-utils](https://github.com/llenotre/maestro-utils)：系统实用命令

+   [blimp](https://github.com/llenotre/blimp)：一个包管理器

+   以及更多可在[我的GitHub](https://github.com/llenotre)上找到的组件

到目前为止，以下第三方软件已在操作系统上进行了测试并正常运行：

+   musl（C标准库）

+   bash

+   一些GNU coreutils命令，如`ls`、`cat`、`mkdir`、`rm`、`rmdir`、`uname`、`whoami`等...

+   neofetch（一个经过修补的版本，因为原始neofetch不了解我的操作系统）

## 亲自测试吧！

> **免责声明**：重要的是要注意，该操作系统仍处于非常早期的开发阶段，非常不稳定。我不建议在有重要数据的机器上尝试安装它。
> 
> 到目前为止，它主要在QEMU、VMWare和VirtualBox上进行了测试。

你可以有两种方式安装操作系统：

ISO提供了操作系统的安装程序。你可以在QEMU、VMWare或VirtualBox上使用它，例如。

> 你应该用足够的RAM运行ISO（**1GB**应该足够了）。
> 
> 因为要安装的软件包存储在RAM中（在initramfs上）而不是磁盘上，所以需要这么多内存。这是目前最好的方法，因为操作系统目前*还不能*自行读取USB存储设备或CD-ROM，因此它依赖于引导加载程序。

## 这个博客是关于什么的？

这个博客的目的**不是**写关于如何创建操作系统的教程。其他网站/博客已经很好地涵盖了这方面。我特别推荐：

目标是探索更高级的主题（因为大多数人/博客往往只停留在基础知识），将主题推向我所能达到的极限，撰写关于我遇到的问题以及如何解决它们的文章，发现计算机是如何在底层工作的，以及操作系统、互联网等等... 有很多事情可以谈论！

## 下一步是什么？

清理代码库和性能优化是有必要的。由于操作系统是作为学校项目启动的，我不得不为了按时完成而取巧。但现在是时候偿还我积累的技术债了。

还有一些内存泄漏存在，并且必须修复。性能优化可能会成为博客文章的主题。

下一个飞跃将是使操作系统的包管理器完全工作。为此，需要一些功能：

+   目前正在开发的网络支持，可能会成为大量文章的主题

+   共享库支持。当前不起作用，因为它需要将文件直接映射到内存中，而目前内核上的`mmap`系统调用的实现不支持此功能

之后，我将能够轻松地安装并测试诸如编译器（gcc/g++、clang、rustc）、make、Git、Vim 等程序...然后在使用它的同时开发内核！

内核的开发主要遵循简单的流程：

+   **1**: 在内核上运行程序并查看其是否正常工作

+   **2**: 如果不起作用，则：

    +   **3**: 在打印系统调用的同时运行程序，并搜索导致问题的第一个系统调用（未实现或有bug）

    +   **4**: 实现或修复相关的系统调用

    +   **5**: 转到步骤 1

+   **6**: 否则：耶！

在内核上正确运行的程序越多，内核就变得越稳定和完整！

## 如何*你*可以帮助

你可以在[内核的 Github 仓库](https://github.com/llenotre/maestro) 上留下一颗⭐️ ❤️

保持联系的方式：

不要犹豫加入 Discord！如果您有反馈要提出、建议要给出或问题要问，我将很乐意回答！
