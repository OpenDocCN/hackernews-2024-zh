<!--yml

类别：未分类

日期：2024-05-27 14:38:53

-->

# 简单持久：使用胶带和 Web Storage API 使地图有状态

> 来源：[`newsletter.pnote.eu/p/simple-lasts-longer`](https://newsletter.pnote.eu/p/simple-lasts-longer)

*这比我想象的要不那么有用。*

我[制作了一张地图](https://newsletter.pnote.eu/p/mapping-space-invader-mosaics-in-paris)，展示了可收集的[太空入侵者](https://en.wikipedia.org/wiki/Invader_(artist))马赛克，并[将其放在线上](https://pnote.eu/projects/invaders/)。我认为这会有助于计划散步（和跑步🚀）的时候顺便寻找一些太空入侵者。

但我错过了一个问题。你能发现问题吗？

哇，好多马赛克！是的，这就是问题所在。

有将近 1500 个入侵者在巴黎，如果要使用地图*实际*规划你的步行路线，你需要跟踪你已经收集到的入侵者。光是绕圈跑一点都不好玩 :). （而且官方应用不会给你重复拍摄同一马赛克的照片任何积分。它实际上会嘲笑你，并问你是否喝醉了🙃）

我的地图无法跟踪已经“收集到”的内容。它完全简单，完全“无状态”。

无状态网站易于管理。您只需要在互联网上发布一些静态文件。网站对每个用户都是相同的，它永远不会更改（除非您发布更新）。

为了跟踪每个用户闪过的马赛克，我需要教会网站将已收集到的列表存储在……某个地方。但是在哪里？

+   传统的答案是运行一个**数据库**，并将每个用户的收藏品存储在那里。

+   一种更时髦、更新的选择是使用第三方**服务**，它充当数据库，但在别人的服务器上运行。[Firebase](https://firebase.google.com/docs/database)是一个众所周知的例子。

第二种方法比第一种方法少了一些工作（网站可以直接与 Firebase 通信，我不需要自己设置任何服务器），但两者都需要一些工作。更糟糕的是，它们增加了项目的复杂性，增加了对另一个服务的依赖。

复杂性会毁掉项目🔪（尤其是那些分心的脆弱的业余项目💫），所以让我们做一些更简单的事情。我们是否可以直接在每个用户的浏览器中存储已收集的入侵者列表？

由于[Web Storage API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API)的存在，任何网站都可以在您的计算机/手机上存储少量数据，并且通过重新启动后会持久存在。这很有前途！

我修改了地图网站，包括为每个入侵者标记闪过的按钮，并使其在本地 Web Storage 中持久保存状态。

默认情况下，此功能无需任何权限提示即可使用。使用 Chrome 开发者工具，我们可以检查地图在浏览器中存储的状态。这只是入侵者 ID 的列表：

这很简单，它有效！您可以在**[此处](https://pnote.eu/projects/invaders/map/)查看发布的更新地图**。

服务器上不需要状态。没有用户帐户，没有认证，没有“我忘记了我的密码”问题。此外，当我们不在服务器上存储任何数据时，我们不能丢失或泄漏它。（[本地优先软件](https://www.inkandswitch.com/local-first/)。）

如果这个解决方案如此好，为什么所有主要网站都坚持要求创建帐户并在服务器端存储我们的状态？

有很多原因，其中之一是，当数据存储在浏览器本地时，它不会在设备之间同步，也不会备份。如果用户重新安装他们的浏览器，他们将丢失所有状态。

既然我们追求简单，也许我们可以允许用户自己处理备份？

只需要 50 行代码就可以添加一个小弹出窗口，具有导入/导出收集的马赛克列表的功能。ChatGPT 很高兴几乎全部编写它：

我们最终得到了一个试图成为所有领域最好的解决方案。网站保持简单，不必管理用户状态。但用户仍然可以将它们标记为已收集，并且甚至可以导出和备份他们的收藏品。

业余项目是脆弱的。它们只有在简单易维护的情况下才能持续存在，否则让它们正常工作会变得乏味，作者最终会放弃。

我仍在维护一个基于数据库的业余项目，我在 15 年前开始的。它最终发展成了一个依赖它的小型社区。我对此感到高兴，但我感到维护应用程序的持续成本和保持最新状态的压力。

从这次经历中更加聪明，如今我尽量以最小化依赖和通用脆弱性的方式构建所有的业余项目。如果需要，这个应用应该在未来十年内保持零修改的运行🤞。

**简单不仅启动更快，而且持续时间更长。**

你是否考虑在 2024 年开始任何业余项目？你能使它的初始版本多简单？

+   📝 [Enso](https://write.sonnet.io/)，一个文本编辑器，你只能写作，而不能编辑。对于突破写作障碍非常有帮助：只需让思绪流淌。

+   🎶 [muted.io](https://muted.io/)，一个运行在浏览器中的音乐理论工具包

+   💻 [Turing Complete](https://turingcomplete.game/)，一个计算机科学游戏，你可以从逻辑门开始，逐渐构建一个计算机，越来越复杂。

巴黎随时可能迎来一波寒冷天气。是阅读和写作的好时机，配上一杯茶。或者看看那个热红酒的食谱。

保持温暖！💫

– Przemek
