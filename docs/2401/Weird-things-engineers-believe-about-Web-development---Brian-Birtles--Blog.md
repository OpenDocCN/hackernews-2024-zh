<!--yml

类别：未分类

日期：2024-05-27 14:34:57

-->

# 关于 Web 开发工程师相信的奇怪事物 - Brian Birtles’ 博客

> 来源：[`birtles.blog/2024/01/06/weird-things-engineers-believe-about-development/`](https://birtles.blog/2024/01/06/weird-things-engineers-believe-about-development/)

*我在 2022 年的某个时候写了大部分这篇文章，但我认为到了 2024 年仍然站得住脚，所以我决定为了后人将其发布出来。我并不太喜欢写这样的文章——我更愿意分享一些无害的学习或提示，但事实证明我也有自己的观点* 😓 *抱歉！*

***2024-02-21**：我在帖子末尾添加了一些反思。*

***2024-04-27**：Developpez.com 制作了[本文的法语翻译](https://web.developpez.com/actu/356070/Les-ingenieurs-croient-des-choses-etranges-sur-le-developpement-Web-par-Brian-Birtles/)。*

自从我退出 Mozilla 并全职回归 Web 开发以来，我发现了一些惊喜。原来 Web 开发实际上相当困难，Web 开发人员实际上非常聪明，我们作为浏览器工程师嘲笑的一些框架和技术并不那么糟糕。糟糕。

与此同时，原来一些 Web 开发人员对浏览器和 Web 有一些想法，作为一名前浏览器工程师和标准编辑，我对此有些怀疑。

这里有一些让我感到惊讶的事情。

1.  “Web 浏览器工程师非常了解 Web 开发”

1.  “制定 Web 规范的人非常了解 Web 开发”

1.  “Web 开发人员非常了解 Web 开发”

1.  “浏览器不是为了运行 SPAs 而制作的”

1.  “MPAs 将取代 SPAs”

1.  “所有站点都应该在没有 JavaScript 的情况下运行”

1.  “Web 开发不应该需要构建步骤”

1.  “我的博客代表了广泛的 Web 开发”

很容易想象，撰写组成 Web 平台的代码的 Web 浏览器工程师必须对 Web 了如指掌，没有人比他们更了解。

麻烦的是，编写 Web 浏览器很困难。

大多数浏览器工程师专注于特定领域，并且对其他领域只有表面了解。此外，浏览器平台工程师整天都在编写 C++ 和 Rust 代码，并且会写一些非常简单的 JavaScript 测试用例。此外，他们贡献给一个巨大的存储库，其中有人负责所有的工具。

因此，在他们的日常工作中，浏览器工程师并没有在与 webpack 斗争，也没有试图理解完整页面的 TypeScript 错误（他们有 C++模板错误来填补他们生活中的*那个*空洞），也没有试图让 iOS 上的 Safari 表现得像其他浏览器一样，也没有在应对大规模的 CSS 时挣扎，也没有试图评估最新的 SSR/SSG/island 框架是否值得投资，也没有为了更优化的代码分块而重构庞大的 JS 代码库，也没有在 GitHub 上提交沮丧的问题，因为他们的某个依赖的最新版本破坏了他们的应用，也没有试图让所有工具在 ESM 与 CJS 之间达成一致，也没有为是否选择了正确的状态管理方法或是否应该第十次重写整个东西而失眠。

简而言之，他们并没有日复一日地进行 Web 开发，所以他们对于现实世界的 Web 开发了解比 Web 开发人员可能期望的要少。

现在，致力于浏览器*开发者工具*和浏览器*前端*的工程师通常*是*日复一日地使用 JS，并且肯定更加关注这些问题，但这仍然与常规 Web 开发有一定距离。例如，他们只需要针对单个浏览器引擎的平台功能，通常只需考虑单个浏览器版本（能够使用新的闪亮功能而不用担心兼容性问题是*了不起的*），无需担心捆绑大小，服务器，离线，或许多其他使 Web 开发变得困难的问题。

显然，一些浏览器工程师有兴趣的项目，但是对于兴趣项目的约束与在创业公司中生死与共的约束完全不同，后者取决于您的 Web 应用程序的成功与否。

我的职业生涯始于平面设计和 Web 开发，甚至在我开始为 Firefox 做贡献之后，我在大阪的一家 Web 开发公司工作了一段时间，并在 Mozilla 日本制作了一些 Web 应用程序。然而，当我辞去 Mozilla 的工作，全职回到 Web 开发时，我对它的变化以及我对它了解的很少感到震惊。

作为一名浏览器工程师，我的经验在 Web 开发中非常有用，最主要的原因不仅仅是因为我知道在哪里寻找，问谁，以及在哪里提交错误报告，但如果我说成为一名浏览器工程师自动使我成为 Web 开发人员，我会自欺欺人的。

在 Mozilla 工作期间，Firefox OS 的日子是最令人愉快的。我们有内部团队构建真实的移动 Web 应用程序，我们作为平台团队必须调试和使其成功作为我们的最高优先级。我看到[`transitionend`事件](https://developer.mozilla.org/docs/Web/API/Element/transitionend_event)可能是不可靠的，导致 Web 应用程序出现错误和过于复杂，因此我提出并实现了[`transitioncancel`事件](https://developer.mozilla.org/docs/Web/API/Element/transitioncancel_event)和 Web Animations 的[`Animation.finished` promise](https://developer.mozilla.org/docs/Web/API/Animation/finished)。

但即使与 Web 开发人员并肩工作，也不能让我完全准备好再次成为全职的 Web 开发人员。在很大程度上，浏览器工程师和 Web 开发人员的工作环境是不同的，也许并不是我们想象中的 Web 开发人员超级英雄。

好吧，但是毫无疑问，致力于 Web *标准*和*规范*的人员（事实证明，他们大部分是浏览器工程师）必须对 Web 开发了如指掌，对吗？

2012 年，[Brendan Eich 指出](https://brendaneich.com/2012/02/community-prioritized-web-standards/)，“制定标准就像制定法律一样肯定是[制作香肠](https://en.wikiquote.org/wiki/John_Godfrey_Saxe)”，引用了 John Godfrey Saxe 的以下语录：

> 法律就像香肠一样，随着我们了解它们是如何制定的，就会失去尊重。

作为一个 Web 开发人员，很容易想象一群对与 Web 技术相关的所有事情都无比明智的人，他们根据每个提案的技术优势和对行业需求的深入理解做出冷静、理性的决定。

这种错觉通常不会在你的第一个工作组会议上持续下去。尽管怀着最好的意图，有时决定会在某种程度上基于某个人的魅力或强势个性，基于当时在场的人，基于大家有多累，或者，我敢说，甚至基于某人为了填写他们的晋升文件夹而需要发布一个功能。

这听起来非常愤世嫉俗，所以让我做两点澄清。

首先，这些团体中的人都是善良、出色的人。此外，他们通常意识到自己的局限性，并尽力征求 Web 开发人员的反馈。不幸的是，我还没有看到一个团体能够非常成功地做到这一点。例如，有 Twitter/X 投票，但往往只有处于前沿的 Web 开发人员会回答，并且很容易被*谁*传播了投票的消息而影响结果。

其次，我对 WHATWG 规范（如 HTML 和 DOM）没有太多经验，在这些规范中，决定似乎是异步进行的（“在面对面会议期间做出的任何决定都被视为不具约束力”—[WHATWG 会议](https://whatwg.org/working-mode#meetings)），但我的印象是它们似乎做出了更好的决定。像 Anne van Kesteren、Simon Pieters 和 Domenic Denicola 这样的人可能比地球上的任何其他人更了解 Web。但即使如此，也不等同于了解 Web 开发。

作为一个浏览器工程师，将一个新的平台功能发布出去真是令人满意。有关此功能的文章可以在《Smashing Magazine》和《CSS Tricks》以及 Twitter/X 上找到。人们开始热烈讨论这个消息。很容易就会认为现在全世界都知道了 Web 能力方面的这个伟大的新进展。

几年前，Mozilla 日本团队的我们决定在东京采访当地的 Web 开发人员，以了解他们可以从中受益的开发人员工具。

结果令人惊讶。

许多人不知道已经在十年前发布了新的 CSS 功能。更重要的是，即使我们告诉他们，他们似乎也不太激动。他们用 jQuery 和 WordPress 还挺好的，谢谢。

相反，他们遇到的问题是，“当我在响应式设计模式下向客户展示网站时，如果窗口周围没有 iPhone 的模型，客户就无法理解他们正在看的是站点在智能手机上的预览。我真的需要那个 iPhone 模型。”

作为一个参与制定新网络标准的浏览器工程师，我有点失望，但我对这些从事网站和 Web 应用程序发布工作的人的印象是受制于这些约束。

与从事浏览器开发或资金充裕的硅谷初创企业的人不同，许多人在小商店工作，他们面临着巨大的压力，需要迅速交付项目以支付账单，然后转移到下一个项目上。他们没有花上一整个上午摆弄即将到来的技术的奢侈，而是寻找他们有经验的经过验证的解决方案。

从浏览器开发转回 Web 开发时的另一个惊喜是关于浏览器工作原理的一些断言。

当我在做动画时，我很惊讶许多人认为一些动画是“在 GPU 上运行的”（浏览器可以将一些动画卸载到一个单独的进程或线程中，该进程或线程使用 GPU 来合成或甚至绘制每一帧的动画，但它并不会全部卸载到 GPU 上），但与其他一些被扔来的论点相比，这只是一个相当小的误解，比如，“浏览器不适合运行单页应用程序（SPA）”。

我认为这里的论点是，最初浏览器会从网络加载内容，逐步布局和渲染内容，并且已经受到了很大的优化。动态内容是后来才出现的，因此受到的优化程度较少。

在过去近二十年里我一直在从事浏览器工作，但我对此表示怀疑，或者至少不再那么确信。

毕竟，Firefox 前端和开发工具实际上是单页应用程序（SPA）。特别是开发工具是使用 React 和 Redux 编写的，从各个方面来看都是单页应用程序。

对于浏览器在处理通过 JavaScript 进行的复杂和长期存在的动态更改时是否存在不足的论点，浏览器本身与该论点相矛盾。

可以提出一个论点，即在移动端浏览器并没有针对运行 SPAs 进行优化。毕竟，在 Android 上，Firefox 从 HTML 渲染的浏览器 chrome 切换到了本地浏览器 chrome 以提高性能。我无法评论导致这种变化的具体性能限制是什么，但是[当时的一篇博客](https://lucasr.org/2011/11/15/native-ui-for-firefox-on-android/)表明与改善应用程序启动时间和平移和滚动性能有关，这两点都没有指出与其他架构相比，浏览器在处理 SPAs 方面存在不足。

“好吧，也许浏览器可以处理复杂的长期存在的 DOM 树，并频繁地进行动态更改，但是 SPAs 往往具有大量的 JS 捆绑包，下载和解析速度较慢，会阻塞初始渲染。”这是一个公平的论点，但这是一个关于更小的阻塞初始渲染捆绑包的论点，同样适用于您的普通 WordPress 站点，并不是浏览器不适合运行 SPAs 的论点。

当我们谈论 SPAs 和“编写 Web 应用的唯一真正方法”时，对“浏览器无法处理 SPAs”观点的一个更近期的变体是，“多页面应用（MPAs）将取代 SPAs”。

我对 MPAs 感到非常兴奋。更具体地说，作为一个参与了很多动画规范的人，我对[视图转换规范](https://drafts.csswg.org/css-view-transitions-1/)感到兴奋。这是我们在 Mozilla 想做很久了的事情，特别是在 Firefox OS 时期，我们提出了[提案](https://www.chrislord.net/2015/04/24/web-navigation-transitions/)。感谢 Jake 和其他人最终实现了这一点。

视图转换最初是为单页面应用（SPAs）实现的，但已经被改编为适用于多页面应用（MPAs），并且在使多页面站点更加愉快的程度上，它们是非常受欢迎的补充。

然而，在“SPAs 不好”的基础上，似乎有一种倾向是认为 MPAs 是未来，而 SPAs 已经过时了。

与本文早期观点不同，我对这种看法的惊讶并不是基于我在浏览器工作经验上，而是基于我最近在 Web 应用上工作的经验。

不过首先，我们所说的多页面应用（MPAs）是什么意思呢？

我的理解是，相对于 SPAs，MPAs 的特点是通过导航到不同的由网络提供的 HTML 资源来更新内容。这些资源不必是顶级导航，例如可以通过导航一个`<iframe>`来实现。同样，SPAs 可能使用`<iframe>`来分块，但内容更新方式有所不同。

按照这个定义，Google Docs 是一个 SPA，因为虽然每个文档都作为一个单独的资源提供，但大部分时间你都在与通过 JavaScript 持续更新的一个文档进行交互。YouTube 可能被认为是 MPA，但它实际上可能是以 SPA 的形式实现的，以平滑内容的变化，拦截导航并通过脚本替换内容——也就是说，直到视图转换可以帮助解决这个问题。

无论哪种情况，我对 MPAs 将取代*所有*SPAs 的想法感到惊讶：Figma 或 Photoshop for Web 如何作为 MPA 工作？或者 Slack，或者 Discord，或者 Google Maps？

我目前正在开发一个离线优先的移动 Web 应用，可以在本地存储数据并同步到服务器。为了走在 Web 技术的前沿，我调查了如何采用多页面应用（MPAs）。

为了长话短说，如果我们要保持我们所期望的独立导航面板和我们的离线优先要求的用户体验（UX），我们*可能*会引入一些`<iframe>`来将一些功能划分为单独的 HTML 请求（而不是单独的脚本块请求），我们甚至可能有时会预先渲染一些块。问题在于，这会使复杂性增加十倍（双向同步变成三向同步首先要开始），而且完全不会给客户带来任何好处——相反，这几乎肯定会导致更多的错误、更多的延迟和更慢地发布功能。

鉴于我们的应用程序目前尚未发布，我意识到这是一个相当薄弱的论点，因为没有人能够查看应用程序并建议更好的方法，所以我只是请求你相信我。我试过了。我真的试过了。这对于这个特定的应用程序来说并不是正确的架构，我对“*一切*都应该是 MPA”的建议感到惊讶。

继续我们的 Web 开发最佳实践主题，构建一个可以在没有 JavaScript 的情况下运行的站点是一个值得赞美的目标。这样做可能意味着它会优雅地降级，没有 JavaScript 阻塞初始渲染，并且在各种浏览器上运行。但令我惊讶的是这种做法经常变得教条化：“*所有*站点都应该在没有 JavaScript 的情况下运行”。

我想如果*你*的网站能够在没有 JavaScript 的情况下运行，那么很容易得出这个结论（见“我的博客代表了大规模 Web 开发”），但对我来说这有点狭隘。

我以前提到过 Figma 和 Photoshop for Web；很难想象它们在没有 JavaScript 的情况下如何工作。同样适用于浏览器的开发者工具。甚至 Parapara Animation 也是如此！

此外，尽管许多反对 JavaScript 的倡导者也关注可访问性，但通常需要 JavaScript 才能使应用程序具有可访问性。

Mozilla 的可访问性专家教会我的一件事是 `Tab` 导航应该相当粗糙。也就是说，您使用 `Tab` 键导航到控件组（例如工具栏），然后使用箭头键在该组内移动。这样可以让您在应用程序中更快地移动，而不必先通过每个控件 `Tab` 一遍。WAI 将此称为[“roving tabindex”](https://www.w3.org/WAI/ARIA/apg/practices/keyboard-interface/#kbd_roving_tabindex)。

然而，要实现这种粗粒度键盘导航，您需要使用 JavaScript。如果要使基于箭头键的导航二维化，您将需要更多的 JavaScript。也许总有一天我们会填补平台上的这一空白（看向你，[focusgroup](https://open-ui.org/components/focusgroup.explainer/)），但目前你可以毫不羞愧地使用客户端 JavaScript 来使你的应用程序可访问。

说实话，我认为有些网站应该使用*更多*的 JavaScript。

例如，[Eleventy 文档](https://www.11ty.dev/docs/)似乎在很大程度上避免使用客户端 JavaScript。由于 Eleventy 支持各种模板语言，它在每种不同的语言中提供了代码示例。不幸的是，它不记录您选择了哪种语言，因此如果您选择的语言不是默认语言，您将被迫在*每一个*代码示例上更改选项卡。在这里加入一点客户端 JavaScript 将使用户的体验更加愉快。

*更新（2024-01-11）：看起来 Eleventy 已经接受了这个反馈，并[修复了这个问题](https://twitter.com/eleven_ty/status/1745156260649959708)。谢谢！* 🙏

*虽然这篇文章中的几乎一切都来自 2022 年，但在整理它时，我忍不住加入了一个最近惊讶我的新想法。*

我们在 Web 开发教条列车上的最后一站是一个观点，这个观点已经出现过几次，但仍然让我感到惊讶。我最近看到的最新版本大致是，“我们是如此盲目和固执，以至于我们最终拥有了一个极其复杂的工具链，但实际上我们应该能够在完全没有构建步骤的情况下发布 Web 应用程序”。

作为一个大部分时间都在使用编译语言工作的人，去掉构建步骤的愿望令人惊讶。编译器工程师做的事情令我惊讶。他们是将聪明的优化层层叠加在一起的天才，将我的普通代码转变成了难以辨认且速度疯狂快的东西。如果有什么的话，我更希望在我的 Web 开发中有更多这样的编译器魔法。

显然，JavaScript 也存在自己的挑战，因为很难静态确定某个操作的副作用，但我相信在编译时优化 JavaScript 还有更多的探索空间。

Web 开发人员似乎都同意优化图像资产和在合适的地方预生成静态 HTML 页面，为什么对优化代码资产也存在抵抗？为什么要将计算和 I/O 推迟到运行时，而这些可以在构建时完成一次呢？即使没有其他原因，我也不想将我长达几兆字的对 iOS Safari 的咒骂评论发送给每个请求的用户。

或许 2024 年将是客户端 Rust/WASM 前端框架开始受到关注的一年，如果是这样，我们最好开始适应构建步骤！

上述一些观点可能可以总结为“我的博客代表了大规模 Web 开发”。也就是说，从浏览器工程师到 Web 开发人员，我发现大多数让我感到惊讶的 Web 开发概念是人们根据自己对 Web 的体验进行推断，而这种推断方式与我的体验并不重叠。

自从四年多前离开 Mozilla 以来，我大部分时间都在开发一个 Web 应用程序。我也花费了*太*长时间来设置这个博客。令人惊讶的是，在工具、架构或 Web 平台功能方面的使用上，我几乎没有发现两者之间有任何重叠。这几乎就像博客和应用程序存在于完全不同的 Web 开发领域一样。

我的应用程序是一堆 TypeScript 代码，我的博客几乎没有使用客户端 JavaScript。我的应用程序通过双向数据同步变得非常复杂，我的博客是只读的。我的应用程序使用 webpack，Playwright 端对端测试，一个组件框架和一个状态管理库，而我的博客没有使用这些。

如果你主要参与其中之一，很容易认为这就是 Web 开发的样子。事实上，Web 开发可能比我们想象的更加多样化。

上述内容中还有其他令我感到惊讶的概念，但以上共同的主题是，很容易假设我们对 Web 的体验代表了 Web 开发的普遍情况。

从浏览器开发转回到 Web 开发是一种谦卑的体验，因为它比我了解的要广泛和深入得多。我对 Web 开发人员有了更大的尊重，尤其是那些靠其 Web 应用程序的成功与否而生死攸关的小型 Web 商店和初创企业。

如果你也是这种情况，我希望阅读本文能让你相信，即使浏览器工程师、标准编辑和其他 Web 开发人员坚持某种特定的做事方式，你也比任何人都更了解自己的限制，而且你很可能做得很好。

自从发布这篇文章以来，我收到了一些非常有用的反馈，我将在下面总结一下：

+   有些人指出，反对 JavaScript 和反对 SPA 情绪背后的背景是对将静态站点渲染为 React SPA 的反应，这是一种非常不合适的做法。这是我没有意识到的有益背景信息。

+   其他人澄清，“无构建步骤”的论点更多地是关于本地开发，而不是关于生产资产。这很有道理，也是我能理解的事情。

    我的观点并不是说你*应该*有一个构建步骤，而只是想说，作为一个来自浏览器开发领域的人，我对反对构建步骤的情绪感到惊讶，因为我习惯于编译器，我很想看看它们还能为我们做些什么。

+   有些人对一些后来的观点提出了异议，因为我没有清晰地总结我的主要争论。这里是：

    我在浏览器上工作了十多年，仍然参与 Web 标准和浏览器开发。*我热爱这个平台，并鼓励其他人充分利用它。*

    我的争论是关于有时对 Web 开发最佳实践断言的绝对条件。Web 开发社交媒体可能是一个激烈的地方——这是我在浏览器工作时所不曾经历的。

    我当然不是在建立一种新的教条，而只是在反驳并说，使用 JavaScript，编写单页应用，并具有构建步骤有时是正确的选择，你不应该感到难过。
