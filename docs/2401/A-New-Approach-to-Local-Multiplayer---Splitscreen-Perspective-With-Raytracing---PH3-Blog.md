<!--yml

分类：未分类

日期：2024年05月27日 14:29:04

-->

# 一种新的本地多人游戏 / 分屏视角与光线追踪 | PH3 博客

> 来源：[https://ph3at.github.io/posts/Ray-Coop-Camera/](https://ph3at.github.io/posts/Ray-Coop-Camera/)

# 动机

我是本地多人游戏的超级粉丝，特别是本地合作多人游戏。我*也*对3D渲染特别感兴趣，尤其是光线追踪。

这篇博文是我终于在 2023 年勉强写的，它源于我在 2019 年提出的一个想法，并在 2022 年作为原型实现的结果。它利用完全光线追踪实时渲染的独特优势来实现本地多人游戏的新型屏幕共享。但在此之前，先来看看历史。

> 如果你对历史课不感兴趣，你可以直接跳转到[结果](#the-result)。
> 
> 我发誓历史部分也很有趣！

## 分屏和共享屏幕的历史[](#split-screen-and-shared-screen-history)

*在实现任何类型的本地合作时，一个更大的挑战是所有玩家共享一个屏幕。理想情况下，一个游戏可以设计成这样一种方式，以利用一个共享的视角，我一般觉得这些游戏最适合本地多人游戏。但通常情况下，特别是对于3D游戏，使用单一视角是不可行的。*

**《光环：无穷》中的传统分屏游戏玩法**

*解决这个难题的传统方法是将屏幕分割为N个区域，用于N个玩家，通常是大小相等的。每个区域显示一个独特的视角，并且 - 从3D渲染的角度来看 - 拥有自己的摄像机。一些游戏进一步发展了这个想法，无论是在视觉上还是通过将其与游戏玩法集成在一起。接下来，我将列举一些我知道的在单屏幕、多摄像机框架内做出有趣尝试的游戏示例。*

### *Renegade Ops – 动态分屏[](#renegade-ops--dynamic-splitting)*

**2011年合作双摇杆射击动作游戏[Renegade Ops](https://store.steampowered.com/app/99300/Renegade_Ops/)是我第一次遇到一个根据世界空间中玩家的相对位置变化而改变多人游戏屏幕布局的系统。**

***Renegade Ops 的动态分屏实现***

**在游戏中，每个玩家控制一个载具，当它们相对接近时，屏幕是共享的。如果它们相互远离，游戏会在某个时刻切换到两个单独的摄像机视角，这些视角沿着相对位置响应的一条线分割。也就是说，如果玩家在水平轴上的位置完全相同，分割线将完全垂直，如果它们在相同的垂直位置上，分割线将完全水平。任何偏移都会导致倾斜的线，就像上面的截图中所见。**

**自《Renegade Ops》以来，有几款拥有俯视或等距摄像头的游戏采用了这种类型的动态分屏视觉风格。如果你知道有早于此的类似作品，请告诉我们。**

> **在内部PH3校对中，发现《乐高印第安纳琼斯2》使用了动态分屏，并于2009年发布。可能会有更早的例子！**

### **《DYO – 将分屏视为游戏机制》[](#dyo--splitscreen-as-a-gameplay-mechanic)**

***[DYO](https://store.steampowered.com/app/791470/DYO/) 是一款于2018年发布的独立合作解谜平台游戏。对我来说，它实现了一个简直是天才的想法：不将分屏视为“必要的恶”，以便让两个玩家在单个屏幕上拥有各自的视角，而是重新将分屏概念化为核心游戏机制。***

****《DYO》将其分屏视为游戏机制****

***在游戏中，玩家可以控制与屏幕分割相关的各种方面，例如，可以安排两半使以前无法通过的障碍物变得可通过。***

> ***DYO现在在[Steam上免费](https://store.steampowered.com/app/791470/DYO/)，如果你对此感兴趣，请务必试试！***

### ***《Degrees of Separation – 为什么不两者兼而有之？》[](#degrees-of-separation--why-not-both)***

***2019年的[Degrees of Separation](https://store.steampowered.com/app/809880/Degrees_of_Separation/) 将《Renegade Ops》的动态分屏和《DYO》的屏幕分割作为游戏玩法融合到了一个出色的解谜平台游戏中。***

****《Degrees of Separation》在机制上很有趣，而且也很美丽****

***《Degrees of Separation》的每个关卡都引入了动态分屏作为机制的独特用法，并且每个这样的机制又在很多拼图中得到了深入的探索。***

### ***《Ys IX – 不要分割它》[](#ys-ix--just-dont-split-it)***

***总的来说，我对分屏游戏玩法并不十分喜欢，除非像上述游戏那样以非常聪明的方式使用。***

***我认为被低估的一个选项是简单地不分割屏幕，即使在完全3D的游戏中也是如此。这就是我为《Ys VIII》和《Ys IX》都实现的合作模式的工作方式。一个单独的3D摄像头尽其所能保持两个玩家在画面内，并且两个玩家都有共享调整它的能力。下面的视频展示了使用该方法的一些游戏玩法：***

***[https://www.youtube.com/embed/SNgDIFRG7S8?si=4pviUxcRhcUMSkYr](https://www.youtube.com/embed/SNgDIFRG7S8?si=4pviUxcRhcUMSkYr)

VIDEO***

***当然，这并不是没有牺牲的：即使花费了相当多的时间来调整摄像机，玩家之间仍然需要适应并良好协调，有时它可能无法显示一个或甚至两个实际玩家角色。然而，我知道我们和其他人都完成了这些游戏，并且共享摄像机提供了独特的游戏体验，所以我希望某时候也有其他人能试一试。*** 

> # ***这个想法***
> # 
> ***迄今为止我所知道的所有分屏游戏实现都有一个共同点：无论屏幕如何分割 – 无论是传统的固定分配还是动态分配 – 最终仍然只是将屏幕分割成两个或多个标准摄像机视角，每个玩家分配一个。*** 
> 
> ## ***技术背景：光栅化的局限性[](#技术背景：光栅化的局限性)*** 
> ## 
> ***这个普遍真理并不令人惊讶。游戏中的实时渲染 – 至少在硬件加速的光线追踪出现之前 – 是基于光栅化的，并且传统的光栅化流水线假设整个屏幕上有一个一致的摄像机投影。为了在3D游戏中实现分屏渲染，传统的跨平台方法基本上需要为每个视角再次执行几乎渲染整个帧的所有工作。*** 
> 
> ***我也对一项与本文主题无关的技术很感兴趣，那就是**VR**。VR渲染需要两个视角，每个眼睛一个，或者对于大视场显示器来说最好是更多。这促使GPU供应商为这种用例提供了改进的支持，尽管我不确定有多少（或者有没有？）分屏游戏实际上利用了这样的硬件支持。*** 
> 
> > ***NVIDIA在这里有一篇关于与VR相关的多视图渲染主题的详尽而且非常有图解的技术博文[（链接）](https://developer.nvidia.com/blog/turing-multi-view-rendering-vrworks/)。如果你想了解更多，可以阅读一下。*** 
> > 
> ***然而，即使有最先进的硬件支持，一次只能渲染最多4个不同的视图而没有重大的性能影响 – 甚至这也需要相当多的开发工作。*** 
> 
> ## ***光线追踪的潜力[](#光线追踪的潜力)*** 
> ## 
> ***光线追踪改变了这些基本规则，并且基本上消除了所有这些限制。略微简化，每个像素都是通过向场景发射一个单独的光线并观察它的击中情况生成的。因此，理论上我们可以为每一个这些光线使用不同的方向和位置。这就是我们最终可以实现的想法所在：*** 
> 
> ***与其为每个玩家拥有完全不同和清晰界定的视角，动态调整摄像机(s)到像素级。*** 
> 
> ***这使我们不仅可以使用屏幕空间的任意分布来展示各个玩家的视角，甚至可以在他们的视角之间平滑地插值！***
> 
> > ***请注意，今天基本上没有使用光线追踪的主流游戏实际上会对所谓的主要或初始光线进行光线追踪（主要是因为光栅化更有效）。不过，你很快就会看到，这是完全可能的。***
> > 
> # ***结果***
> # 
> ***话不多说，这就是它可能看起来像的样子：***
> 
> ***[https://www.youtube.com/embed/O_LH6aGUzbY?si=dkKKrmzicJlHNOYV](https://www.youtube.com/embed/O_LH6aGUzbY?si=dkKKrmzicJlHNOYV)
> 
> ***视频***
> 
> ***这是一个展示这个想法的基本实现的短视频。
> 
> ***正如你所看到的，场景从一个共享的视角开始，当两个球（由两名玩家控制）彼此远离时，屏幕会平滑地分割成每个玩家的独立区域。最有趣的部分是发生在它们之间的“无人区”，在那里，由于相机参数的插值，空间看起来被压缩了。***
> 
> ***如果你想知道游戏是什么：你所看到的（第一次）是*球体壮观*。这是我们在首批RTX系列GPU发布后不久，大约在2019年左右开发的。在游戏玩法上，基本上是一个滚动球游戏。在技术层面上，我们想构建的是一个**完全**光线追踪的东西，绝对不使用光栅化。我们也不想在游戏中使用任何图像/纹理，所以一切都只是几何和着色器。***
> 
> # ***实施***
> # 
> ***在这里我不会详细说明，但实现中最有趣的部分是如何实际决定分割屏幕。我在这里尝试了几个选项。从数学上讲，这个问题似乎类似于尝试用屏幕上玩家的位置绘制泰森多边形图，然后设置一些值来确定插值的宽度。我试图让它工作，但最终还是回到了更加临时的解决方案。***
> 
> ***你在视频中看到的是我尝试了一些不同的公式，并坚持选择了看起来像我想要的东西，但在这里有很多探索的选项。我最终只花了两个工作日将这个演示程序改编成球体壮观 - 这还包括为两名玩家实现支持！
> 
> ***正如人们所预料的那样，代码相当混乱。最有趣的核心方面在这里，在光线生成着色器的这一部分：***
> 
> ***我仍然认为，我能够在短短两天的时间里将整个想法实现，至少在某种程度上，这令人感到非常了不起，这表明了它在根本上比试图在光栅化管线中做任何类似的事情要简单得多。***
> 
> # ***结论***
> # 
> ***如果你读到了这一点，那么感谢你和我一起通过本地多人游戏摄像机视角历史以及我基于光线追踪的新想法的旅程。***
> 
> ***现在我们只需要有人围绕它构建一个完整的游戏！***
