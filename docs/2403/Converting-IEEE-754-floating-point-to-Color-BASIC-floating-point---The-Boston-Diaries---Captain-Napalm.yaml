- en: <!--yml
  prefs: []
  type: TYPE_NORMAL
- en: 'category: 未分类'
  prefs: []
  type: TYPE_NORMAL
- en: 'date: 2024-05-27 14:32:56'
  prefs: []
  type: TYPE_NORMAL
- en: -->
  prefs: []
  type: TYPE_NORMAL
- en: Converting IEEE-754 floating point to Color BASIC floating point - The Boston
    Diaries - Captain Napalm
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 来源：[https://boston.conman.org/2024/02/28.1](https://boston.conman.org/2024/02/28.1)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: I'm still playing around with [floating point on the 6809](/2024/02/07.1)—specifically,
    support for floating point for the Color Computer. The format for floating point
    for Color BASIC (written by Microsoft) predates the [IEEE-754 Floating Point Standard](https://codedocs.org/what-is/ieee-754)
    by a few years and thus, isn't quite compatible. It's close, though. It's defined
    as an 8-bit exponent, biased by 129, a single sign bit (after the exponent) and
    31 bits for the mantissa (the leading one assumed). It also does *not* support
    ±∞ nor NaN. This differs from the IEEE-754 single precision that uses a single
    sign bit, an 8-bit exponent biased by 127 and 23 bits for the mantissa (which
    also assumes a leafing one) and support for infinities and NaN. The IEEE-754 double
    precision uses a single sign bit, an 11-bit exponent biased by 1023 and 52 bit
    for the mantissa (leading one assumed) plus support for infinities and NaN.
  prefs: []
  type: TYPE_NORMAL
- en: 'So the Color BASIC is about halfway between single precision and double precision.
    This lead me to use IEEE-754 double precision for the Color Computer backend (generating
    an error for inifinities and NaN) [then massaging the resulting double into the
    proper format](https://github.com/spc476/a09/blob/8682748ac0f98d7f83bbdb0b6e772270cf3fc89f/frsdos.c#L292).
    I double checked this by finding some floating point constants in the Color BASIC
    ROM as shown in the book *Color BASIC Unravelled II*, ([available on the Computer
    Computer Archives](https://colorcomputerarchive.com/repo/Documents/Books/Unravelled%20Series/)),
    like this table:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Then using the byte values to populate a variable and printing it inside BASIC
    (this is the expression -2π³/3!):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'Then using that to create a floating point value:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Checking the resulting bytes that were generated:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'And adjusting the floating point constant until I got bytes that matched:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: I figure it's “close enough.” The parsing code in the Color BASIC ROM is old
    and predates the IEEE-754 floating point standard, so a few different digits at
    the end I think is okay.
  prefs: []
  type: TYPE_NORMAL
- en: 'As a final check, I wrote the following bit of code to calculate and display
    -2π³/3!, display the pre-calculated result, as well as display the pre-calculated
    value of 2π:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'The results were:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: The calculation results in -41.3417023 and the direct result stored in `answer`
    also prints out -41.3417023, so that matches and it reinforces my approach to
    this nominally right.
  prefs: []
  type: TYPE_NORMAL
- en: But I think Microsoft had issues with either generating some of the floating
    point constants for the larger terms, or transcribing the byte values of the larger
    terms. Take for instance -2π^(11)/11!. The correct answer is -15.0946426, but
    the bytes in the ROM define the constant -14.3813907, a difference of .7. And
    it's not like Color BASIC can't calculate that correctly—when I typed in the expression
    by hand, it was able to come up with -15.0946426.
  prefs: []
  type: TYPE_NORMAL
- en: Or it could be that ~~Walter K. Zydhek,~~  author of *Color BASIC Unravelled
    II*, is wrong in his interpretation of the expressions used to generate the values,
    or his interpretation of what the values are used for. I'm not sure who is at
    fault here.
  prefs: []
  type: TYPE_NORMAL
- en: Update on Friday, March 1^(st), 2024
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: I was wrong about the authorship of *Color BASIC Unravelled II*. It was not
    Walter K. Zydhek, but some unknown author of Spectral Associates, a company that
    is no longer in business. All Zydhek did was to transcribe a physical copy of
    the book (which is no longer available for purchase anywhere) into a PDF and make
    it available.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: Discussions about this entry
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: You have my permission to link freely to any entry here. Go ahead, I won't bite.
    I promise.
  prefs: []
  type: TYPE_NORMAL
- en: 'The dates are the permanent links to that day''s entries (or entry, if there
    is only one entry). The titles are the permanent links to *that* entry only. The
    format for the links are simple: Start with the base link for this site: [https://boston.conman.org/](https://boston.conman.org/),
    then add the date you are interested in, say [2000/08/01](/2000/08/01), so that
    would make the final URL:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://boston.conman.org/2000/08/01](https://boston.conman.org/2000/08/01)'
  prefs: []
  type: TYPE_NORMAL
- en: You can also specify the entire month by leaving off the day portion. You can
    even select [an arbitrary portion of time.](/about/technical.html)
  prefs: []
  type: TYPE_NORMAL
- en: 'You may also note subtle shading of the links and that''s intentional: the
    “closer” the link is (relative to the page) the “brighter” it appears. It''s an
    experiment in using color shading to denote the distance a link is from here.
    If you don''t notice it, don''t worry; it''s not all *that* important.'
  prefs: []
  type: TYPE_NORMAL
- en: It is assumed that every brand name, slogan, corporate name, symbol, design
    element, et cetera mentioned in these pages is a protected and/or trademarked
    entity, the sole property of its owner(s), and acknowledgement of this status
    is implied.
  prefs: []
  type: TYPE_NORMAL
