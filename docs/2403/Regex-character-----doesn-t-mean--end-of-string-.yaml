- en: <!--yml
  id: totrans-split-0
  prefs: []
  type: TYPE_NORMAL
- en: 'category: 未分类'
  id: totrans-split-1
  prefs: []
  type: TYPE_NORMAL
- en: 'date: 2024-05-29 12:31:57'
  id: totrans-split-2
  prefs: []
  type: TYPE_NORMAL
- en: -->
  id: totrans-split-3
  prefs: []
  type: TYPE_NORMAL
- en: Regex character “$” doesn't mean “end-of-string”
  id: totrans-split-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 来源：[https://sethmlarson.dev/regex-$-matches-end-of-string-or-newline](https://sethmlarson.dev/regex-$-matches-end-of-string-or-newline)
  id: totrans-split-5
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: This article is about a bit of surprising behavior I recently discovered using
    Python's regex module (`re`) while [developing SBOM tooling for CPython](https://github.com/python/release-tools/pull/92#discussion_r1484470272).
  id: totrans-split-6
  prefs: []
  type: TYPE_NORMAL
- en: Folks who've worked with regular expressions before might know about `^` meaning
    "start-of-string" and correspondingly see `$` as "end-of-string". So the pattern
    `cat$` would match the string `"lolcat"` but not `"internet cat video"`.
  id: totrans-split-7
  prefs: []
  type: TYPE_NORMAL
- en: The behavior of `^` made me think that `$` was similar, but they aren't always
    symmetrical and the behavior is *platform-dependent*. Specifically for Python
    with multiline mode *disabled* the `$` character can match either the end of a
    string *or a trailing newline before the end of a string*.
  id: totrans-split-8
  prefs: []
  type: TYPE_NORMAL
- en: So if you're trying to match a string without a newline at the end, **you can't
    only use `$` in Python!** My expectation was having multiline mode disabled wouldn't
    have had this newline-matching behavior, but that isn't the case.
  id: totrans-split-9
  prefs: []
  type: TYPE_NORMAL
- en: Next logical question is how does one match the end of a string without a newline
    in Python?
  id: totrans-split-10
  prefs: []
  type: TYPE_NORMAL
- en: After doing more research on [Python](https://docs.python.org/3/library/re.html#regular-expression-syntax)
    and [other regular expression syntaxes](https://www.regular-expressions.info/anchors.html)
    I also found `\z` and `\Z` as candidates for "end-of-string" characters.
  id: totrans-split-11
  prefs: []
  type: TYPE_NORMAL
- en: 'Multi-line mode is enabled with [`re.MULTILINE`](https://docs.python.org/3/library/re.html#re.MULTILINE)
    in Python, the docs have the following to say:'
  id: totrans-split-12
  prefs: []
  type: TYPE_NORMAL
- en: When `re.MULTILINE` is specified the pattern character '$' matches at the end
    of the string and at the end of each line (immediately preceding each newline).
    By default, '$' only matches at the end of the string and immediately before the
    newline (if any) at the end of the string.
  id: totrans-split-13
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Let''s see how these features work together across multiple platforms:'
  id: totrans-split-14
  prefs: []
  type: TYPE_NORMAL
- en: '| Pattern matches `"cat\n"`? | `"cat$"` multiline | `"cat$"` no multiline |
    `"cat\z"` | `"cat\Z"` |'
  id: totrans-split-15
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- | --- | --- |'
  id: totrans-split-16
  prefs: []
  type: TYPE_TB
- en: '| PHP | ✅ | ✅ | ❌ | ✅ |'
  id: totrans-split-17
  prefs: []
  type: TYPE_TB
- en: '| ECMAScript | ✅ | ❌ | ⚠️ | ⚠️ |'
  id: totrans-split-18
  prefs: []
  type: TYPE_TB
- en: '| Python | ✅ | ✅ | ⚠️ | ❌ |'
  id: totrans-split-19
  prefs: []
  type: TYPE_TB
- en: '| Golang | ✅ | ❌ | ❌ | ⚠️ |'
  id: totrans-split-20
  prefs: []
  type: TYPE_TB
- en: '| Java 8 | ✅ | ✅ | ❌ | ✅ |'
  id: totrans-split-21
  prefs: []
  type: TYPE_TB
- en: '| .NET 7.0 | ✅ | ✅ | ❌ | ✅ |'
  id: totrans-split-22
  prefs: []
  type: TYPE_TB
- en: '| Rust | ✅ | ❌ | ❌ | ⚠️ |'
  id: totrans-split-23
  prefs: []
  type: TYPE_TB
- en: '✅: Pattern matches the string `"cat\n"`'
  id: totrans-split-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '❌: Pattern does not match the string `"cat\n"`'
  id: totrans-split-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '⚠️: Pattern is invalid or character not supported.'
  id: totrans-split-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Summarizing the above table, if matching a trailing newline is acceptable then
    `$` with multiline mode works consistently across all platforms, but if we wanted
    to *not match* a trailing newline then things get more complicated.
  id: totrans-split-27
  prefs: []
  type: TYPE_NORMAL
- en: To not match a trailing newline, use `\z` on all platforms except Python and
    ECMAScript where you'll need to use `\Z` or `$` without multiline mode respectively.
    Hope you learned something about regular expressions today!
  id: totrans-split-28
  prefs: []
  type: TYPE_NORMAL
- en: 'Note: The table of data was gathered from [regex101.com](https://regex101.com),
    I didn''t test using the actual runtimes.'
  id: totrans-split-29
  prefs: []
  type: TYPE_NORMAL
- en: '**Thanks for reading!** ♡ Did you find this article helpful and want more content
    like it? <nobr>Get notified of new posts</nobr> by subscribing to the [RSS feed](/feed)
    or the [email newsletter](https://buttondown.email/sethmlarson).'
  id: totrans-split-30
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
