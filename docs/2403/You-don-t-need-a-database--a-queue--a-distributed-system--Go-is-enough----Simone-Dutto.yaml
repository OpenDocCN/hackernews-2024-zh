- en: <!--yml
  prefs: []
  type: TYPE_NORMAL
- en: 'category: 未分类'
  prefs: []
  type: TYPE_NORMAL
- en: 'date: 2024-05-27 14:50:27'
  prefs: []
  type: TYPE_NORMAL
- en: -->
  prefs: []
  type: TYPE_NORMAL
- en: 'You don’t need a database, a queue, a distributed system: Go is enough. | Simone
    Dutto'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 来源：[https://simonedutto.github.io/2024-03-09/binary-duel](https://simonedutto.github.io/2024-03-09/binary-duel)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Written by Simone Dutto
  prefs: []
  type: TYPE_NORMAL
- en: on  March 09, 2024
  prefs: []
  type: TYPE_NORMAL
- en: 'You don''t need a database, a queue, a distributed system: Go is enough.'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: This article is a reminder to me and you all that you probably don’t need to
    make things harder for yourself.
  prefs: []
  type: TYPE_NORMAL
- en: Reading all these articles about software architectures and scalability has
    influenced me to think that before shipping an idea we need to have it all figured
    out.
  prefs: []
  type: TYPE_NORMAL
- en: The Scalability Tale
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We need to choose a *database*: so, let’s start with that. We need to choose
    a db with a generous free tier, set it up, secure it, check the client API, and
    debug obscure network thingy (VPC, security group, TLS, etc.).'
  prefs: []
  type: TYPE_NORMAL
- en: 'After that, we need to choose a scalable application deployment: so we need
    to check the pricing on that, set the scalability metric, check if it works, see
    the supported runtime, etc.'
  prefs: []
  type: TYPE_NORMAL
- en: At a certain point, we asked ourselves self “Do I need to learn K8?”.
  prefs: []
  type: TYPE_NORMAL
- en: Finally, we are gonna write our first character of code, right? No, we need
    to set up the CI/CD pipeline. So let’s start the fight to make it work with a
    secret key and permission model (I Love IAM).
  prefs: []
  type: TYPE_NORMAL
- en: By the end of this process the magic, the sparkle is lost and the will to ship
    the thing is gone away.
  prefs: []
  type: TYPE_NORMAL
- en: Been there, done that.
  prefs: []
  type: TYPE_NORMAL
- en: 'So with this new project: [Binary Duel](https://binary-duel.com/) ← shameless
    plug, I decided to go with a completely different approach.'
  prefs: []
  type: TYPE_NORMAL
- en: My Current Project
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Binary Duel is a simple quiz game to compete with friends, it even has matchmaking,
    and it is all handled by a single half-CPU Golang Server.
  prefs: []
  type: TYPE_NORMAL
- en: And I love it.
  prefs: []
  type: TYPE_NORMAL
- en: 'Incredible features:'
  prefs: []
  type: TYPE_NORMAL
- en: The quiz state machine is full in memory
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The queue system for the matchmaking is in memory
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The questions are stored in a sqlite database
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: There is no auth, no login, no SSO, no nothing
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: It is deployed on an App Engine from the CLI of my personal PC
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: FAQ
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Does it scale?
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: No.
  prefs: []
  type: TYPE_NORMAL
- en: What if someone decides to DoS your application?
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Well, the attack will work. See the [article](https://medium.com/@ifrimvale/binary-duel-front-end-in-2-weeks-with-svelte-and-dasyui-48230a633eb4)
    of the frontend guy who “friendly fired” my backend.
  prefs: []
  type: TYPE_NORMAL
- en: Numbers for engineers
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The backend is a Golang [Fiber](https://docs.gofiber.io/) backend.
  prefs: []
  type: TYPE_NORMAL
- en: The game state machine is map with a mutex to ensure memory safety.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: I have selected the RW Mutex to improve performance since a lot of requests
    are RO operations.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The queue for the matchmaking is handled similarly.
  prefs: []
  type: TYPE_NORMAL
- en: 'The functioning is better explained in this [article](https://medium.com/@ifrimvale/binary-duel-front-end-in-2-weeks-with-svelte-and-dasyui-48230a633eb4),
    but the main idea is that:'
  prefs: []
  type: TYPE_NORMAL
- en: there are some actions to progress the state machine (`/submit-answer`, `/join-game`)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: there is periodic request to check the state of the game machine (`/game-status`)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: I have load tested my application with a prod-like load using [Artillery](https://www.artillery.io/).
  prefs: []
  type: TYPE_NORMAL
- en: The backend can handle approximately 100 concurrent games with a median response
    time of 30ms in a free tier (thanks Google) App Engine. Since each game is expected
    to last 1-3 minutes. It means that scalability would become an issue if and when
    Binary Duel is used by more than a few thousands of people an hour.
  prefs: []
  type: TYPE_NORMAL
- en: In this fortunate case, I will be very happy to host the infrastructure on a
    K8 cluster with autoscaling, self-healing, a distributed database, a Redis server
    and so on.
  prefs: []
  type: TYPE_NORMAL
- en: Final Thoughts
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Let the scalability be a consequence of the success, not something that holds
    you back.
  prefs: []
  type: TYPE_NORMAL
