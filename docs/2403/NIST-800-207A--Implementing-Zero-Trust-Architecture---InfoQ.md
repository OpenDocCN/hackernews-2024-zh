<!--yml

category: 未分类

date: 2024-05-27 14:33:55

-->

# NIST 800-207A: 实施零信任架构 - InfoQ

> 来源：[https://www.infoq.com/presentations/nist-800-207a/](https://www.infoq.com/presentations/nist-800-207a/)

## Transcript

Butcher: 我将简要讨论零信任。我们将主要涵盖以下四个方面。我们将为零信任得到一个可感知的工作定义。我对围绕零信任的恐慌感到非常疲倦，因此我们和SP已得到了一个非常具体的定义。我将介绍其为基于身份的分段。我们将讨论一种使用服务网格作为其中一种架构实现的可能方式。更一般地说，我将概述如何从面向网络的策略逐步转向基于身份的策略。

为什么我要在这里与你们谈论它？我曾是Istio项目的早期工程师之一，这是一个比较流行的服务网格。在那之前，我在Google Cloud上从事了各种各样的工作。我开玩笑地说，如果你在Google Cloud上做企业级的事情，我可能参与过其中一些代码。具体来说，像项目是我长时间以来的宝贝。从那时起，我们在Google内部实际上做了很多网格化的事情，并部署了这种架构，我们认为这可能解决Kubernetes领域即将出现的一些重要问题。这时我们开始了Istio项目的工作。我另外一个主要原因，也可能是我在这里与你们谈论的最大原因是，我与NIST共同撰写了一套安全指南。我参与了两套指南的编写，分别是SP 800-204A和SP 800-204B，这些指南提供了关于微服务安全的指导。第二套指南刚刚完成，事实上，它刚刚被最终确定，之前草案已经发布了几个月。它刚刚被发布，是207A，它是关于零信任的。207系列是NIST关于零信任的系列指南，207A是其中的第二部分。这真正是我们将要深入探讨的内容。这些都是相对较新的东西。再次强调，我们将以以下方式对其进行分解。

## 什么是零信任？

首先，让我们退一步。零信任实际上是什么意思？我们将给出一个定义。我希望你理解的关键是，一个有动机的攻击者可能已经在网络中了。问题是，我们如何限制他们可能造成的损害？这一切都是关于风险缓解。我想先退后一步，然后我们再来定义。这是希望大多数人熟悉的东西，比如一个API网关或者向最终用户提供应用程序。有一些我们总是做的事情。我们总是在用户进入时进行认证。我们希望总是授权该用户执行某些操作。如果我们谈论的是API网关，也许我们还会额外做一些速率限制。也许我们有一些其他的策略，比如WAF可以应用。在前端门户上发生了很多不同的事情。两个重要的是我们总是对用户进行认证和授权。当我们考虑有人可能在网络中，有人可能在内部围栏之内，我们如何尽量减少损害？然后，肯定地，我们可能想要开始对通信工作负载做同样的认证和授权。不仅仅是，我们有一个用户在会话中，而是我们知道这些用户在使用什么。我们希望能够说，前端可以调用后端，后端可以调用数据库。在所有这些跳跃中，最好有一个有效的最终用户凭据。也许我们甚至可以进一步。我们可能会说，如果你要在前端进行put操作，你就必须在最终用户凭据中具备正确的范围。如果你只是要get，那么也许你只需要读权限。当我们开始结合这些时，我们可以制定非常强大的策略。

再次强调，我开头说的是攻击者已经进入了网络。每次我在这个207A演讲中提供的变体都有不同的例子可以引用网络入侵。例如，对于关注新闻的人来说，美国网络安全与基础设施安全局（CISA）与日本联合发布了一份关于由中国驱动的各种网络的网络入侵的重要公告。那个例子非常相关。这个例子来自十年前。有人知道那张图片是从哪里来的吗？那实际上是从斯诺登泄密事件中来的。美国政府介入了基础设施。这里的重点是，一个有动机的攻击者可以进入网络。如果我们唯一的控制措施，唯一的安全措施在边界，那么你已经失控了。这就引出了零信任。我们想要的是显式的信任。事实上，我非常讨厌“零信任”这个短语，它真的应该称为零隐含信任，因为它完全是关于使我们对系统中的信任变得显式化。希望通过策略来实现这一点，这样我们实际上有一个执行它的代码片段。我们想要的信任不是基于边界的，因为它是可以被攻破的。因此，我们需要的是基于最小权限的决策。我们希望每个请求都这样做，因为请求可能会执行不同的操作。我们希望它基于上下文。如果你在美国访问了很多次，然后突然，5分钟后，你从完全不同的地理位置访问，那里可能有些可疑。我们想要基于上下文的决策。再次强调，这些决策需要基于身份。不仅仅是服务身份，我们还想要终端用户身份，可能还有设备身份。因为所有这些因素都影响了我们允许用户访问系统的上下文。如果我使用的是公司批准的设备，并且我已经登录，并且我来自我的家庭地理位置，我可能可以拥有很多访问权限。如果我使用的是一个不受信任的随机设备，突然出现在像俄罗斯或东欧这样的奇怪地理位置，那么我可能想要减少对它的访问权限，因为这不是系统正常操作的典型情况。

## 基于身份的分段（零信任分段）

对于零信任的高层次定义，让我介绍一下基于身份的分段。这是207A的主要内容。我们在207A中定义了几件不同的事物，可能是三件，我将与你讨论，但基于身份的分段是其中重要的一部分。微分段是在网络层面隔离工作负载。理想情况下，我们希望将其下降到单个IP地址，因此我们拥有针对谁能访问谁的成对策略。我们希望在身份层面做同样的事情。我们希望为用户、设备和服务提供防篡改的、可加密验证的身份。我们希望利用这些身份来做出我之前谈到的那个决定，即基于上下文的每个请求的最小特权决策。理想情况下，我们可能会将网络参数作为我们基于风险的评估的一部分。它们不应该是我们做出访问决策的唯一区分因素。然而，再次强调，我们将会因为在网络中的特权位置今天不是一个足够好的安全边界而受到影响。

什么是基于身份的分段？这就是这五件事。如果有什么是你在这次讲话中带走的，那就是这些，这五个运行时活动是你至少需要做的，这些事情，你可以称自己为零信任姿态。除了这些以外，我们还可以做很多事情，也许应该做得更多。这是一个最低限度的工作定义。我们希望有五件事情，传输中的加密。实际上，我们有两个原因想要这个。一是我们想要消息的真实性。我想知道别人不能改变我发送的消息。然后，第二，我们想要窃听保护。如果数据很敏感，我希望确保别人不能查看我正在发送的数据。然后，除此之外，我们想知道，哪些工作负载正在通信？前端是否在调用后端？数据库是否在调用前端？从软件部署的角度来看，我们的系统的哪些部分正在通信？然后，对于身份信息，我们应该授权该访问。同样，我们应该根据每个请求来执行。然后，就像我之前说的一样，我们还想额外地包含终端用户的凭证和终端用户的授权决策。我们希望做到这五件事情。理想情况下，我们希望在我们基础设施的每一个跳点都做到这一点。如果我们实现了这一点，如果我们正在做这个，那么我们对于网络上出现攻击者的答案是什么？希望我们有一个相当不错的答案。因为答案是，现在他们需要窃取一个凭证。我们稍后将更详细地讨论这个模型，但他们需要窃取一个终端用户凭证。他们需要妥协一个工作负载或窃取一个工作负载凭证。这些凭证也是非常短暂的。我会谈谈服务网格，特别是 Istio，工作负载标识可能持续 24 小时，甚至只有一小时。终端用户凭证通常在 15 分钟左右没有刷新的情况下持续。我们可以开始结合这些事情，我们开始在时间和空间上限制攻击者。我们减轻他们可以造成的损害。我稍后会更详细地谈论这个问题。

## 服务网格

服务网格是我们在SPs中讨论实施这一点的关键方式之一。这不是你可以实现这些功能的唯一方式，但这是一个非常强大的方法。我将深入探讨这一点。如果您对基于身份的分段之外的一些其他用例感兴趣，有一些其他的SPs涉及到更多服务网格。我们如何使用服务网格来进行分段？只是为了让每个人都知道什么是服务网格，我们所做的是拿一个代理，一个web代理，一个反向代理，在Istio中我们使用Envoy实现，但您也可以考虑类似的东西如NGINX，或者类似的。我们将它放在每个单个应用程序实例旁边，并强制所有网络流量通过该代理进出应用程序。这使我们能够拥有应用程序标识并代表应用程序进行加密。我们可以代表应用程序做出负载均衡决策。我们可以进行服务发现和负载均衡。我们可以执行诸如弹性、超时、保持活动、重试之类的操作。您可以从系统中获得操作遥测数据，以帮助您闭环。当您进行更改时，您可以看到该更改的效果是什么，它是否符合您的意图？然后再次进行更改，如果不符合。

再次强调，这里有相当多的功能。如果您要建立任何分布式系统，您必须具备这些功能。服务网格在将这些功能引入使用方面并不新颖。服务网格的新颖之处在于，它使我们能够在整个应用程序群中一致地执行所有这些功能，而不论我们使用的是哪种语言，因为我们在网络级别进行操作，并拦截网络流量。这为我们提供了集中控制，因此我们在每个应用程序实例旁都有那些代理，即旁车。我们有一个管理它的中央控制平面。我们可以将声明性配置推送到该控制平面，并且它将在不到一秒的时间内在所有旁车上实施该配置，通常如此。我们有一个非常快速、响应迅速的系统。我们可以查看信号以查看它是否处于我们想要的状态。如果不是，我们可以推送配置，使其几乎即时生效。然后观察并查看它是否处于我们希望的状态。

我曾经在 Istio 上工作。Istio 是目前部署最广泛的服务网格。Istio 现在也是一个 CNCF 项目。在那里，Envoy 是数据平面的一部分。Envoy 处理你请求的比特和字节。它是 sidecar。在运行时，Istio 就是在编程这个 Envoy。还有几个关键的想法我也想给大家，因为我们正在思考这个框架，如何实现零信任的访问控制？我们如何使用服务网格？第一个关键的想法是，这个 sidecar 形成了一个策略强制执行点。这个想法是因为它拦截了所有进出的流量，我们可以利用它来施加任何我们想要的策略。我提到过像加密这样的事情。我提到过像可观察性这样的事情。我们还可以做一些像与 OPA 集成的事情。我们可以做一些像与我们的身份提供者集成以代表应用程序进行单点登录的事情。我们可以构建一个自定义库，执行某些特定于我们业务的操作，并强制要求通过服务网格调用它。这个想法是，当我们有要在整个架构中应用的策略时，不仅仅是针对一组应用程序，而是大多数应用程序时，我们可以利用一次与服务网格集成来进行强制执行，而不必逐个应用程序进行操作。

如果你回到上世纪七十年代的老派访问控制文献，这就是核心的概念来源。这就是我们讨论参考监视器的概念，它拦截了所有的流量并强制执行策略。然后扩展到服务网格本身，这也是 NIST 的人们对服务网格如此感兴趣的一个关键理念之一，可能会成为我们现代分布式系统的安全核心。如果我们将操作系统内核和它为运行在操作系统上的进程提供的安全能力联系起来，它提供了隔离。这些天它提供了 cgroups 和 namespaces，为容器提供软多租户性。它提供了 Unix 文件权限作为另一种访问控制机制。我们在操作系统内核中构建了相当多的访问控制系统，并利用它们来保护我们的应用程序。这个想法是，服务网格可以在我们的分布式系统中扮演同样的角色。与将进程部署到主机上不同，我们将微服务部署到我们的基础设施中。就像操作系统为应用程序提供一套关键的能力集一样，服务网格可以为运行的应用程序提供一致的安全能力集。

通过服务网格实现跨切变更。我提到我们可以集成任何策略，无论是流量路由、安全性还是可观察性，我们都可以将其集成到服务网格中进行强制执行。我们可以集中更改和管理它，这意味着少数人可以代表整个组织来执行政策并进行更改。没有免费午餐，我们无法摆脱复杂性。我们希望在任何地方进行加密。有人仍然需要与PKI集成，并获取证书。服务网格让您只需一次集成，将其与服务网格集成，然后所有应用程序都将受益。一个例子。它可以是我们可以使用的力量倍增器，集中我们需要处理的复杂性，交给一个小团队，他们有能力处理它。例如，在加密的情况下，不需要每个应用团队都去实现一些加密库在他们自己的系统中。

归根结底，如果我们看看我们基于身份的分段的五个原则，我们可以使用服务网格来实现所有这些原则。首先，我们可以实现传输中的加密。服务网格为您提供强大的应用程序身份。我们使用一个称为SPIFFE的系统来做到这一点，并发放一个普通证书来编码应用程序身份，我们可以使用它来进行传输加密，具体来说是双向TLS。然后使用该证书，我们可以认证我们正在通信的工作负载，这意味着我们有机会应用授权。我们确切地知道哪些工作负载正在通信，我们已经对它们进行了身份验证。现在我们实际上可以决定，前端blob调用是否可以直接访问数据库？不，可能不能，它需要通过后端。我们可以开始执行该策略。然后，我们可以将sidecar集成为现有身份和授权系统的策略执行点，用于最终用户。服务网格本身不适合模拟用户对资源访问或类似事物。它擅长于建模服务间的访问。我们希望将授权委托给我们现有的系统来处理最终用户的身份验证和授权。服务网格提供了与这些系统集成的工具。

## 逐步迁移

最后一件我想讨论的事情是，我们如何能够逐步从今天的现有系统——基于周界的系统，过渡到一些基于身份的政策？这样做有什么好处？首先，任何一个层面的政策都会有其不足和痛点。如果我们仅考虑网络策略和基于身份的策略，那么今天基于网络的策略最大的痛点之一是更改通常需要很长时间。在这里有谁的组织中有防火墙，每次需要更改时都得操作一番？有谁能在两周内更改防火墙？通常情况下，我认为我曾经和任何一个组织谈过的，都需要六周时间来更改防火墙。我不知道为什么是这样。需要多长时间？六周。得去查电子表格，得找到CIDR。这种方式不适合我们今天部署的高度动态的环境。特别是云环境，自动伸缩等特性，传统的网络控制无法胜任。我们要么需要使用更复杂、通常也更昂贵的技术来做到这一点，要么就得妥协，减慢我们在云中使用资源的速度，以适应现有的流程，但这是不可接受的。

基于身份的策略，对于这个行业而言，我们在管理基于身份的策略方面并没有太多经验，就像我们在网络导向策略方面那样。一些挑战至今未被解决。其中一个更为明显和最初的问题是，即使像服务这样简单的东西在不同的域中也有不同的身份。如果我在本地运行在虚拟机上，它可能有一个我们在系统中为其分配的Unix用户名来运行，但如果我们在云上，比如GCP，它将会有一个服务账户。如果它在AWS上，也会有一个服务账户，在Azure和许多其他云服务提供商上也是如此。问题在于这些服务账户并不相同。如果我想做类似的事情，前端可以调用后端，而我希望无论这两个在哪里部署，我都可以做到，那么在如何映射这些不同身份宇宙（比如不同的云服务提供商和本地）的身份时，会有一些复杂性。最后，房间里的另一个大象级问题是，即使我们完全接受基于身份的策略，并且说，是的，这是正确的方式，在大多数受监管环境中，我们实际上还不能完全摆脱基于网络的策略。因为审计员或监管机构希望有这样的策略，或者我有一份1992年编写的文件，为组织设置了安全姿态。文件中说必须存在网络分段。修改该文件的成本比支付思科数百万美元进行网络分段更高。出于组织中的多种不同原因，我们不能完全取消网络导向的策略或网络层策略，即使这是可取的。我并不认为这一定是正确的选择。

## 多层策略

相反，我们希望这两个层可以共存。我们想要做的是在两者之间进行权衡，以便我们可以在网络级别最小化某些类型的策略，并用基于身份的策略抵消它们。希望这样做可以使系统更加灵活。接下来我会给你一些具体的例子。如果我们谈论多层策略，实际上有更多层的策略，但我们尽量让SP非常简短和专注。大约有18页，内容约12页，如果你想阅读的话。大多数SP通常是50或60页长。我们确实保持了专注。至少有两个策略，网络层策略，例如防火墙规则，身份层策略，例如我刚刚和你讲过的，如基于应用的更强身份授权。我们可以开始做的是，在需要像穿越防火墙这样的事情时，我们可以开始整合基于身份的策略，并放宽一些我们的网络规则。特别是今天，在网络导向的方案中，当我有两个应用程序，可能一个在本地，一个在云中，或者是我的两个本地数据中心或两个不同的云提供商，其实并不重要，并且我希望它们能够通信。我通常需要去更改组织中的防火墙规则，逐对地。我需要说应用A现在可以调用应用B，或者服务1可以调用服务2。如果明天服务1需要调用服务3，我需要一个新的防火墙更改，然后我又回到了六周更新防火墙的周期中。这是我们与之交谈的人中敏捷性的巨大杀手。

相反，我们可以部署具备身份感知的网关。与其不断更新这些成对规则，我们可以部署这些具备身份感知的代理或网关，实例化一组防火墙规则，说明这两组工作负载可以进行通信。然后，当我们有需要消费的成对应用程序时，我们可以通过基于身份的策略授权，说明服务1和服务2可以通过桥接进行通信。通过这种方式，我们所做的是仍然拥有所有我们的网络控制。我们的用户请求仍然穿越组织已有的所有网络控制，但我们已经能够将策略变更从网络转移到身份上。关键思想是，基于网络的策略是一个CIDR范围。谁知道CIDR是什么及其作用？基于身份的策略应该与运行的应用程序强相关。如果您的运行时身份与应用程序内部的身份不匹配，可能有些问题。我们希望这些事情能够对齐。通常情况下，我们可以更快地改变基于身份的策略，因为人们可以更轻松地阅读和理解默认命名空间中的前端，一旦它被称为后端和默认命名空间，比起我能够理解的10.1.2.4/30，可以调用10.2.5/24。谁知道那意味着什么？这就是为什么我们可以通过这里的转嫁获得更快的变化速度。

典型情况下，我们的系统中不仅有两层策略，通常还有多层策略。我们通常有粗粒度的互联网、内部网的分割。可能我们在这里有广泛的段，一个DMZ，一个应用区域，一个业务区域，数据区域。再次强调，我们今天已经倾向于堆叠这些策略。对于那些在他们的网络中实施微分段的人来说，当你转向微分段时，你们中有多少人放弃了你们的粗粒度段？答案是我们倾向于保留两者并逐步叠加它们。然后Kubernetes带来了一个全新的挑战，因为它是一个虚拟网络。我们有一套新的技术，比如CNI提供者来控制网络策略。这些与传统的网络规则相比具有更好的权衡，因为它们是为动态性而构建的。从根本上讲，仍然有第3层、第4层的策略。然而，我们真正想要的是应用程序标识和最终用户标识，这些都是第7层的事情。这就是为什么我们喜欢看到服务网格堆叠在所有这些上面的原因。我把它想象成一个层层叠加的蛋糕，随着我们的提升。你可以把它想象成瑞士奶酪，如果你真的想考虑深度防御。我们正在努力增强安全防护。

## 多层策略的优势

为什么要这样做？一方面，如果我们以这种方式进行，那么我们可以开始在现有的网络策略之上引入这些新的基于身份的策略。这样做提供了深层防御，因为我们仍然通过传统的网络控制进行操作，但现在在网络控制之上还有这个身份层。当然，已经提到的服务网格可以强制执行这一点，因为它是不可绕过的，是可验证的。我们在SP 800-204B中详细讨论了这一点。我希望你能明白的关键是，我们不需要去除防火墙、Web应用防火墙或类似的东西。你应该能够向你的组织正当地证明，你可以放宽这些控制措施，以引入基于身份的控制措施作为交换。关键在于你的组织要找到合适的平衡点，这样你就可以保持快速推进，同时保持安全和风险控制在组织的适当部分。

## 如何定义和部署基于身份分层策略

从高层次来看，我们如何开始做这件事？我们想要做的是在基础设施的子集中开始实施基于身份的分割。如果我们有多个数据中心，首先尝试在一个数据中心中实施这一策略。然后，在你对基于身份的分割有了良好的概念之后，我们可以开始实施一些更高级的模式，比如将这些网关进行分层连接，以及其他一些模式。当然，并不需要完全将基于身份的分割推广开来，就能够实施一些网关样式的模式。但至少需要足够的能力来对通过该隧道的服务和用户进行身份验证和授权。同样的控制方式适用于用户应用程序的遍历，这一点很关键，因为我们不希望改变现有的安全策略，但我们确实希望在原有的基础上做得更好，以便我们作为一个组织能够更快地前进。

## 零信任心态模型（将攻击限制在空间和时间的边界内）

当谈到零信任时，我提到了一个重要的思维模式。我们希望在空间和时间上限制攻击。我们希望尽量减少攻击者在内部可以做的事情。在这里的一个关键点是，通过堆叠基于身份的政策和基于网络的政策，我们帮助在空间和时间上限制攻击者。显然，基于网络的政策会影响攻击者可以在控制一个工作负载后何时进行攻击的时机。同样地，L7 上的细粒度授权政策帮助限制攻击者可以访问的影响范围。然后，就像我提到的那样，这些短暂凭证。最终用户凭证通常会在 15 分钟后过期，而服务网格服务凭证则通常在 1 到 24 小时后过期。为了实施攻击，攻击者需要同时拥有服务凭证和最终用户凭证，并且需要具有正确的范围，以便我们能够实际上达到并攻击我们想要的系统。由于过期时间的限制，我需要要么持续控制工作负载，以便我可以继续重新窃取这些凭证，要么我需要反复进行攻击，以在它们过期后重新窃取。无论哪种方式，目标都是尽可能增加攻击者的难度。这两种方案都有助于增加难度，有助于在空间和时间上限制攻击者。

## 问题与答案

参与者 1：有了所有这些身份和凭证，我认为调试这个配置会很棘手。你是否提供任何工具，比如正式工具来验证凭证？

Butcher：这个领域今天仍然相当初级。服务网格并不是你实现这些控制的唯一方式。有很多方法可以实现这些控制。服务网格的一个优点是它输出指标。你可以观察系统的状态。让我应用一个策略。它是否正确？我们开始看到的是在其上构建的工具，现在仍然处于早期阶段。例如，我们有一个 CLI 工具，基本上会说，给我 30 天的遥测数据，我会为你生成出基于那 30 天访问的细粒度授权策略。工具正在不断完善，但现在仍然处于早期阶段。我认为这是我们很快会看到成熟的一件事情。

参与者 2：由于你提到服务网格只是一个层次，你可能会在这种认证中放弃它。服务网格在一些非常大的公司规模上有着重大的影响，如果你想在同一个控制平面上运行，它可能会带来很大的单点故障。对于那些可能会卖给我们服务网格的人，你有什么建议吗？

屠夫：在这个世界中，一致性是你最大的资产。如果我从头开始，我要么是一个小组织，要么是试图在没有服务网格的情况下解决这个问题。有一些可能是现代部署事务，我们可以通过服务网格来减轻你所遭受的一些痛苦，但不是全部。简而言之，我将开始专注于库。例如，如果你在一个较小的组织中，在那里，希望我们有一组一致的语言，我们正在处理，特别是如果你是一个相当小的店铺，你只有一种语言。在这种情况下，首先，把它做成一个单体。其次，在库中实现这些确切的五个控件，但只需在库中实现。现在，你可以通过像 gRPC 这样的框架走得更远。即使不管语言，你也可以通过像 gRPC 这样的框架在实现所有这些控制方面走得更远。我给出的第一条建议将会是这样的，用一个库来解决这个问题，如果你只有一个非常小的语言集合。如果你是一个小的商店，有一个小数量的服务和开发者，不要做微服务。为什么要这样做呢？尽可能长时间地将其保持为单体，为了自己简化事务。这就是我会开始的方式。

然后，再次，随着我们在规模和异构性上的成长，要么你分配一个更大的团队来做像开发者正在开发的不同语言的那种库工作。在这里存在一系列关于更新、部署和生命周期的挑战。最终，我们看到服务网格对人们变得有趣的转折点是，维护整个组织中一致的一组更新的库的工作，以及在不同版本之间保持兼容性等等，成本往往很高。像 gRPC 这样的东西使得这一切变得更加可控，而不仅仅是 gRPC，你还可以使用 Spring Boot 或其他东西。在这段旅程中的某个地方，服务网格开始变得更加吸引人。现在，你可以做很多事情来在服务网格部署中拥有更精细化的爆炸半径。特别是，我们建议将它们与你的 Kubernetes 集群一对一地保持一致，这样你就有了一个精炼的爆炸半径，也就是你的集群。然后在集群中，你可以使用一系列技术来分片工作负载，如果你确实处于巨大规模并且需要多个控制平面。或者有一套配置可以用于服务网格，以帮助限制配置流向何处。像在 Istio 中，sidecar API 资源可以在整体性能上给你更好的表现。我要在 Istio 的世界中提到的最后一件事是 Ambient，这是一个在节点级别执行某些这些能力的代理。这又是一个更便宜的方式，用于在那些尚未具备这些能力的地方开始服务网格的采纳。

参与者3：[不可听00:34:32]，这是一种非常多样化的商店类型。一旦我们提到零信任，总是涉及到网络问题，这个，那个，现在我们已经连接了网络。你对如何提出案例有什么建议吗？[不可听00:34:51]。

屠夫：给他们看看这个207A，这就是我写的原因。说真的，这是我们到处都碰到的一个大问题。我开玩笑，但也不是开玩笑。我经常与人们交谈，人们认为，或者说，或者供应商宣传零信任是一种网络活动。我所谈论的仅仅是零信任的运行时部分。那是简单的部分。人员、流程、变更才是困难的部分。我完全忽略了那些。对于网络团队提出的论据，首先是我提到的敏捷性论点。我们更改策略的时间是多久，这是否损害了开发的敏捷性？然后你可以从这样的角度来看待它，因为由于网络痛苦，由于我们执行像策略更改这样的事情的时间，导致我们的用户无法部署的功能是什么？这是我会从一个角度来攻击它的。另一个是，再次强调，您也需要这些认证和授权组件。网络只能完成其中的一部分。我们确实需要更强的身份验证，特别是在用户级别。此外，我们也希望在服务级别也能有。这些是我会强调的一些事情。你可以开始进入像第7层控制这样的东西。例如，你可以说，不仅仅是前端可以调用后端，我可以有一个微分割策略来模拟这个。你可以说，前端只能调用后端的put方法，只能是那一个方法。这是传统网络策略无法模拟的事情。然后我们甚至可以说，只有在有一个有效的终端用户凭证的情况下，才能调用put，如果该终端用户凭证具有正确的范围和put案例正确的范围，例如。希望对大家来说，为什么这会是一个更严格的边界或者说比严格的网络导向更好的安全姿态，这一点是非常清楚的。这是我开始做的方式。说真的，我帮助NIST写这些东西的原因是为了推动这些团队。对于那些特别是在银行业的人们来说，例如，FFIEC已经在他们的指导和IT手册中包括了一些这些内容。如果你在银行或金融领域，去查一下FFIEC关于架构的IT手册。那里有一个微服务的部分，引用了所有这些东西。例如在这个行业，这可能是你的理由。它可能会帮助你的行业，也可能不会。在不同的行业中，我们实际上已经看到这些指导成为标准。

第四位参与者：我非常支持服务网格。我们在几个不同的地方正在生产中使用它。你在这里谈论的很多内容都非常 resonates。我很好奇，你带来了所有这些白皮书。我们担心的一件事是明显的权衡，你担心所有集中控制的力量。我认为现在在这一点上，如果我是 Kubernetes 系统的攻击者，我真正想要的是接管 Istiod。这是我正在寻找的攻击向量。我会直接开门见山，我希望你稍微谈一下这个。你们是否考虑过这个问题？

Butcher：是的，我们确实考虑过。这回到了服务网格潜在地成为内核的核心思想。其中一个影响是，在操作系统中，内核代码接受了相当严格的检查，进行了大量的安全审查。有很多漏洞赏金。无论你是白帽子还是黑帽子，找到内核漏洞都非常有价值。环境的经济学设定为，希望你转向它并这样做。我们在服务网格中也在做类似的事情。你更愿意有一个处理这些安全姿态的服务网格，并且只有一个代码库可以审计吗？所有的执行都发生在 Envoy 中，所以让我们在 Envoy 数据路径上进行安全审计。控制平面配置发生在控制平面上，让我们对此进行审计。或者，我们可以对每个应用程序中的最终用户和服务进行加密、认证和授权。无论是 AppDevs 写了 10 次、100 次，还是希望你使用一个库或类似的东西。关键是，我们可以审计一个代码库，而不是很多个。因为这是一个共享的代码库，并且是开源的，像 Istio 代码库已经存在漏洞赏金，我们可以对其安全性有更高水平的保证。

这里没有什么魔法。就像操作系统内核是人们非常感兴趣的攻击向量一样，在分布式世界中，服务网格也可以是。我认为所有服务网格供应商都有相当健全的安全实践。Linkerd 的团队在这方面有非常好的实践。我亲身知道，Istio 在应对 CVE 的安全实践方面是优秀的。这是我们深入思考的事情。我们知道这是一个攻击向量，这是你想要接管的明显事物。关键是，我们可以集中在这里进行检查，我们可以集中我们的安全审计，并为整个系统获得保障。

第五位参与者：或者，他们也可以添加传播服务原则以及用户原则的上下文到垂直领域。正如你提到的 Istio 的特定服务网格，你可以通过 DN 传播服务身份，通过服务网格加密、双向 TLS。你认为这与稍微将其推向第 7 层，比如 JWT 令牌，有什么区别，[不可听 00:41:11]？

Butcher：实际上，在这个领域已经有先例。对于应用程序身份，所有的服务网格今天都使用安全生产身份框架（SPIFFE）。SPIFFE是由Kubernetes创建者乔·贝达创建的。SPIFFE实际上是基于谷歌内部技术LOAS的松散架构。他们写了一篇名为ALTS的白皮书。正是你所说的那个。这具有一系列有趣的功能。如果我们在那个层面做，我们可以做一些像传播多个服务这样的事情。我们可以传播像服务链这样的东西，前端称为后端，称为数据库。然后我们不需要看一对一的策略。我们不必说前端称为后端，后端称为数据库。我们可以有呼叫图的完整起源，并且我们可以根据此做出决策。我们可以说，只有请求经过前端和后端才能将数据库写入，并且只有这些方法。如果它经过这些路径，它只能被读取。在具有应用程序身份或服务身份的情况下，有大量的力量。那里的一个问题是，你仍然需要处理传输中的加密。没问题。有很多方法可以做到这一点。这不是一个大问题，但你确实需要处理它。然后，有两点，那里似乎有更多的运行时成本。许多人由于那种链接而没有追求它，因为由于签名服务器上有很多签名压力，你往往必须重新发出JWT。那里有一系列权衡。基本上，在运行时，我们看到对于应用程序身份来说，使用mTLS相当不错。有很多关于在应用程序级别进行服务身份的先例，例如JWT，甚至将JWT进行嵌套并将端用户和服务JWT放在一起。所有这些都是好的和有效的。你不必像网格一样使用SPIFFE和mTLS。

参与者 6：在身份安全方面，您如何看待基于角色的安全和网格服务？

Butcher：当涉及到服务网格时，我们如何看待RBAC（基于角色的访问控制）和其他访问控制范式？

在授权服务到服务访问时，请使用适合您的方案。在 Istio 中，有一个本地授权 API，这是一种 RBAC 风格的 API。在这个世界中，如果你只是在纯上游 Istio 中工作，你基本上只是编写直接的 RBAC。这是你在处理服务到服务访问时唯一的选择。肯定还有其他方案。许多人使用像 OPA（Open Policy Agent）这样的东西来实现，他们在那里编码关于服务到服务访问的策略。从 207A 的角度来看，我们不太关心授权机制是什么。如果你去读 SP 800-204B，我们强烈主张下一代访问控制，NGAC，是你应该用于服务到服务访问的访问控制系统。这是现代化的 RBAC。访问控制总体上是我研究的关键领域之一，特别是下一代访问控制。

**查看更多 [带有文本](https://www.infoq.com/transcripts/presentations/)的演示**
