- en: <!--yml
  id: totrans-split-0
  prefs: []
  type: TYPE_NORMAL
- en: 'category: 未分类'
  id: totrans-split-1
  prefs: []
  type: TYPE_NORMAL
- en: 'date: 2024-05-29 12:31:40'
  id: totrans-split-2
  prefs: []
  type: TYPE_NORMAL
- en: -->
  id: totrans-split-3
  prefs: []
  type: TYPE_NORMAL
- en: 'PostgreSQL: pgsql: Support C.UTF-8 locale in the new builtin collation provider.'
  id: totrans-split-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 来源：[https://www.postgresql.org/message-id/E1rmhxt-004ezT-OB%40gemulon.postgresql.org](https://www.postgresql.org/message-id/E1rmhxt-004ezT-OB%40gemulon.postgresql.org)
  id: totrans-split-5
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Support C.UTF-8 locale in the new builtin collation provider.
  id: totrans-split-6
  prefs: []
  type: TYPE_NORMAL
- en: The builtin C.UTF-8 locale has similar semantics to the libc locale of
  id: totrans-split-7
  prefs: []
  type: TYPE_NORMAL
- en: the same name. That is, code point sort order (fast, memcmp-based)
  id: totrans-split-8
  prefs: []
  type: TYPE_NORMAL
- en: combined with Unicode semantics for character operations such as
  id: totrans-split-9
  prefs: []
  type: TYPE_NORMAL
- en: pattern matching, regular expressions, and
  id: totrans-split-10
  prefs: []
  type: TYPE_NORMAL
- en: LOWER()/INITCAP()/UPPER(). The character semantics are based on
  id: totrans-split-11
  prefs: []
  type: TYPE_NORMAL
- en: Unicode simple case mappings.
  id: totrans-split-12
  prefs: []
  type: TYPE_NORMAL
- en: The builtin provider's C.UTF-8 offers several important advantages
  id: totrans-split-13
  prefs: []
  type: TYPE_NORMAL
- en: 'over libc:'
  id: totrans-split-14
  prefs: []
  type: TYPE_NORMAL
- en: '* faster sorting -- benefits from additional optimizations such as'
  id: totrans-split-15
  prefs: []
  type: TYPE_NORMAL
- en: abbreviated keys and varstrfastcmp_c
  id: totrans-split-16
  prefs: []
  type: TYPE_NORMAL
- en: '* faster case conversion, e.g. LOWER(), at least compared with some'
  id: totrans-split-17
  prefs: []
  type: TYPE_NORMAL
- en: libc implementations
  id: totrans-split-18
  prefs: []
  type: TYPE_NORMAL
- en: '* available on all platforms with identical semantics, and the'
  id: totrans-split-19
  prefs: []
  type: TYPE_NORMAL
- en: semantics are stable, testable, and documentable within a given
  id: totrans-split-20
  prefs: []
  type: TYPE_NORMAL
- en: Postgres major version
  id: totrans-split-21
  prefs: []
  type: TYPE_NORMAL
- en: Being based on memcmp, the builtin C.UTF-8 locale does not offer
  id: totrans-split-22
  prefs: []
  type: TYPE_NORMAL
- en: natural language sort order. But it is an improvement for most use
  id: totrans-split-23
  prefs: []
  type: TYPE_NORMAL
- en: cases that might otherwise use libc's "C.UTF-8" locale, as well as
  id: totrans-split-24
  prefs: []
  type: TYPE_NORMAL
- en: many use cases that use libc's "C" locale.
  id: totrans-split-25
  prefs: []
  type: TYPE_NORMAL
- en: 'Discussion: [https://postgr.es/m/ff4c2f2f9c8fc7ca27c1c24ae37ecaeaeaff6b53.camel%40j-davis.com](https://postgr.es/m/ff4c2f2f9c8fc7ca27c1c24ae37ecaeaeaff6b53.camel@j-davis.com)'
  id: totrans-split-26
  prefs: []
  type: TYPE_NORMAL
- en: 'Reviewed-by: Daniel Vérité, Peter Eisentraut, Jeremy Schneider'
  id: totrans-split-27
  prefs: []
  type: TYPE_NORMAL
- en: Branch
  id: totrans-split-28
  prefs: []
  type: TYPE_NORMAL
- en: '------'
  id: totrans-split-29
  prefs: []
  type: TYPE_NORMAL
- en: master
  id: totrans-split-30
  prefs: []
  type: TYPE_NORMAL
- en: Details
  id: totrans-split-31
  prefs: []
  type: TYPE_NORMAL
- en: '-------'
  id: totrans-split-32
  prefs: []
  type: TYPE_NORMAL
- en: '[https://git.postgresql.org/pg/commitdiff/f69319f2f1fb16eda4b535bcccec90dff3a6795e](https://git.postgresql.org/pg/commitdiff/f69319f2f1fb16eda4b535bcccec90dff3a6795e)'
  id: totrans-split-33
  prefs: []
  type: TYPE_NORMAL
- en: Modified Files
  id: totrans-split-34
  prefs: []
  type: TYPE_NORMAL
- en: '--------------'
  id: totrans-split-35
  prefs: []
  type: TYPE_NORMAL
- en: doc/src/sgml/charset.sgml | 27 +++++-
  id: totrans-split-36
  prefs: []
  type: TYPE_NORMAL
- en: doc/src/sgml/ref/create_collation.sgml | 2 +-
  id: totrans-split-37
  prefs: []
  type: TYPE_NORMAL
- en: doc/src/sgml/ref/create_database.sgml | 13 ++-
  id: totrans-split-38
  prefs: []
  type: TYPE_NORMAL
- en: doc/src/sgml/ref/initdb.sgml | 5 +-
  id: totrans-split-39
  prefs: []
  type: TYPE_NORMAL
- en: src/backend/regex/regc_pg_locale.c | 36 ++++++-
  id: totrans-split-40
  prefs: []
  type: TYPE_NORMAL
- en: src/backend/utils/adt/formatting.c | 112 ++++++++++++++++++++++
  id: totrans-split-41
  prefs: []
  type: TYPE_NORMAL
- en: src/backend/utils/adt/pg_locale.c | 52 +++++++---
  id: totrans-split-42
  prefs: []
  type: TYPE_NORMAL
- en: src/bin/initdb/initdb.c | 16 +++-
  id: totrans-split-43
  prefs: []
  type: TYPE_NORMAL
- en: src/bin/initdb/t/001_initdb.pl | 17 ++++
  id: totrans-split-44
  prefs: []
  type: TYPE_NORMAL
- en: src/bin/pg_upgrade/t/002_pg_upgrade.pl | 2 +-
  id: totrans-split-45
  prefs: []
  type: TYPE_NORMAL
- en: src/bin/scripts/t/020_createdb.pl | 18 ++++
  id: totrans-split-46
  prefs: []
  type: TYPE_NORMAL
- en: src/include/catalog/catversion.h | 2 +-
  id: totrans-split-47
  prefs: []
  type: TYPE_NORMAL
- en: src/include/catalog/pg_collation.dat | 3 +
  id: totrans-split-48
  prefs: []
  type: TYPE_NORMAL
- en: src/test/regress/expected/collate.utf8.out | 136 +++++++++++++++++++++++++++
  id: totrans-split-49
  prefs: []
  type: TYPE_NORMAL
- en: src/test/regress/expected/collate.utf8_1.out | 8 ++
  id: totrans-split-50
  prefs: []
  type: TYPE_NORMAL
- en: src/test/regress/parallel_schedule | 4 +-
  id: totrans-split-51
  prefs: []
  type: TYPE_NORMAL
- en: src/test/regress/sql/collate.utf8.sql | 67 +++++++++++++
  id: totrans-split-52
  prefs: []
  type: TYPE_NORMAL
- en: 17 files changed, 494 insertions(+), 26 deletions(-)
  id: totrans-split-53
  prefs: []
  type: TYPE_NORMAL
