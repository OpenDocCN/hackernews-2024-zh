- en: <!--yml
  prefs: []
  type: TYPE_NORMAL
- en: 'category: 未分类'
  prefs: []
  type: TYPE_NORMAL
- en: 'date: 2024-05-29 12:31:40'
  prefs: []
  type: TYPE_NORMAL
- en: -->
  prefs: []
  type: TYPE_NORMAL
- en: 'PostgreSQL: pgsql: Support C.UTF-8 locale in the new builtin collation provider.'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 来源：[https://www.postgresql.org/message-id/E1rmhxt-004ezT-OB%40gemulon.postgresql.org](https://www.postgresql.org/message-id/E1rmhxt-004ezT-OB%40gemulon.postgresql.org)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Support C.UTF-8 locale in the new builtin collation provider.
  prefs: []
  type: TYPE_NORMAL
- en: The builtin C.UTF-8 locale has similar semantics to the libc locale of
  prefs: []
  type: TYPE_NORMAL
- en: the same name. That is, code point sort order (fast, memcmp-based)
  prefs: []
  type: TYPE_NORMAL
- en: combined with Unicode semantics for character operations such as
  prefs: []
  type: TYPE_NORMAL
- en: pattern matching, regular expressions, and
  prefs: []
  type: TYPE_NORMAL
- en: LOWER()/INITCAP()/UPPER(). The character semantics are based on
  prefs: []
  type: TYPE_NORMAL
- en: Unicode simple case mappings.
  prefs: []
  type: TYPE_NORMAL
- en: The builtin provider's C.UTF-8 offers several important advantages
  prefs: []
  type: TYPE_NORMAL
- en: 'over libc:'
  prefs: []
  type: TYPE_NORMAL
- en: '* faster sorting -- benefits from additional optimizations such as'
  prefs: []
  type: TYPE_NORMAL
- en: abbreviated keys and varstrfastcmp_c
  prefs: []
  type: TYPE_NORMAL
- en: '* faster case conversion, e.g. LOWER(), at least compared with some'
  prefs: []
  type: TYPE_NORMAL
- en: libc implementations
  prefs: []
  type: TYPE_NORMAL
- en: '* available on all platforms with identical semantics, and the'
  prefs: []
  type: TYPE_NORMAL
- en: semantics are stable, testable, and documentable within a given
  prefs: []
  type: TYPE_NORMAL
- en: Postgres major version
  prefs: []
  type: TYPE_NORMAL
- en: Being based on memcmp, the builtin C.UTF-8 locale does not offer
  prefs: []
  type: TYPE_NORMAL
- en: natural language sort order. But it is an improvement for most use
  prefs: []
  type: TYPE_NORMAL
- en: cases that might otherwise use libc's "C.UTF-8" locale, as well as
  prefs: []
  type: TYPE_NORMAL
- en: many use cases that use libc's "C" locale.
  prefs: []
  type: TYPE_NORMAL
- en: 'Discussion: [https://postgr.es/m/ff4c2f2f9c8fc7ca27c1c24ae37ecaeaeaff6b53.camel%40j-davis.com](https://postgr.es/m/ff4c2f2f9c8fc7ca27c1c24ae37ecaeaeaff6b53.camel@j-davis.com)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Reviewed-by: Daniel Vérité, Peter Eisentraut, Jeremy Schneider'
  prefs: []
  type: TYPE_NORMAL
- en: Branch
  prefs: []
  type: TYPE_NORMAL
- en: '------'
  prefs: []
  type: TYPE_NORMAL
- en: master
  prefs: []
  type: TYPE_NORMAL
- en: Details
  prefs: []
  type: TYPE_NORMAL
- en: '-------'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://git.postgresql.org/pg/commitdiff/f69319f2f1fb16eda4b535bcccec90dff3a6795e](https://git.postgresql.org/pg/commitdiff/f69319f2f1fb16eda4b535bcccec90dff3a6795e)'
  prefs: []
  type: TYPE_NORMAL
- en: Modified Files
  prefs: []
  type: TYPE_NORMAL
- en: '--------------'
  prefs: []
  type: TYPE_NORMAL
- en: doc/src/sgml/charset.sgml | 27 +++++-
  prefs: []
  type: TYPE_NORMAL
- en: doc/src/sgml/ref/create_collation.sgml | 2 +-
  prefs: []
  type: TYPE_NORMAL
- en: doc/src/sgml/ref/create_database.sgml | 13 ++-
  prefs: []
  type: TYPE_NORMAL
- en: doc/src/sgml/ref/initdb.sgml | 5 +-
  prefs: []
  type: TYPE_NORMAL
- en: src/backend/regex/regc_pg_locale.c | 36 ++++++-
  prefs: []
  type: TYPE_NORMAL
- en: src/backend/utils/adt/formatting.c | 112 ++++++++++++++++++++++
  prefs: []
  type: TYPE_NORMAL
- en: src/backend/utils/adt/pg_locale.c | 52 +++++++---
  prefs: []
  type: TYPE_NORMAL
- en: src/bin/initdb/initdb.c | 16 +++-
  prefs: []
  type: TYPE_NORMAL
- en: src/bin/initdb/t/001_initdb.pl | 17 ++++
  prefs: []
  type: TYPE_NORMAL
- en: src/bin/pg_upgrade/t/002_pg_upgrade.pl | 2 +-
  prefs: []
  type: TYPE_NORMAL
- en: src/bin/scripts/t/020_createdb.pl | 18 ++++
  prefs: []
  type: TYPE_NORMAL
- en: src/include/catalog/catversion.h | 2 +-
  prefs: []
  type: TYPE_NORMAL
- en: src/include/catalog/pg_collation.dat | 3 +
  prefs: []
  type: TYPE_NORMAL
- en: src/test/regress/expected/collate.utf8.out | 136 +++++++++++++++++++++++++++
  prefs: []
  type: TYPE_NORMAL
- en: src/test/regress/expected/collate.utf8_1.out | 8 ++
  prefs: []
  type: TYPE_NORMAL
- en: src/test/regress/parallel_schedule | 4 +-
  prefs: []
  type: TYPE_NORMAL
- en: src/test/regress/sql/collate.utf8.sql | 67 +++++++++++++
  prefs: []
  type: TYPE_NORMAL
- en: 17 files changed, 494 insertions(+), 26 deletions(-)
  prefs: []
  type: TYPE_NORMAL
