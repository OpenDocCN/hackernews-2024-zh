- en: <!--yml
  prefs: []
  type: TYPE_NORMAL
- en: 'category: 未分类'
  prefs: []
  type: TYPE_NORMAL
- en: 'date: 2024-05-29 12:36:59'
  prefs: []
  type: TYPE_NORMAL
- en: -->
  prefs: []
  type: TYPE_NORMAL
- en: 1024cores - Relacy Race Detector
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 来源：[https://www.1024cores.net/home/relacy-race-detector](https://www.1024cores.net/home/relacy-race-detector)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Relacy Race Detector is a tool for efficient execution of unit-tests for synchronization
    algorithms written in C++0x.
  prefs: []
  type: TYPE_NORMAL
- en: Every user thread is represented as a fiber (ucontext). Every time only one
    fiber is running, and special scheduler controls interleaving between fibers.
  prefs: []
  type: TYPE_NORMAL
- en: With random scheduler it just executes numerous amount of various interleavings
    between threads. With full search scheduler or context-bound scheduler it systematically
    executes all possible interleavings between threads. While executing particular
    interleaving it makes exhaustive verification of various aspects of execution
    (races, accesses to freed memory etc).
  prefs: []
  type: TYPE_NORMAL
- en: If no errors found then verification terminates when particular number of interleavings
    are verified (for random scheduler), or when all possible interleavings are verified
    (for full search scheduler). If error is found then tool outputs execution history
    which leads to error and terminates.
  prefs: []
  type: TYPE_NORMAL
- en: Physically Relacy Race Detector is a header-only library for C++98.
  prefs: []
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Relaxed ISO C++0x Memory Model. Relaxed/acquire/release/acq_rel/seq_cst memory
    operations. The only non-supported feature is memory_order_consume, it's simulated
    with memory_order_acquire.
  prefs:
  - PREF_UL
  - PREF_UL
  type: TYPE_NORMAL
- en: Exhaustive automatic error checking (including ABA detection).
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Full-fledged atomics library (with spurious failures in compare_exchange()).
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Memory fences.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Arbitrary number of threads.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Detailed execution history for failed tests.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: No false positives.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Before/after/invariant functions for test suites.
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: MSVC 7/8/9, Windows 2000 and above, 32-bit
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: GCC 3.4 and above, Linux, 32-bit
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 1\. Add
  prefs: []
  type: TYPE_NORMAL
- en: '#include <relacy/relacy_std.hpp>'
  prefs: []
  type: TYPE_NORMAL
- en: '2\. For atomic variables use type std::atomic<T>:'
  prefs: []
  type: TYPE_NORMAL
- en: std::atomic<void*> head;
  prefs: []
  type: TYPE_NORMAL
- en: '3\. For usual non-atomic variables use type rl::var<T>:'
  prefs: []
  type: TYPE_NORMAL
- en: rl::var<int> data;
  prefs: []
  type: TYPE_NORMAL
- en: Such vars will be checked for races and included into trace.
  prefs: []
  type: TYPE_NORMAL
- en: '4\. All accesses to std::atomic<T> and rl::var<T> variables postfix with ''($)'':'
  prefs: []
  type: TYPE_NORMAL
- en: std::atomic<void*> head;
  prefs: []
  type: TYPE_NORMAL
- en: rl::var<int> data;
  prefs: []
  type: TYPE_NORMAL
- en: head($).store(0);
  prefs: []
  type: TYPE_NORMAL
- en: data($) = head($).load();
  prefs: []
  type: TYPE_NORMAL
- en: '5\. Strictly thread-private variables use can leave as-is:'
  prefs: []
  type: TYPE_NORMAL
- en: for (int i = 0; i != 10; ++i)
  prefs: []
  type: TYPE_NORMAL
- en: Such vars will be NOT checked for races NOR included into trace. But they will
    accelerate verification.
  prefs: []
  type: TYPE_NORMAL
- en: '6\. Describe test-suite: number of threads, thread function, before/after/invariant
    functions. See example below.'
  prefs: []
  type: TYPE_NORMAL
- en: '7\. Place asserts:'
  prefs: []
  type: TYPE_NORMAL
- en: int x = g($).load();
  prefs: []
  type: TYPE_NORMAL
- en: RL_ASSERT(x > 0);
  prefs: []
  type: TYPE_NORMAL
- en: '8\. Start verification:'
  prefs: []
  type: TYPE_NORMAL
- en: rl::simulate<test_suite_t>();
  prefs: []
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '#include <relacy/relacy_std.hpp>'
  prefs: []
  type: TYPE_NORMAL
- en: // template parameter '2' is number of threads
  prefs: []
  type: TYPE_NORMAL
- en: 'struct race_test : rl::test_suite<race_test, 2>'
  prefs: []
  type: TYPE_NORMAL
- en: '{'
  prefs: []
  type: TYPE_NORMAL
- en: std::atomic<int> a;
  prefs: []
  type: TYPE_NORMAL
- en: rl::var<int> x;
  prefs: []
  type: TYPE_NORMAL
- en: // executed in single thread before main thread function
  prefs: []
  type: TYPE_NORMAL
- en: void before()
  prefs: []
  type: TYPE_NORMAL
- en: '{'
  prefs: []
  type: TYPE_NORMAL
- en: a($) = 0;
  prefs: []
  type: TYPE_NORMAL
- en: x($) = 0;
  prefs: []
  type: TYPE_NORMAL
- en: '}'
  prefs: []
  type: TYPE_NORMAL
- en: // main thread function
  prefs: []
  type: TYPE_NORMAL
- en: void thread(unsigned thread_index)
  prefs: []
  type: TYPE_NORMAL
- en: '{'
  prefs: []
  type: TYPE_NORMAL
- en: if (0 == thread_index)
  prefs: []
  type: TYPE_NORMAL
- en: '{'
  prefs: []
  type: TYPE_NORMAL
- en: x($) = 1;
  prefs: []
  type: TYPE_NORMAL
- en: a($).store(1, rl::memory_order_relaxed);
  prefs: []
  type: TYPE_NORMAL
- en: '}'
  prefs: []
  type: TYPE_NORMAL
- en: else
  prefs: []
  type: TYPE_NORMAL
- en: '{'
  prefs: []
  type: TYPE_NORMAL
- en: if (1 == a($).load(rl::memory_order_relaxed))
  prefs: []
  type: TYPE_NORMAL
- en: x($) = 2;
  prefs: []
  type: TYPE_NORMAL
- en: '}'
  prefs: []
  type: TYPE_NORMAL
- en: '}'
  prefs: []
  type: TYPE_NORMAL
- en: // executed in single thread after main thread function
  prefs: []
  type: TYPE_NORMAL
- en: void after()
  prefs: []
  type: TYPE_NORMAL
- en: '{'
  prefs: []
  type: TYPE_NORMAL
- en: '}'
  prefs: []
  type: TYPE_NORMAL
- en: // executed in single thread after every 'visible' action in main threads
  prefs: []
  type: TYPE_NORMAL
- en: // disallowed to modify any state
  prefs: []
  type: TYPE_NORMAL
- en: void invariant()
  prefs: []
  type: TYPE_NORMAL
- en: '{'
  prefs: []
  type: TYPE_NORMAL
- en: '}'
  prefs: []
  type: TYPE_NORMAL
- en: '};'
  prefs: []
  type: TYPE_NORMAL
- en: int main()
  prefs: []
  type: TYPE_NORMAL
- en: '{'
  prefs: []
  type: TYPE_NORMAL
- en: rl::simulate<race_test>();
  prefs: []
  type: TYPE_NORMAL
- en: '}'
  prefs: []
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: struct race_test
  prefs: []
  type: TYPE_NORMAL
- en: DATA RACE
  prefs: []
  type: TYPE_NORMAL
- en: 'iteration: 8'
  prefs: []
  type: TYPE_NORMAL
- en: 'execution history:'
  prefs: []
  type: TYPE_NORMAL
- en: '[0] 0: <00366538> atomic store, value=0, (prev value=0), order=seq_cst, in
    race_test::before, test.cpp(14)'
  prefs: []
  type: TYPE_NORMAL
- en: '[1] 0: <0036655C> store, value=0, in race_test::before, test.cpp(15)'
  prefs: []
  type: TYPE_NORMAL
- en: '[2] 0: <0036655C> store, value=1, in race_test::thread, test.cpp(23)'
  prefs: []
  type: TYPE_NORMAL
- en: '[3] 0: <00366538> atomic store, value=1, (prev value=0), order=relaxed, in
    race_test::thread, test.cpp(24)'
  prefs: []
  type: TYPE_NORMAL
- en: '[4] 1: <00366538> atomic load, value=1, order=relaxed, in race_test::thread,
    test.cpp(28)'
  prefs: []
  type: TYPE_NORMAL
- en: '[5] 1: <0036655C> store, value=0, in race_test::thread, test.cpp(29)'
  prefs: []
  type: TYPE_NORMAL
- en: '[6] 1: data race detected, in race_test::thread, test.cpp(29)'
  prefs: []
  type: TYPE_NORMAL
- en: 'thread 0:'
  prefs: []
  type: TYPE_NORMAL
- en: '[0] 0: <00366538> atomic store, value=0, (prev value=0), order=seq_cst, in
    race_test::before, test.cpp(14)'
  prefs: []
  type: TYPE_NORMAL
- en: '[1] 0: <0036655C> store, value=0, in race_test::before, test.cpp(15)'
  prefs: []
  type: TYPE_NORMAL
- en: '[2] 0: <0036655C> store, value=1, in race_test::thread, test.cpp(23)'
  prefs: []
  type: TYPE_NORMAL
- en: '[3] 0: <00366538> atomic store, value=1, (prev value=0), order=relaxed, in
    race_test::thread, test.cpp(24)'
  prefs: []
  type: TYPE_NORMAL
- en: 'thread 1:'
  prefs: []
  type: TYPE_NORMAL
- en: '[4] 1: <00366538> atomic load, value=1, order=relaxed, in race_test::thread,
    test.cpp(28)'
  prefs: []
  type: TYPE_NORMAL
- en: '[5] 1: <0036655C> store, value=0, in race_test::thread, test.cpp(29)'
  prefs: []
  type: TYPE_NORMAL
- en: '[6] 1: data race detected, in race_test::thread, test.cpp(29)'
  prefs: []
  type: TYPE_NORMAL
- en: 'You can download the library here: http://sites.google.com/site/1024cores/home/downloads/relacy_2_4.zip'
  prefs: []
  type: TYPE_NORMAL
- en: 'The old deprecated site for the tool: [http://groups.google.com/group/relacy](http://groups.google.com/group/relacy)'
  prefs: []
  type: TYPE_NORMAL
