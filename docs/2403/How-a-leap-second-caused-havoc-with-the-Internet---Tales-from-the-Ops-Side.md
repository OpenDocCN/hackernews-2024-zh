<!--yml

category: 未分类

date: 2024-05-27 14:30:27

-->

# 一场闰秒如何使互联网陷入混乱 - 运维故事

> 来源：[https://www.talesfromtheopsside.com/blog/how-a-leap-second-caused-havoc-with-the-internet/](https://www.talesfromtheopsside.com/blog/how-a-leap-second-caused-havoc-with-the-internet/)

[stack.io](https://www.stack.io/) CEO Hany Fahim 遇到了一个意外的难题。这个难题超越了技术挑战，迫使他深入思考时间和空间对运维及地球本身的涟漪效应。

**缺失的连接**

在2012年6月的一个夏夜，多个网站突然宕机。起初，Hany 以为可能是攻击，但这并不合理，因为其他网站似乎是正常运行的。更奇怪的是，几个系统报告高负载。虽然单个客户的工作量增加并不少见，但系统同时出现的高负载增长却是不寻常的。

当 Hany 登录进行调查时，答案总是躲闪他，他只有更多的问题。

“我注意到系统的响应相当迅速。对于一个抱怨负载过高的系统，我本来预计它会显得迟钝。”

多种不同的技术，如 MySQL、Ruby 和 Java，尽管没有共同点，却都经历了相同的症状。Hany 将这个谜题比作某人的手机、电视和收音机都出现同样问题，尽管它们是不同的设备。这些看似毫无联系的系统之间究竟有什么共同点？

**时间中的答案**

在使用 strace（类似于打开故障汽车引擎盖的诊断工具）之后，Hany 终于找到了失落的联系！

“MySQL、Java、Ruby - 它们一遍又一遍地向 CPU 请求同样的东西：*现在是什么时间*？”

Hany 不明白为什么这些系统都如此关注时间。查阅互联网后，他发现了一些非常不寻常和令人着迷的事情！那天全世界的钟表刚刚添加了一个额外的 [闰秒](https://en.wikipedia.org/wiki/Leap_second)。

Hany 不明白为什么一个闰秒会引起如此大的混乱，但在最后一搏中，他尝试了“解决所有技术问题的通用方法：重启”。

令人难以置信的是，这个简单的解决方案似乎让系统满意了。一切都恢复正常，就像没有发生过任何异常一样。

**一个研究兔子洞**

Hany 对刚刚发生的一切感到困惑，所以他决定深入挖掘。他很快发现 Reddit、Mozilla 甚至航空公司都受到了影响。

他了解到，闰秒挑战了人们对时间的认知 - 或者说是我们认为自己了解的时间。闰秒是“偶尔增加的额外一秒，以适应精确时间和不精确观测时间之间的差异”。

精确的（或太阳）时间是人类测量时间的方法，但它并未考虑到地球自转的不一致性。

Hany继续解释说：“由于物理学原因，一年中某些时期地球沿其轨道运动的速度比其他时期快。那么我们如何基于此来确定时间呢？” 结果是我们并没有这样做。

除了根据这些不一致性某些日子比其他日子更长之外，一些重大事件如地震也能加快地球的自转。甚至人造结构也能影响时间。

Hany解释道：“NASA计算出中国三峡大坝蓄水增加了一天的长度约0.06微秒。”

**闰秒的连锁反应**

时钟基于协调世界时（UTC），这是一种在精确和不精确时间之间起调和作用的时间系统。通常，闰秒会提前约六个月宣布。但这种时间增加会如何影响运维呢？

“闰秒的问题在于每个人实现的方式都不同。对于我们使用的Linux系统以及互联网的大部分部分来说，一天只能有 86,400 秒。”

在深入研究Linux源代码时，Hany发现五年前，Linux社区中有人标记了其闰秒实现的潜在问题。可能会出现死锁或计算机冻结的情况。为了修复此问题，只改变了一行代码。在这次更改中留下了一条注释来记录一个看似小的警告：“这种移除可能唯一的副作用是计时器在闰秒后触发稍晚。” 令人不安的是，这个副作用导致了2012年互联网的大面积崩溃。

Hany深入探讨了宇宙规则的引人入胜且有时令人费解的部分，以及它对运维的影响，你可以在[这个信息丰富的播客](https://www.talesfromtheopsside.com/blog/episode-2-earthquakes-and-the-moon/)中了解更多！
