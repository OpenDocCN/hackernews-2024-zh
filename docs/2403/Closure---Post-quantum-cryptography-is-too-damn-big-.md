<!--yml

category: 未分类

date: 2024-05-29 12:37:14

-->

# 结束 | 后量子密码学实在太大了。

> 来源：[https://dadrian.io/blog/posts/pqc-signatures-2024/](https://dadrian.io/blog/posts/pqc-signatures-2024/)

大规模量子计算机能够破解今天互联网上使用的所有常见非对称密码学形式。幸运的是，它们目前还不存在。从2022年起，全网范围内向后量子密码学的过渡开始，当时NIST宣布了他们在[NIST PQC竞赛](https://csrc.nist.gov/projects/post-quantum-cryptography)中的最终候选者。关于正在进行的各种算法和标准化进程，[有大量的文章](https://blog.cloudflare.com/pq-2024/)，[讨论](https://bughunters.google.com/blog/5108747984306176/google-s-threat-model-for-post-quantum-cryptography)，[以及](https://durumcrustulum.com/2024/02/24/how-to-hold-kems/) [标准化](https://csrc.nist.gov/projects/pqc-dig-sig) [进程](https://wiki.ietf.org/group/sec/PQCAgility) 正在进行中。

传统观点是，转向后量子密码学需要很长时间，因此我们需要现在开始标准化和部署事物，尽管量子计算机实际上还没有出现在地平线上。我们将采纳NIST竞赛中涌现的最佳方案，并加以部署。

遗憾的是，目前还没有足够讨论关于NIST标准化的内容是否足够在大多数情况下部署在公共网络上。我们需要更好的算法。具体来说，我们需要使用在传输中字节数较少的算法——一个嵌入在TLS ClientHello中的KEM仍然在一个MTU以下，一个性能与ECDSA相当且不大于RSA-2048的签名，以及一个小于100字节的签名，我们可以选择处理一个更大的公钥。

要理解为什么，我们将看看HTTPS的当前状态。在公共网络上，HTTPS主要通过五种方式使用密码学：

+   **对称加密/解密**：HTTP(2)的实际数据以一些认证的密码（AEAD）如AES-GCM的形式在TLS连接中作为数据传输。这在[量子计算机](https://words.filippo.io/dispatches/post-quantum-age/)面前大体上已经是安全的。

+   **密钥协商**：对称加密需要一个秘密密钥。密钥协商是两个方共同生成秘密密钥的过程。TLS 1.3传统上使用椭圆曲线Diffie-Hellman进行密钥协商。所有非后量子密钥交换机制，包括Diffie-Hellman，都被量子计算机破解了。

+   **服务器身份**：服务器通过X.509证书进行身份验证。至少，服务器证书（叶证书）包含一个公钥和来自中间证书的签名。中间证书包含另一个公钥和来自受信任根证书的签名。

+   **签发透明性**：[公共网络PKI](https://dadrian.io/blog/posts/certificates-explained)依赖于被称为*认证机构*的可信第三方来验证域名所有权。证书是公开记录的，并且服务器声明它们的证书已包含在日志中。这提供了对恶意证书签发的威慑，因为任何恶意颁发给攻击者某个站点的证书都将是公开可见的，有可能被检测到。服务器通过提供至少两个*签名证书时间戳*来实现签发透明性，通常嵌入在证书本身中。

+   **握手认证**：在TLS握手期间，需要将服务器的身份绑定到连接本身。在TLS 1.3中，这由对服务器密钥分享消息的签名提供，该签名来自CertificateVerify消息中服务器证书的密钥。

如今，存在来自未来量子计算机的威胁，采用[“先收集，后解密”](https://en.wikipedia.org/wiki/Harvest_now,_decrypt_later)攻击形式对加密网络连接构成威胁。为了抵御这一威胁，我们只需确保密钥协商和对称加密是“量子抗性”的（即在量子计算机存在的情况下安全）。幸运的是，对称加密已经是量子抗性的，因此防御“先收集，后解密”攻击只需要将密钥交换算法更新为后量子变体。

在HTTPS中剩余的加密用途——服务器身份、签发透明性和握手认证——最终需要过渡到后量子变体。在当前TLS的结构中，这意味着将所有签名替换为后量子变体。然而，尽管这样做的必要性与过渡密钥协商一样*重要*，但不那么*紧急*。这与正在[积极](https://www.reddit.com/r/firefox/comments/1827g86/tls_13_hybridized_kyber_support_for_firefox/) [部署](https://blog.chromium.org/2023/08/protecting-chrome-traffic-with-hybrid.html)后量子密钥交换算法的浏览器行动相一致。X25519密钥交换涉及客户端和服务器各传输32字节。NIST密钥协商的获胜者，[ML-KEM（Kyber）](https://csrc.nist.gov/pubs/fips/203/ipd)，涉及客户端发送1,184字节和服务器发送1,088字节。

然而，目前没有广泛使用的浏览器开始部署后量子签名。

这是因为后量子签名及其相应的公钥太大了。在HTTPS的平均TLS握手过程中，有5个签名和2个公钥传输：

+   叶证书具有站点的1个签名公钥和中间证书的1个签名。

+   中间证书有1个签名公钥，用于验证叶上的签名，以及来自根证书的密钥的1个签名，用于验证中间证书的真实性。根证书及其嵌入的公钥预先分发给客户端。

+   握手本身只有1个来自与叶证书对应的公钥的私钥的签名。

+   每个签名的证书时间戳（SCT）包含一个签名。用于验证签名的公钥预先分发给客户端。大多数证书有2个SCT，因此还有2个额外的签名。

TLS中密钥和签名大小的当前分解大致为：

+   根证书通常包含RSA密钥，中间证书也是如此。根证书预先分发，中间证书由服务器提供，与叶子证书一起。RSA中间证书有一个4096位（512字节）的签名，以及一个2048位（256字节）的公钥。

+   ECDSA叶证书有一个32字节的密钥和一个来自中间证书的256字节的RSA签名。

+   握手包含一个64字节的ECDSA签名。

+   每个SCT包含一个64字节的ECDSA签名。

总之，在HTTPS的普通TLS握手中，签名和公钥总共有512 + 256 + 256 + 32 + 64 + 2*64 = 1,248字节。从第一个NIST PQC竞赛的获胜签名算法中，[ML-DSA（Dilithium）](https://csrc.nist.gov/pubs/fips/204/ipd)是唯一可在TLS环境中使用的签名算法，它有1,312字节的公钥和2,420字节的签名。这意味着*单个ML-DSA公钥比当前在HTTPS连接期间传输的所有5个签名和2个公钥还要大*。在当前签名算法与ML-DSA的直接“复制和替换”中，TLS握手将包含5*2420 + 2*1312 = 14,724字节的签名和公钥，增加了10倍以上。

除非面对一个大规模的量子计算机，否则这不是一个可接受的数据量，只是为了*建立*连接而发送。作为基准现实检验，我们不应该仅仅通过签名和公钥^发送超过3.5英寸软盘的1%。

更具体地说，对于服务器发送的消息，[Cloudflare发现](https://blog.cloudflare.com/pq-2024/)，每增加1K的额外数据到服务器响应，导致HTTPS握手中位数延迟增加约1.5%。对于ClientHello，当他们部署了ML-KEM时，Chrome看到TLS握手延迟增加了4%，这需要在ClientHello中占用约1K的额外空间。这使得ClientHello的大小大于互联网数据包的标准最大传输单元（MTU）约1400字节，导致ClientHello在两个底层传输层（TCP或UDP）数据包中被分段^。

假设 ML-KEM 将持续存在，这意味着如果我们希望将量子后密码学的总延迟影响保持在服务器响应消息中额外不超过 10%^(，我们需要确保所有的身份验证在约 4K 字节以内完成。不幸的是，*单个* ML-DSA 签名/公钥对大小约为 4K 字节。ML-DSA 太大，无法部署以应对尚未存在时间表的威胁。）

有关未来的一些好消息。NIST 认识到签名非常庞大，并正在为更小、更快的签名进行 [后续竞争](https://csrc.nist.gov/projects/pqc-dig-sig)。不幸的是，竞争中的 [领导者](https://pqshield.github.io/nist-sigs-zoo/) 还没有完全达到要求，但其中一些有潜力：

+   **Unbalanced Oil and Vinegar (UOV)**：UOV 公钥非常大（66K！），但签名为 94 字节，与当前 SCT 中 ECDSA 签名的 64 字节相当。66K 的公钥大小是可接受的，因为用于证书透明度日志的公钥是预分发的，并且只有少量日志（约 10 个）。UOV 并不适合根证书——根证书太多，根存储将会太大无法嵌入二进制文件中。

+   **SQISign**：SQISign 公钥为 64 字节，签名为 177 字节。如果用于证书和握手签名，它将是 2*64 + 3*177 = 659 字节。与当前的 RSA+ECDSA 方法相比，后者为 4096/8 + 2048/8 + 2048/8 + 32 + 64 = 1,120 字节。SQISign 是一种净胜（与仅使用 ECDSA 的链相比类似）！不幸的是，SQISign 的速度非常慢。为了使 SQISign 可行，它需要约 10,000 倍的签名速度提升和 100 倍的验证性能提升。

+   **Mayo**：Mayo 可能是可行的。Mayo1 公钥为 1,168 字节，签名为 321 字节，这使其成为证书和握手认证的候选者（1168*2 + 321*3 = 3,299 字节）。Mayo2 公钥为 5,488 字节，但只有 180 字节的签名，这使其成为 SCT 的候选者，如果 UOV 方案不行的话。

还有几个性能调节旋钮我们可以尝试调整，但这些都需要更大的变动来调整 HTTPS、TLS 和 Web PKI 之间的互动，而不是简单的“复制和替换”使用 PQC 算法。

+   **Intermediate ellison**：预分发已知的中间证书到浏览器将为中位数中间证书节省约 1.5K 字节。这并不从根本上改变 NIST 候选者的可行性，但可能有助于 Mayo 保持在当前可行范围内。

+   **合并SCT和证书**：诸如[Merkle-Tree Certificates](https://datatracker.ietf.org/doc/draft-davidben-tls-merkle-tree-certs/)的实验性提案将证书和SCT合并成一个单一对象，并具有基于哈希的真实性证明。这将使握手过程仅需要单一的握手签名以及Merkle树证书中的单一公钥，以及一个基于哈希的包含证明。不幸的是，这做出了一些权衡，可能对非浏览器应用程序来说不太可行，例如需要延迟（每小时）批量发放，并要求客户端相对于透明度服务器保持最新状态。这种形式的解决方案可能是浏览器客户端的性能优化，但对非浏览器客户端来说可能不太可行。即便如此，对于非浏览器客户端来说，握手延迟问题较为不重要。

+   **缩小根存储的大小**：一个包含少于10个包含UOV公钥的证书的后量子根证书存储将与当前根证书存储的大小相差不到一个数量级。

这意味着将Mayo和UOV与PKI的其他更改结合起来*可能*足以转变为WebPKI中的抗量子认证。不幸的是，所有这些纸上谈兵的设计仍然存在一些风险：

+   性能影响几乎肯定比Cloudflare测量到的要大。Cloudflare的实验很可能主要是理想客户端（企业用户在桌面上）访问登录页面（由低往返时延的边缘服务器提供）。

+   性能影响很可能也比Chrome当前看到的更糟！4%的延迟增加是在添加ML-KEM到ClientHello中的密钥份额之后的所有连接的净增加。在部署的这个阶段，ML-KEM主要仅受到Google属性和Cloudflare的支持。大多数服务器 *没有* 选择ML-KEM并且用ML-KEM封装的~1K进行响应。随着ML-KEM的部署扩展，Chrome所看到的4%延迟影响将变得更加*严重*，因为加密算法的标准化和服务器开始部署ML-KEM。

+   Mayo和UOV的安全性可能无法保证。这将不是有希望的后量子算法[被发现存在问题](https://securitycryptographywhatever.com/2022/08/11/hot-cryptanalytic-summer-with-steven-galbraith/)的第一次。

+   即使性能估计是准确的，也许10%的性能损耗直到量子计算机出现仍然太大了。

将所有这些放在一起，甚至像Merkele Tree Certs这样的激烈变化，当与ML-DSA或Mayo结合用于握手认证时，很可能仍然太大，只适合浏览器客户端。

那么，我们可以做些什么来降低所有这些风险？对于任何解决方案，我们都需要在信任锚点敏捷性、中间抑制和PKI迁移方面变得更好。这已经[在进行中了](https://datatracker.ietf.org/doc/draft-davidben-tls-trust-expr/)。

为了使后量子过渡更可行的最佳方法是提出比RSA-2048性能特性不差的更好的算法。

1.  一个后量子KEM，在与TLS ClientHello的其余部分组合时可以适合单个MTU

1.  在SQISign中签名速度提升了10,000倍，验证速度提升了100倍（或者一个具有这些特征的新的等效算法）

在某种程度上，这可能是对不可能的呼声。不幸的是，使用ML-DSA在当前形式下对Web PKI也是不可能的。
