<!--yml

类别：未分类

日期：2024-05-27 14:45:04

-->

# 异端邪说二 – 注释即代码 – 负责的自动化

> 来源：[https://responsibleautomation.wordpress.com/2018/02/01/heresy-ii-comments-are-code/](https://responsibleautomation.wordpress.com/2018/02/01/heresy-ii-comments-are-code/)

我持有一个不受欢迎的观点：代码注释和代码本身一样重要。好吧，也许这有点言过其实，但我坚持认为代码注释对于代码的可读性和可维护性至关重要。

在你看看我比鸭子更重之前，请听我说完……

当我还是大学本科生时，我有幸与一位研究生教授和一些研究生一起参与了一个项目。该项目的核心是创建一个软件包，用于在非类型化的函数语言上进行类型检查；这既奇怪又酷……但我偏离了主题。作为项目的一部分，我们被要求注释我们的代码。我和我的队友们认真地为我们创建的每个函数和代码的其他有趣部分写了注释。完成后，我们自豪地提交了我们的代码给教授。

第二天，教授要求我们去她的办公室。她继续责备我们的注释……我会用自己的话说：我可以读懂代码，不要告诉我代码在做什么，告诉我为什么代码这样做。她让我们回家思考，并告诉我们第二天回来重新注释一切。

这是我关于编码方面收到的最好的建议之一。让我告诉你为什么。

正如你可能推测的那样，我们的代码注释解释了代码在做什么。“遍历列表，将每个名称添加到待处理事务列表”或类似的直接描述。正如我的教授正确地指出的那样，她（以及可能是查看代码的其他人）可以读懂代码；她理解它在做什么，但不一定明白为什么。注释缺少上下文；它们没有解释为什么我们选择了这种实现方式，同样重要的是，为什么我们没有选择其他实现方式。

在你拿出称重鸭子的设备之前，请允许我继续……

我是自说明代码的忠实拥护者。我和大多数开发人员一样：我不想为我的代码写文档。我希望编写的代码是自解释的，简单直接，易于使用和维护。对于代码，我最不愿做的事情之一是浏览并写一大堆注释。自说明的代码确实很好，但在某个时候，像大多数事情一样，它可能被夸张。例如，我可以写一个方法名，像这样

```
searchListInReverseOrderBecauseTheValueWeWantIsUsuallyAtTheEnd()
```

我认为这是一个荒谬的函数或方法名。当然，它很描述性。当然，现在大多数人使用具有代码补全功能的集成开发环境，因此我们不需要真的输入所有这些字符。然而，我仍然认为，在“反向搜索”循环之前加上一条注释，比如说

```
// Search list in reverse; the value we want is usually at the end
```

反向遍历列表有什么大不了的？也许没有什么。但如果这并不重要，那么为什么不以更直观的方式遍历列表，即从索引 0 开始？如果反向遍历很重要，也许重要到足以说明原因。如果我们不注释为什么、原因、上下文，我们可能会因为算法在反向搜索列表时“更好”而导致未来的作者更改算法而不知情地引发某种问题。

等等！注释会与代码不同步！好吧，它们不应该。当我们进行代码审查时，我们需要审查注释以及代码。注释应该正确、可理解和有价值；我们在审查过程中需要牢记这些要点。

我们应该考虑在何时使用代码注释？

+   代码很直接但不直观（例如，*为什么*不从代码本身明显）

+   当代码出于有意的原因不直接时，例如以更直接或自我描述的方式编写会牺牲性能时

+   注释会提高可读性或可维护性

+   注释会提醒我们代码来自何处，比如一本书或 StackOverflow 的 URL。

+   生成文档（见下面的示例）

什么时候我们应该考虑不添加注释？

+   当代码行为和上下文都在代码中明显时

+   当简化代码或将其抽象为“辅助”方法可以使代码自我描述而不牺牲价值（例如性能、可维护性、可读性等）时

冒着虚伪的风险，我厌恶每个文件、类和方法开头的标准注释块。这似乎是毫无价值的忙碌工作，特别是因为我确实尝试让我的代码相当描述性。然后有一天，当我在抱怨这个话题时，我的团队中一位经验较少的成员（是的，我们可以向各个经验水平的人学习）说：“你知道吗，这些注释块是 IntelliSense 提供便利文档的地方，对吧？”我从未考虑过这一点。我暗自诅咒他说得对。我仍然厌恶做这种类型的注释，但我现在理解它所提供的价值，所以我会把抱怨留给自己……嗯，除了现在。

是的，通常最好让代码自我描述。不过，除了为了愚笨而愚笨之外，也许可以添加一些代码注释来为其他人提供上下文……或者也许为了你未来的自己。

*像这样？在[即将举行的活动](https://responsibleautomation.wordpress.com/upcoming-events/)上找我吧！*
