- en: <!--yml
  id: totrans-split-0
  prefs: []
  type: TYPE_NORMAL
- en: 'category: 未分类'
  id: totrans-split-1
  prefs: []
  type: TYPE_NORMAL
- en: 'date: 2024-05-27 14:31:16'
  id: totrans-split-2
  prefs: []
  type: TYPE_NORMAL
- en: -->
  id: totrans-split-3
  prefs: []
  type: TYPE_NORMAL
- en: 'Git: programmatic staging · Choly''s Blog'
  id: totrans-split-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 来源：[https://choly.ca/post/git-programmatic-staging/](https://choly.ca/post/git-programmatic-staging/)
  id: totrans-split-5
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Git: programmatic staging'
  id: totrans-split-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Fri, Mar 1, 2024
  id: totrans-split-7
  prefs: []
  type: TYPE_NORMAL
- en: In the past year, I’ve been using a lot of tools to automatically rewrite/refactor
    code. These include [semgrep](https://semgrep.dev/), [ast-grep](https://ast-grep.github.io/),
    LLMs, and one-off scripts. After running these tools on a large code-base, you
    usually end up with lots of additional unintended changes. These range from formatting/whitespace
    to unrequested modifications by LLMs.
  id: totrans-split-8
  prefs: []
  type: TYPE_NORMAL
- en: The subsequent “cleanup” step is a very manual and tedious process. I’m essentially
    running `git add -p` and staging hunks one at a time. At times it feels like this
    step offsets the productivity gain from the rewrite tool itself.
  id: totrans-split-9
  prefs: []
  type: TYPE_NORMAL
- en: 'After doing this several times, I realized that most of the hunks I was staging
    included some common text. If I could automatically stage hunks containing a search
    term, I could automate a lot of this work! Git does not natively support this,
    but it can be easily accomplished using the [expect](https://linux.die.net/man/1/expect)
    tool:'
  id: totrans-split-10
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-split-11
  prefs: []
  type: TYPE_PRE
- en: 'To install this script, save it in your `PATH` with the name `git-add-match`.
    Once installed, the usage is as follows:'
  id: totrans-split-12
  prefs: []
  type: TYPE_NORMAL
- en: After running this command, all hunks where the string “foo” is found will be
    staged.
  id: totrans-split-13
  prefs: []
  type: TYPE_NORMAL
- en: 'Edit:'
  id: totrans-split-14
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'A user on [lobste.rs suggested](https://lobste.rs/s/2iogwz/git_programmatic_staging#c_q5btxo)
    using [grepdiff](https://linux.die.net/man/1/grepdiff) instead:'
  id: totrans-split-15
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-split-16
  prefs: []
  type: TYPE_PRE
