<!--yml

category: 未分类

date: 2024-05-27 14:36:42

-->

# Motion Blur All the Way Down

> 来源：[https://www.osar.fr/notes/motionblur/](https://www.osar.fr/notes/motionblur/)

# Motion Blur All the Way Down

Pierre Cusa <pierre@osar.fr>

2022年11月

[(历史)](https://github.com/pac-dev/notes/commits/master/content/motionblur.md)

"环球空间加速器"，启发了本文的动画。

如果你把运动模糊推向它的逻辑极限会发生什么？以下是在试图回答这个问题时遇到的一些有趣的观察和想法，试图在程序化动画中应用结果。

## 运动模糊应该是什么样子？

运动模糊最初纯粹是一种电影的产物，是在主体移动时摄像机快门打开的结果。这种产物被认为是可取的，特别是对于视频，因为它提高了视频和自然场景之间的感知相似性，我将在本节中深入探讨。

在3D和动画的背景下，有趣的是注意到这两个目标 - 看起来自然，以及模拟相机，可能并不一致，并可能导致不同的运动模糊效果。我将把模拟方面作为一个侧面说明，并探讨最自然的运动模糊应该是什么样子。这可以细分为几个问题：

1.  自然移动场景是如何被我们感知的？

1.  我们如何感知视频中再现的这一场景？

1.  这两种情况之间的感知差异是什么？

1.  视频运动模糊如何最小化这种差异？

### 在自然场景中感知运动

为了制作运动模糊，我们可以从人类视觉的最初几步开始分析，即光线照射到我们的视网膜上，以及[光转导](https://en.wikipedia.org/wiki/Visual_phototransduction)的过程。在光照充足的条件下，这由锥细胞处理。光转导并不是即时的，我们可以通过随时间平滑光刺激来模拟这种滞后。

**1\. 金鱼锥体中的时间积分示例**

，直接引用自

[Howlett et al. (2017)](https://journals.plos.org/plosbiology/article?id=10.1371/journal.pbio.2001210)

. 原始刺激是进入光感受器的光子数量，在这种情况下是一个现实的例子。加权函数源自不同条件下锥体的反应，并可用于模拟锥体的平均时间积分。结果的“有效刺激”，虽然不是可测量的响应，但是成功地模拟了锥体的实际光电流响应的第一步。

结合上述加权函数的形状和已知的人类锥体反应时间，我们可以基于任何输入场景创建一个*感知图像*的详细模拟。这个概念以前已经被[使用过](https://pubmed.ncbi.nlm.nih.gov/26357212/)，但没有时间响应形状。

**2\. 运动模糊**。左：假设为自然连续的示例场景。右：模拟的感知图像。这假设观众正盯着一个固定点，并且没有用眼睛追踪物体。

这表明，在光感受器级别已经存在自然模糊，这种现象通常称为运动模糊。那么为什么在视频中添加人为的运动模糊，运动模糊与运动模糊之间有什么联系呢？

### 屏幕上场景的感知

让我们看看当观看每秒帧数有限的屏幕时，这种感知图像会是什么样子。

**3\. 视频的感知**。左：在屏幕上显示的示例场景。右：感知到的图像。

最后，这给我们提供了一种可视化运动模糊有用性的方式。在观看没有运动模糊的视频时，结果的感知图像看起来像是叠加的帧，而不是预期的运动模糊。使用运动模糊的视频改善了这种情况，其中每个帧不再显示某一时刻，而是显示该帧时间间隔内所有时刻的平均值。这类似于使用快门开放每帧持续时间的相机制作的视频。结果的感知图像看起来更加类似于自然情况。

### 使用快门功能使屏幕更加自然

传统的运动模糊在感知图像上仍然有些问题。在某些物体速度下，伪影仍然表现为运动模糊中的不连续性。通过应用快门功能，这几乎可以消除：不再是对帧内所有时刻进行平均，而是通过函数进行加权，使得帧的起始和结束时刻的权重小于帧中心的时刻。 "快门功能" 这个名字来自于类比到[光圈相机](https://en.wikipedia.org/wiki/Diaphragm_%28optics%29)，在那里快门需要在开启和关闭状态之间进行过渡。但是，与模拟相机不同，快门功能可以选择为最小化屏幕和自然场景之间的感知差异。这个问题然后变得非常类似于在信号处理中制作[窗口函数](https://en.wikipedia.org/wiki/Window_function)，事实上最受欢迎的窗口函数提供非常好的结果。

**4\. 应用快门功能**。

这项工作效果如何？您可以在以下演示中大致了解，可以在带有和不带有快门功能的运动模糊之间切换。我个人的印象是，低速情况下快门功能不是必需的，但对于快速移动的物体来说显然更加自然^(。这使得它与我正在追求的“超越逻辑极限”的实验高度相关。它在静止画面中看起来更加平滑，这是偶然的，但有时也很重要。

**5\. 运动模糊的实时比较**，带有和不带有快门功能的比较。

我要强调这种对运动模糊的感知方法并不传统，可能在某些方面是误导的。常见的方法是模拟相机，导致帧之间没有时间重叠，并且通常完全丢弃在帧之间落入的时刻。与此同时，我描述的方法导致连续帧之间存在时间重叠的时间范围。说了这么多，让我们尝试应用这种技术。

## 与环面球感到愉悦

为了使事情既困难又有趣，我决定将这个无限运动模糊动画制作成一个实时[着色器](https://thebookofshaders.com/01/)。因为我喜欢挑战和痛苦，是的，但主要是因为我希望最终产品是互动的，而在这种情况下，着色器可能是最简单的方法。

首先，如何实时渲染运动模糊？在排除了多重采样和解析射线追踪的运动模糊后，我采用了一个可怕的方法，最好被描述为“综合体积运动模糊”。将运动物体表示为一个函数，该函数接受坐标（包括时间）并返回密度（内部为1，其他为0）。对这个密度函数在时间上进行积分，结果应该在任何时间间隔内给出一个“运动模糊密度”。结果可以通过[体积光线投射](https://en.wikipedia.org/wiki/Volume_ray_casting)来渲染。这种方法并不逼真，但可以处理极长的轨迹并实时性能良好。

所期望的动画结合了**轨道球体**和**旋转环面**，这两者都需要达到几乎无限速度的运动模糊效果。

### 运动模糊的球体

取轨道球的二维切片，问题简化为找到轨道圆的运动模糊密度。假设轨道半径为$R$，圆的半径为$a$。圆的中心始终与原点距离为$R$，因此可以从点$(R, 0)$开始。这意味着最初，圆上的所有点$(x, y)$由以下定义：

$$ (x - R)^2 + y^2 = a^2 $$

要处理轨道问题，应该使用极坐标$(r,\theta)$来表示，可以通过以下替换实现：

$$ r^2 - 2 r R \cos\theta + R^2 = a^2 $$

找到密度函数意味着取任意点，并回答这个问题：这个点何时进入轨道圆？何时退出？答案在于初始对象表面的角度坐标$\theta$，其径向坐标$r$与给定点相同。因为对象正在轨道运动，所以这个角度直接与对象击中该点的时间相关。因此，让我们根据上述表面的定义找到$\theta$：

$$ \theta = \pm\arccos\frac{R^2 + r^2 - a^2}{2 r R}, \theta\in[-\pi,\pi] $$

$\pm$符号来自于$\cos$的反转。这个$\pm$很有用，因为它决定了哪一半圆被定义为正或负的$\theta$。这两个半部分可以结合起来得到相应圆盘密度$\rho$的极坐标表达式：

$$ \rho(r,\theta) = \begin{cases} 1 & \text{如果 }-h(r)\lt\theta\lt h(r) \cr 0 & \text{否则} \end{cases}\\[2ex] \text{其中}\ \ h(r) = \arccos\frac{R^2 + r^2 - a^2}{2 r R} $$

从这个起始位置，圆盘围绕原点运动。这相当于从角度坐标中减去时间$t$乘以速度$v$：

$$ \rho(\colorbox{yellow}{t,}r,\theta) = \begin{cases} 1 & \text{如果 }-h(r)\lt\theta\colorbox{yellow}{- v t}\lt h(r) \cr 0 & \text{否则} \end{cases} $$

我们可以将时间间隔$I$内的时间$t$与物体在点$(r,\theta)$的位置分开：

$$ \rho(t, r,\theta) = \begin{cases} 1 & \text{如果 }t\in I \cr 0 & \text{否则} \end{cases}\\[2ex] I=\left[\cfrac{\theta-h(r)}{v}, \cfrac{\theta+h(r)}{v}\right] $$

运动模糊密度是在当前帧时间间隔$F$内密度$\rho$的积分。这等于$I$和$F$的交集的长度。这也可以直观地描述：我们测量的是物体在空间中给定点上占用了帧时间的多少。

$$\int_F\rho(t,r,\theta) d t = \int_{F\cap I}1\ d t = |F\cap I|$$

让我们应用一个快门函数$s$。为了简单起见，假设$s$已经居中在当前帧的时间跨度上。我们可以在积分之前通过将密度乘以$s(t)$来应用它，从而替换密度的任何积分边界。如果$s$有一个反导数$S$，那么运动模糊密度变为：

$$ \int\rho(t,r,\theta) s(t) d t = \int_I s(t) d t = S(\max I)-S(\min I) $$

这可以在着色器中实现，并且适用于任何快门函数，然而，根据本文第一部分的目标，快门函数应该有一个积分为1，并且应该以一种使得任何时间点的所有快门函数的和总是1的方式重叠。这可以通过梯形函数或像动画中使用的这种正弦函数来实现：

$$ s(t)=\begin{cases} \cfrac{1-\cos\frac{(t-A)2\pi}{B-A}}{B-A} & \text{如果 }A\lt t\lt B \cr 0 & \text{否则} \end{cases}\\[2ex] A=\min F-\frac{|F|}{2},B=\max F+\frac{|F|}{2} $$

### 运动模糊的圆环

对于圆环，可以采用同样的过程。圆环的二维垂直切片称为[斯皮尔科截面](https://en.wikipedia.org/wiki/Spiric_section)，或者称为Perseus的斯皮尔科。除了听起来像是一个**史诗般的视频游戏武器**外，在极坐标中还有一个方便的表述。取小半径为$a$，大半径为$b$的圆环。在位置$c$处取一个切片，在该切片中的极坐标$(r,\theta)$中，所有的圆环点由以下公式定义：

$$ (r^2-a^2+b^2+c^2)^2 = 4b^2(r^2\cos^2\theta+c^2) $$

求解$\theta$，假设$\theta\in[-\pi/2,\pi/2]$，则变为：

$$ \theta = \pm\arccos\frac{\sqrt{(a^2 - b^2 - c^2 - r^2 - 2 b c) (a^2 - b^2 - c^2 - r^2 + 2 b c)}}{2 b r} $$

再次强调，环面的内部在正负$\pm$符号之间被包围，给我们一个实体环面密度的极坐标表达式。获取运动模糊旋转环面的剩余步骤与上面的球体完全相同。

**6\. 运动模糊螺旋截面**。

### 把它组合在一起

唯一需要做的是通过以令人信服的方式组合元素，并在结果上使用标准体积光线投射来"画出猫头鹰的剩余部分"。[表面法线](https://en.wikipedia.org/wiki/Normal_%28geometry%29)需要额外注意，因为"运动模糊表面法线"这种东西不存在，所以它们在这里只是混合在一起。

动画应在下方以基本的鼠标/触摸交互方式运行。在所有设备上可能运行效果不佳，因此页面顶部还有预渲染的视频。你也可以在[Shadertoy上找到这个着色器](https://www.shadertoy.com/view/cdXSRn)。

环面加速器（现场）

* * *
