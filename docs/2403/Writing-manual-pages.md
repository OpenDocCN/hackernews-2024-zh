<!--yml

类别：未分类

日期：2024-05-27 14:59:26

-->

# 编写手册页

> 来源：[https://liw.fi/manpages/](https://liw.fi/manpages/)

# 介绍

手册页是 Unix 系统的经典文档类型。它们有点晦涩，但对于一个几十年历史的技术来说，它们的效果相当不错。晦涩的部分是标记语言。这是一个关于撰写良好手册页的简短教程，至少适用于典型情况。假设您已经熟悉阅读手册页。

实际上有许多方法可以生成手册页。 **`man`(1)** 命令需要使用 **`troff`(1)** 格式化命令的文件。[`troff`](http://en.wikipedia.org/wiki/Troff) 是 Unix 开发者在 1970 年代编写的排版系统。`troff` 文件可以手动编写，也可以从其他格式（如 DocBook 或 Perl POD 标记）生成。在 Linux 上，使用 GNU 实现的 `troff`，即 `groff`。

# 手册页中的约定

重要的是格式化的页面要遵循手册页排版和其他约定，以便读者能够高效地从中提取所需信息。这点很重要：手册页是**参考文档**，旨在**快速解答**诸如“此命令的目的是什么”或“是否有选项可以显示更多有关文件的信息”的问题。

下面是一些更重要的约定：

+   手册页应简洁明了，但不失清晰度

+   仅使用通常的部分，按照通常的顺序；有关详细信息，请参阅 **`man-pages`(7)** 

+   特别是在概要中对命令行语法进行简要易读的总结；如果有许多选项，请在选项部分列出它们

+   格式化选项部分，使选项以粗体显示，并将其可选参数以斜体显示，以便快速浏览页面

+   对于任何复杂使用的内容，请添加一个示例部分

    +   添加一些常见情况下的示例，而不仅仅是特殊情况：你可能认为你的程序很容易使用，但并非所有人都会这么认为

+   不要忘记环境和文件部分

+   另外，SEE ALSO 部分通常也很有用

# 示例手册页面

`troff` 是一种排版语言。它具有宏功能，并已编写了几个用于编写手册页的宏包。其中最常见的是 `-man`。以下是使用该语言的一个手册页示例：

```
.TH CORRUPT 1
.SH NAME
corrupt \- modify files by randomly changing bits
.SH SYNOPSIS
.B corrupt
[\fB\-n\fR \fIBITS\fR]
[\fB\-\-bits\fR \fIBITS\fR]
.IR file ...
.SH DESCRIPTION
.B corrupt
modifies files by toggling a randomly chosen bit.
.SH OPTIONS
.TP
.BR \-n ", " \-\-bits =\fIBITS\fR
Set the number of bits to modify.
Default is one bit. 
```

将其保存到名为 `corrupt.1` 的文件中，然后使用命令 `man -l corrupt.1` 查看。输出应大致如下（经手动转换为 HTML 以允许字体）：

> `CORRUPT(1)`
> 
> **名称**
> 
> corrupt - 通过随机更改位来修改文件
> 
> **概要**
> 
> **corrupt** [**-n** BITS] [**--bits** BITS] file...
> 
> **描述**
> 
> **corrupt** 通过切换随机选择的位来修改文件。
> 
> **选项**
> 
> **-n**, **--bits**=BITS
> 
> 设置要修改的位数。默认为一位。
> 
> CORRUPT(1)`

## 标题：`.TH`

每个手册页都应从指定其标题开始：

```
.TH CORRUPT 1 
```

在这里，`CORRUPT`是手册页的名称，`1`是手册页所属的部分（用户命令的第1部分，系统调用的第2部分等；请参见**`man-pages`(7)**获取整个列表）。

您还可以添加三个信息：本手册页修订的日期，文档化程序的来源以及此页所属整本书的标题。我几乎从不使用可选的内容：保持日期最新更新很麻烦，其他对于我的个人项目并不是很有用。

## `NAME`部分

```
.SH NAME
corrupt \- modify files by randomly changing bits 
```

`NAME`部分声明正在文档化的命令的名称。它还给出了它做什么的非常简短的解释。这两部分由反斜杠-dash分隔。这是一个魔法组合，`man`命令要求使用它。

此部分是`man -k`搜索的数据源。这是一个有用的功能，并且值得稍微注意确保简短的解释尽可能有用。但是要保持简洁；解释分成几行看起来很糟糕。（如果简短的解释很难写，这可能是程序设计不良的迹象。）

Debian及其派生的`man`实现附带了`lexgrog`，它可以验证您是否正确地获取了`NAME`部分。

## `SYNOPSIS`部分

```
.SH SYNOPSIS
.B corrupt
[\fB\-n\fR \fIBITS\fR]
[\fB\-\-bits\fR \fIBITS\fR]
.IR file ... 
```

在此部分，我们向用户提供程序命令行语法的摘要。字体使用在这里很重要，并携带信息。所有以粗体显示的部分是用户期望逐字写的内容。斜体表示用户期望填写的值。正常字体用于语法元字符：用于表示可选性的方括号和表示重复的省略号。

## 使用字体

字体可以通过两种方式设置：使用点命令或反斜杠-f转义。`.B`命令（点在行的开头）使该行剩余部分以粗体显示。类似地，`.I`以斜体显示（但终端显示为下划线），`.R`使用`troff`称为罗马字体，我们称为普通字体。您可以组合这些命令，`.BR`将第一个单词设置为粗体，第二个单词设置为普通字体。输出中单词之间没有空格：`.BR manpagename (7)`通常是引用另一页手册的方式。如果单词中有空格，请使用双引号：`.B "far and away"` 例如。

反斜杠-f转义可以在行中的任何位置使用，并且有时比点命令更容易使用。它们的效果也不会在行的末尾结束。

不幸的是，一个令人遗憾的古怪语法是选项中的破折号应该用反斜杠前缀。因此，写成`\-\-bits`，而不只是`--bits`。对于终端输出，Debian和Ubuntu的`man`实现将它们视为相同，但这不是可移植的。从技术上讲，裸的`-`表示连字符，而`\-`表示减号。在印刷上，它们是不同的，Unicode中它们也是不同的。排版者可以在连字符处换行，但不能在减号处换行。因此，在选项中的破折号应该使用减号，但在正常文本中，用于普通单词的连字符。

## `DESCRIPTION`部分

```
.SH DESCRIPTION
.B corrupt
modifies files by toggling a randomly chosen bit. 
```

DESCRIPTION部分详细描述程序的功能，比NAME部分更详细。这里没有人为的大小限制，但避免冗长的文风仍然是好的风格。同时，也许最好不要像例子那样简洁。

## 段落和行结构

如果写了多个段落，请使用`.PP`命令开始其他段落。不要只留空行；这有时会导致`troff`做出错误的处理。事实上，手册页源文件根本不应有空行。

`troff` 更倾向于每句话都在新行开始。这样做有助于它在使用比例字体输出时更好地排版句尾的空白。此外，这样做也更容易比较`diff`版本的手册页。

## 更多关于字体的信息

还有一些字体约定。

+   对于你正在文档化的命令，请使用粗体。

+   参考其他手册页如此：**`man-pages`(7)**（最简单的实现方式是`.BR man-pages (7)`）

+   文件名使用斜体

查看更多详情，请参阅**`man-pages`(7)**。

## `OPTIONS`部分

```
.SH OPTIONS
.TP
.BR \-n ", " \-\-bits =\fIBITS\fR
Set the number of bits to modify.
Default is one bit. 
```

选项可能是文档中最繁琐的部分。同时，正确的格式给读者带来了最大的好处。

首先，有列表结构。这是通过`.TP`命令实现的，这种命令有一种魔法效果。它接受*下一行*，不缩进它，然后缩进段落的其余部分。这提供了漂亮的缩进段落样式，使得即使是长长的选项列表，也能轻松快速地找到正确的选项。

第一行不缩进的描述选项，给出其名称，并指示它是否有参数。如果一个选项有多个名称（例如长名称和单字母名称），它们应该在同一行上，用逗号分隔。单字母选项名称不带选项参数，以保持简洁。

字体再次用于澄清事物：

+   选项的名称（包括开头的任何破折号）用粗体表示

+   任何参数都用斜体表示，但等号（如果有的话）使用普通字体

+   选项之间的逗号使用普通字体

## `troff`源文件中的注释

`troff` 也支持注释：以`.\"`开头的行将被视为注释。例如，可以使用它们在OPTIONS部分的选项描述之间添加空白（记住，不能有空行）。

## 标记示例

大多数手册页面受益于一个`EXAMPLES`部分，显示命令的基本用法。有时显示高级用法也是有用的，但基本用法几乎总是最需要的，因为这是人们最常需要的。

在手册页面中标记命令行使用的示例有些棘手。这里是一个示例的示例：

```
.SH EXAMPLES
To write some text to the standard output, use the
.BR printf (1)
command:
.PP
.nf
.RS
printf "this is a %s format %s\n" \\
usual string
.RE
.fi
.PP
Nifty, huh? 
```

几个新的`troff`命令：

+   `.nf`关闭段落填充模式：我们不希望显示命令行时使用。

+   `.fi`重新开启它。

+   `.RS`开始相对边距缩进：如果缩进，示例会更加视觉上的可区分。

+   `.RE`结束缩进。

+   `\\`在输出中放置一个反斜杠。由于`troff`在行内命令中使用反斜杠来表示字体和其他内容，因此在手册页面源文件中必须将其加倍，以便输出中有一个反斜杠。

反斜杠用于显示shell命令行被分成两行，即使它只是一个逻辑命令。这在手册页面中相当常见：页面宽度通常只有80个等宽字符，加上边距和缩进后，示例中通常每行只有60或65个字符。因此，命令行示例需要换行，最好是在手册页面源文件中明确指定，而不是让`man`程序自行处理。

# 创建手册页面的其他方式

本示例使用了`troff`的`-man`宏，因为这是撰写手册页面的最常用方式。然而，必须承认，这些方式在当前历史阶段已经有些过时。虽然它们相对容易编写，但不像Perl POD标记或DocBook标记（参见refentry元素）那样方便。然而，这些其他标记语言需要转换工具才能生成`man`实际可用的文件，并且这些工具并不总是能正确地遵循手册页的格式约定。

# 另见

关于撰写手册页面的更多信息，请参阅：

+   **`man`(7)**，用于`-man`宏

+   **`mdoc`(7)**，另一组`troff`宏的替代方式

+   **`man-pages`(7)**，用于手册页面的结构和字体约定

+   [Branden Robinson's Debconf5 talk](http://web.archive.org/web/20060102171907/people.debian.org/~branden/talks/wtfm/)

创建手册页面的其他方法：

+   **`perlpod`(1)**，用于Perl POD标记和转换

+   [asciidoc](http://asciidoc.org)
