<!--yml

category: 未分类

date: 2024-05-29 12:36:54

-->

# 如何通过不去云中节省了4亿美元 | 作者：Efim Mirochnik | Ahrefs

> 来源：[https://tech.ahrefs.com/how-ahrefs-saved-us-400m-in-3-years-by-not-going-to-the-cloud-8939dd930af8?gi=10fa74faaed3](https://tech.ahrefs.com/how-ahrefs-saved-us-400m-in-3-years-by-not-going-to-the-cloud-8939dd930af8?gi=10fa74faaed3)

# 如何通过不去云中节省了4亿美元的Ahrefs

最近IT基础设施的云使用如此流行，以至于进入云已成为一种趋势。基础设施即服务（IaaS）云提供了多种优势：灵活性、快速部署时间、易于扩展、即时在世界多个地区的存在等等。

云服务提供商已成为IT服务的知识性外包者，提供方便且通常易于使用的服务。凭借出色的营销、会议、认证和精心挑选的用例场景，人们很容易认为云是现代企业IT的唯一合理选择。

但这些外包云服务的成本有时候很高。它们如此之高，以至于我们担心如果我们的基础设施100%在云中，我们的业务是否能够存在。这激发了我们根据事实进行实际比较。以下是具体情况：

# **Ahrefs自有硬件概述**

Ahrefs在新加坡租用了一个托管数据中心，其基础设施相对均匀。因此，我们决定汇总为此数据中心花费的所有成本，将其除以服务器数量，并将其与Amazon Web Services（AWS）云中类似安装的成本进行比较（我们将其用作领先的IaaS示例）。

Ahrefs服务器

我们的硬件相对较新。云托管合同始于2020年中期，当时正值COVID-19封锁高峰期。所有安装的设备自那时以来都已购买。我们在这个数据中心的服务器配置相似，唯一的区别在于两代CPU核心数相同。我们使用高核心数的CPU，2TB内存和每台服务器的2x 100Gbps。平均而言，我们的服务器大约有16x 15TB硬盘驱动器。

对于月度成本计算，我们假设所有硬件只会使用五年。我们决定将五年后的任何内容视为“免费赠品”。基于此，初始设备成本的月度部分是其原始价格除以5*12 = 60个月。

所有当前的成本，如租金和电费，截至2022年10月。虽然通货膨胀也影响我们，但是试图考虑进去会使这些计算变得更加困难，所以我们目前忽略了这一点。

我们的托管支付包括两个主要部分：租金和*事实上*消耗的计量电费。自2022年初以来，电价显著增加。但我们根据最新的更高电费计算我们的月度费用，而不是整个租期的平均费用，后者会更低。因此，这应该给AWS带来了优势。

另外，我们还要支付数据中心与我们的点之间的IP过境和暗纤。

下表显示了我们每台服务器的月度支出。服务器硬件占整体月度支出的三分之二，而包括电费租金（DC）、互联网服务提供商（ISP）IP过境、暗纤（DF）和内部网络硬件（Network HW）在内的数据中心占剩余三分之一。

我们自己的本地硬件成本结构

# **AWS成本结构**

由于我们在新加坡的托管服务回顾中，我们使用AWS的亚太（新加坡）区域的价格进行比较。

AWS的成本结构与托管服务不同。不幸的是，AWS不提供与我们拥有的核心数相同的EC2实例。因此，我们找到了一个具有一半核心数和1TB RAM的EC2配置。然后，我们将一个Ahrefs服务器的成本与两个这样的EC2实例的成本进行了比较。

另外，我们考虑了长期EC2使用情况。因此，我们将三年预留的最低EC2实例价格与五年的本地服务器成本进行了比较。

除了EC2实例，我们还添加了弹性块存储（EBS）。它不是直接连接存储的准确替代品，因为我们在服务器上使用大而快速的NVMe驱动器。为了简化问题，我们选择了更便宜的*gp3* EBS（尽管比我们的慢得多）。其成本由两部分组成：存储大小和IOPS费用。

我们在服务器上保存数据块的两份副本。但我们只为EBS的可用空间下订单，这些空间已经为我们处理了复制工作。因此，我们应该考虑*gp3*存储大小的价格等于我们驱动器大小的一半：(1*1TB + 16*15TB)/2 ≈ 每台服务器约为120TB。

我们没有添加更高IOPS的成本。我们还丢弃了EBS *gp3*存在的各种限制；例如，*gp3*最大吞吐量/实例为10GB/s。同时，单个PCIe Gen 4 NVMe驱动器的性能为6-7GB/s，我们有16个并行工作。因此，这不是一种苹果对苹果的比较。但这种方法应显著降低AWS存储成本，使其具有进一步的优势。

与托管服务不同，AWS按每GB下载收费，而不是按带宽收费。因此，我们粗略估计了每台服务器的平均下载量，并使用该数字进行AWS网络计算。

将这三个组件汇总起来，我们有以下AWS的成本分布。

AWS成本结构

# **自有硬件 vs. AWS**

在总结上述表格时，我们看到虚构的AWS支出要高得多。

自有硬件 vs. AWS EC2月度支出

在 AWS 中用类似的可用 SSD 空间替换一个 EC2 实例，对我们而言，与合作数据中心的 11.3 台服务器大致需要相同金额。因此，这意味着我们的 20 台服务器机架将转变为大约只有 2 台服务器。

与 AWS 中的 2 台服务器成本相比，Ahrefs 的 20 台服务器成本

因此，假设我们在实际的 2½ 年数据中心使用期间运行了我们的 850 台服务器。一旦计算出数字，我们就能看到显著的差异。

850 台服务器的 AWS 与本地成本在 30 个月内的比较

自 2020 年以来，我们需要向 AWS 支付额外的**~USD 4 亿** 美元来维持我们在新加坡的基础设施运行。

有人可能会想：“也许 Ahrefs 负担得起这个？”

Ahrefs 确实是一家盈利和可持续发展的公司，因此让我们看看它的收入并在我们的计算中使用它。话虽如此，我们是一家私营公司，没有义务公布我们的财务数据。但人们可以在《海峡时报》的有关《新加坡最快增长的公司 2022》和《2023》的文章中找到关于 Ahrefs 2020 年和 2021 年收入的一些信息。

我们也可以对 2022 年的收入进行线性外推。这只是一个粗略的估算。但这已足以让我们得出一些结论。

Ahrefs 2020–2022 年的收入估算

从上表中，我们可以看到 Ahrefs 过去三年的总收入约为 2.57 亿美元。但我们还计算出 AWS 成本将约为 4.48 亿美元用于替换这样一个数据中心。因此，公司的收入甚至不足以覆盖 2½ 年 AWS 使用成本。

多么令人震惊的结果！

但我们的所有利润将去哪里？

根据[这份由波音公司的 L.J. 哈特-史密斯博士于 20 年前撰写的报告](https://www.documentcloud.org/documents/69746-hart-smith-on-outsourcing.html)：“如果主要制造商或系统集成商不能通过放弃所有工作来赚取财富，那么谁会从中受益？当然是分包商。”

值得记住的是，我们已经通过使用高于平均水平的电费来为我们的合作数据中心计算 EBS 的存储部分，并忽略了 EBS 存储的慢速性，为 AWS 提供了几个优势。此外，这个数据中心并不是我们的唯一成本中心。我们还在其他数据中心、服务器、服务、人员、办公室、市场活动等方面花费了资金。

因此，如果云是我们的主要基础设施目的地，Ahrefs 几乎无法生存。

## 其他考虑因素

本文并未考虑到其他会使比较变得更加复杂的因素。这些因素包括人员技能、财务控制、现金流、根据负载类型的容量规划等。

# **结论**

在过去的两年半中，Ahrefs通过确保其基础设施并非100%依赖IaaS云计算，已节省了约**4亿美元**。这一数字正在增长，因为我们目前正在启动另一家拥有新硬件的大规模机房数据中心。

尽管Ahrefs利用AWS在世界各地托管我们的前端，但Ahrefs大部分基础设施隐藏在自有硬件的合作机房中。如果我们的产品完全依赖AWS，Ahrefs不会盈利，甚至可能无法存在。

如果我们采用纯云方法，我们的基础设施成本将高出10倍以上。但由于我们不这样做，我们可以把节省下来的钱用于实际的产品改进和开发。因此，取得更快和更好的结果意味着我们的服务器比云计算能提供的要快得多（考虑到其限制）。我们的报告也生成更快，更全面，因为每份报告所需的时间更短。

在这一点上，我建议关注可持续增长的财务总监、CEO和企业主们考虑并定期重新评估云计算的益处与实际成本。尽管云计算是初创企业的首选，但在公司和其基础设施增长时，完全依赖云计算可能会拖垮一家公司。

然后就是困境。

一旦你进入云计算，要离开它就很复杂。云计算方便而且封闭。此外，由于成本较高可能会放弃云基础设施，这可能不是工程团队想要的。他们可能会认为云计算相比于老式的实体服务器和数据中心更容易和更灵活。

对于更成熟的公司来说，从云计算迁移到自己的基础设施是困难的。在迁移过程中，保持公司生存也将面临挑战。但这种痛苦的转移可能是拯救公司的办法，因为它可以避免将收入的日益增加的份额支付给云服务提供商。

多年来，大公司，特别是FAANG公司，主导了就业市场。他们一直在招聘工程师来运行他们庞大的数据中心和基础设施，留给小公司的机会很少。但是，近几个月来大型科技公司的大规模裁员可能是重新评估云计算方法的机会，考虑从云中逆向迁移，并雇佣数据中心世界的经验丰富的专业人员。

如果您要创办一家新公司，请考虑购买机架和服务器，并将它们放在地下室。这可能从第一天起就提升您的可持续性。
