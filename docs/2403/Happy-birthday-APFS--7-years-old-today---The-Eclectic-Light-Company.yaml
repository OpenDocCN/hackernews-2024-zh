- en: <!--yml
  id: totrans-split-0
  prefs: []
  type: TYPE_NORMAL
  zh: <!--yml
- en: 'category: 未分类'
  id: totrans-split-1
  prefs: []
  type: TYPE_NORMAL
  zh: 'category: 未分类'
- en: 'date: 2024-05-29 12:43:42'
  id: totrans-split-2
  prefs: []
  type: TYPE_NORMAL
  zh: 日期：2024-05-29 12:43:42
- en: -->
  id: totrans-split-3
  prefs: []
  type: TYPE_NORMAL
  zh: -->
- en: Happy birthday APFS, 7 years old today – The Eclectic Light Company
  id: totrans-split-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: APFS 今天已经七岁了——The Eclectic Light Company
- en: 来源：[https://eclecticlight.co/2024/03/27/happy-birthday-apfs-7-years-old-today/](https://eclecticlight.co/2024/03/27/happy-birthday-apfs-7-years-old-today/)
  id: totrans-split-5
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 来源：[https://eclecticlight.co/2024/03/27/happy-birthday-apfs-7-years-old-today/](https://eclecticlight.co/2024/03/27/happy-birthday-apfs-7-years-old-today/)
- en: Seven years ago, on 27 March 2017, Apple introduced one of the most fundamental
    changes in its operating systems since Mac OS X 10.0 Cheetah was released 16 years
    earlier. On that day, those who updated iOS to version 10.3 had their iPhone’s
    storage silently converted to the first release of Apple File System, APFS. Six
    months later, with the release of macOS 10.13 High Sierra on 25 September, Mac
    users followed suit.
  id: totrans-split-6
  prefs: []
  type: TYPE_NORMAL
  zh: 七年前的今天，即2017年3月27日，苹果推出了自Mac OS X 10.0 Cheetah发布16年以来其操作系统中最重大的变化之一。那天，将iOS更新到版本10.3的人们的iPhone存储被悄悄地转换为苹果文件系统的首个发布版本APFS。六个月后，随着2017年9月25日macOS
    10.13 High Sierra的发布，Mac用户也步入了同样的行列。
- en: At the time, these were huge gambles. The potential for disaster was significant,
    and at the last minute, Apple decided that those Macs with Fusion Drives had to
    stay with its old Mac OS Extended File System (HFS+) for another year before they
    too could start up from APFS. In some markets, notably South Korea, even Apple’s
    own software failed to cope with changes in the way that file names were handled
    by the new file system.
  id: totrans-split-7
  prefs: []
  type: TYPE_NORMAL
  zh: 当时，这些都是非常大的赌注。灾难的可能性很大，临近最后时刻，苹果决定那些带有Fusion Drive的Mac还必须继续使用旧的Mac OS 扩展文件系统（HFS+）一年，然后它们也可以从APFS启动。在一些市场，特别是韩国，即使是苹果自己的软件也无法适应新文件系统处理文件名方式的变化。
- en: Although APFS has certainly had its moments over the last seven years, Apple’s
    gambles have paid off, and proved key to the success of Apple silicon Macs. Had
    there been no APFS, many of the fundamental technologies like Secure Boot and
    the Signed System Volume (SSV) would have been far tougher if not impossible to
    implement. Macs and Apple’s devices had been in dire need of a modern file system
    for years; while there was a time when it looked as if that could have been ZFS,
    in 2014 Apple decided to write its own file system from scratch, with Dominic
    Giampaolo and Mike Mackovitch as lead engineers.
  id: totrans-split-8
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管在过去的七年中，APFS确实有其低谷时期，但苹果的赌注最终取得了成功，并且对Apple Silicon Mac的成功起到了关键作用。如果没有APFS，诸如安全引导和签名系统卷（SSV）等基本技术可能会更加困难，甚至不可能实现。多年来，Mac和苹果的设备一直急需现代化文件系统；尽管曾有过可能是ZFS的时刻，但在2014年，苹果决定从头开始编写自己的文件系统，Dominic
    Giampaolo和Mike Mackovitch担任首席工程师。
- en: Prehistory
  id: totrans-split-9
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 史前历史
- en: The very first Macs shipped with MFS, designed for 400 KB floppy disks and unable
    to cope with storage larger than 20 MB. In 1985 that was replaced with the Hierarchical
    File System HFS, and that evolved into HFS+ in 1998, intended to address hard
    disk seek times, fragmentation, and limited storage space. In 2002, journalling
    was added to improve its reliability.
  id: totrans-split-10
  prefs: []
  type: TYPE_NORMAL
  zh: 第一台Mac使用的是MFS，专为400 KB软盘设计，无法处理大于20 MB的存储。1985年，这被用HFS替代，后来在1998年演变为HFS+，旨在解决硬盘寻址时间、碎片化和有限的存储空间问题。2002年，添加了日志功能以提高其可靠性。
- en: Apple announced APFS at WWDC in 2016, when it was expected to be released in
    another 18 months if development and testing went smoothly. Those who had hoped
    for ZFS were disappointed and many remain so today. But over the last seven years,
    APFS has overcome most of its initial problems, is now one of the most widely
    used file systems, and has proved itself more than capable on anything from a
    watch to extensive enterprise networks of Macs.
  id: totrans-split-11
  prefs: []
  type: TYPE_NORMAL
  zh: 苹果在2016年的WWDC上宣布了APFS，预计如果开发和测试顺利的话，将在18个月后发布。那些希望得到ZFS的人感到失望，今天仍然有很多人如此。但在过去的七年里，APFS已经克服了大部分最初的问题，现在是最广泛使用的文件系统之一，并且在从手表到大型企业网络的各种设备上表现出色。
- en: History
  id: totrans-split-12
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 历史
- en: macOS Sierra already had a pre-release version for those who wanted to preview
    it. That ended its life in 10.12.6 as version 0.3, or 249.7.6 in the subsequent
    numbering system. As we discovered when we upgraded to High Sierra, that was a
    far cry from what was to come.
  id: totrans-split-13
  prefs: []
  type: TYPE_NORMAL
  zh: macOS Sierra已经有了供那些想要预览的人使用的预发布版本。当我们升级到High Sierra时，发现与即将到来的版本相比，它们大相径庭。
- en: After a promising period in beta, Apple discovered fundamental problems between
    APFS and its popular Fusion Drives. The first release of macOS 10.13 shipped with
    APFS version 748.1.46, but suddenly dropped support for those, so converted only
    those startup volumes on SSDs and hard disks. Snapshots were wobbly at first,
    and it quickly became clear that APFS was never going to perform well on rotating
    disks.
  id: totrans-split-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在测试版期间，APFS 与广受欢迎的融合驱动器之间发现了基本问题。macOS 10.13 的首次发布搭载了 APFS 版本 748.1.46，但突然停止支持这些驱动器，只对固态硬盘和硬盘上的启动卷进行了转换。快照起初不稳定，很快就清楚，APFS
    永远不会在旋转磁盘上表现良好。
- en: High Sierra had a stormy early release history, marred by a series of security
    gaffes. Vulnerabilities were fixed in the Supplemental Update released less than
    two weeks after 10.13, leaving snapshots to be improved in 10.13.1 on 31 October.
    Many expected problems with Fusion Drives would be fixed quickly, but those weren’t
    addressed until the following September. Another problem that troubled the introduction
    of APFS to all platforms was [the refusal](https://eclecticlight.co/2017/07/17/apfs-ios-11-and-high-sierra-will-fix-normalisation-problems/)
    during beta-testing to incorporate Unicode normalisation; this had to be resolved
    in later versions of macOS 10.13 and iOS 10, as explained [here](https://mjtsai.com/blog/2017/06/27/apfs-native-normalization/)
    and [here](https://eclecticlight.co/2021/05/08/explainer-unicode-normalization-and-apfs/).
  id: totrans-split-15
  prefs: []
  type: TYPE_NORMAL
  zh: High Sierra 在早期发布历史上颇为风波，一系列安全问题搅局。不到两周后的 10.13 补充更新修复了漏洞，留下 10.13.1 于 10 月
    31 日优化快照。许多人期待对融合驱动器的问题能迅速修复，但直到隔年 9 月才解决。另一个困扰 APFS 引入所有平台的问题是，在测试版期间拒绝集成 Unicode
    正规化，这得在 macOS 10.13 和 iOS 10 的后续版本中解决，详见[这里](https://mjtsai.com/blog/2017/06/27/apfs-native-normalization/)和[这里](https://eclecticlight.co/2021/05/08/explainer-unicode-normalization-and-apfs/)。
- en: In September 2018, Apple at last released Mojave 10.14 with support for Fusion
    Drives, accompanied by the first version of the Apple File System Reference. Although
    a long and detailed document, developers soon realised how incomplete it was,
    in spite of the long delay in its publication. At last third-party file system
    developers had some hard information to work with, and users started assuming
    that third-party disk maintenance and repair tools were imminent.
  id: totrans-split-16
  prefs: []
  type: TYPE_NORMAL
  zh: 2018 年 9 月，苹果终于发布了 Mojave 10.14，并支持了融合驱动器，附带首个苹果文件系统参考资料版本。尽管这是一份长而详细的文档，开发人员很快意识到其不完整，尽管其发布已有很长一段时间。终于第三方文件系统开发人员有了一些切实的信息可以使用，用户开始认为第三方磁盘维护和修复工具即将推出。
- en: Catalina brought major changes to APFS, with the use of expanded volume roles
    to form System Volume Groups, with their separate but firmlinked System and Data
    volumes. macOS 10.15.5 fixed a serious bug preventing the transfer of very large
    amounts of data to RAID volumes. At that time, Apple released an updated version
    of the Apple File System Reference, building expectations that third-party tools
    were just round the corner, at least among those who weren’t aware of how much
    information was still missing. Nearly four years later, it’s still that edition
    dated 22 June 2020 which remains the latest information released by Apple about
    APFS.
  id: totrans-split-17
  prefs: []
  type: TYPE_NORMAL
  zh: Catalina 对 APFS 做出了重大改变，使用扩展卷角色形成系统卷组，其独立但使用链接指向的系统和数据卷。macOS 10.15.5 修复了一个严重的错误，阻止向
    RAID 卷传输大量数据。当时，苹果发布了更新版本的苹果文件系统参考资料，建立了第三方工具即将问世的预期，至少在那些不知晓仍有多少信息缺失的人中间如此。近四年后，仍然是
    2020 年 6 月 22 日的那一版仍是苹果发布的有关 APFS 的最新信息。
- en: 'Further major changes came with Big Sur 11.0.1 when it was released in November
    2020, introducing the sealed and signed snapshot now used to boot macOS. This
    was also the first release to support making Time Machine backups to APFS volumes,
    and to support Apple silicon Macs. Since then, macOS has continued to take advantage
    of the many new features in APFS. Apple’s ongoing failure to inform even developers
    of changes still catches us out: apparently Monterey added a feature to trim UDRW
    disk images, only [discovered just over a year ago](https://eclecticlight.co/2023/01/15/last-week-on-my-mac-how-apfs-trims-a-disk-image-to-size/).
    Who knows what still remains hidden in APFS in Sonoma?'
  id: totrans-split-18
  prefs: []
  type: TYPE_NORMAL
  zh: 更重大的变化出现在2020年11月发布的Big Sur 11.0.1版本中，引入了封闭和签名的快照，现在用于启动macOS。这也是第一个支持将Time
    Machine备份到APFS卷，并支持Apple Silicon Mac的发布。从那时起，macOS继续利用APFS中的许多新功能。苹果持续未能通知开发者即使发生了变化，似乎Monterey增加了一个功能来修剪UDRW磁盘映像，直到一年多前才[被发现](https://eclecticlight.co/2023/01/15/last-week-on-my-mac-how-apfs-trims-a-disk-image-to-size/)。谁知道Sonoma中APFS仍然隐藏了什么？
- en: Free space or wear?
  id: totrans-split-19
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 空闲空间还是耐久性？
- en: Perhaps the most common everyday annoyance with APFS is its apparent inability
    to give a clear estimate of free space available in a container. This is the downside
    to its complexity, making free space dynamic, so that much of it may be temporary
    and conditional. I and others have written repeatedly about our lack of confidence
    in any of the estimates of free space currently available in macOS, which is worst
    when it’s most critical, such as when trying to update macOS.
  id: totrans-split-20
  prefs: []
  type: TYPE_NORMAL
  zh: 或许对于APFS最常见的日常烦恼是它似乎无法清晰地估算容器中的可用空间。这是其复杂性的弊端，使得空闲空间动态变化，因此其中很多可能是暂时性的和有条件的。我和其他人已经多次写到，我们对macOS目前所有空闲空间估计的信心不足，这在最关键的时候表现最糟糕，例如在尝试更新macOS时。
- en: What has attracted almost no attention, though, is how APFS is designed to prolong
    the working life of SSDs by minimising the number of write/erase cycles. Although
    the user may be unable to realise the space efficiency achieved with the use of
    sparse and clone files, for instance, by reducing the number of storage blocks
    actually written in order to store files, with APFS each write/erase cycle should
    store unique data rather than needless copies or null data.
  id: totrans-split-21
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，几乎没有引起注意的是APFS如何设计来延长SSD的工作寿命，通过最小化写入/擦除周期的数量。尽管用户可能无法意识到使用稀疏文件和克隆文件所实现的空间效率，例如，通过减少实际写入存储块的文件存储，但是使用APFS每个写入/擦除周期应存储唯一数据，而不是不必要的副本或空数据。
- en: This is of little or no comfort to those condemned to use hard disks for storage,
    even if only for Time Machine backups. Although the great majority of APFS users’
    devices will never be connected to a hard disk, for the small minority running
    it in macOS, they remain the medium of choice for backups and other bulk storage,
    and vulnerable to performance degradation resulting from fragmentation by the
    file system.
  id: totrans-split-22
  prefs: []
  type: TYPE_NORMAL
  zh: 对于那些被迫使用硬盘进行存储的人来说，这些都没有什么或没有安慰，即使只是用于Time Machine备份。尽管绝大多数APFS用户的设备永远不会连接到硬盘，但对于在macOS中运行它的少数用户来说，它们仍然是备份和其他大容量存储的首选介质，并且易受文件系统碎片化导致的性能下降的影响。
- en: Third-party tools
  id: totrans-split-23
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 第三方工具
- en: Although Apple dropped early hints that APFS might be released as open source,
    after seven years information about its internals released by Apple still appears
    to be insufficient to allow third-party developers to create maintenance tools
    independent of those bundled in macOS. This isn’t just about the potential for
    someone outside Apple to improve on the performance of `fsck` or Disk Utility,
    but also concerns features that Apple shows no sign of supporting.
  id: totrans-split-24
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管苹果早先暗示APFS可能会作为开源发布，但经过七年，由苹果发布的其内部信息仍然似乎不足以使第三方开发者能够创建独立于macOS捆绑工具之外的维护工具。这不仅仅是关于外部开发者有可能改进`fsck`或磁盘工具的性能，还涉及到苹果没有显示支持的功能。
- en: While Apple may be content with checking integrity only in the file system itself,
    many users also want to be assured that critical data doesn’t become corrupted
    or modified. In the absence of adequate documentation, third-party support for
    integrity checking remains relatively clumsy.
  id: totrans-split-25
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然苹果可能满足于仅在文件系统本身中检查完整性，但许多用户也希望确保关键数据不会损坏或修改。在文档不足的情况下，对完整性检查的第三方支持仍然相对笨拙。
- en: Another significant and lasting omission is the fundamental ability to copy
    Time Machine backups to a different storage device. Encouraged by reports, I recently
    attempted (again) to do this using Disk Utility’s Restore feature, only to be
    told repeatedly that my Time Machine backup storage volume wasn’t of the right
    type to be copied elsewhere.
  id: totrans-split-26
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个显著且持久的遗漏是基本能力，即将 Time Machine 备份复制到不同的存储设备上。受到报告的鼓舞，我最近再次尝试使用 Disk Utility
    的还原功能进行此操作，但一再被告知我的 Time Machine 备份存储卷不是正确类型，无法复制到其他位置。
- en: Apple’s reluctance to document APFS internals may stem from the deep involvement
    between the file system and macOS security. If so, then it’s a strange choice
    that we should be deprived of better tools for safeguarding data on our Macs for
    the sake of their security by obscurity. Perhaps if APFS had proved less of a
    success, then we might have been allowed to know more of its secrets.
  id: totrans-split-27
  prefs: []
  type: TYPE_NORMAL
  zh: 苹果不愿意记录 APFS 的内部细节，可能是因为文件系统与 macOS 安全性有着深度关联。如果是这样，那么出于安全性而剥夺我们更好地保护 Mac 上数据的工具的选择是一种奇怪的选择。也许如果
    APFS 没有取得如此大的成功，我们或许可以知道更多关于它的秘密。
- en: Version numbering
  id: totrans-split-28
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 版本编号
- en: APFS version numbers are important, as they’re referred to in the file system
    and may be quoted in terms of which version created a given container or volume,
    and which last modified it.
  id: totrans-split-29
  prefs: []
  type: TYPE_NORMAL
  zh: APFS 版本号非常重要，因为它们在文件系统中被引用，并且可能被用来指明创建特定容器或卷的版本，以及最后修改它的版本。
- en: 'Its major version numbers change with major version of macOS:'
  id: totrans-split-30
  prefs: []
  type: TYPE_NORMAL
  zh: 其主要版本号随 macOS 的主要版本变化：
- en: macOS 10.12 has APFS version 0.3 or 249.x.x
  id: totrans-split-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: macOS 10.12 的 APFS 版本是 0.3 或 249.x.x。
- en: 10.13 has 748.x.x
  id: totrans-split-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 10.13 的版本是 748.x.x。
- en: 10.14 has 945.x.x
  id: totrans-split-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 10.14 的版本是 945.x.x。
- en: 10.15 has 1412.x.x
  id: totrans-split-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 10.15 的版本是 1412.x.x。
- en: 11 has 1677.x.x
  id: totrans-split-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 11 的版本是 1677.x.x。
- en: 12 has 1933.x.x until 12.2, thereafter 1934.x.x.
  id: totrans-split-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 12 的版本是 1933.x.x 直到 12.2，之后是 1934.x.x。
- en: 13 has 2142.x.x.
  id: totrans-split-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 13 的版本是 2142.x.x。
- en: 14 has 2235.x.x. until 14.3, thereafter 2236.x.x
  id: totrans-split-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 14 的版本是 2235.x.x 直到 14.3，之后是 2236.x.x。
- en: Minor version numbers increment according to the minor version of macOS, and
    patch numbers wander without pattern. Changing version numbers thus aren’t any
    indication of the scope or magnitude of changes made to APFS. As Apple seldom
    provides any information on changes made to APFS, it’s anyone’s guess as to what
    is going on.
  id: totrans-split-39
  prefs: []
  type: TYPE_NORMAL
  zh: 小版本号会随 macOS 的小版本递增，而补丁号则没有规律可循。因此，更改版本号并不能说明对 APFS 所做更改的范围或重要性。由于苹果很少提供有关对
    APFS 所做更改的信息，所以任何人都无法猜测到具体情况。
- en: Happy birthday APFS, and thanks to all the engineers whose labours have made
    it such a success.
  id: totrans-split-40
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: APFS 生日快乐，感谢所有工程师们的努力，使其如此成功。
- en: '*Amended 28 March 2024 to add Mike Mackovitch as joint lead engineer, thanks
    to Dominic Giampaolo who didn’t want to hog the limelight (see his comment below).*'
  id: totrans-split-41
  prefs: []
  type: TYPE_NORMAL
  zh: '*2024 年 3 月 28 日更改，将迈克·麦克沃奇添加为联合首席工程师，感谢多米尼克·贾帕洛不愿独占风头（请参阅他的下方评论）。*'
