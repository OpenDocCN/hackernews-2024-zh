<!--yml

category: 未分类

date: 2024-05-27 13:08:31

-->

# 你可能并不需要 GraphQL | Max Stoiber (@mxstbr)

> 来源：[https://mxstbr.com/thoughts/graphql/](https://mxstbr.com/thoughts/graphql/)

我在 Twitter 上问过 [“为什么你不使用 GraphQL？”](https://twitter.com/mxstbr/status/1765821895742828915)，大多数 150 多个回复都是“我不需要它”的某种形式。

**他们是正确的：他们可能确实不需要 GraphQL！**

你可能会惊讶地读到来自 [一家 GraphQL 公司的联合创始人](https://stellate.co/) 的说法。

让我解释一下。

## 为什么你可能不需要 GraphQL

在 Facebook 于 2015 年发布它后不久（几乎十年前！），GraphQL 因其能够比其他 API 提供更好的开发者体验构建类型安全的 API 而受到了广泛关注。各种各样的人开始采用它，包括：

1.  早期阶段的小团队初创企业

1.  独立开发者正在构建他们的 MVP

1.  没有 UI 的产品构建公司

1.  用于服务间通信的微服务团队

1.  甚至是作为其查询语言的数据库引擎团队

但是 GraphQL 并不适合这些用例。

Facebook 发明了 GraphQL 作为它们众多面向最终用户的客户端和众多数据源之间的中央中介层。他们创造了一种新语言（因此工具链），使其能够在不同语言编写的微服务之间工作。

这使得它成为“我希望客户端数据访问是类型安全的”问题的一个笨拙解决方案。**不可避免地，为这些用例出现了更好的解决方案（如 tRPC），并在采用上超越了 GraphQL。** 随着 React 服务器组件的出现，许多这些用例再次准备变得更加简化。

## 那么，谁需要 GraphQL 呢？

困扰人们的问题是，“谁需要 GraphQL？” GraphQL 解决了许多不同的问题。当你和两个使用它的人交谈时，你将不可避免地得到两种不同的关于他们为什么使用它的答案。

不仅如此，但是 **GraphQL 并不显然 *解决* 所有这些不同的问题；许多问题只是在使用 GraphQL 时悄然消失。** 这使得很难意识到 GraphQL 解决了这些问题，因为你“必须曾经经历过”才能看到那些悄然消失的问题。

我知道：作为运营 GraphQL 公司的一部分，我过去三年与数千名工程师在数百家公司进行了关于他们的 API 的讨论，特别是那些使用 GraphQL 的公司。

让我总结一下他们告诉我的 GraphQL 解决了他们的问题及其方式。

### GraphQL 解决的问题

#### 1\. API 变更后，移动应用程序定期崩溃

GraphQL 仅返回客户端明确请求的字段，因此可以通过添加新类型或字段来添加新功能，这对于现有客户端来说永远不是一个破坏性的变化。

此外，您可以监控哪些客户端使用了哪些字段，因为他们必须明确指定他们需要的数据。

#### 2\. 由于请求瀑布和/或过度获取导致的加载时间缓慢

使用 GraphQL，客户端仅需发送一个请求获取渲染整个页面/视图所需的所有数据，服务器解析所有数据并一次性返回，**无需 BFFs 引入的重复数据**。（客户端甚至可以使用 `@defer` 和 `@stream` 指令要求服务器优先流式传输上折叠数据）

#### 3\. 由于数百个重复的一次性端点而导致的难以维护和端点发现困难

GraphQL 集中每个实体/资源的数据访问。当底层微服务或数据库更改其数据管理方式时，只需将此更改应用于 API 层中的单个中心位置，而无需更新多个端点或 BFFs。

更进一步，GraphQL 使客户端能够按组件级别指定其数据需求使用片段。（例如，`UserAvatar` 组件可以抽象地指定它需要 `UserType.avatarUrl`）因此，即使在客户端，变更也只需应用于相关的特定组件！

#### 4\. 安全性和性能是一场打地鼠的游戏

GraphQL 是客户端的中心数据访问层，因此您可以根据需要在非常精细的级别强制执行安全性和性能 SLA。类似于 REST API 的每个端点，您可以在 GraphQL 中每个操作强制执行限制，但您还可以更加精细化并限制每种类型甚至每个字段。

* * *

如果贵公司遇到了这些问题中的一个（或多个！），那么考虑将 GraphQL 加入到技术栈中是必须的。

如果今天你没有遇到这些问题，你可能会想：“我什么时候会遇到这些问题？”答案是很难预测，因为这取决于您的具体用例。有些公司在扩展到50名工程师和数百万用户时，仍然没有遇到这些问题。而其他公司在构建其 MVP 时就遇到了多个这些问题。

根据我的经验给出一些建议：**最迟在您有100名以上的工程师时，您可能会遇到至少一个这些问题。**

这就是为什么我的推文中大多数回复者都是正确的：他们可能不需要 GraphQL。

有一件事是确定的：无论何时遇到这些问题之一，GraphQL 都会在那里为您解决。

*敬请期待我的下一篇文章，将解释我们已经学到的最佳采用 GraphQL 成功的逆向路径。（如果您不想错过，请订阅下面的通讯！）*
