<!--yml

category: 未分类

date: 2024-05-27 13:30:01

-->

# 应该使用Ruby on Rails还是Hanami？| AppSignal博客

> 来源：[https://blog.appsignal.com/2024/04/24/should-you-use-ruby-on-rails-or-hanami.html](https://blog.appsignal.com/2024/04/24/should-you-use-ruby-on-rails-or-hanami.html)

*本文更新于2024年5月23日，以澄清Rails和Hanami之间模型和数据持久性的差异。*

Ruby on Rails是Ruby生态系统中最流行的Web框架，拥有广泛的用户群体，从自由职业者到大型成熟公司都有。凭借活跃的用户社区和广泛的文档，它可用于构建从简单应用程序到复杂Web平台的所有内容。

话虽如此，一个新的竞争者正在挑战Rails在全栈Ruby框架领域的主导地位：Hanami。与Rails相比，它是一个快速、模块化的Ruby框架，具有更好的性能和可维护性。

在本文中，我们将探讨每个框架在性能、功能、测试等方面的优势和劣势。因此，无论您是要构建面向客户的Web应用程序、内部工具还是高度可扩展的API，您都应该更加了解用于下一个项目的选择。

让我们从每个框架的简要介绍开始。

## 介绍Ruby on Rails

[Ruby on Rails](https://guides.rubyonrails.org/getting_started.html)是最知名的Ruby Web应用程序开发框架，其使命是通过增强开发人员的生产力（通过对应用程序构建方式进行大量假设，通常称为“Rails方式”）。

一些假设包括确保开发人员不花时间配置各种东西，或者所谓的“惯例优于配置”，并且强调使用DRY（“不要重复自己”）原则。DRY原则鼓励开发人员避免一遍又一遍地重复代码，而是使用单一和专注的应用功能表示，以确保可维护性和组织性。

## 介绍Hanami

虽然Rails在Ruby社区中非常知名，但[Hanami](https://hanamirb.org/)则不太为人所知。它是一个相对较新的现代Ruby框架，试图挑战Rails在全栈Web框架领域的主导地位。

Hanami从头开始构建，具有较小的内存占用和模块化的重点，这反过来使其成为一个非常快速和灵活的框架。

显然，这些简要介绍并不能真正为你提供选择最适合你的框架所需的所有信息。为此，我们需要深入探讨每个框架，首先从它们的结构开始。

## Rails和Hanami的结构与架构

Rails和Hanami在某种程度上相似，因为两者都是Ruby框架。然而，它们的构建方式及其应用架构是你将找到大部分差异的地方。

起步时，使用 Rails 时，你拥有较少的文件或*抽象*（用于构建应用程序的构建块），随着应用程序的开发，这些文件往往会增长。另一方面，Hanami将抽象推向一个全新的水平，拥有许多文件，这些文件往往较小。

下面的图表更清楚地说明了这一点。让我们从 Rails 开始。

现在将 Rails 的抽象图与下面的 Hanami 进行比较。

正如你所见，每个框架通常都遵循*模型-视图-控制器*（MVC）结构。但是，Hanami将抽象化推向了一个新的水平。

下面是每个框架组织结构的简化概述：

+   **路由** - 每个框架都有一个定义应用程序端点的路由。

+   **控制器与动作** - 在 Rails 中，你会得到带有一个或多个动作的控制器。控制器接收并响应路由请求，将它们定向到相关的动作。在 Hanami 中，没有控制器。取而代之的是直接进入自包含的动作（每个动作都有自己独立的类）。

+   **模型和持久层** - Rails 的模型层负责数据验证和数据库通信，包括应用程序可能有的任何查询。持久性由 Ruby Object Mapper (ROM) 处理。在 Hanami 中，模型层更为抽象，分为实体和存储库。实体处理领域逻辑，并且与数据库无关，而*存储库*（repos）用于与数据库通信。从 Hanami 2.0 开始，不再预配置持久层，允许你选择适合需求的对象关系映射器（ORM）或者不使用ORM。

+   **视图渲染** - 与持久层类似，Ruby on Rails 的视图通常包含了渲染数据到外部世界所需的一切内容。这包括所有的 HTML 结构、视图帮助器和视图逻辑。而在 Hanami 中，视图渲染更为抽象。首先，你有*视图*，它利用应用程序的任何视图帮助器，并且还渲染*模板*。*模板*处理实际的 HTML 结构，而*部分*则负责任何展示逻辑。

所以，当构建应用程序时，这意味着什么？Rails 的抽象较少，适合快速启动应用程序，对初学者更友好（我们稍后将在本文中看到）。使用 Rails，你可以构建非常健壮的单体应用程序，但随着规模扩大，你的代码会变得越来越复杂。另一方面，Hanami 的结构更复杂，学习起来可能有些艰难，但它将允许你构建大规模可扩展的应用程序，并可能实现更好的代码组织。

接下来，让我们来看看每个框架的生态系统。

## 生态系统和社区

正如我们之前提到的，Rails 比 Hanami 拥有更为成熟的框架。Rails 已经存在更长时间，因此拥有更大、更成熟的社区。

生态系统和社区的差异如下所示：

+   **文档** - 不管你想要构建什么，如果你使用 Rails，你都可以获得非常完善的文档。文档会引导你完成应用的各个部分，从认证、数据持久性、视图展示，以及其他方方面面。此外，各种第三方教程几乎涵盖了构建应用可能涉及的一切内容。

就说到了，Hanami 这边的情况还没有那么成熟。作为一个相对较新的框架，Hanami 的文档基础相对有限。Hanami 团队在官方指南方面做得非常出色，但与 Rails 的文档基础相比，还差得远。

+   **社区** - 在这里，和文档一样，Rails 显然是赢家。Rails 已经存在的时间比 Hanami 长得多，因此它被采用得最多。无论你是初学者还是高级开发者，在相关的 subreddits、Slack 群组、Discord 群等地方，都能找到 Rails 社区。另一方面，Hanami 还在成长中，这意味着它的社区规模要小得多。

+   **Gems 和库** - 由于 Hanami 和 Rails 都是 Ruby 框架，有人可能会认为在 Rails 中使用的 gems 可以在 Hanami 中工作。尽管从技术上讲这是正确的，但你会发现 Rails 拥有更多成熟的 gems 和库，用于各种专门功能。

也就是说，由于 Hanami 专注于抽象和专业化，它拥有一些非常先进的 gems，可以将你的 Rails 应用程序提升到更高的水平。例如，在 Hanami 中默认的 [dry-rb gems](https://dry-rb.org/) 可以在使用于 Rails 应用程序时带来更好的代码组织和抽象。

接下来，让我们比较每个框架的学习曲线和应用情况。

## 易用性、采用率、治理和学习曲线

基于上一节所说的原因，Ruby on Rails 在易用性、行业应用和学习曲线方面轻松击败 Hanami，具体如下：

+   **学习** - 想象一下，你是一个完全的初学者，正在学习一门新的编程语言。你第一个想到的将会是查找在线学习资源。如果一个框架有广泛可用的学习材料，覆盖从头到尾的应用构建过程，那么你可能会选择这门语言而不是其他。正因为 Rails 有更成熟的文档基础，它比 Hanami 更适合初学者选择。此外，Rails 对于初学者来说更加友好，因为它在底层做了很多假设（相对于 Hanami，后者提供了一种更抽象的应用构建方式）。Hanami 的抽象对于已经熟悉的 Rails 开发者来说，甚至都可能是令人望而生畏的。

+   **行业采纳** - 如果不考虑其他流行且更成熟的框架如 Python、React、C# 等的采纳情况，仅考虑 Ruby 框架的采纳情况，Rails 显然比 Hanami 更受欢迎。[Rails 官网](https://rubyonrails.org/)列出了一些使用该框架的知名组织。另一方面，作为新兴框架，Hanami 的采纳情况并不广泛。我们将等待看看未来是否会有所改变。

+   **就业市场前景** - 在就业前景方面，Rails 开发者的职位开放数要比 Hanami 开发者多得多。

+   **治理** - 另一个不容忽视的重要方面是治理。变化的格局指导着开源框架的进化和发展。然而，更重要的是，这些框架的核心团队成员往往拥有巨大的权力，可以决定框架的发展方向和内容等。

一个很好的例子是 [1月份的公告](https://twitter.com/dhh/status/1743664413964374505)，由 Rails 的创始人 David Heinemeier Hansson (DHH) 宣布。他表示，未来将推动 Rails 提供全栈渐进式 Web 应用和本地通知的一流支持。这些功能将使 Rails 对移动开发者非常有吸引力。

对此，许多开发者，包括 Ruby 生态系统之外的开发者，甚至是多年来放弃 Rails 的开发者，都积极响应，表示如果 DHH 兑现承诺的话，他们将很乐意选择或学习该框架。这个例子充分表明，在选择框架时，治理是一个非常重要的考虑因素。

现在让我们转向更加技术化的内容，应用程序性能。

## 性能：Ruby on Rails vs. Hanami

作为开发者，你会关心你的应用在部署到生产环境后的可靠性、响应性以及如何利用服务器资源。这些是极为重要的考虑因素，能够极大地影响你选择框架的决策。

你可以使用多种方法来对你的应用进行性能测试，其中最流行的之一是 [Apache JMeter](https://jmeter.apache.org/)。让我们使用 [基准测试数据](https://web-frameworks-benchmark.netlify.app/result?asc=0&f=hanami,rails&order_by=level64) 来比较 Hanami 和 Rails。

这里是一个快速的基准测试，显示了每个框架每秒可以处理的请求数：

Hanami 轻松击败了 Rails，其处理请求的能力是 Rails 的三倍。

下面的截图显示了每个框架的平均延迟值：

再次，Hanami 的平均延迟时间比 Rails 短大约 3 倍。

如果你正在寻找一个速度极快的 Ruby 框架（比如说，你需要开发一个快速且高度可扩展的 API），那么在 Ruby 领域内，你很难找到比 Hanami 更好的选择。

## 测试

在测试代码方面，由于你可以使用多功能的 [RSpec](https://rspec.info/) 库，所以两个框架都是非常可比的。

对于 Hanami 应用，RSpec 通过 `hanami-rspec` gem 已经包含在内，而对于 Rails 应用，你需要安装 `rspec-rails` gem 才能使用它。下面的示例展示了在新的 Hanami 应用中包含的一个非常基本的测试规范：

使用 `$ bundle exec rspec spec/requests/root_spec.rb` 运行应该会通过测试（假设你没有编辑默认视图模板）：

对于 Rails 来说，你需要自己处理一些事情。首先，你需要在 `Gemfile` 的开发/测试块中添加如下所示的 RSpec gem，然后运行 `bundle`：

下一步是使用命令 `bundle exec rails generate rspec:install` 安装 RSpec，为你的 Rails 项目做好准备。

最后，在编写和运行任何测试之前，你可能需要安装另一个 gem 来为你的 Rails 应用定义测试数据：[FactoryBot](https://github.com/thoughtbot/factory_bot_rails)。

假设你已经设置好了你的测试套件，并定义了一些测试，你可以像在 Hanami 应用中一样运行测试，使用 `bundle exec rspec spec/models/user_spec.rb`。你可以获取到与 Hanami 应用类似的测试结果：

最后，让我们看看当涉及到部署时这两个框架如何比较。

## 部署

现在，有很多选项可以部署 Ruby 应用到生产环境。

要开始，你可以选择一个像 [Heroku](https://www.heroku.com/ruby) 这样的平台即服务（PaaS）提供商，或者像 [Fly](https://fly.io/) 这样更无缝的体验。你也可以进行一些 DevOps 工作：在 VPS 上设置 Docker 安装，并在那里部署你的应用。

无论你选择哪个选项，你都可以期待在部署方面有类似的体验。唯一的问题是缺乏详尽的文档和教程来部署 Hanami 应用。

正如我们之前提到的，作为一个较新的框架，Hanami 还没有涵盖部署过程和可能出现的挑战的详尽文档。如果你不介意处理这些问题，那么你应该没问题。

## 总结

在本文中，我们比较了两个 Ruby 框架 — Ruby on Rails 和 Hanami — 从功能、架构、性能等方面进行了对比。最终，我们需要回答这样一个问题：“我应该选择哪个框架，为什么？”。我们可以总结如下：

+   如果你是一个初学者的 Ruby 开发者，建议从 Rails 开始：它更容易学习和掌握。如果你是一个更高级的 Ruby 开发者，发展 Hanami 技能集将帮助你开发更加健壮的 Ruby 应用程序。

+   如果你需要开发一个快速的应用，比如为多个客户提供 API，Hanami 的小内存占用、极快的响应速度和低延迟将非常适合你。然而，如果你只需要开发一个单体全栈应用来验证 SaaS 想法，Rails 肯定会更快地帮助你实现目标。

最终，您选择什么取决于您自己。同时掌握两种框架的技能并不是一个坏主意。这样，您可以根据项目的需求选择最合适的框架。

快乐编程！

**P.S. 如果您想第一时间阅读 Ruby Magic 的文章，请[订阅我们的 Ruby Magic 新闻通讯，绝不错过任何一篇文章](https://blog.appsignal.com/ruby-magic)!**

**P.P.S. 您知道 AppSignal 已经为 [Rails](https://www.appsignal.com/ruby/rails-monitoring) 和 [Hanami](https://www.appsignal.com/ruby/hanami-monitoring) 提供了集成吗？**
