<!--yml

类别：未分类

日期：2024-05-27 13:22:52

-->

# 多光标代码编辑：一个动画介绍

> 来源：[https://alexharri.com/blog/multi-cursor-code-editing-animated-introduction](https://alexharri.com/blog/multi-cursor-code-editing-animated-introduction)

<main class="css-fkkl8v">

# 多光标代码编辑：一个动画介绍

2023年1月28日

当编辑文本时，特别是结构化文本时，通常需要在多个位置进行重复更改。一个常见情况是重命名变量。

选择并键入，选择并键入。

对于一个小的代码块来说，这没问题。有点乏味，但还好。这样敲出来不会花费太多时间。

但是，按键次数会线性增长。增加几十个引用已经让任务相当繁重。

我们希望重复更改的工作量呈非线性增长。我们可以使用 Command `D` 做到这一点。

注意：本文集中在 VS Code 上，但 Command `D` 可以用于其他文本编辑器，如 Sublime Text。其他文本编辑器将具有类似的键盘快捷键。

Command `D` 选择下一个你已选择的实例，这样可以进行多光标编辑。

使用 Command `D` 看起来简单得令人难以置信。找到一个匹配的模式，然后进行更改：

使用 Command `D` 进行简单转换（例如上述内容）已经非常有价值，但我们只是触及到表面。结合智能文本导航技术，我们可以把 Command `D` 发挥得更加淋漓尽致。

## 导航文本

首先，基础知识。

+   **箭头键** 用于移动光标

+   **Shift** 在移动光标的同时选择文本。

使用 Option 跳过单词。

跳过单词允许我们导航包含不同长度单词的文本。

使用 Command 跳转到行的开头或结尾。

跳转到行边界允许我们导航包含可变数量单词的文本。

在锁定文本导航的同时，让我们做一些酷炫的事情。

## 寻找模式

以将一系列 `if` 语句转换为 switch 语句的示例为例。

所有的 `if` 语句都具有完全相同的结构，因此匹配它们有些琐碎。这些类型的模式是 Command `D` 的基础，非常常见。

但是，对于非统一模式，Command `D` 仍然非常有效。这些更复杂的模式可以以

+   变量数量的参数，

+   字符串中的变量数量的单词，或者

+   不同的参数类型。

让我们看一个例子。

### 非统一模式

假设我们正在开发一个用于评估数学表达式的库。

```
import  { evaluate }  from  "imaginary-mathlib";evaluate("2 * 4"); evaluate("[5, 10] / 2"); evaluate("1 > 1/2 ? 1 : 'err'"); 
```

为了使测试库变得不那么冗长，我们制作了一个实用函数，它接受一个表达式和它的期望值。

```
function  expectEqual(expression:  string, expectedValue:  any):  void;
```

我们有一些使用它的测试代码看起来像这样：

```
expectEqual("2**4",  16);expectEqual("1/0",  ERR_DIV_ZERO);expectEqual("[1, 3, 5] * 2",  [2,  6,  10]);expectEqual("1/10 < 0.2 ? 'a' : 'b'",  "a");
```

但是，我们想将此测试代码转换为以下内容：

```
const tests =  [  { expression:  "2**4", value:  16  },  { expression:  "1/0", value:  ERR_DIV_ZERO  },  { expression:  "[1, 3, 5] * 2", value:  [2,  6,  10]  },  { expression:  "1/10 < 0.2 ? 'a' : 'b'", value:  "a"  },];
```

由于我们有很多测试，手动完成这些工作将会非常繁琐。这是使用 Command `D` 的一个典型案例，我们只需要找到一个匹配的模式即可。

如果我们匹配到 `expectEqual` 并从那里开始，我们会遇到表达式长度不同的问题。

匹配到末尾时遇到同样的问题。这些值的长度是不同的。

如果我们尝试匹配表达式和值之间的逗号 `,`，我们也会匹配表达式和期望值中的逗号：

表达式和期望值可以是任意长度，因此匹配开头或结尾是没有用的。

然而，我们可以观察到表达式总是一个字符串。表达式总是以双引号 `"` 紧接着逗号 `,` 结束。这是我们可以匹配的模式！

## 匹配每一个实例

在上面的例子中，我们匹配了四个测试。对于一个评估数学表达式的库来说，这是一个相当少量的测试。

按三次 Command `D` 不算多的工作，但如果测试数量增加到 1,000，我们将需要按下 999 次 Command `D`。这与我们使重复更改呈非线性增长的目标相违背。

这是介绍 Shift Command `L` 的好时机，这是 *选择所有匹配项* 的键盘快捷键。

对于 Shift Command `L`，您必须更加小心，因为它会选择文件中的**每个**匹配项。您可能会匹配到不打算匹配的内容，这种情况可能发生在当前视图之外。

因此，当处理少量匹配项时，我更喜欢使用 Command `D`。匹配感觉更加局部化，您可以直观地看到每个匹配的发生。

## 跳过一个实例

在选择匹配项时，您可能想跳过某个实例。要跳过一个匹配项，请按下 Command `K`，然后再按 Command `D`。

要跳过匹配项，首先需要将匹配项添加到选择中。在将匹配项添加到选择后，按下 Command `K` 和 Command `D` 取消选择它并选择下一个匹配项。

按下 Command `K` 和 Command `D` 解决了一个名为**将最后的选择移至下一个查找匹配项**的命令。这是一个非常技术化的名称，但基本上意味着

+   删除最近的匹配项，并

+   选择下一个匹配项。

起初这并不是很直观，但是经过足够的练习，它会变得很熟练。

## 匹配换行符

当处理任意数据时，匹配每一行可以是有用的。

看看这个文本文件：

```
PythonJavaC++GoRustElixir
```

假设我们想将此文件的行转换为 JSON 数组：

```
[  "Python",  "Java",  "C++",  "Go",  "Rust",  "Elixir",]
```

这些行之间没有模式，因此匹配每一行似乎是不可能的。但是，Command `D` 允许我们匹配换行符。

匹配换行符在某些情况下是有用的，例如

+   匹配每一行，或者

+   匹配仅出现在行末的模式，或者

+   匹配跨越两行或更多行的模式。

对于匹配跨多行模式的示例，请看这个只匹配空数组的例子：

## 大小写转换

在不同的情况下进行大小写转换（例如将蛇形命名转换为驼峰命名）偶尔会出现。我通常在处理 HTML、CSS 和 JavaScript 时遇到这种情况。

VS Code 提供了一个方便的`转换为大写`命令，我们可以与命令`D`结合使用。

`转换为大写`命令没有直接的键盘快捷键。在 VS Code 中，你可以通过打开命令提示符（Shift Command `P`）然后输入命令名称来运行它。

注意：不幸的是，你无法在此编辑器中使用`转换为大写`方法。本文使用的是 Monaco Editor，它没有 VS Code 的命令提示符。

## 到此结束！

使用 VS Code 进行多光标编辑有许多方法，但我发现使用命令`D`是最简单和最实用的方法。

将本文学到的内容应用到你自己的工作中！虽然有一定的学习曲线，但如果你能克服它，我保证命令`D`将证明是一个非常有用和高效的工具。

感谢阅读本文！

</main>
