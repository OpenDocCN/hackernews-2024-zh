<!--yml

category: 未分类

date: 2024-05-27 12:48:53

-->

# Inside the failed attempt to backdoor SSH globally — that got caught by chance | by Kevin Beaumont | Mar, 2024 | DoublePulsar

> 来源：[https://doublepulsar.com/inside-the-failed-attempt-to-backdoor-ssh-globally-that-got-caught-by-chance-bbfe628fafdd](https://doublepulsar.com/inside-the-failed-attempt-to-backdoor-ssh-globally-that-got-caught-by-chance-bbfe628fafdd)

# Q&A

**我需要惊慌吗？** 不需要。作为保证，组织可以检查他们是否在使用Debian和Fedora的最新不稳定版本——但他们很可能没有。

安德烈斯发现了问题——这使得它在任何稳定发布之前被逐出Linux发行生态系统。

安德烈斯是如何发现问题的？让我们去找安德烈斯：

> “当时我正在进行一些微基准测试，需要平息系统以减少噪音。发现sshd进程使用了令人惊讶的CPU，尽管因为用户名错误等原因立即失败。对sshd进行了性能分析，显示在liblzma中有大量CPU时间，但是perf无法将其归因于一个符号。开始怀疑。回忆起几周前包更新后，在自动测试Postgres时看到了一个奇怪的valgrind投诉。
> 
> 真的需要很多巧合。
> 
> 另一个方面，我认为强调了许多巧合，这些巧合使我们找到了这个问题：
> 
> 我运行了一些“buildfarm”实例，用于自动测试Postgres。其中一些使用了valgrind。由于某种原因，我已经不记得了，一年多前我将所有测试实例移动到了一个共同的基础配置，而不是重复的配置。我选择让它们都使用了-fno-omit-frame-pointer。
> 
> 我认为如果没有-fno-omit-frame-pointer，valgrind不会抱怨载荷。因为_get_cpuid()期望栈帧看起来应该是某种方式。
> 
> 此外，我选择使用Debian的不稳定版来更早地发现可能的可移植性问题。如果没有这个，valgrind就没有什么可抱怨的了。
> 
> 如果没有看到valgrind中的奇怪投诉，我不认为我会深入研究看到sshd下面_get_cpuid()中高CPU的问题。”

这里有几点。首先，全世界都应该感谢安德烈斯，他在业余时间拯救了每个人的屁股。我不是在开玩笑。

没有其他人提出关注，我不认为任何现有的安全工具或流程会发现这个问题（我知道会有一堆供应商声称他们可以检测到...但是现在他们会检测到*有人告诉他们*）。

因为安德烈斯私下研究了这个问题，并让Linux发行版认真对待，他避免了这个问题在现实世界中的任何广泛（甚至是小范围）部署。

此外，安德烈斯拥有独特的测试环境和一系列偶然的设置问题，使他能够发现这个问题。我不知道还有谁有这样的设置。

当我安装一个有漏洞的Linux盒子时，我不得不仔细检查它是否真的有漏洞，因为我甚至看不到速度问题。对我来说，这是一个完全透明的后门 —— sshd像往常一样从磁盘运行，具有通常的文件哈希和没有额外的网络活动。

**威胁行为者有多先进？** 这次后门尝试非常严重，需要极高的知识、研究、开发和技艺才能深入到Linux生态系统中。此外，威胁行为者在GitHub上的更改跨越多年，包括引入与OSS Fuzzer不兼容的函数，由于2015年以来未解决的小问题，然后去年让OSS Fuzzer排除了对XZ Utils的扫描。后门本身设计非常精良，甚至包括通过kill命令远程停用和删除后门的功能。全球关注数天后，尽管没有看到任何完成对其进行逆向工程的人。

**是谁做的？** 你妈妈。开个玩笑，是GCHQ在切尔滕纳姆。再开个玩笑，是俄罗斯。再开个玩笑，是中国。再开个玩笑，是美国。再开个玩笑，绝对是你妈妈。

**我们应该停止使用开源，只购买美国供应商的产品！** 嗯，祝你好运。

**我们应该开始资助每一个开源项目！** 嗯，祝你好运……我会开始为我去火星的旅行存钱。

**这是关于网络安全的警钟！** 人们一周后就会忘记它。除了LinkedIn，他们会在四十年后仍在闭门讨论供应链问题。

**那么我们能做什么？** 首先，如果你依赖*任何*软件，你就有内部威胁的风险。无论是开源、闭源还是你自己的内部开发者 —— 如果人们添加后门而没有人注意到，那就是一个问题。

第二，***这里的核心问题是Linux中的systemd***。libsystemd链接到所有systemd服务，为第三方服务打开了丰富的后门攻击面。这就是威胁行为者在此处滥用的地方。这意味着他们不需要在systemd中设置后门，因为systemd有一个关注度很高的开发社区 —— 相反，他们依赖于liblzma加载XZ，这在整个链条中位于更低层次，没有人关注。

这里有一个情节转折。今天在systemd中提出了这个问题请求：

但在GitHub问题出现之前和XZ问题被突显之前，这个修复方案*已经在进行中*。该修复方案阻止了XZ后门进入SSH，但尚未在systemd的发布版中推出。

我认为威胁行为者有很大可能意识到这一点，并开始快速加速开发和部署，因此公开提交错误报告，试图促使Ubuntu等更新XZ，因为它即将破坏数年的工作。看起来他们开始犯错误的时候也是这个时候。

**我们都完蛋了!!!1! 供应链将毁灭世界!11! 我真的想要恐慌!!!** 不。恐慌对任何人都没有好处。同样重要的是，我们要保持正确的看法，例如这件事情被发现并避免了。

让我们继续在CISA做好良好的SBOM工作，停止围绕华为等事务做一些噱头 - 与成千上万没有报酬的开发者撰写现今世界最关键基础设施的问题相比，华为只是个尘埃。

工作围绕加强systemd和其他核心Linux依赖关系的工作需要继续。可能还需要在Linux上加强EDR检测，例如注入到ssh中却没有被检测到？检测它。事实上，Linux的EDR产品远不及Windows的EDR产品健壮。问我怎么知道。

现实是所有的开发都存在内部账户滥用的风险，包括开源。

我们还应该承认，开源开发者大多数情况下没有报酬，并且面临着大量来自软件用户的在线滥用。这并不是开发者被添加为维护者后开源软件包被劫持的第一次事例 - 实际上，在Python仓库等地方这种情况经常发生，一直以来都是信息窃取和货币挖掘工具在开发流程中的主要原因之一。毫不奇怪有人在瞄准systemd加载的开源压缩库.. 也令人遗憾的是，在线欺凌这些库的创造者也不是什么新鲜事。

没有简单的解决方案.. 我们应该试着降低风险，冷静地寻找解决方案。

其他阅读：
