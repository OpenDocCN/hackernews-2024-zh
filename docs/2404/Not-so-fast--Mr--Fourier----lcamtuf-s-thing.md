<!--yml

category: æœªåˆ†ç±»

date: 2024-05-27 12:48:44

-->

# ä¸è¦é‚£ä¹ˆå¿«ï¼Œå‚…ç«‹å¶å…ˆç”Ÿï¼ - lcamtuf çš„è§‚ç‚¹

> æ¥æºï¼š[https://lcamtuf.substack.com/p/not-so-fast-mr-fourier](https://lcamtuf.substack.com/p/not-so-fast-mr-fourier)

ç¦»æ•£å‚…ç«‹å¶å˜æ¢ï¼ˆDFTï¼‰æ˜¯ç°ä»£è®¡ç®—ä¸­æœ€é‡è¦çš„ç®—æ³•ä¹‹ä¸€ï¼šåœ¨é€šä¿¡ã€å›¾åƒå’ŒéŸ³é¢‘å¤„ç†ã€æœºå™¨å­¦ä¹ ã€æ•°æ®å‹ç¼©ç­‰é¢†åŸŸä¸­èµ·ç€å…³é”®ä½œç”¨ã€‚æœ‰è¶£çš„æ˜¯ï¼Œå®ƒä¹Ÿæ˜¯è®¡ç®—æœºç§‘å­¦ä¸­è§£é‡Šæœ€å·®çš„ä¸»é¢˜ä¹‹ä¸€ã€‚ä¾‹å¦‚ï¼Œç»´åŸºç™¾ç§‘ä¸Šçš„ç›¸å…³æ–‡ç« ç”¨å¤§çº¦ä¸‰åå¤šä¸ªç¥ç§˜çš„å…¬å¼æ”»å‡»è¯»è€…ï¼Œå´æ²¡æœ‰æä¾›å¯è®¿é—®çš„è§£é‡Šè¯´æ˜è¿™ä¸ªç®—æ³•å¦‚ä½•å·¥ä½œæˆ–ä¸ºä½•å·¥ä½œã€‚

æˆ‘ä»Šå¤©çš„ç›®æ ‡æ˜¯æ”¹å˜è¿™ä¸€ç‚¹ã€‚è®©æˆ‘ä»¬ä»åŸºç¡€çŸ¥è¯†å¼€å§‹ï¼šDFTå°†æ—¶åŸŸæ³¢å½¢ï¼ˆä¾‹å¦‚éŸ³é¢‘è½¨é“ï¼‰è½¬æ¢ä¸ºé¢‘åŸŸæ•°æ®ï¼šä¸€ç³»åˆ—æè¿°åŸºç¡€ä¿¡å·çš„æ­£å¼¦æ³¢å¼ºåº¦ã€‚å¦‚æœå°†è¿™äº›ä¸åŒé¢‘ç‡ã€ç›¸ä½å’Œå¹…åº¦çš„æ­£å¼¦æ³¢å†æ¬¡ç›¸åŠ ï¼Œåº”è¯¥å¯ä»¥å¿ å®åœ°é‡æ–°åˆ›å»ºåŸå§‹æ³¢å½¢ã€‚

ä¸ºäº†è¯´æ˜DFTçš„å®ç”¨æ€§ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¼ ç»Ÿæ³¢å½¢è¡¨ç¤ºçš„[ğŸ”ˆ è­¦ç¬›å£°](https://lcamtuf.coredump.cx/police.mp3)ä¸å…¶é¢‘åŸŸå¤„ç†çš„å¯¹æ¯”ã€‚åœ¨ä¸¤ä¸ªå›¾ä¸­ï¼Œæ°´å¹³è½´è¡¨ç¤ºæ—¶é—´ã€‚åœ¨åº•éƒ¨å›¾åƒä¸­ï¼Œå‚ç›´è½´è¡¨ç¤ºé¢‘ç‡ï¼Œåƒç´ é¢œè‰²è¡¨ç¤ºå¼ºåº¦ã€‚é¡¶éƒ¨è§†å›¾å‘Šè¯‰æˆ‘ä»¬å…³äºå½•éŸ³çš„ä¿¡æ¯å¾ˆå°‘ï¼›åœ¨åº•éƒ¨å›¾ä¸­ï¼Œè­¦ç¬›çš„éŸ³è°ƒå˜åŒ–å¾ˆå®¹æ˜“çœ‹åˆ°ï¼Œä»¥å…¶åŸºé¢‘å’Œ[ä¸€äº›è°æ³¢](https://lcamtuf.substack.com/p/square-waves-or-non-elephant-biology)ä¸ºç‰¹å¾ï¼š

*è­¦ç¬›å£°ï¼šæ—¶åŸŸä¸é¢‘åŸŸçš„å¯¹æ¯”*

ä¸¥æ ¼æ¥è¯´ï¼Œåº•å›¾â€”â€”ç§°ä¸ºé¢‘è°±å›¾â€”â€”ä¸æ˜¯å•ä¸€DFTæ“ä½œçš„ç»“æœï¼›å˜æ¢ä¸æ˜¾ç¤ºé¢‘ç‡éšæ—¶é—´çš„å˜åŒ–ã€‚ç›¸åï¼Œé¢‘è°±å›¾æ˜¯é€šè¿‡å°†éŸ³é¢‘åˆ†æˆå¤šä¸ªçŸ­æ—¶æ®µï¼Œå¹¶ä¸ºæ¯ä¸ªçŸ­æ—¶æ®µè®¡ç®—å•ç‹¬çš„é¢‘åŸŸè¡¨ç¤ºæ¥åˆ›å»ºçš„ï¼Œæ¯ä¸ªçŸ­æ—¶æ®µåœ¨ç»˜å›¾ä¸­å½¢æˆä¸€åˆ—ã€‚æœ‰æ—¶è¿™è¢«ç§°ä¸º*çŸ­æ—¶å‚…ç«‹å¶å˜æ¢*ï¼ˆSTFTï¼‰ï¼›å°½ç®¡å¦‚æ­¤ï¼Œè¿™ç§ä¸åŒçš„æœ¯è¯­å¯¹ç»“æœæ²¡æœ‰å®è´¨æ€§å½±å“ï¼Œå› ä¸ºå…¶åŸºç¡€æ•°å­¦æ˜¯ç›¸åŒçš„ã€‚

æ— è®ºå“ªç§æ–¹å¼ï¼Œä¿¡å·çš„é¢‘åŸŸè¡¨ç¤ºå…è®¸æˆ‘ä»¬æ‰§è¡Œå„ç§æœ‰è¶£çš„æŠ€å·§ã€‚ä¾‹å¦‚ï¼Œå¯¹äºéŸ³ä¹ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åˆ†ç¦»ç‰¹å®šä¹å™¨ï¼Œå»é™¤ä¸éœ€è¦çš„äº¤æµå—¡å—¡å£°ï¼Œæˆ–è€…æ”¹å˜äººå£°çš„éŸ³é«˜ã€‚å®Œæˆç¼–è¾‘åï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®è½¬æ¢å›æ—¶åŸŸæ³¢å½¢ã€‚ç¡®å®ï¼ŒæŸäº›æµè¡Œæ­Œæ‰‹åˆ©ç”¨çš„è‡­åæ˜­è‘—çš„Auto-TuneéŸ³é«˜ä¿®æ­£å™¨ï¼Œæ˜¯DFTçš„ä¼—å¤šåº”ç”¨ä¹‹ä¸€ã€‚

ä¸ºäº†æŠŠè¿™ä¸ªé—®é¢˜æ‘†å¹³ï¼Œè®©æˆ‘ä»¬ä»å®˜æ–¹å…¬å¼å¼€å§‹â€”â€”å¯¹äºå¤–è¡Œæ¥è¯´ï¼Œè¿™ç›¸å½“æ™¦æ¶©ï¼š

\(F_k = \sum\limits_{n=0}^{N-1} s_n \cdot e^{-i 2 \pi k\frac{n}{N} }\)

åœ¨è¿™ä¸ªæ–¹ç¨‹ä¸­ï¼Œ*F[k]*æ˜¯ç‰¹å®šé¢‘ç‡ç®±çš„DFTå€¼ï¼ˆâ€œç³»æ•°â€ï¼‰ã€‚ç®±å·æ˜¯ä¸è¾“å…¥é‡‡æ ·ç‡å¯¹åº”çš„æ•´æ•°ã€‚ç»§ç»­å‘å‰ï¼Œ*s[0]*åˆ°*s[N-1]*æ˜¯æ„æˆDFTè¾“å…¥çª—å£çš„æ—¶åŸŸæ ·æœ¬ï¼›å…¶ä½™çš„æ˜¯â€¦â€¦ä¸€äº›å·«æœ¯ï¼Ÿ

ä¸ºäº†ç†è§£è¿™ç§å·«æœ¯ï¼Œè®©æˆ‘ä»¬è¿›è¡Œä¸€ä¸ªç®€å•çš„æ€æƒ³å®éªŒã€‚æƒ³è±¡ä¸€ä¸ªä»¥æ’å®šè§’é€Ÿåº¦æ—‹è½¬çš„æœºæ¢°è‡‚ã€‚è‡‚ä¸Šæ¡ç€ä¸€æ”¯ç¬”ï¼Œç¬”ä¸ä¸€å¼ ç»˜ç”»çº¸æ¥è§¦ã€‚ç¬”æ ¹æ®è¾“å…¥æ³¢å½¢æ²¿è‡‚çš„é•¿åº¦ä¸Šä¸‹ç§»åŠ¨ã€‚

å‡è®¾è‡‚æ¯ç§’å®Œæˆä¸€æ¬¡æ—‹è½¬ï¼Œè¾“å…¥ä¿¡å·æ˜¯è¿è¡Œä¸‰å€é€Ÿï¼ˆ3 Hzï¼‰çš„æ­£å¼¦æ³¢ã€‚åœ¨è¿™ç§è®¾ç½®ä¸‹ï¼Œç¬”å°†æ¯æ¬¡è½¬åŠ¨éƒ½ç”»å‡ºä¸€ä¸ªæ•´é½å±…ä¸­çš„ä¸‰å¶å½¢çŠ¶ï¼š

*è§’é€Ÿåº¦ä¸º1è½¬æ¯ç§’çš„3 Hzä¿¡å·çš„æåæ ‡å›¾ã€‚*

å¦‚æœæ‚¨æ„¿æ„ï¼Œæ‚¨å¯ä»¥åœ¨ä¸‹é¢è§‚çœ‹åŠ¨ç”»ç‰ˆæœ¬ï¼š

åœ¨æŸäº›æƒ…å†µä¸‹â€”â€”ä¾‹å¦‚ï¼Œå¦‚æœä¿¡å·çš„é¢‘ç‡ä½äºæ—‹è½¬è‡‚çš„æ—‹è½¬é¢‘ç‡â€”â€”å¯èƒ½éœ€è¦å¤šæ¬¡æ—‹è½¬æ‰èƒ½äº§ç”Ÿä¸€ä¸ªé—­åˆå½¢çŠ¶ã€‚ä½†ç»“æœåº”è¯¥æ˜¯ç±»ä¼¼çš„ï¼›ä¾‹å¦‚ï¼Œè¿™æ˜¯ä¸€ä¸ªç»˜åˆ¶äº0.9 Hzä¿¡å·çš„æ¼‚äº®çš„ä¹å¶å›¾æ¡ˆï¼š

*è§’é€Ÿåº¦ä¸º1è½¬æ¯ç§’çš„0.9 Hzæåæ ‡å›¾ï¼ˆå¤šæ¬¡è½¬åŠ¨ï¼‰ã€‚*

å†æ¬¡ï¼Œæ‚¨å¯ä»¥åœ¨ä¸‹é¢è§‚çœ‹åŠ¨ç”»ï¼š

è¿™ç§å¾„å‘å¯¹ç§°æ€§åœ¨é™¤äº†ä¸€ä¸ªç‰¹æ®Šæƒ…å†µå¤–çš„æ¯æ¬¡å‡ºç°ï¼šå½“æ—‹è½¬è‡‚çš„é€Ÿåº¦ä¸æ­£å¼¦æ³¢å½¢çš„å‘¨æœŸåŒ¹é…æ—¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ³¢å½¢çš„å³°å§‹ç»ˆåœ¨å›¾çš„ä¸€ä¾§ï¼Œè€Œè°·å§‹ç»ˆåœ¨å¦ä¸€ä¾§ã€‚

*1 Hzä¿¡å·@ 1è½¬/ç§’ã€‚*

æ ¹æ®è¾“å…¥æ³¢å½¢çš„ç›¸ä½ï¼Œå½¢çŠ¶å¯èƒ½ä¼šæ—‹è½¬ï¼Œä½†ä¸€ä¾§å§‹ç»ˆçªå‡ºã€‚

å¥‡è¿¹èˆ¬åœ°ï¼Œè¿™ä¹Ÿé€‚ç”¨äºç”±å åŠ æ­£å¼¦æ³¢ç»„æˆçš„å¤åˆä¿¡å·ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å–ä¸€ä¸ª1 + 5 Hzä¿¡å·ï¼Œå½“ä»¥1 Hzæˆ–5 Hzæ—‹è½¬çš„è‡‚ç»˜åˆ¶æ—¶ä¼šåç¦»ä¸­å¿ƒï¼Œä½†åœ¨2 Hzå¤„ä¼šæ˜¾å¾—å±…ä¸­ï¼š

*è§£æ„å¤åˆä¿¡å·ã€‚*

æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç›¸å½“å·§å¦™çš„*é¢‘ç‡æ£€æµ‹å™¨ï¼š*æˆ‘ä»¬è®¾ç½®æ—‹è½¬è‡‚çš„é€Ÿåº¦ï¼Œç»˜åˆ¶æ ·æœ¬â€”â€”å¦‚æœç»“æœåœ¨ï¼ˆ0,0ï¼‰å‘¨å›´ä¸å‡åŒ€åˆ†å¸ƒï¼Œæˆ‘ä»¬çŸ¥é“è¾“å…¥ä¿¡å·ä¸­å­˜åœ¨åŒ¹é…çš„æ­£å¼¦é¢‘ç‡åˆ†é‡ã€‚é€šè¿‡æµ‹é‡å½¢çŠ¶åç¦»æ—‹è½¬ä¸­å¿ƒçš„åå·®ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥é‡åŒ–è¯¥åˆ†é‡çš„å¹…åº¦ã€‚

ç¦»æ•£å‚…é‡Œå¶å˜æ¢å½’ç»“ä¸ºè¿™ä¸ªç¡®åˆ‡çš„æ“ä½œã€‚å®ƒæ¥å—è¾“å…¥çª—å£ä¸­çš„ *N* ä¸ªå€¼çš„åºåˆ—ï¼Œå¹¶åœ¨ç»™å®šé€Ÿåº¦ä¸‹å°†å®ƒä»¬å¾„å‘åˆ†å¸ƒåœ¨äºŒç»´ç©ºé—´ä¸­ï¼Œå®Œæˆ *k* æ¬¡æ—‹è½¬ã€‚ç„¶åå¯¹ç”Ÿæˆçš„åæ ‡ï¼ˆâˆ‘ éƒ¨åˆ†ï¼‰æ±‚å’Œã€‚ä»æ—‹è½¬ä¸­å¿ƒåˆ°è®¡ç®—ä¸­ç‚¹çš„è·ç¦»æ˜¯è®¡ç®—é¢‘ç‡åˆ†é‡çš„å¹…åº¦ï¼›å‘é‡çš„è§’åº¦æ˜¯æ³¢å½¢çš„ï¼ˆæœ‰æ—¶è¢«å¿½ç•¥çš„ï¼‰ç›¸ä½ã€‚è¯·æ³¨æ„ï¼Œä¸€äº›åœ¨çº¿èµ„æºï¼ŒåŒ…æ‹¬ä¸€ä¸ªæå…¶æµè¡Œçš„YouTubeè§†é¢‘ï¼Œé”™è¯¯åœ°å£°æ˜ *x* è½´åˆ†é‡æ˜¯å¹…åº¦ï¼›è¿™æ˜¯ä¸æ­£ç¡®çš„ã€‚

è¿™ç§ç®—æ³•å¯ä»¥ç”¨æåæ ‡ â€” è§’åº¦å’Œè·ç¦» â€” å®ç°ï¼Œæ¨¡ä»¿æˆ‘ä»¬ä¸Šé¢æ‰€åšçš„ã€‚å®ƒå¯ä»¥ç”¨ç¬›å¡å°” *x,y* åæ ‡å¯¹å’Œç®€å•çš„ä¸‰è§’æ³•å®Œæˆã€‚åœ¨æœ¬èŠ‚å¼€å§‹å¼•ç”¨çš„å®šä¹‰ä¸­ï¼Œå®ƒç”¨ä¸€ç§æœ€æ™¦æ¶©çš„æ–¹å¼å®ç° â€” é€šè¿‡ä¸€ä¸ªç§°ä¸º [æ¬§æ‹‰å…¬å¼](https://en.wikipedia.org/wiki/Euler%27s_formula) çš„å¥‡ç‰¹è®¾å¤‡ â€” ä½†æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯ç­‰æ•ˆçš„ã€‚*e^(-i2Ï€kn/N)* éƒ¨åˆ†ä»…ä»…æ˜¯é€šè¿‡åˆ©ç”¨è¿™ä¸ªæƒŠäººçš„ç›¸ç­‰æ€§åœ¨å¤å¹³é¢ä¸­æ—‹è½¬äº‹ç‰©çš„è£…ç½®ï¼š

\(e^{it} = cos \ t + i \cdot sin \ t\)

å¦‚æœä½ å¯¹å¤æ•°ä¸ç†Ÿæ‚‰ï¼Œ*i* éƒ¨åˆ†ï¼ˆ*i = âˆš-1*ï¼‰æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°å­¦æŠ€å·§ï¼Œç”¨äºåœ¨å•ä¸ªæ–¹ç¨‹ä¸­ä¿æŒä¸¤ä¸ªå€¼çš„è·ç¦»ã€‚ä¸ºäº†é¿å…å®ƒï¼ŒDFTå…¬å¼å¯ä»¥ä½¿ç”¨ä¸€å¯¹åˆ†ç¦»çš„ç¬›å¡å°”åæ ‡ â€” ï¼ˆ*x, y*ï¼‰è¿›è¡Œé‡å†™ï¼š

\(F_k =\Biggl ( { \sum\limits_{n=0}^{N-1} s_n \cdot cos ( 2 \pi k \frac{n}{N} )}, \ - { \sum\limits_{n=0}^{N-1} s_n \cdot sin( 2 \pi k \frac{n}{N} )} \Biggl )\)

è¿™ç§è¡¨ç¤ºæ³•åº”è¯¥æ›´å®¹æ˜“è§£æï¼š*2Ï€* éƒ¨åˆ†ç­‰åŒäºä»¥å¼§åº¦è¡¨ç¤ºçš„360Â°ï¼›*k* æ˜¯æˆ‘ä»¬æƒ³è¦åœ¨æ ·æœ¬ä¸­ä½¿ç”¨çš„è½¬æ•°ï¼›è€Œ *n/N* ç¡®å®šäº†æ¯ä¸ªæ ·æœ¬åœ¨è¿™äº› *k* è½¬ä¸­çš„ä½ç½®ã€‚åŒæ—¶ï¼Œ*x = cos(t)* å’Œ *y = sin(t)* åªæ˜¯ç»˜åˆ¶åœ†çš„æ–¹æ³•ã€‚

DFTçš„åŸºæœ¬å®ç°å¾ˆç®€å•ï¼›ä¾‹å¦‚ï¼Œåœ¨Cä¸­ï¼Œä½ åªéœ€ä»¥ä¸‹ä»£ç ï¼š

> ```
> void dft(complex* out_buf, complex* in_buf, uint32_t len) {
> 
>   for (uint32_t bin_no = 0; bin_no < len; bin_no++) {
>     complex sum = 0;
>     for (uint32_t s_no = 0; s_no < len; s_no++)
>       sum += in_buf[s_no] * cexp(-2 * I * M_PI * bin_no * s_no / len);
>     out_buf[bin_no] = sum;
>   }
> 
> }
> ```

ä»£ç æ¥å—å’Œè¾“å‡ºå¤æ•°ï¼›å¯¹äºå®æ•°è¾“å…¥ï¼Œ*in_buf* å¯ä»¥æ”¹ä¸º *double**ã€‚è¦å°†ç»“æœçš„å¤æ•°ç³»æ•°è½¬æ¢ä¸ºå¹…åº¦ï¼Œè°ƒç”¨ *cabs()*ã€‚è¦è·å–ç›¸ä½ä¿¡æ¯ï¼ˆä»¥å¼§åº¦è¡¨ç¤ºï¼‰ï¼Œä½¿ç”¨ *carg()*ã€‚

ä»¥æœ€å¤§é¢‘ç‡èŒƒå›´å¼€å§‹ã€‚å¦‚æœè¾“å…¥æ•°æ®ç”±å®æ•°ç»„æˆï¼ŒDFTä»…åœ¨æ‰€è°“çš„å¥ˆå¥æ–¯ç‰¹é¢‘ç‡ä¸Šäº§ç”Ÿæœ‰ç”¨çš„è¾“å‡º â€” å³é‡‡æ ·ç‡çš„ä¸€åŠã€‚æ­¤é¢‘ç‡æˆåˆ†å¯åœ¨*k = N/2*çš„ç®±ä¸­æ‰¾åˆ°ã€‚é‚£äº›ç³»æ•°å¯ä»¥è®¡ç®—ï¼Œæœ‰æ—¶éœ€è¦è®¡ç®— â€” ä½†æˆ–è®¸æœ‰äº›ä»¤äººæƒŠè®¶ï¼Œå®ƒä»¬åªåŒ…å«ä»è¾ƒä½é¢‘ç‡ç®±ä¸­é•œåƒçš„æ•°æ®ã€‚

è¦ç†è§£ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œè¯·è€ƒè™‘æˆ‘ä»¬æ—‹è½¬è‡‚çš„ä»¥ä¸‹åŠ¨ç”»ã€‚åœ¨è§†é¢‘ä¸­ï¼Œè‡‚çš„æ—‹è½¬é€Ÿåº¦ç›¸å¯¹äºè¾“å…¥é‡‡æ ·ç‡éå¸¸å¿«ï¼Œä»¥è‡³äºè¿ç»­çš„æ ·æœ¬é—´éš”è¶…è¿‡äº†180Â°ã€‚å®é™…ä¸Šï¼Œè§’è·ç¦»ä¸º330Â°ï¼Œè¿™è¡¨æ˜æˆ‘ä»¬ä»¥æ¥è¿‘è¾“å…¥é‡‡æ ·ç‡çš„çº¦92%è¿è¡ŒDFTï¼š

è§‚çœ‹è§†é¢‘åï¼Œåº”è¯¥æ¸…æ¥šï¼Œæœ€ç»ˆç»“æœä¸ç”±ä¸€ä¸ªè½¬é€Ÿè¾ƒæ…¢çš„è‡‚åœ¨ç›¸åæ–¹å‘æ—‹è½¬æ‰€äº§ç”Ÿçš„ç»“æœç›¸åŒã€‚

ç³»æ•°é•œåƒè¡Œä¸ºæ˜¯DFTç®—æ³•çš„ä¸€ä¸ªå‰¯ä½œç”¨ï¼Œä½†æ˜¯å¥ˆå¥æ–¯ç‰¹é¢‘ç‡æœ¬èº«å¹¶ä¸æ˜¯ã€‚è¿™æ˜¯ä¿¡å·é‡‡æ ·æŠ€æœ¯çš„åŸºæœ¬å¸¦å®½é™åˆ¶ï¼šåœ¨å…¶ä¸Šæ–¹ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„æ ·æœ¬å¯é åœ°åˆ†è¾¨é¢‘ç‡ã€‚å¥ˆå¥æ–¯ç‰¹é™åˆ¶æ˜¯éŸ³ä¹é€šå¸¸ä»¥çº¦44åƒèµ«å½•åˆ¶çš„åŸå› ï¼Œå³ä½¿æˆ‘ä»¬çš„å¬è§‰åªèƒ½è¾¾åˆ°å¤§çº¦20åƒèµ«ï¼ˆè€Œä¸”åªæ˜¯åœ¨å¥½çš„æƒ…å†µä¸‹ï¼‰ã€‚

DFTçš„å¦ä¸€ä¸ªé™åˆ¶ä¸é¢‘ç‡åˆ†ç¦»æœ‰å…³ã€‚ä¸€ä¸ªèƒ½å¤Ÿä½¿ç”¨æ— é™é•¿æ ·æœ¬çª—å£çš„ç¦»æ•£å‚…é‡Œå¶å˜æ¢å°†å…·æœ‰å®Œç¾çš„é€‰æ‹©æ€§ â€” ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå°†èƒ½å¤Ÿç²¾ç¡®åœ°åŒºåˆ†æ‰€é€‰æ‹©çš„é¢‘ç‡ï¼ŒåŒæ—¶æ’æ–¥å…¶ä»–ä¸€åˆ‡ã€‚å®é™…ä¸Šï¼ŒDFTåœ¨æœ‰é™çš„æ ·æœ¬çª—å£ä¸Šè¿è¡Œï¼Œå¯¼è‡´æ¯ä¸ªé¢‘æ®µæ•æ‰åˆ°é¢å¤–çš„ä¸œè¥¿ã€‚

è¦ç†è§£åŸå› ï¼Œè®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æ­£åœ¨è¿›è¡ŒDFTï¼Œæ¯éš”ä¸‰èµ«å…¹ä¸€ä¸ªé¢‘æ®µ â€” å³ï¼Œ*F[0]* æ˜¯ç›´æµåˆ†é‡ï¼Œ*F[1]* æ˜¯3èµ«å…¹ï¼Œ*F[2]* æ˜¯6èµ«å…¹ã€‚ *F[1]* é¢‘æ®µæ€»æ˜¯é€šè¿‡å®Œæˆå•ä¸ªè½¬åŠ¨è®¡ç®—å¾—å‡ºï¼ˆæ—¶é—´è¡¨è¾¾å¼ä¸º *k Ã— 2Ï€*ï¼Œ*k = 1*ï¼‰ã€‚ä½†æ˜¯ï¼Œå¯¹äºè¾“å…¥ä¿¡å·é¢‘ç‡ä¸º2èµ«å…¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸‰æ¬¡è½¬åŠ¨æ‰èƒ½å½¢æˆä¸€ä¸ªé—­åˆå½¢çŠ¶ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬æ—¶é—´ä¸å¤Ÿ â€” å¹¶ä¸”åœ¨ç»˜åˆ¶äº†ä¸€ä¸ªåç¦»ä¸­å¿ƒçš„æ³¢å½¢åï¼Œæˆ‘ä»¬çš„è¾“å…¥æ ·æœ¬ä¹Ÿä¸å¤Ÿç”¨ï¼š

*DFTçš„é™åˆ¶ï¼šä¸€ä¸ªé è¿‘F[1]é¢‘æ®µçš„é™„è¿‘é¢‘ç‡æ¸—å…¥ã€‚*

å®é™…ä¸Šï¼Œåªæœ‰ä¸¤ä¸ªé¢‘ç‡éå¸¸æ¥è¿‘æ—¶ï¼Œç»˜å›¾æ‰ä¼šä¸¥é‡åç¦»ä¸­å¿ƒã€‚ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨ä¸€ç³»åˆ—è¾“å…¥ä¿¡å·ä¸­çš„3èµ«å…¹ *F[1]* é¢‘æ®µçš„åŠ¨ç”»ã€‚è§‚å¯Ÿè®¡ç®—å‡ºçš„è“ç‚¹ï¼Œå®ƒè·Ÿè¸ªå½¢çŠ¶çš„â€œé‡å¿ƒâ€ â€” å› æ­¤é•œåƒäº†ç»“æœçš„DFTç³»æ•°ã€‚

äº‹å®è¯æ˜ï¼Œåœ¨å¤§çº¦æ¯ä¸ªé¢‘æ®µæ­¥é•¿çš„æ­£è´Ÿ75%å†…ï¼Œåå·®éå¸¸æ˜¾è‘—ã€‚åœ¨è¾ƒä½é¢‘ç‡ä¸‹ï¼Œéƒ¨åˆ†å½¢çŠ¶éå¸¸æ¥è¿‘åœ†å½¢ï¼›åœ¨æ›´é«˜çš„ä¿¡å·ç‡ä¸‹ï¼Œå®ƒå…·æœ‰è¶³å¤Ÿå¯¹ç§°çš„æ³¢ç“£ï¼Œç¼ºå¤±éƒ¨åˆ†ä¸ä¼šå¯¹å¹³è¡¡äº§ç”Ÿå¤ªå¤§å½±å“ã€‚

æˆ‘ä»¬å¯ä»¥æ›´ä¸¥æ ¼åœ°æµ‹é‡è¿™ä¸€ç‚¹ã€‚ä»¥ä¸‹å›¾æ˜¾ç¤ºäº†å‡ ä¸ª1èµ«å…¹é—´éš”é¢‘æ®µæ‰€æœ‰å¯èƒ½ä¿¡å·ç›¸ä½çš„å¹³å‡é¢‘ç‡å“åº”ï¼š

*çœŸå®ä¸–ç•Œçš„DFTé¢‘æ®µå“åº”ã€‚*

é‡å æ„å‘³ç€æ ‡å‡†çš„ DFT bin é›†åˆæœ€ç»ˆå æ®äº†ä» DC åˆ° Nyquist çš„æ•´ä¸ªé¢‘è°±ã€‚æ²¡æœ‰ä»€ä¹ˆèƒ½é˜»æ­¢æˆ‘ä»¬ä¸ºä»»ä½•éæ•´æ•°*k*è®¡ç®—ç‰¹å®šçš„ ad-hoc DFT ç³»æ•°ï¼Œä½†è¿™äº›â€œéƒ¨åˆ†æ—‹è½¬â€ bin å¹¶ä¸ä»ç³»ç»Ÿä¸­æå–ä»»ä½•æ–°çš„ã€æ›´ç²¾ç»†çš„ä¿¡æ¯ã€‚å¦‚æœéœ€è¦æ›´å¥½çš„é¢‘ç‡åŒºåˆ†èƒ½åŠ›ï¼Œå¿…é¡»å¢åŠ çª—å£å¤§å°ã€‚

è¿™å°†å¸¦æˆ‘ä»¬åˆ°æ—¶é—´åˆ†è¾¨ç‡ã€‚å•ä¸ª DFT æ“ä½œä¸ºæ•´ä¸ªè¾“å…¥æ³¢å½¢è¾“å‡ºé¢‘ç‡ç³»æ•° â€”â€” ä»…æ­¤è€Œå·²ã€‚åœ¨å®ƒæ‰€è¦†ç›–çš„æ—¶é—´æ®µå†…ï¼Œæˆ‘ä»¬ä¸å†å®¹æ˜“ç¡®å®šç‰¹å®šéŸ³è°ƒçš„èµ·å§‹æˆ–ç»“æŸæ—¶é—´ï¼Œæˆ–è€…å®ƒçš„å¼ºåº¦æ˜¯ä¸Šå‡è¿˜æ˜¯ä¸‹é™ã€‚ç¡®å®ï¼Œåœ¨æ³¢å½¢ä¸­çš„å°–é”ä¿¡å·ä¸è¿ç»­æ€§ä¼šäº§ç”Ÿéš¾ä»¥è§£é‡Šä¸ºä»»ä½•ç‰¹å®šé¢‘ç‡çš„å¹¿è°±â€œå…‰æ™•â€ã€‚æ—¶é—´åŸŸä¿¡å·è¶Šå±€éƒ¨åŒ–ï¼Œå…¶é¢‘åŸŸå›¾åƒå°±è¶Šæ¨¡ç³Šã€‚

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå£°è°±å›¾å°†ä¿¡å·åˆ†æˆçŸ­æ—¶é—´ç‰‡æ®µï¼Œå¹¶ä¸ºæ¯ä¸ªç‰‡æ®µè®¡ç®—å•ç‹¬çš„å˜æ¢ï¼Œè€Œä¸æ˜¯ä¸ºæ•´ä¸ªç¼“å†²åŒºæ‰§è¡Œä¸€ä¸ª DFTã€‚ä½†æ˜¯è¿™äº›ç‰‡æ®µä¸èƒ½ä»»æ„çŸ­ï¼šè‡³å°‘ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨è¶³å¤Ÿå¤§çš„çª—å£ï¼Œä½¿å¾—åº•éƒ¨é¢‘ç‡*F[1]*ä¸æ‚¨å¸Œæœ›åˆ†è¾¨çš„æœ€ä½é¢‘ç‡å¯¹é½ã€‚ä¸¾ä¾‹è¯´æ˜ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ª 44.1 kHz çš„éŸ³é¢‘æµï¼Œå¹¶ä¸”æƒ³è¦æµ‹é‡åˆ° 20 Hzï¼Œé‚£ä¹ˆæ‚¨éœ€è¦æ¯ä¸ª DFT ä½¿ç”¨ 2,205 ä¸ªæ ·æœ¬çš„çª—å£ï¼Œå³ 50 æ¯«ç§’çš„è·¨åº¦ã€‚

åœ¨ 50 æ¯«ç§’å†…å‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ï¼›å› æ­¤ï¼Œä¸ºäº†åœ¨æŸäº›åº”ç”¨ç¨‹åºä¸­è·å¾—å¯æ¥å—çš„æ—¶é—´åˆ†è¾¨ç‡ï¼Œå¯èƒ½éœ€è¦é‡‡å–å„ç§å˜é€šæ–¹æ³•ï¼Œå¦‚ä½¿ç”¨é‡å çª—å£ã€åŠ æƒé‡‡æ ·æˆ–ä¸“é—¨çš„æ··æ·†æ–¹æ³•ã€‚éŸ³é¢‘å¤„ç†å¾€å¾€æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚

ç¦»æ•£å‚…é‡Œå¶é€†å˜æ¢åœ¨æ¦‚å¿µä¸Šå¾ˆç®€å•ã€‚å®ƒå½’ç»“ä¸ºä¸ºä»¥å‰è®¡ç®—è¿‡çš„æ¯ä¸ªé¢‘ç‡ bin ç”Ÿæˆæ³¢å½¢ï¼Œæ ¹æ® DFT äº§ç”Ÿçš„*F[k]*ç³»æ•°è°ƒæ•´å®ƒä»¬çš„å¹…åº¦å’Œç›¸ä½ï¼Œç„¶åå°†ç»“æœç›¸åŠ ä»¥é‡æ–°åˆ›å»ºæ—¶é—´åŸŸæ ·æœ¬çª—å£(*s[0]* åˆ° *s[N-1]*)çš„å†…å®¹ã€‚

è¿™é‡Œæ˜¯æ‰§è¡Œæ­¤æ“ä½œçš„ IDFT å…¬å¼ï¼š

\(s_n = \frac{1}{N} { \sum\limits_{k=0}^{N-1} F_k \cdot e^{i{{2 \pi n \frac{k}{N} }}} } \)

è¯·æ³¨æ„ï¼Œè¿™ä¸ªæ–¹ç¨‹ä¸å‰å‘ DFT å…¬å¼éå¸¸ç›¸ä¼¼ã€‚åœ¨ç®—æ³•çš„æ ¸å¿ƒï¼Œè¾“å…¥å’Œè¾“å‡ºä¹‹é—´å­˜åœ¨é‡è¦çš„å¯¹ç§°æ€§ï¼›è¿™è¢«ç§°ä¸º*æ­£äº¤æ€§*ã€‚åœ¨æŸç§ç•¥å¸¦ä»¤äººè´¹è§£çš„æ„ä¹‰ä¸Šï¼Œé¢‘åŸŸåªæ˜¯æ—¶é—´åŸŸè¢«â€œé‡Œå¤–é¢ å€’â€ã€‚

è¿™é‡Œæ˜¯ C è¯­è¨€ä¸­ç®€å•çš„ IDFT å®ç°ï¼š

> ```
> void idft(complex* out_buf, complex* in_buf, uint32_t len) {
> 
>   for (uint32_t s_no = 0; s_no < len; s_no++) {
>     complex sum = 0;
>     for (uint32_t bin_no = 0; bin_no < len; bin_no++)
>       sum += in_buf[bin_no] * cexp(2 * I * M_PI * s_no * bin_no / len);
>     out_buf[s_no] = sum / len;
>   }
> 
> }
> ```

å°±åƒä¹‹å‰ä¸€æ ·ï¼Œå¦‚æœå¤„ç†å®æ•°ä¿¡å·ï¼Œ*out_buf* å¯ä»¥å£°æ˜ä¸º*double**ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå‰å‘ DFT åæ¥ IDFT æ˜¯æ— æŸçš„ â€” å³ï¼Œå®ƒä¼šå¾—åˆ°ä¸å¼€å§‹æ—¶ç›¸åŒçš„æ—¶é—´åŸŸæ•°æ®ã€‚åœ¨å®è·µä¸­ï¼Œéœ€è¦æ³¨æ„æµ®ç‚¹è¿ç®—çš„ç²¾åº¦ï¼Œä»¥é¿å…ç´¯ç§¯è¯¯å·®ï¼Œä½†è¿™é€šå¸¸ä¸æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ã€‚

DFTæ˜¯å®Œå…¨é€‚åˆçš„ï¼Œé™¤äº†ä¸€ä¸ªå¾®å°çš„é—®é¢˜ï¼šå³ä½¿æˆ‘ä»¬é¢„å…ˆè®¡ç®—äº†æŒ‡æ•°éƒ¨åˆ†ï¼Œç®—æ³•ä»ç„¶æ¶‰åŠ*K Ã— N*å¤æ•°ä¹˜æ³•ã€‚å› ä¸ºè®¡ç®—çš„ç®±æ•°*K*é€šå¸¸ä¸çª—å£å¤§å°*N*ç›¸åŒï¼Œä¸€äº›å¯¹è®¡ç®—å¤æ‚åº¦çš„è¿·æ‹çš„è®¡ç®—æœºç§‘å­¦çˆ±å¥½è€…å°†DFTçš„è®¡ç®—å¤æ‚åº¦æè¿°ä¸º*O(nÂ²)*ã€‚

è¿™å°±æ˜¯å¿«é€Ÿå‚…é‡Œå¶å˜æ¢ï¼ˆFFTï¼‰å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ï¼›FFTä»ç„¶æ˜¯ç¦»æ•£å‚…é‡Œå¶å˜æ¢ï¼Œå®ƒäº§ç”Ÿç›¸åŒçš„ç»“æœï¼Œä½†è®¡ç®—è¢«å·§å¦™åœ°ä¼˜åŒ–ï¼Œé€‚ç”¨äºå¤§è¾“å…¥çª—å£å’Œ*K = N*ç”¨ä¾‹ï¼ˆè¯¥ç®—æ³•ä¸èƒ½é€‰æ‹©æ€§åœ°è®¡ç®—ä»…ä¸€äº›é¢‘ç‡åˆ†ç®±ï¼‰ã€‚

æ€§èƒ½æå‡å½’åŠŸäºä¸€ç§ç§°ä¸º[radix-2 Cooley-Tukeyç®—æ³•](https://en.wikipedia.org/wiki/Cooley%E2%80%93Tukey_FFT_algorithm)çš„æŠ€æœ¯ã€‚è¿™ç§ä¼˜åŒ–çš„æ¨å¯¼æœ‰ç‚¹å¤æ‚ï¼Œä½†åœ¨é«˜å±‚æ¬¡ä¸Šï¼Œå®ƒæ¶‰åŠå°†å®Œæ•´çš„DFTè®¡ç®—è¿­ä»£åœ°æ‹†åˆ†æˆæ›´å°çš„å­å’Œï¼Œç„¶ååˆ©ç”¨*e^(-i2)*^Ï€*^(kn/N)*è¡¨è¾¾å¼çš„å‘¨æœŸæ€§ â€”â€” å®ƒç¡®å®æ˜¯åœ†å½¢çš„ï¼ â€”â€” æ¥å› å¼åˆ†è§£è®¸å¤šå†—ä½™çš„ä¹˜æ³•ã€‚å¯¹äºæ›´å¤§çš„çª—å£ï¼ŒFFTçš„ç»“æœå¤æ‚åº¦æ¥è¿‘*O(n â‹… logâ‚‚ n)*ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„æ”¹è¿›ã€‚

å‡ ä¹æ¯ç§ç¼–ç¨‹è¯­è¨€éƒ½å­˜åœ¨å¤šç§å‚è€ƒFFTå®ç°ï¼Œ[Fast Fourier Transform](https://rosettacode.org/wiki/Fast_Fourier_transform)ï¼›å¯¹äºäºŒçš„å¹‚çª—å£å¤§å°ï¼Œä¸€ç§ç‰¹åˆ«ç®€æ´ã€æç®€çš„Cè¯­è¨€å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š

> ```
> void __fft_int(complex* buf, complex* tmp, 
>                const uint32_t len, const uint32_t step) {
> 
>   if (step >= len) return;
>   __fft_int(tmp, buf, len, step * 2);
>   __fft_int(tmp + step, buf + step, len, step * 2);
> 
>   for (uint32_t pos = 0; pos < len; pos += 2 * step) {
>     complex t = cexp(-I * M_PI * pos / len) * tmp[pos + step];
>     buf[pos / 2] = tmp[pos] + t;
>     buf[(pos + len) / 2] = tmp[pos] - t;
>   }
> 
> }
> 
> void in_place_fft(complex* buf, const uint32_t len) {
>   complex tmp[len];
>   memcpy(tmp, buf, sizeof(tmp));
>   __fft_int(buf, tmp, len, 1);
> }
> ```

å°†è¿™æ®µä»£ç è½¬æ¢ä¸ºåFFTï¼ˆIFFTï¼‰å¯ä»¥ç®€åŒ–ä¸ºç§»é™¤*cexp(...)*è¡¨è¾¾å¼ä¸­çš„è´Ÿå·ï¼Œå¹¶å°†æœ€ç»ˆå€¼é™¤ä»¥*len*ã€‚

åŒæ ·ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œé¢„è®¡ç®—å¤æ•°æŒ‡æ•°éƒ¨åˆ†çš„ç»“æœæ˜¯æ˜æ™ºçš„ï¼›è¯¥å€¼ä»…å–å†³äº*pos*ç´¢å¼•å’Œé€‰æ‹©çš„çª—å£å¤§å°ã€‚

ç¦»æ•£ä½™å¼¦å˜æ¢å¯ä»¥è¢«çœ‹ä½œæ˜¯ç¦»æ•£å‚…é‡Œå¶å˜æ¢çš„ä¸€ä¸ªéƒ¨åˆ†ã€ä»…é™äºå®æ•°ç‰ˆæœ¬ã€‚å°±åƒç¦»æ•£å‚…é‡Œå¶å˜æ¢ä¸€æ ·ï¼Œå®ƒå°†æ—¶åŸŸæ ·æœ¬è½¬æ¢ä¸ºé¢‘è°±ã€‚è€Œä¸”ä¸ç¦»æ•£å‚…é‡Œå¶å˜æ¢ä¸€æ ·ï¼Œå®ƒé€šè¿‡ä¹˜ä»¥ä½™å¼¦æ³¢å½¢çš„è¾“å…¥æ•°æ®ç„¶åå°†ç»“æœæ±‚å’Œæ¥è·å¾—ä¸€å †åˆ†ç®±ç³»æ•°ã€‚

å°½ç®¡å¦‚æ­¤ï¼Œè¿™ç§æè¿°è¿˜æœ‰äº›ä¸è¶³ï¼›è¿™ä¸ªç®—æ³•ä¸ç¦»æ•£å‚…é‡Œå¶å˜æ¢åœ¨ä¸€äº›æœ‰è¶£çš„æ–¹é¢æœ‰æ‰€ä¸åŒã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹DCT-IIçš„å¸¸è§å…¬å¼ï¼Œè¿™æ˜¯DCTçš„æœ€å¸¸è§å˜ä½“ï¼š

\(F_k = \sum\limits_{n=0}^{N-1} s_n \cdot cos ( \pi k { n + \frac12 \over N} )\)

å¦‚æœä½ å›åˆ°DFTæ–¹ç¨‹ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°åœ¨ä¸Šé¢çš„å…¬å¼ä¸­ï¼Œ*k* è¢«Ï€ï¼ˆ180Â°ï¼‰è€Œä¸æ˜¯2Ï€ï¼ˆ360Â°ï¼‰ç›¸ä¹˜ã€‚å®é™…ä¸Šï¼Œæ³¢å½¢ç”Ÿæˆéƒ¨åˆ†ä½¿ç”¨äº¤æ›¿æ¨¡å¼çš„å®Œæ•´è½¬å‘å’Œéƒ¨åˆ†è½¬å‘é¢‘ç‡åŒºé—´ï¼Œè¿è¡Œåœ¨DFTé¢‘ç‡çš„ä¸€åŠï¼Œå¹¶å°†F[N-1]æ”¾åœ¨å¥ˆå¥æ–¯ç‰¹æé™å¤„ã€‚è¿™ç§å˜åŒ–ä¸ä»…ä»…æ˜¯ä¸ºäº†æ›´é«˜æ•ˆï¼šå¦‚æœä½ å°è¯•å°†æ—¶é—´è¡¨è¾¾å¼åˆ‡æ¢å› *2Ï€*ï¼Œæ•´ä¸ªç®—æ³•å°±ä¼šåç¦»è½¨é“ï¼Œè®¸å¤šé¢‘ç‡åŒºé—´å¼€å§‹è¯»å–é›¶ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è®¨è®ºåŸå› ã€‚

å¦ä¸€ä¸ªæ–°å…ƒç´ æ˜¯æ—¶é—´è¡¨è¾¾å¼ä¸­çš„ *+Â½* åç§»é‡ã€‚è¯·è®°ä½ï¼Œæ ·æœ¬ç¼–å·ä» *n = 0* åˆ° *N - 1*ï¼Œå› æ­¤å°† *n* é™¤ä»¥ *N* ç•™ä¸‹èŒƒå›´ä¸Šç«¯çš„é—´éš™ã€‚+*Â½* çš„åç§»å°†æ³¢å½¢ç½®äºä¸­å¿ƒä½ç½®ï¼›è¿™ç§å¯¹ç§°æ€§å¯¹äºä½¿é€†å‡½æ•°å·¥ä½œéå¸¸é‡è¦ã€‚ç¦»æ•£å‚…é‡Œå¶å˜æ¢ä¸ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå› ä¸ºå®ƒçš„å¯¹ç§°æ€§æ¥è‡ªäºå¤å¹³é¢ä¸­ä½™å¼¦å’Œæ­£å¼¦çš„æ›´åŸºæœ¬å…³ç³»ã€‚

å¸¸è§çš„é€†DCT-IIï¼ˆIDCT-IIï¼‰å…¬å¼ä¸ºï¼š

\(s_n = \frac{1}{N} \sum\limits_{k=0}^{N-1} F_k \cdot w_k \cdot cos [ \pi (n + \frac12) {k \over N} ]\)

*w[k]* å€¼ä¸ºDCé¢‘ç‡åŒºé—´ï¼ˆ*k = 0*ï¼‰ä¸º *1*ï¼Œè€Œæ‰€æœ‰åç»­çš„éƒ¨åˆ†è½¬å‘é¢‘ç‡åŒºé—´ï¼ˆ*k > 0*ï¼‰ä¸º *2*ã€‚ä½ å¯èƒ½ä¼šé‡åˆ°å˜ä½“ï¼Œå°† *w[k]* å’Œç¼©æ”¾å› å­ï¼ˆ*1/N*ï¼‰æ”¾åœ¨æ­£å‘DCTå…¬å¼ä¸­ï¼›ä¸€äº›ä½œè€…åœ¨DCTå’ŒIDCTä¹‹é—´åˆ†å‰²å› å­ã€‚è¿™äº›å˜åŒ–å¯¼è‡´äº†ä¸åŒæ¯”ä¾‹çš„ç³»æ•°ï¼Œä½†æ•´ä½“æ“ä½œæ˜¯ç›¸åŒçš„ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥æ£€éªŒç¦»æ•£ä½™å¼¦å˜æ¢çš„åŸºæœ¬æœºåˆ¶ã€‚å‡è®¾æˆ‘ä»¬æ­£åœ¨å¤„ç†ä»¥2 kHzé‡‡æ ·çš„ä¸€ç§’æ•°æ®ã€‚ä½¿ç”¨DFTï¼Œæˆ‘ä»¬åœ¨è¾¾åˆ°å¥ˆå¥æ–¯ç‰¹æé™ï¼ˆ1 kHzï¼‰ä¹‹å‰å¾—åˆ°N / 2 = 1,000ä¸ªå¯ç”¨çš„é¢‘ç‡åŒºé—´ï¼›é¢‘ç‡åŒºé—´é—´éš”ä¸º1 Hzã€‚ä½¿ç”¨ä½™å¼¦å˜æ¢ï¼Œæˆ‘ä»¬å¾—åˆ°N = 2,000ä¸ªé¢‘ç‡åŒºé—´ï¼Œè¡¨ç¤ºä»DCåˆ°å¥ˆå¥æ–¯ç‰¹çš„0.5 Hzå¢é‡ã€‚

è®©æˆ‘ä»¬é€‰å–4 Hzé¢‘ç‡åŒºé—´ï¼ˆ*F[8]*ï¼‰ã€‚é¦–å…ˆï¼Œè€ƒè™‘ä¸€ä¸‹å¦‚æœæˆ‘ä»¬åˆ†æçš„è¾“å…¥ä¿¡å·è¿è¡Œåœ¨8 Hzæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚å›¾åƒæ˜¾ç¤ºäº†é¢‘ç‡åŒºé—´4 Hzçš„å‚è€ƒæ³¢å½¢ï¼ˆè“è‰²ï¼‰ï¼Œæ¥ç€æ˜¯è¾“å…¥é¢‘ç‡ï¼ˆç»¿è‰²ï¼‰ï¼Œç„¶åæ˜¯ä¸¤è€…çš„ä¹˜ç§¯ï¼ˆçº¢è‰²ï¼‰ã€‚ä¹˜ç§¯ä»¥*x*è½´ä¸ºä¸­å¿ƒï¼Œæ‰€ä»¥DCTç³»æ•°ä¸ºé›¶ï¼š

*DCTï¼šä¸åŒ¹é…çš„é¢‘ç‡ã€‚*

ä½†æ˜¯å¦‚æœé¢‘ç‡ï¼ˆå’Œç›¸ä½ï¼‰åŒ¹é…ä¼šæ€ä¹ˆæ ·ï¼Ÿåœ¨ä¸‹é¢çš„å›¾ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶åœ¨çœ‹*F[8]*é¢‘ç‡åŒºé—´ï¼Œä½†æ˜¯è¾“å…¥ä¿¡å·ç°åœ¨ä¸4 Hzå¯¹é½ã€‚ä¹˜ç§¯æ€»æ˜¯æ¶‰åŠä¸¤ä¸ªæ­£å€¼æˆ–ä¸¤ä¸ªè´Ÿå€¼ï¼Œæ‰€ä»¥ä¹˜ç§¯æ³¢å½¢ç°åœ¨æœ‰ä¸€ä¸ªæ­£çš„æ€»å’Œï¼š

*åŒ¹é…é¢‘ç‡å’Œç›¸ä½æ—¶çš„DCTè¡Œä¸ºã€‚*

å¦‚æœä¿¡å·çš„ç›¸ä½åç§»åŠä¸ªå‘¨æœŸï¼ˆ180Â°ï¼‰ï¼Œç¦»æ•£ä½™å¼¦å˜æ¢ä»ç„¶æœ‰æ•ˆ â€”â€” åªæ˜¯è¯»æ•°æ˜¯è´Ÿæ•°ã€‚

é‰´äºè¿™é‡Œè§‚å¯Ÿåˆ°çš„è¡Œä¸ºï¼Œäººä»¬å¯èƒ½ä¼šæƒ³çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å‚ä¸æ‰€æœ‰ä¸çœŸå® DFT ç›¸å…³çš„å¤æ•°æ‰‹æ³•ã€‚å¦‚æœæˆ‘ä»¬è€ƒè™‘ 90Â° æˆ– 270Â° çš„ç›¸ä½åç§»ï¼ˆæ³¢é•¿çš„å››åˆ†ä¹‹ä¸€æˆ–å››åˆ†ä¹‹ä¸‰ï¼‰ï¼Œç­”æ¡ˆæ˜¾è€Œæ˜“è§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»»ä½•å¯æ£€æµ‹åˆ°çš„ä¹˜ç§¯æ³¢å½¢åç§»éƒ½ä¼šç®€å•æ¶ˆå¤±ï¼Œ*F[8]* ç³»æ•°å°½ç®¡å­˜åœ¨åŒ¹é…çš„ä¿¡å·é¢‘ç‡å´ä¸ºé›¶ï¼š

*DCT ç¬¬ 8 ä¸ªé¢‘æ®µçš„ç›¸ä½é”™ä½é—®é¢˜ã€‚*

åŸå§‹å‚…é‡Œå¶å˜æ¢åœ¨å¤„ç†è¿™ç§æƒ…å†µæ—¶æ²¡æœ‰é—®é¢˜ï¼›åœ¨ 90Â° æ—¶ï¼ŒDFT å‘é‡æŒ‡å‘ä¸Šï¼Œä¿¡å·çš„å¤§å°ä»…ç”±è™šéƒ¨ï¼ˆå³ *y* åæ ‡ï¼‰è¡¨ç¤ºã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨ç¦»æ•£ä½™å¼¦å˜æ¢ä¸­ï¼Œè™šéƒ¨ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬åœ¨é¢„æœŸçš„é¢‘æ®µä¸­æ²¡æœ‰ä»»ä½•æ³¨å†Œã€‚

æ­¤æ—¶ï¼Œä½ å¯èƒ½ä¼šæƒ³çŸ¥é“æ˜¯å¦å¯ä»¥ç®€å•åœ°ä¸¢å¤±ä¸å¯¹é½çš„ä¿¡å·ã€‚ç­”æ¡ˆæ˜¯å¦å®šçš„ â€” DCT çš„å¦™å¤„åœ¨äºï¼Œä¸ç›¸ä½çš„æ•°æ®æœ€ç»ˆä¼šå‡ºç°åœ¨é™„è¿‘çš„â€œéƒ¨åˆ†è½¬åŠ¨â€é¢‘æ®µä¸­ï¼Œè¿™åœ¨æ­£å¸¸çš„ DFT ä¸­æ˜¯ä¸è®¡ç®—çš„ã€‚ç»§ç»­æˆ‘ä»¬çš„ç›¸ä½åç§»ä¸º 4 Hz çš„é—®é¢˜ä¿¡å·ç‰¹å¾ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä¸‹ä¸€ä¸ªé¢‘æ®µ â€” *F[9]* åœ¨ 4.5 Hzï¼š

*DCT éƒ¨åˆ†è½¬åŠ¨é¢‘æ®µæ­£åœ¨å‘æŒ¥ä½œç”¨ã€‚*

å¦‚æœä½ ä»å±€éƒ¨è§†è§’æ¥çœ‹ï¼Œä¿¡å·åœ¨å¼€å§‹æ—¶å‡ºç°äº† 90Â° çš„ç›¸ä½åç§»ï¼›åœ¨ä¸­é—´ä¼¼ä¹çªç„¶æ¢å¤äº†ç›¸ä½ï¼›ç„¶ååœ¨ç»“å°¾å¤„åˆå‡ºç°äº† -90Â° çš„ç›¸ä½åç§»ã€‚åœ¨è¿™ä¸ªâ€œéƒ¨åˆ†è½¬åŠ¨â€é¢‘æ®µçš„æµ‹é‡çª—å£å†…ï¼Œå¹³å‡ä¹˜ç§¯ä¸ºæ­£ã€‚å¦‚æœæˆ‘ä»¬è¿›å…¥ä¸‹ä¸€ä¸ªâ€œå®Œæ•´è½¬åŠ¨â€é¢‘æ®µï¼ˆ5 Hzï¼‰ï¼Œæ³¢å½¢çš„ä¹˜ç§¯å†æ¬¡å˜ä¸ºé›¶ã€‚

æ¢å¥è¯è¯´ï¼ŒDCT é¢‘æ®µç¼–ç äº†å¹…åº¦ **å’Œ** ç›¸ä½ä¿¡æ¯ï¼Œåªæ˜¯ä¸æ€»æ˜¯åœ¨æˆ‘ä»¬æœŸæœ›çš„åœ°æ–¹ã€‚è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆå˜æ¢éœ€è¦ä¸¤å€çš„é¢‘æ®µ â€” ä»¥åŠä¸ºä»€ä¹ˆè¯•å›¾å¢åŠ å®ƒä»¬çš„é—´è·ä»¥åŒ¹é… DFT ä¼šç ´åç®—æ³•ã€‚

è¿™ç§æ··ä¹±çš„ç¼–ç æ–¹æ¡ˆä½¿å¾—ç¦»æ•£ä½™å¼¦å˜æ¢å¯¹äºå¤§å¤šæ•°ä¿¡å·åˆ†æä»»åŠ¡è€Œè¨€æ˜¯ä¸€ä¸ªç›¸å½“å·®çš„å·¥å…·ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒå¯¹äºå¿«é€Ÿã€ç©ºé—´é«˜æ•ˆçš„å‹ç¼©ç®—æ³•éå¸¸æœ‰ç”¨ï¼Œåœ¨é¢‘åŸŸè¡¨ç¤ºçš„ç¾å­¦ä¸é‚£ä¹ˆé‡è¦çš„æƒ…å†µä¸‹å°¤ä¸ºå¦‚æ­¤ã€‚ä¸€ä¸ªç»å…¸çš„ä¾‹å­å°±æ˜¯ JPEG å›¾åƒæ ¼å¼ï¼Œå®ƒå¯¹ 8Ã—8 åƒç´ å—è¿›è¡Œ DCTï¼Œç„¶åå¯¹è®¡ç®—å‡ºçš„ç³»æ•°è¿›è¡Œé‡åŒ–ï¼ˆå³é™ä½ç²¾åº¦ï¼‰ï¼Œä»¥ä¾¿ä½¿ç”¨ä¼ ç»Ÿçš„æ— æŸå‹ç¼©ï¼ˆå“ˆå¤«æ›¼ç¼–ç ï¼‰æ›´å®¹æ˜“åœ°å‹ç¼©ã€‚

å“¦ï¼Œå¦‚æœä½ å¸Œæœ›å°è¯• DCT-IIï¼Œä¸‹é¢åŒ…å«äº†ä¸€ä¸ªç®€å•çš„å®ç°ï¼š

> ```
> `void dct(double* out_buf, double* in_buf, uint32_t len) {
> 
>   for (uint32_t bin_no = 0; bin_no < len; bin_no++) {
>     double sum = 0;
>     for (uint32_t s_no = 0; s_no < len; s_no++)
>       sum += in_buf[s_no] * cos(M_PI * bin_no * (s_no + 0.5) / len);
>     out_buf[bin_no] = sum;
>   }
> 
> }
> 
> void idct(double* out_buf, double* in_buf, uint32_t len) {
> 
>   for (uint32_t s_no = 0; s_no < len; s_no++) {
>     double sum = 0;
>     for (uint32_t bin_no = 0; bin_no < len; bin_no++)
>       sum += in_buf[bin_no] * cos(M_PI * (s_no + 0.5) * bin_no / len) *
>              (bin_no ? 2 : 1);
>     out_buf[s_no] = sum / len;
>   }
> 
> }`
> ```

æƒ³çœ‹ä¸€ä¸ªè’è°¬ä½†æœ‰è¶£çš„æ¼”ç¤ºï¼Ÿçœ‹çœ‹ [è¿™ç¯‡æ–‡ç« ](https://lcamtuf.substack.com/p/afternoon-project-jpeg-dct-text-lossifizer)ï¼Œè®©ä½ äº†è§£å¦‚æœå°†æ–‡æœ¬åº”ç”¨ JPEG é£æ ¼çš„æœ‰æŸå‹ç¼©ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

*
