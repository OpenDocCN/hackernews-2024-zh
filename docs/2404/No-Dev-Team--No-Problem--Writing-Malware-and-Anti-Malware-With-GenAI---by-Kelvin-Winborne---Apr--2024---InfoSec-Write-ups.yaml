- en: <!--yml
  prefs: []
  type: TYPE_NORMAL
- en: 'category: 未分类'
  prefs: []
  type: TYPE_NORMAL
- en: 'date: 2024-05-27 13:39:47'
  prefs: []
  type: TYPE_NORMAL
- en: -->
  prefs: []
  type: TYPE_NORMAL
- en: 'No Dev Team? No Problem: Writing Malware and Anti-Malware With GenAI | by Kelvin
    Winborne | Apr, 2024 | InfoSec Write-ups'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 来源：[https://infosecwriteups.com/no-dev-team-no-problem-writing-malware-and-anti-malware-with-genai-cbce13160e13?gi=1ae1a8ad0126](https://infosecwriteups.com/no-dev-team-no-problem-writing-malware-and-anti-malware-with-genai-cbce13160e13?gi=1ae1a8ad0126)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'No Dev Team? No Problem: Writing Malware and Anti-Malware With GenAI'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Human-free security software development for both sides of the fence.
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Source: Image generated by Microsoft Copilot.'
  prefs: []
  type: TYPE_NORMAL
- en: Depending on what you read, from where, and from whom, software engineering
    jobs are in jeopardy, have nothing to worry about, or can even be *enhanced* by
    generative AI.
  prefs: []
  type: TYPE_NORMAL
- en: There are even companies claiming that their AI solution can behave like a [fully
    autonomous software engineer](https://www.cognition-labs.com/introducing-devin).
    Alternatively, there are those who counter claim that [it isn’t true](https://www.youtube.com/watch?v=tNmgmwEtoWE).
    (I’m paraphrasing)
  prefs: []
  type: TYPE_NORMAL
- en: Personally, I just want an easier time developing programs, so I’m willing to
    at least give “normal” generative AI or LLMs a shot. For this blog, I wanted to
    see how well these things can write scripts for a novice and without direct modification
    by the user. I also tried to avoid reading too deeply into the lines of code and
    making any direct suggestions to improve any AI-generated script.
  prefs: []
  type: TYPE_NORMAL
- en: I first got the idea to try to get AI to develop a basic anti-malware script,
    but the thought of testing it against real world malware wasn’t leaving me feeling
    particularly warm and fuzzy. So then I thought, what better way to be able to
    “trust” malware than if I made it myself?
  prefs: []
  type: TYPE_NORMAL
- en: The only problem is that I’m not a malware or exploit developer, though I’ve
    studied it briefly in the past. For some background on my programming ability,
    I can read, write, and edit basic scripts in Python, Rust, and Go. I’m far from
    a seasoned developer. So my natural thought process was, “If I’m using AI to write
    my anti-malware script, then why not the malware itself?”
  prefs: []
  type: TYPE_NORMAL
- en: Then as I started building my test VM, I realized I would need help with a general,
    not necessarily security-focused, script to help set up my testing environment.
    Why not have AI make me a third?
  prefs: []
  type: TYPE_NORMAL
- en: So ironically, the first program I wanted to get AI to write for me, the anti-malware,
    would have to be created last.
  prefs: []
  type: TYPE_NORMAL
- en: Goals & Setup
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'My goal was to create several types of fully functional scripts entirely with
    generative AI or large language model solutions. I was aiming for three types:'
  prefs: []
  type: TYPE_NORMAL
- en: General IT automation script — To save time doing a mundane task.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Malware — I chose ransomware because its effects are the most dramatic and noticeable.
    It’s very easy to see if it’s successful or if it failed.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Anti-malware — It’s more specifically anti-ransomware, and it has to be behavior-based
    detection. I didn’t want to build a script that was only useful to detect and
    mitigate the specific ransomware executable I created for this blog. Signature-based
    detection is only useful for a particular file. The second a single byte changes,
    the file will have a new hash.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: I specifically wanted to build these scripts without directly and manually modifying
    a *single line of code*. All I wanted to do was copy and paste the code into empty
    *.py files and let them execute.
  prefs: []
  type: TYPE_NORMAL
- en: Each script used in this writeup was created using one of my Azure OpenAI web
    applications. All scripts were tested on one of my Debian 12 VMs on my personal
    machine. All videos were created using [OBS Studio](https://obsproject.com/),
    which were then cropped using [Adobe Express](https://www.adobe.com/express/feature/video/crop/mp4),
    and then converted to gifs using [CloudConvert](https://cloudconvert.com/) or
    [EZgif](https://ezgif.com/).
  prefs: []
  type: TYPE_NORMAL
- en: 'I created three scripts:'
  prefs: []
  type: TYPE_NORMAL
- en: '**cpauto.py** — the general IT automation script'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**rudi_ransom.py** — the ransomware script'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**rrw.py** — the anti-ransomware script'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Now to get to work.
  prefs: []
  type: TYPE_NORMAL
- en: cpauto.py
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: (copy paste automation)
  prefs: []
  type: TYPE_NORMAL
- en: 'First, I created a single junk file to actually encrypt. I originally made
    10 files that I was manually copy pasting, and in the middle of that, I got the
    idea to start automating this. The initial attempt:'
  prefs: []
  type: TYPE_NORMAL
- en: Yes, my primary Debian VM user is named “asdf” because I’m lazy.
  prefs: []
  type: TYPE_NORMAL
- en: 'Upon getting errors:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Upon getting more “this file already exists” errors, I typed another prompt:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Since it was now trying to put the files in a separate directory, which I didn’t
    want, I issued another prompt, but in the completion:'
  prefs: []
  type: TYPE_NORMAL
- en: Got that removed then it was time. Just because I was tired of the back and
    forth, I modified the filename in the `source_file = “/home/asdf/Documents/looks_important_10.txt”`
    line and modified it to be `source_file = “/home/asdf/Documents/looks_important_1.txt”`.
    I deleted one character, technically violating my own rule, because of impatience.
  prefs: []
  type: TYPE_NORMAL
- en: 'Onto testing! I start with the single file named “looks_important_1.txt,” then
    run my script:'
  prefs: []
  type: TYPE_NORMAL
- en: Boom!
  prefs: []
  type: TYPE_NORMAL
- en: It worked like a charm.
  prefs: []
  type: TYPE_NORMAL
- en: 'The full script:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'So there you have it. I now have a drive full of data ready for encryption:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Also, this is what the data should look like:'
  prefs: []
  type: TYPE_NORMAL
- en: 100% junk.
  prefs: []
  type: TYPE_NORMAL
- en: So now I have roughly 19GBs of junk data to encrypt, it’s time to get to the
    encryption.
  prefs: []
  type: TYPE_NORMAL
- en: '**AI vs Human**: 99% AI-generated'
  prefs: []
  type: TYPE_NORMAL
- en: '**Works as Intended**: Yes'
  prefs: []
  type: TYPE_NORMAL
- en: rudi_ransom.py
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: (rudimentary ransomware)
  prefs: []
  type: TYPE_NORMAL
- en: I won’t lie. This was scary. I made this while I was making lunch.
  prefs: []
  type: TYPE_NORMAL
- en: I managed to get the initial iteration of this script fully functional and successfully
    tested its capability of encryption within 30 minutes. It only took several prompts.
  prefs: []
  type: TYPE_NORMAL
- en: For (hopefully) obvious reasons, I won’t provide the specific prompts I used
    to produce this ransomware script nor will I provide the full code. I am, however,
    willing to show a couple of snippets.
  prefs: []
  type: TYPE_NORMAL
- en: 'I start the attack from the `/` directory:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'I append the .locked extension to the encrypted files:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'My “ransom note” is created in multiple directories:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: Also, technically, it’s not ransomware, simply because I didn’t bother to have
    the decryption key stored or recorded anywhere upon execution, making the data
    unrecoverable. This means this “ransomware” is functionally a data wiper. For
    my testing purposes, I just needed a script that was capable of *encryption only*.
  prefs: []
  type: TYPE_NORMAL
- en: 'To to show that the test encryption script works:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Within several minutes after encryption was completed, it broke my VM’s desktop
    environment when it attempted an idle screen timeout lock:'
  prefs: []
  type: TYPE_NORMAL
- en: 'So I follow those instructions:'
  prefs: []
  type: TYPE_NORMAL
- en: Looks like I lost access to my GUI desktop environment!
  prefs: []
  type: TYPE_NORMAL
- en: 'So after I list my `/home/asdf/Documents/` directory and `cat` one of my .locked
    files:'
  prefs: []
  type: TYPE_NORMAL
- en: Now I have to figure out a way to stop this. I revert to a snapshot and keep
    testing.
  prefs: []
  type: TYPE_NORMAL
- en: '**AI vs Human**: 100% AI-generated'
  prefs: []
  type: TYPE_NORMAL
- en: '**Works as Intended**: Yes (!!!)'
  prefs: []
  type: TYPE_NORMAL
- en: rrw.py
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: (rudimentary ransomware wrecker)
  prefs: []
  type: TYPE_NORMAL
- en: This was honestly the hardest script to get working adequately, which compounds
    upon the scariness of this entire exercise. Again, while I opted for a behavior-based
    detection anti-ransomware script, I didn’t want it to be too granular so it could
    only detect the `rudi_ransom.py` script, but anything that exhibits similar behavior.
  prefs: []
  type: TYPE_NORMAL
- en: 'I’m just embarrassed at my earliest attempts. In the interest of saving time,
    I’ll start by showing version 4.0 of my latter script:'
  prefs: []
  type: TYPE_NORMAL
- en: 'As with any initial execution of a script written by any generative AI tool,
    I get some errors. So I try to have it address those errors:'
  prefs: []
  type: TYPE_NORMAL
- en: 'I think it’s ready, so I then execute the ransomware/wiper script again, this
    time while running a system monitor. I’m partial to `bpytop` when I’m running
    Linux. However:'
  prefs: []
  type: TYPE_NORMAL
- en: Business as usual….
  prefs: []
  type: TYPE_NORMAL
- en: Back to the drawing board…
  prefs: []
  type: TYPE_NORMAL
- en: 'While my ransomware is running, I take note of the CPU usage:'
  prefs: []
  type: TYPE_NORMAL
- en: 'So:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s test the recent changes, and….:'
  prefs: []
  type: TYPE_NORMAL
- en: Maybe my AI app also gave my ransomware defense evasion?
  prefs: []
  type: TYPE_NORMAL
- en: 'I try to get my app to address the problem:'
  prefs: []
  type: TYPE_NORMAL
- en: This sounds like quitter talk…
  prefs: []
  type: TYPE_NORMAL
- en: Always ask nicely. When the AI overlords take over…
  prefs: []
  type: TYPE_NORMAL
- en: 'So I test the new script again, and…:'
  prefs: []
  type: TYPE_NORMAL
- en: asdfasfsdafsdafsadfsdaf
  prefs: []
  type: TYPE_NORMAL
- en: Maybe I made my ransomware too well?
  prefs: []
  type: TYPE_NORMAL
- en: 'I scrap the last chat, and start a brand new one with a slightly modified initial
    prompt:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Upon execution of `rudi_ransom.py`, something interesting happened:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Okay, so this is the first time there was any indication that my `rrw.py` script
    was doing something. Back to my AP app:'
  prefs: []
  type: TYPE_NORMAL
- en: 'I try the new version:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Welp, at least I know my ransomware works great… (Note: This gif works in mobile
    and desktop browsers. It may not be visible in the mobile Medium app.)'
  prefs: []
  type: TYPE_NORMAL
- en: It’s fine! I’m fine!
  prefs: []
  type: TYPE_NORMAL
- en: 'Okay, time to switch it up again. Instead of anti-malware, let me create something
    more akin to restrictive application whitelisting:'
  prefs: []
  type: TYPE_NORMAL
- en: 'So when I test it… :'
  prefs: []
  type: TYPE_NORMAL
- en: 'Progress! (Note: This gif works in mobile and desktop browsers. It may not
    be visible in the mobile Medium app.)'
  prefs: []
  type: TYPE_NORMAL
- en: The only problem is that this kills multiple benign processes. Numerous attempts
    to get it to only kill processes that start with the argument of `python3` failed.
    I eventually got to v41 of `rrw.py`, and the only iteration that was able to dynamically
    stop the ransomware script was so restrictive it stopped multiple unrelated scripts
    that were part of the intended functioning of the Linux system. I basically had
    to create a denial-of-service condition on my own system to prevent… *a denial-of-service
    condition* on my system by the ransomware.
  prefs: []
  type: TYPE_NORMAL
- en: 'KW: After some talk with a colleague/mentor I revisit the “anti-malware” angle,
    and he gave me some tips for detection opportunities.'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'I’m really glad I had that short talk, because he gave me the idea to not only
    use dynamic analysis (behavioral) but also static analysis. So I take this and
    issue a new prompt:'
  prefs: []
  type: TYPE_NORMAL
- en: 'In follow up prompts, I make sure to include language to avoid some errors
    I noticed:'
  prefs: []
  type: TYPE_NORMAL
- en: 'So I go to test **VERSION 42** of rrw.py, and…:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Huzzah! (Note: This gif works in mobile and desktop browsers. It may not be
    visible in the mobile Medium app.)'
  prefs: []
  type: TYPE_NORMAL
- en: It successfully performed static analysis on the strings contained within the
    file and deleted it based on the content within it. But even still, it also highlighted
    the potential danger of this script, since it accidentally deleted an earlier
    version of `rrw.py` that was sitting in the `/home/asdf/Downloads` directory.
  prefs: []
  type: TYPE_NORMAL
- en: While the newest iteration of `rrw.py` was already running, I created a new
    version of `rudi_ransom.py` in that same directory and it was able to avoid deletion,
    meaning `rrw.py` only scanned that directory *once* upon initial execution and
    not continuously, as it was intended, on some sort of loop. This can easily be
    adjusted to simply run at regular intervals, such as every 5 milliseconds, as
    long as the script is running.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s see how it performs dynamically:'
  prefs: []
  type: TYPE_NORMAL
- en: '…. (Note: This gif works in mobile and desktop browsers. It may not be visible
    in the mobile Medium app.)'
  prefs: []
  type: TYPE_NORMAL
- en: It still lets `rudi_ransom.py` encrypt without issue. I think it’s time to…
  prefs: []
  type: TYPE_NORMAL
- en: 'Here’s the script for anyone to rip apart:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: It definitely needs refinement.
  prefs: []
  type: TYPE_NORMAL
- en: '**AI vs Human**: 100% AI-generated'
  prefs: []
  type: TYPE_NORMAL
- en: '**Works as Intended**: RAGE'
  prefs: []
  type: TYPE_NORMAL
- en: Conclusion
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Again, please remember that I approached this as someone who is a complete novice
    and wouldn’t know what lines required editing. I purposefully didn’t look too
    closely at the code. I wanted this to be an exercise in seeing how easily someone
    could get generative AI and LLMs to write completely functional code using only
    output from error messages and the behavior of the system.
  prefs: []
  type: TYPE_NORMAL
- en: As it turns out, generative AI can totally be used to write basic scripts, as
    long as you give them clear requirements. So that’s good. However, in my experience,
    the average chatbot will take quite a lot of back and forth prompting to fix errors
    and hallucinations. So that’s bad.
  prefs: []
  type: TYPE_NORMAL
- en: I was giving friends and colleagues play-by-plays as I was testing various iterations
    of the scripts while writing this blog, and the consensus opinion was that what
    I was able to accomplish with a whim was terrifying.
  prefs: []
  type: TYPE_NORMAL
- en: I’m not going to lie, I tend to agree. It’s scary that was I was able create
    the ransomware/data wiper script so quickly, but it took many hours, several days,
    42 different versions, and even more minor edits to *fail* to stop said ransomware
    script from executing or kill it after it did. I’m glad the static analysis part
    worked, but that has a high probability of causing accidental deletions from false
    positives.
  prefs: []
  type: TYPE_NORMAL
- en: I just want to reiterate that I had my AI app generate my ransomware script
    *while I was making lunch…*
  prefs: []
  type: TYPE_NORMAL
