- en: <!--yml
  id: totrans-split-0
  prefs: []
  type: TYPE_NORMAL
  zh: <!--yml
- en: 'category: æœªåˆ†ç±»'
  id: totrans-split-1
  prefs: []
  type: TYPE_NORMAL
  zh: 'category: æœªåˆ†ç±»'
- en: 'date: 2024-05-27 12:48:35'
  id: totrans-split-2
  prefs: []
  type: TYPE_NORMAL
  zh: 'date: 2024-05-27 12:48:35'
- en: -->
  id: totrans-split-3
  prefs: []
  type: TYPE_NORMAL
  zh: -->
- en: Your Database Skills Are Not 'Good to Have'
  id: totrans-split-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ä½ çš„æ•°æ®åº“æŠ€èƒ½å¹¶éâ€œå¯æœ‰å¯æ— â€
- en: æ¥æºï¼š[https://renegadeotter.com/2023/11/12/your-database-skills-are-not-good-to-have.html](https://renegadeotter.com/2023/11/12/your-database-skills-are-not-good-to-have.html)
  id: totrans-split-5
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: æ¥æºï¼š[https://renegadeotter.com/2023/11/12/your-database-skills-are-not-good-to-have.html](https://renegadeotter.com/2023/11/12/your-database-skills-are-not-good-to-have.html)
- en: A MySQL war story
  id: totrans-split-6
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ä¸€åœºMySQLçš„æˆ˜äº‰æ•…äº‹
- en: Itâ€™s 2006, and the New York Magazine digital team set out to create a new search
    experience for its Fashion Week portal. It was one of those projects where technical
    feasibility was not even discussed with the tech team - a common occurrence back
    then. Agile was still new, let alone in publishing. It was just a vision, a real
    frigginâ€™ moonshot, and 10 to 12 weeks to develop the wireframed version of the
    product. There would be almost no time left for proper QA. Fashion Week does not
    start slowly but rather goes from zero to sixty in a blink.
  id: totrans-split-7
  prefs: []
  type: TYPE_NORMAL
  zh: å½“æ—¶æ˜¯2006å¹´ï¼Œçº½çº¦æ‚å¿—çš„æ•°å­—å›¢é˜Ÿç€æ‰‹ä¸ºå…¶æ—¶è£…å‘¨é—¨æˆ·åˆ›å»ºæ–°çš„æœç´¢ä½“éªŒã€‚è¿™æ˜¯ä¸€ä¸ªé‚£ç§æŠ€æœ¯å¯è¡Œæ€§ç”šè‡³æ²¡æœ‰ä¸æŠ€æœ¯å›¢é˜Ÿè®¨è®ºçš„é¡¹ç›® - é‚£æ—¶å¾ˆå¸¸è§ã€‚æ•æ·å¼€å‘è¿˜å¾ˆæ–°ï¼Œæ›´ä¸ç”¨è¯´åœ¨å‡ºç‰ˆç•Œäº†ã€‚è¿™åªæ˜¯ä¸€ä¸ªæ„¿æ™¯ï¼Œä¸€ä¸ªçœŸæ­£çš„å¤©æ–¹å¤œè°­ï¼Œ10åˆ°12å‘¨å†…å¼€å‘äº§å“çš„çº¿æ¡†ç‰ˆæœ¬ã€‚å‡ ä¹æ²¡æœ‰æ—¶é—´è¿›è¡Œé€‚å½“çš„è´¨é‡ä¿è¯ã€‚æ—¶è£…å‘¨ä¸æ˜¯ä»æ…¢æ…¢å¼€å§‹ï¼Œè€Œæ˜¯ä¸€çœ¨çœ¼é—´å°±ä»é›¶åˆ°å…­åã€‚
- en: 'The vision? Thousands of near-real-time fashion show images, each one with
    its sub-items categorized: â€œ2006â€, â€œbagâ€, â€œredâ€, â€œ leatherâ€, and so on. A user
    will land on the search page and have the ability to â€œdrill downâ€ and narrow the
    results based on those properties. To make things *much* harder, all of these
    properties would come with exact counts.'
  id: totrans-split-8
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªæ„¿æ™¯å‘¢ï¼Ÿæˆåƒä¸Šä¸‡çš„è¿‘å®æ—¶æ—¶è£…ç§€å›¾åƒï¼Œæ¯ä¸ªå›¾åƒéƒ½æœ‰å…¶å­é¡¹ç›®è¿›è¡Œåˆ†ç±»ï¼šâ€œ2006å¹´â€ï¼Œâ€œåŒ…â€ï¼Œâ€œçº¢è‰²â€ï¼Œâ€œçš®é©â€ç­‰ç­‰ã€‚ç”¨æˆ·ä¼šç€é™†åœ¨æœç´¢é¡µé¢ï¼Œæœ‰èƒ½åŠ›â€œæ·±å…¥æŒ–æ˜â€ï¼Œæ ¹æ®è¿™äº›å±æ€§ç¼©å°ç»“æœã€‚ä¸ºäº†è®©äº‹æƒ…å˜å¾—*æ›´*éš¾ï¼Œæ‰€æœ‰è¿™äº›å±æ€§éƒ½å°†é™„æœ‰ç²¾ç¡®çš„è®¡æ•°ã€‚
- en: The workflow was going to be intense. Photographers will courier their digital
    cartridges from downtown NYC to our offices on Madison Avenue, where the images
    will be processed, tagged by interns, and then indexed every hour by our Perl
    script, reading the tags from the embedded EXIF information. Failure to build
    the search product on our side would have collapsed the entire ecosystem already
    in place, primed and ready to rumble.
  id: totrans-split-9
  prefs: []
  type: TYPE_NORMAL
  zh: å·¥ä½œæµç¨‹å°†ä¼šéå¸¸ç´§å¼ ã€‚æ‘„å½±å¸ˆä»¬å°†æŠŠä»–ä»¬çš„æ•°å­—å­˜å‚¨å¡å¸¦ä»çº½çº¦å¸‚ä¸­å¿ƒå¿«é€’åˆ°æˆ‘ä»¬åœ¨éº¦è¿ªé€Šå¤§é“çš„åŠå…¬å®¤ï¼Œé‚£é‡Œçš„å›¾åƒå°†è¢«å¤„ç†ï¼Œç”±å®ä¹ ç”Ÿæ ‡è®°ï¼Œç„¶åæˆ‘ä»¬çš„Perlè„šæœ¬æ¯å°æ—¶è¯»å–åµŒå…¥çš„EXIFä¿¡æ¯ä¸­çš„æ ‡ç­¾ï¼Œå¹¶è¿›è¡Œç´¢å¼•ã€‚å¦‚æœæˆ‘ä»¬çš„è¿™ä¸€ä¾§æœªèƒ½æ„å»ºå‡ºæœç´¢äº§å“ï¼Œæ•´ä¸ªå·²ç»å°±ä½ã€å‡†å¤‡å¥½è¿›è¡Œæˆ˜æ–—çš„ç”Ÿæ€ç³»ç»Ÿå°†ä¼šå´©æºƒã€‚
- en: â€œOh! Just use the facets in Solr, dudeâ€. Yeah, not so fast - *dude*. In 2006
    that kind of technology didnâ€™t even exist yet. I sat through multiple enterprise
    search engine demos, and none of the products (which cost a LOT of money) could
    do a deep faceted search. We already had an Autonomy license and my first try
    proved thatâ€¦ it just couldnâ€™t do it. It was supposed to be able to, but the counts
    were all wrong. Endeca (now owned by Oracle), [came out of stealth](https://www.digitalcommerce360.com/2006/03/31/endeca-unveils-the-endeca-information-access-platform-takes-aim/)
    when the design part of the project was already underway. Too new, too raw, too
    risky. The idea was just a little too ambitious for its time, especially for a
    tiny team in a non-tech company.
  id: totrans-split-10
  prefs: []
  type: TYPE_NORMAL
  zh: â€œå“¦ï¼åªéœ€åœ¨Solrä¸­ä½¿ç”¨facetsï¼Œè€å…„â€ã€‚æ˜¯çš„ï¼Œå¹¶ä¸é‚£ä¹ˆå¿« - *è€å…„*ã€‚åœ¨2006å¹´ï¼Œé‚£ç§æŠ€æœ¯ç”šè‡³è¿˜ä¸å­˜åœ¨ã€‚æˆ‘ç»å†äº†å¤šæ¬¡ä¼ä¸šæœç´¢å¼•æ“æ¼”ç¤ºï¼Œè€Œæ‰€æœ‰çš„äº§å“ï¼ˆå®ƒä»¬èŠ±è´¹äº†å¤§é‡çš„é’±ï¼‰éƒ½ä¸èƒ½è¿›è¡Œæ·±å±‚æ¬¡çš„facetæœç´¢ã€‚æˆ‘ä»¬å·²ç»æ‹¥æœ‰äº†Autonomyè®¸å¯è¯ï¼Œæˆ‘çš„ç¬¬ä¸€æ¬¡å°è¯•è¯æ˜äº†â€¦â€¦å®ƒå°±æ˜¯ä¸èƒ½åšåˆ°ã€‚å®ƒæœ¬æ¥åº”è¯¥èƒ½åšåˆ°ï¼Œä½†è®¡æ•°å…¨éƒ½é”™äº†ã€‚Endecaï¼ˆç°åœ¨ç”±Oracleæ‹¥æœ‰ï¼‰ï¼Œ[åœ¨é¡¹ç›®è®¾è®¡éƒ¨åˆ†å·²ç»å¯åŠ¨](https://www.digitalcommerce360.com/2006/03/31/endeca-unveils-the-endeca-information-access-platform-takes-aim/)ã€‚å¤ªæ–°äº†ï¼Œå¤ªåŸå§‹äº†ï¼Œå¤ªå†’é™©äº†ã€‚è¿™ä¸ªæƒ³æ³•å¯¹äºå½“æ—¶çš„æ—¶é—´æ¥è¯´ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸€ä¸ªéæŠ€æœ¯å…¬å¸ä¸­çš„å°å›¢é˜Ÿæ¥è¯´ï¼Œåªæ˜¯æœ‰ç‚¹å¤ªé›„å¿ƒå‹ƒå‹ƒäº†ã€‚
- en: So here we were, a team of three, myself and two consultants, writing Perl for
    the indexing script, query-parsing logic, and modeling the data - in MySQL 4\.
    It was one of those projects where one single insurmountable technical risk would
    have sunk the whole thing. I will cut the story short and spare you the excitement.
    We did it, and then we went out to celebrate at a karaoke bar (where I got my
    very first work-stress-related severe hangover) ğŸ¤®
  id: totrans-split-11
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰€ä»¥åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ˜¯ä¸€ä¸ªä¸‰äººå›¢é˜Ÿï¼Œæˆ‘å’Œä¸¤ä½é¡¾é—®ï¼Œä¸ºç´¢å¼•è„šæœ¬ç¼–å†™Perlä»£ç ï¼ŒæŸ¥è¯¢è§£æé€»è¾‘ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œå»ºæ¨¡ - åœ¨MySQL 4ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªå•ä¸ªæ— æ³•é€¾è¶Šçš„æŠ€æœ¯é£é™©å°†ä¼šä½¿æ•´ä¸ªé¡¹ç›®å¤±è´¥çš„é¡¹ç›®ã€‚æˆ‘ä¼šç®€çŸ­åœ°åˆ‡æ–­æ•…äº‹ï¼Œå…å¾—è®©ä½ æ¿€åŠ¨ä¸å·²ã€‚æˆ‘ä»¬åšåˆ°äº†ï¼Œç„¶åæˆ‘ä»¬å‡ºå»åœ¨å¡æ‹‰OKé…’å§åº†ç¥ï¼ˆåœ¨é‚£é‡Œæˆ‘ç¬¬ä¸€æ¬¡å› å·¥ä½œå‹åŠ›å¯¼è‡´äº†ä¸¥é‡çš„å®¿é†‰ï¼‰ğŸ¤®
- en: For someone who was in charge of the SQL model and queries, it was days and
    days of tuning those, timing every query and studying the `EXPLAIN` output to
    see what else I could do to squeeze another 50ms out of the database. There were
    no free nights or weekends. In the end, it was a combination of trial and error,
    digging deep into MySQL server settings, and crafting `GROUP BY` queries that
    would make you nauseous. The MySQL query analyzer was fidgety back then, and sometimes
    re-arranging the fields in the `SELECT` clause could change a queryâ€™s performance.
    Imagine if `SELECT field1, field2 FROM my_table` was faster than `SELECT field2,
    field1 FROM my_table`. Why would it do that? I have no idea to this day, and I
    donâ€™t even want to know.
  id: totrans-split-12
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹äºé‚£äº›è´Ÿè´£SQLæ¨¡å‹å’ŒæŸ¥è¯¢çš„äººæ¥è¯´ï¼Œè°ƒä¼˜æ˜¯æ—¥å¤ä¸€æ—¥çš„å·¥ä½œï¼Œè®¡æ—¶æ¯ä¸€ä¸ªæŸ¥è¯¢å¹¶ç ”ç©¶`EXPLAIN`è¾“å‡ºï¼Œçœ‹çœ‹è¿˜èƒ½åšäº›ä»€ä¹ˆæ¥ä»æ•°æ®åº“ä¸­æŒ¤å‡ºå¦å¤–50msã€‚æ²¡æœ‰å…è´¹çš„å¤œæ™šæˆ–å‘¨æœ«ã€‚æœ€ç»ˆï¼Œè¿™æ˜¯è¯•é”™çš„ç»“åˆï¼Œæ·±å…¥ç ”ç©¶MySQLæœåŠ¡å™¨è®¾ç½®ï¼Œä»¥åŠç²¾å¿ƒè®¾è®¡çš„`GROUP
    BY`æŸ¥è¯¢ï¼Œå¯èƒ½ä¼šè®©ä½ æ„Ÿåˆ°æ¶å¿ƒã€‚é‚£æ—¶çš„MySQLæŸ¥è¯¢åˆ†æå·¥å…·æ˜¯çƒ¦èºä¸å®‰çš„ï¼Œæœ‰æ—¶å€™é‡æ–°æ’åˆ—`SELECT`å­å¥ä¸­çš„å­—æ®µå¯ä»¥æ”¹å˜æŸ¥è¯¢çš„æ€§èƒ½ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœ`SELECT
    field1, field2 FROM my_table`æ¯”`SELECT field2, field1 FROM my_table`æ›´å¿«ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿç›´åˆ°ä»Šå¤©æˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œè€Œä¸”æˆ‘ä¹Ÿä¸æƒ³çŸ¥é“ã€‚
- en: Unfortunately, I lost examples of this work, but the [Way Back Machine](https://web.archive.org/web/20070519214259/http://nymag.com/fashion/fashionshows/2007/spring/main/newyork/womenrunway/yigalazrouel/)
    has proof of our final product.
  id: totrans-split-13
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä¸¢å¤±äº†è¿™é¡¹å·¥ä½œçš„ä¾‹å­ï¼Œä½†æ˜¯[Way Back Machine](https://web.archive.org/web/20070519214259/http://nymag.com/fashion/fashionshows/2007/spring/main/newyork/womenrunway/yigalazrouel/)å¯ä»¥è¯æ˜æˆ‘ä»¬çš„æœ€ç»ˆäº§å“ã€‚
- en: The point here is - if you really know your database, you can do pretty crazy
    things with it, and with the modern generation of storage technologies and beefier
    hardware, you donâ€™t even need to push the limits - it should easily handle what
    I refer to as â€œcommon-scaleâ€.
  id: totrans-split-14
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™é‡Œçš„å…³é”®æ˜¯ - å¦‚æœä½ çœŸçš„äº†è§£ä½ çš„æ•°æ®åº“ï¼Œä½ å¯ä»¥åšå‡ºç›¸å½“ç–¯ç‹‚çš„äº‹æƒ…ï¼Œè€Œä¸”éšç€ç°ä»£å­˜å‚¨æŠ€æœ¯å’Œæ›´å¼ºå¤§çš„ç¡¬ä»¶çš„å‡ºç°ï¼Œä½ ç”šè‡³ä¸éœ€è¦æ¨åŠ¨æé™ - å®ƒåº”è¯¥å¯ä»¥è½»æ¾å¤„ç†æˆ‘æ‰€ç§°çš„â€œå¸¸è§„è§„æ¨¡â€ã€‚
- en: The fading art of SQL
  id: totrans-split-15
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: SQLè¿™é—¨æ—¥æ¸è¡°è½çš„è‰ºæœ¯
- en: In the past few years I have been noticing an unsettling trend - software engineers
    are eager to use exotic â€œplanet-scaleâ€ databases for pretty rudimentary problems,
    while at the same time not having a good grasp of the very powerful relational
    database engine they are likely already using, let alone understanding the technologyâ€™s
    more advanced and useful capabilities. The SQL layer is buried so deep beneath
    libraries and too clever by a half ORMs that it all just becomes high-level code.
  id: totrans-split-16
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿‡å»çš„å‡ å¹´é‡Œï¼Œæˆ‘æ³¨æ„åˆ°ä¸€ä¸ªä»¤äººä¸å®‰çš„è¶‹åŠ¿ - è½¯ä»¶å·¥ç¨‹å¸ˆæ¸´æœ›åœ¨å¤„ç†ç›¸å½“åŸºç¡€çš„é—®é¢˜æ—¶ä½¿ç”¨å¤–æ¥çš„â€œæ˜Ÿçƒè§„æ¨¡â€æ•°æ®åº“ï¼Œä¸æ­¤åŒæ—¶ï¼Œä»–ä»¬å¯¹è‡ªå·±å¯èƒ½å·²ç»åœ¨ä½¿ç”¨çš„å¼ºå¤§çš„å…³ç³»å‹æ•°æ®åº“å¼•æ“çš„æŒæ¡ç¨‹åº¦å¹¶ä¸é«˜ï¼Œæ›´ä¸ç”¨è¯´ç†è§£è¿™äº›æŠ€æœ¯æ›´é«˜çº§å’Œæ›´æœ‰ç”¨çš„èƒ½åŠ›äº†ã€‚SQLå±‚è¢«æ·±æ·±åŸ‹è—åœ¨åº“ä¸‹é¢ï¼Œè¢«è¿‡äºèªæ˜çš„ORMsæ‰€æ©ç›–ï¼Œä¸€åˆ‡éƒ½å˜æˆäº†é«˜çº§åˆ«çš„ä»£ç ã€‚
- en: Modern hardware certainly allows us to go way up from the CPU into the higher
    abstraction layers, while it wasnâ€™t that uncommon in the past to convert certain
    functions to assembly code in order to squeeze every bit of performance out of
    the processor. Now compute and storage is cheaper - itâ€™s true - but abusing this
    abundance has trained us laziness and complacency. Suddenly, that Cloud bill is
    a wee too high, and heavens knows how much energy the world is burning by just
    running billions of auto-generated â€œSqueelâ€ queries every second against mammoth
    database instances.
  id: totrans-split-17
  prefs: []
  type: TYPE_NORMAL
  zh: ç°ä»£ç¡¬ä»¶ç¡®å®å…è®¸æˆ‘ä»¬ä»CPUæå‡åˆ°æ›´é«˜çš„æŠ½è±¡å±‚ï¼Œè™½ç„¶è¿‡å»å°†æŸäº›åŠŸèƒ½è½¬æ¢ä¸ºæ±‡ç¼–ä»£ç ä»¥æŒ¤å‹å¤„ç†å™¨çš„æ¯ä¸€ä½æ€§èƒ½å¹¶ä¸ç½•è§ã€‚ç°åœ¨è®¡ç®—å’Œå­˜å‚¨å˜å¾—æ›´ä¾¿å®œäº† - è¿™æ˜¯çœŸçš„
    - ä½†æ˜¯æ»¥ç”¨è¿™ç§ä¸°å¯Œè®­ç»ƒäº†æˆ‘ä»¬çš„æ‡’æƒ°å’Œè‡ªæ»¡ã€‚çªç„¶é—´ï¼Œäº‘è´¦å•æœ‰ç‚¹é«˜ï¼Œè€Œä¸”è°çŸ¥é“ä¸–ç•Œæ¯ç§’è¿è¡Œæ•°åäº¿ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„â€œSqueelâ€æŸ¥è¯¢å¯¹å·¨å¤§æ•°æ®åº“å®ä¾‹çš„èƒ½æºæ¶ˆè€—æœ‰å¤šå¤§ã€‚
- en: The morning of my first job interview in 2004, I was on a subway train memorizing
    the nine levels of database normalization. Or is it five levels? I donâ€™t remember,
    and It doesnâ€™t even matter - no one will ever ask you this now in a software engineer
    interview.
  id: totrans-split-18
  prefs: []
  type: TYPE_NORMAL
  zh: 2004å¹´æˆ‘ç¬¬ä¸€æ¬¡æ±‚èŒé¢è¯•çš„æ—©æ™¨ï¼Œæˆ‘åœ¨åœ°é“ä¸ŠèƒŒè¯µæ•°æ®åº“è§„èŒƒåŒ–çš„ä¹ä¸ªçº§åˆ«ã€‚è¿˜æ˜¯äº”ä¸ªçº§åˆ«å—ï¼Ÿæˆ‘ä¸è®°å¾—äº†ï¼Œä½†è¿™å·²ç»æ— å…³ç´§è¦äº† - åœ¨è½¯ä»¶å·¥ç¨‹å¸ˆçš„é¢è¯•ä¸­ç°åœ¨æ°¸è¿œä¸ä¼šæœ‰äººé—®ä½ è¿™ä¸ªã€‚
- en: Just skimming through the table of contents of your database of choice, say
    the now [freshly in vogue Postgres](https://www.crunchydata.com/blog/when-did-postgres-become-cool),
    you will find an absolute treasure trove of features fit to handle everything
    but the most gruesome planet-scale computer science problems. Petabyte-sized Postgres
    boxes, replicated, are effortlessly running now as you are reading this.
  id: totrans-split-19
  prefs: []
  type: TYPE_NORMAL
  zh: åªéœ€å¤§ç•¥æµè§ˆæ‚¨é€‰æ‹©çš„æ•°æ®åº“çš„ç›®å½•ï¼Œæ¯”å¦‚ç°åœ¨ [é£é¡ä¸€æ—¶çš„ Postgres](https://www.crunchydata.com/blog/when-did-postgres-become-cool)ï¼Œæ‚¨ä¼šå‘ç°ä¸€ä¸ªç»å¯¹å®è—èˆ¬çš„åŠŸèƒ½ç»„åˆï¼Œé€‚åˆå¤„ç†å‡ ä¹æ‰€æœ‰ï¼Œé™¤äº†æœ€æ£˜æ‰‹çš„å…¨çƒè§„æ¨¡è®¡ç®—æœºç§‘å­¦é—®é¢˜ã€‚åƒæ‚¨ç°åœ¨é˜…è¯»çš„è¿™æ ·çš„
    PB çº§ Postgres ç›’å­ï¼Œå·²ç»è½»æ¾å¤åˆ¶è¿è¡Œäº†ã€‚
- en: The trick is to not expect your database or your ORM to read your mind. Speaking
    ofâ€¦
  id: totrans-split-20
  prefs: []
  type: TYPE_NORMAL
  zh: çªé—¨åœ¨äºä¸è¦æŒ‡æœ›æ‚¨çš„æ•°æ®åº“æˆ– ORM èƒ½å¤Ÿè¯»æ‡‚æ‚¨çš„å¿ƒæ€ã€‚è¯´åˆ°â€¦â€¦
- en: ORMs are not magic
  id: totrans-split-21
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ORM ä¸æ˜¯é­”æ³•
- en: I was a new hire at an e-commerce outfit, and right off the bat I was thrown
    into fixing serious performance issues with the companyâ€™s product catalog pages.
    Just a straight-forward, paginated grid of product images. How hard could it be?
    Believe it or not - it be. The pages took over 10 seconds to load, sometimes longer,
    the database was struggling, and the solution was to â€œjust cache itâ€. One last
    datapoint - this was not a high-traffic site. The pages were dead-slow even if
    there was no traffic at all. Thatâ€™s a rotten sign that something is seriously
    off.
  id: totrans-split-22
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘æ˜¯ä¸€å®¶ç”µå­å•†åŠ¡å…¬å¸çš„æ–°å‘˜å·¥ï¼Œä¸€å¼€å§‹å°±è¢«æŠ›å…¥ä¿®å¤å…¬å¸äº§å“ç›®å½•é¡µé¢çš„ä¸¥é‡æ€§èƒ½é—®é¢˜ä¸­ã€‚åªæ˜¯ä¸€ä¸ªç®€å•çš„ã€åˆ†é¡µçš„äº§å“å›¾ç‰‡ç½‘æ ¼ã€‚è¿™èƒ½æœ‰å¤šéš¾ï¼Ÿä¿¡ä¸ä¿¡ç”±ä½ â€”â€”ç¡®å®éš¾ã€‚é¡µé¢åŠ è½½è¶…è¿‡
    10 ç§’ï¼Œæœ‰æ—¶æ›´é•¿ï¼Œæ•°æ®åº“æŒ£æ‰ä¸å ªï¼Œè§£å†³æ–¹æ¡ˆæ˜¯â€œåªéœ€ç¼“å­˜å®ƒâ€ã€‚æœ€åä¸€ä¸ªæ•°æ®ç‚¹â€”â€”è¿™ä¸æ˜¯ä¸€ä¸ªé«˜æµé‡ç½‘ç«™ã€‚å³ä½¿æ²¡æœ‰æµé‡ï¼Œé¡µé¢ä¹Ÿä¼šéå¸¸ç¼“æ…¢ã€‚è¿™è¡¨æ˜é—®é¢˜ä¸¥é‡ã€‚
- en: After looking a bit closer, I realized that I hit the motherlode - all top three
    major database and coding mistakes in one.
  id: totrans-split-23
  prefs: []
  type: TYPE_NORMAL
  zh: ä»”ç»†æŸ¥çœ‹åï¼Œæˆ‘æ„è¯†åˆ°æˆ‘ä¸€æ¬¡æ€§çŠ¯äº†å‰ä¸‰å¤§ä¸»è¦æ•°æ®åº“å’Œç¼–ç é”™è¯¯ã€‚
- en: 'âŒ Mistake #1: There is no index'
  id: totrans-split-24
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 'âŒ é”™è¯¯ #1ï¼šæ²¡æœ‰ç´¢å¼•'
- en: The column that was hit in every single mission-critical query had no index.
    None. After adding the much-needed index in production, you could practically
    hear MySQL exhaling in relief. Still, the performance was not quite there yet,
    so I had to dig deeper, now in the code.
  id: totrans-split-25
  prefs: []
  type: TYPE_NORMAL
  zh: æ¯ä¸ªå…³é”®ä»»åŠ¡æŸ¥è¯¢ä¸­è¢«å‘½ä¸­çš„åˆ—éƒ½æ²¡æœ‰ç´¢å¼•ã€‚ä¸€ä¸ªéƒ½æ²¡æœ‰ã€‚åœ¨ç”Ÿäº§ä¸­æ·»åŠ äº†éå¸¸éœ€è¦çš„ç´¢å¼•åï¼Œæ‚¨å‡ ä¹å¯ä»¥å¬åˆ° MySQL åœ¨æ¾äº†å£æ°”ã€‚ç„¶è€Œï¼Œæ€§èƒ½è¿˜æ²¡æœ‰å®Œå…¨è¾¾åˆ°é¢„æœŸï¼Œæ‰€ä»¥æˆ‘ä¸å¾—ä¸æ·±å…¥ä»£ç ã€‚
- en: 'âŒ Mistake #2: Assuming each ORM call is free'
  id: totrans-split-26
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 'âŒ é”™è¯¯ #2ï¼šå‡è®¾æ¯ä¸ª ORM è°ƒç”¨éƒ½æ˜¯å…è´¹çš„'
- en: 'Activating the query logs locally and reloading a product listing page, I seeâ€¦
    200, 300, 500 queries fired off just to load one single page. What the shit? Turns
    out, this was the result of a classic ORM abuse of going through every record
    in a loop, to the effect of:'
  id: totrans-split-27
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬åœ°æ¿€æ´»æŸ¥è¯¢æ—¥å¿—å¹¶é‡æ–°åŠ è½½äº§å“åˆ—è¡¨é¡µé¢æ—¶ï¼Œæˆ‘çœ‹åˆ°â€¦â€¦ä¸ºäº†åŠ è½½ä¸€ä¸ªé¡µé¢ï¼Œç«Ÿç„¶å‘å‡ºäº† 200ã€300ã€500 æ¬¡æŸ¥è¯¢ã€‚è¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿç»“æœï¼Œè¿™æ˜¯ç»å…¸çš„ ORM
    æ»¥ç”¨å¯¼è‡´çš„ï¼Œæ¯ä¸ªè®°å½•éƒ½é€šè¿‡å¾ªç¯è¿›è¡ŒæŸ¥è¯¢ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š
- en: '[PRE0]'
  id: totrans-split-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The high number of queries was also due the fact that some of this logic was
    *nested*. The obvious solution is to keep the number of queries in each request
    to a minimum, using ORM capabilities to join and combine the data into one single
    blob. This is what relational databases do - *itâ€™s in the name*.
  id: totrans-split-29
  prefs: []
  type: TYPE_NORMAL
  zh: é«˜æ•°é‡çš„æŸ¥è¯¢ä¹Ÿæ˜¯å› ä¸ºéƒ¨åˆ†é€»è¾‘æ˜¯*åµŒå¥—*çš„äº‹å®ã€‚æ˜æ˜¾çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ ORM çš„èƒ½åŠ›å°†æ¯ä¸ªè¯·æ±‚ä¸­çš„æŸ¥è¯¢æ•°é‡ä¿æŒæœ€å°åŒ–ï¼Œå°†æ•°æ®è”æ¥å’Œç»„åˆæˆä¸€ä¸ªå•ä¸€çš„å—ã€‚è¿™æ˜¯å…³ç³»å‹æ•°æ®åº“åšçš„äº‹æƒ…â€”â€”*è¿™å°±æ˜¯å®ƒçš„åå­—*ã€‚
- en: What is happening above is that each separate query needs to travel to the database,
    [get parsed, transformed, analyzed, planned, executed](https://postgrespro.com/blog/pgsql/5969262#:~:text=Any%20query%20can%20be%20executed,rows%20that%20match%20your%20query),
    and then travel back to the caller. It is one of the most expensive operations
    you can do, and ORMs will happily do the worst possible thing for you in terms
    of performance. How does that ORM call translate to SQL? If itâ€™s not what you
    think it should be, is it an ORM limitation or are you just not using the right
    library call? Is it a particular flavor of non-ANSI vendor SQL that your choice
    of ORM has a tough time with? Do you ultimately need to drop into raw SQL for
    this call but not the others? And so on.
  id: totrans-split-30
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸Šè¿°æƒ…å†µæ˜¯æ¯ä¸ªå•ç‹¬çš„æŸ¥è¯¢éœ€è¦è®¿é—®æ•°æ®åº“ï¼Œ[è¿›è¡Œè§£æã€è½¬æ¢ã€åˆ†æã€è®¡åˆ’ã€æ‰§è¡Œ](https://postgrespro.com/blog/pgsql/5969262#:~:text=Any%20query%20can%20be%20executed,rows%20that%20match%20your%20query)ï¼Œç„¶åè¿”å›ç»™è°ƒç”¨è€…ã€‚è¿™æ˜¯ä½ èƒ½åšçš„æœ€æ˜‚è´µçš„æ“ä½œä¹‹ä¸€ï¼ŒORM
    ä¼šä¹æ„ä¸ºäº†æ€§èƒ½åšæœ€ç³Ÿç³•çš„äº‹æƒ…ã€‚ORM è°ƒç”¨å¦‚ä½•è½¬æ¢ä¸º SQLï¼Ÿå¦‚æœä¸ç¬¦åˆæ‚¨çš„é¢„æœŸï¼Œæ˜¯ ORM çš„é™åˆ¶è¿˜æ˜¯æ‚¨æ²¡æœ‰ä½¿ç”¨æ­£ç¡®çš„åº“è°ƒç”¨ï¼Ÿè¿™æ˜¯ç‰¹å®šçš„é ANSI å‚å•†
    SQL çš„é£æ ¼å—ï¼Ÿå¯¹äºè¿™ä¸ªè°ƒç”¨ï¼Œæ‚¨æœ€ç»ˆæ˜¯å¦éœ€è¦åˆ‡æ¢åˆ°åŸå§‹ SQLï¼Œä½†å…¶ä»–ä¸éœ€è¦ï¼Ÿç­‰ç­‰ã€‚
- en: '<photo-element source="database-skills/55.png" aspect="original-size" alt="Don''t
    do this">#### âŒ Mistake #3: Pulling in the world'
  id: totrans-split-31
  prefs: []
  type: TYPE_NORMAL
  zh: '<photo-element source="database-skills/55.png" aspect="original-size" alt="Don''t
    do this">#### âŒ é”™è¯¯ #3ï¼šå¼•å…¥æ•´ä¸ªä¸–ç•Œ'
- en: To make matters worse, the amount of data here was relatively small, but there
    were dozens and dozens of columns. What do ORMs usually do by default in order
    to make your life â€œeasierâ€? They send the whole thing, all the columns, clogging
    your network pipes with the data that you donâ€™t even need. It is a form of *toxic
    technical debt*, where the speed of development will eventually start eating into
    performance.
  id: totrans-split-32
  prefs: []
  type: TYPE_NORMAL
  zh: æ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿™é‡Œçš„æ•°æ®é‡ç›¸å¯¹è¾ƒå°ï¼Œä½†åˆ—æ•°å´å¤šè¾¾æ•°åä¸ªã€‚ORM é€šå¸¸é»˜è®¤åšä»€ä¹ˆä»¥ä½¿ä½ çš„ç”Ÿæ´»â€œæ›´è½»æ¾â€ï¼Ÿä»–ä»¬å‘é€æ•´ä¸ªå†…å®¹ï¼Œæ‰€æœ‰åˆ—ï¼Œç”¨ä½ ç”šè‡³ä¸éœ€è¦çš„æ•°æ®å µå¡ä½ çš„ç½‘ç»œç®¡é“ã€‚è¿™æ˜¯ä¸€ç§*æœ‰æ¯’çš„æŠ€æœ¯å€ºåŠ¡*ï¼Œå…¶ä¸­å¼€å‘é€Ÿåº¦æœ€ç»ˆå°†å¼€å§‹å½±å“æ€§èƒ½ã€‚
- en: I spent hours within the same project hacking the dark corners of the Dango
    admin, overriding default ORM queries to be less â€œeagerâ€. This led to a much better
    office-facing experience.
  id: totrans-split-33
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘èŠ±äº†å‡ ä¸ªå°æ—¶åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæ·±å…¥æŒ–æ˜ Django åå°çš„é»‘æš—è§’è½ï¼Œè¦†ç›–é»˜è®¤çš„ ORM æŸ¥è¯¢ä»¥å‡å°‘â€œæ€¥è¿«æ€§â€ã€‚è¿™å¤§å¤§æ”¹å–„äº†é¢å‘åŠå…¬ç¯å¢ƒçš„ä½“éªŒã€‚
- en: Performance IS a feature
  id: totrans-split-34
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: æ€§èƒ½æœ¬èº«å°±æ˜¯ä¸€ç§ç‰¹æ€§ã€‚
- en: Serious, mission-critical systems have been running on classic and boring relational
    databases for decades, serving thousands of requests per second. These systems
    have become more advanced, more capable, and more relevant. They are wonders of
    computer science, one can claim. You would think that an ancient database like
    Postgres (in development since 1982) is in some kind of legacy maintenance mode
    at this point, but the opposite is true. In fact, the work has been only accelerating,
    with the scale and [features becoming pretty impressive](https://www.se-radio.net/2019/04/se-radio-episode-362-simon-riggs-on-advanced-features-of-postgresql/).
    What took multiple queries just a few years ago now takes a single one.
  id: totrans-split-35
  prefs: []
  type: TYPE_NORMAL
  zh: æ•°åå¹´æ¥ï¼Œä¸¥è‚ƒçš„ã€å…³é”®ä»»åŠ¡çš„ç³»ç»Ÿä¸€ç›´åœ¨ç»å…¸è€Œä¹å‘³çš„å…³ç³»å‹æ•°æ®åº“ä¸Šè¿è¡Œï¼Œæ¯ç§’æœåŠ¡æˆåƒä¸Šä¸‡çš„è¯·æ±‚ã€‚è¿™äº›ç³»ç»Ÿå˜å¾—æ›´åŠ å…ˆè¿›ã€æ›´æœ‰èƒ½åŠ›å’Œæ›´ç›¸å…³ã€‚å®ƒä»¬æ˜¯è®¡ç®—æœºç§‘å­¦çš„å¥‡è¿¹ï¼Œå¯ä»¥è¯´ã€‚ä½ å¯èƒ½ä¼šè®¤ä¸ºåƒ
    Postgres è¿™æ ·çš„å¤è€æ•°æ®åº“ï¼ˆè‡ª 1982 å¹´èµ·å¼€å‘ï¼‰åœ¨æŸç§ç¨‹åº¦ä¸Šå¤„äºæŸç§é—ç•™ç»´æŠ¤æ¨¡å¼ï¼Œä½†äº‹å®æ°æ°ç›¸åã€‚äº‹å®ä¸Šï¼Œå·¥ä½œè¿›å±•åªæ˜¯åœ¨åŠ é€Ÿï¼Œè§„æ¨¡å’Œ[åŠŸèƒ½å˜å¾—éå¸¸ä»¤äººå°è±¡æ·±åˆ»](https://www.se-radio.net/2019/04/se-radio-episode-362-simon-riggs-on-advanced-features-of-postgresql/)ã€‚å‡ å¹´å‰éœ€è¦å¤šæ¬¡æŸ¥è¯¢çš„ä»»åŠ¡ç°åœ¨åªéœ€ä¸€æ¬¡æŸ¥è¯¢ã€‚
- en: 'Why is this significant? It has been known for a long time, [as discovered
    by Amazon](https://www.conductor.com/academy/page-speed-resources/faq/amazon-page-speed-study/),
    that every additional 100ms of a user waiting for a page to load loses a business
    money. We also know now that from a userâ€™s perspective, [the maximum target response
    time for a web page is around 100 milliseconds](https://designingforperformance.com/performance-is-ux/#:~:text=A%20delay%20of%20less%20than,start%20to%20mentally%20context-switch):'
  id: totrans-split-36
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºä»€ä¹ˆè¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Ÿé•¿æœŸä»¥æ¥ï¼Œ[äºšé©¬é€Šçš„å‘ç°](https://www.conductor.com/academy/page-speed-resources/faq/amazon-page-speed-study/)è¡¨æ˜ï¼Œæ¯å¢åŠ 
    100 æ¯«ç§’ç”¨æˆ·ç­‰å¾…é¡µé¢åŠ è½½æ—¶é—´ï¼Œä¼ä¸šå°±ä¼šæŸå¤±ä¸€å®šçš„æ”¶å…¥ã€‚æˆ‘ä»¬ç°åœ¨ä¹ŸçŸ¥é“ï¼Œä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œ[ç½‘é¡µçš„æœ€å¤§ç›®æ ‡å“åº”æ—¶é—´å¤§çº¦æ˜¯ 100 æ¯«ç§’](https://designingforperformance.com/performance-is-ux/#:~:text=A%20delay%20of%20less%20than,start%20to%20mentally%20context-switch)ã€‚
- en: A delay of less than 100 milliseconds feels instant to a user, but a delay between
    100 and 300 milliseconds is perceptible. A delay between 300 and 1,000 milliseconds
    makes the user feel like a machine is working, but if the delay is above 1,000
    milliseconds, your user will likely start to mentally context-switch.
  id: totrans-split-37
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: å¯¹ç”¨æˆ·æ¥è¯´ï¼Œå°‘äº 100 æ¯«ç§’çš„å»¶è¿Ÿæ„Ÿè§‰ç¬é—´å®Œæˆï¼Œä½†åœ¨ 100 åˆ° 300 æ¯«ç§’ä¹‹é—´çš„å»¶è¿Ÿæ˜¯å¯å¯Ÿè§‰çš„ã€‚300 åˆ° 1,000 æ¯«ç§’ä¹‹é—´çš„å»¶è¿Ÿä¼šè®©ç”¨æˆ·æ„Ÿè§‰åƒæœºå™¨æ­£åœ¨å·¥ä½œï¼Œä½†å¦‚æœå»¶è¿Ÿè¶…è¿‡
    1,000 æ¯«ç§’ï¼Œä½ çš„ç”¨æˆ·å¯èƒ½ä¼šå¼€å§‹è¿›è¡Œå¿ƒç†ä¸Šçš„åˆ‡æ¢ã€‚
- en: The â€œjust add more CPU and RAM if itâ€™s slowâ€ approach may have worked for a
    while, but [many are finding out the hard way](https://venturebeat.com/data-infrastructure/the-shift-to-the-cloud-could-be-costing-businesses-more-than-its-saving/)
    that this kind of laziness is not sustainable in a frugal business environment
    where costs *matter*.
  id: totrans-split-38
  prefs: []
  type: TYPE_NORMAL
  zh: â€œå¦‚æœæ…¢äº†ï¼Œåªéœ€å¢åŠ æ›´å¤šçš„ CPU å’Œ RAMâ€è¿™ç§æ–¹æ³•å¯èƒ½ä¸€åº¦æœ‰æ•ˆï¼Œä½†[å¾ˆå¤šäººæ­£åœ¨è‹¦è‹¦å‘ç°](https://venturebeat.com/data-infrastructure/the-shift-to-the-cloud-could-be-costing-businesses-more-than-its-saving/)ï¼Œè¿™ç§æ‡’æƒ°åœ¨æˆæœ¬è‡³ä¸Šçš„å•†ä¸šç¯å¢ƒä¸­æ˜¯ä¸å¯æŒç»­çš„ã€‚
- en: Database anti-patterns
  id: totrans-split-39
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: æ•°æ®åº“åæ¨¡å¼ã€‚
- en: 'Knowing what **not** to do is as important as knowing what **to** do. Some
    of the below mistakes are all too common:'
  id: totrans-split-40
  prefs: []
  type: TYPE_NORMAL
  zh: çŸ¥é“**ä¸**åšä»€ä¹ˆä¸çŸ¥é“**è¦**åšä»€ä¹ˆåŒæ ·é‡è¦ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„é”™è¯¯ï¼š
- en: 'âŒ Anti-pattern #1\. Using exotic databases for the wrong reasons'
  id: totrans-split-41
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 'âŒ åæ¨¡å¼ #1\. å‡ºäºé”™è¯¯çš„åŸå› ä½¿ç”¨å¼‚ç±»æ•°æ®åº“ã€‚'
- en: Technologies like DynamoDB are designed to handle scale at which Postgres and
    MySQL begin to fail. This is achieved by denormalizing, duplicating the data aggressively,
    where the database is not doing much real-time data manipulation or joining. Your
    data is now modeled after how it is queried, not after how it is *related*. Regular
    relational concepts disintegrate at this insane level of scale. Needless to say,
    if you are resorting to this kind of storage for â€œcommon-scaleâ€ problems, you
    are already [solving problems you donâ€™t have](/2023/09/10/death-by-a-thousand-microservices.html).
  id: totrans-split-42
  prefs: []
  type: TYPE_NORMAL
  zh: ç±»ä¼¼DynamoDBè¿™æ ·çš„æŠ€æœ¯æ˜¯ä¸ºäº†å¤„ç†Postgreså’ŒMySQLå¼€å§‹å¤±è´¥çš„è§„æ¨¡è€Œè®¾è®¡çš„ã€‚è¿™æ˜¯é€šè¿‡éè§„èŒƒåŒ–ã€å¤§é‡å¤åˆ¶æ•°æ®æ¥å®ç°çš„ï¼Œæ•°æ®åº“å¹¶æ²¡æœ‰è¿›è¡Œå®æ—¶æ•°æ®æ“ä½œæˆ–è¿æ¥ã€‚ä½ çš„æ•°æ®ç°åœ¨æ˜¯æ ¹æ®æŸ¥è¯¢æ–¹å¼å»ºæ¨¡çš„ï¼Œè€Œä¸æ˜¯æ ¹æ®å®ƒä»¬çš„*å…³ç³»*ã€‚å¸¸è§„çš„å…³ç³»æ¦‚å¿µåœ¨è¿™ç§ç–¯ç‹‚çš„è§„æ¨¡ä¸‹ä¼šè§£ä½“ã€‚ä¸ç”¨è¯´ï¼Œå¦‚æœä½ ä¸ºâ€œå¸¸è§è§„æ¨¡â€é—®é¢˜è€Œé‡‡ç”¨è¿™ç§å­˜å‚¨æ–¹å¼ï¼Œé‚£ä¹ˆä½ å·²ç»åœ¨
    [è§£å†³ä½ å¹¶æ²¡æœ‰çš„é—®é¢˜](/2023/09/10/death-by-a-thousand-microservices.html) äº†ã€‚
- en: 'âŒ Anti-pattern #2\. Caching things unnecessarily'
  id: totrans-split-43
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 'âŒ åæ¨¡å¼ #2\. æ— è°“çš„ç¼“å­˜'
- en: Caching is a necessary evil - *but itâ€™s not always necessary*. There is an entire
    class of bugs and on-call issues that stem from stale cached data. Read-only database
    replicas are a classic architecture pattern that is still very much not outdated,
    and it will buy you insane levels of performance before you have to worry about
    anything. It should not be a surprise that mature relational databases already
    have query caching in place - it just [has to be tuned](https://severalnines.com/blog/overview-caching-postgresql/)
    for your specific needs.
  id: totrans-split-44
  prefs: []
  type: TYPE_NORMAL
  zh: ç¼“å­˜æ˜¯ä¸€ç§å¿…è¦ä¹‹æ¶ï¼Œ*ä½†å¹¶ä¸æ€»æ˜¯å¿…éœ€çš„*ã€‚æœ‰ä¸€æ•´ç±»é”™è¯¯å’Œå³æ—¶é—®é¢˜æºäºè¿‡æ—¶çš„ç¼“å­˜æ•°æ®ã€‚åªè¯»æ•°æ®åº“å‰¯æœ¬æ˜¯ä¸€ç§ç»å…¸æ¶æ„æ¨¡å¼ï¼Œè‡³ä»Šä»ç„¶éå¸¸æœ‰æ•ˆï¼Œå®ƒå¯ä»¥åœ¨ä½ éœ€è¦æ‹…å¿ƒä»»ä½•é—®é¢˜ä¹‹å‰å¤§å¹…æå‡æ€§èƒ½ã€‚ä¸åº”è¯¥è®©äººæ„Ÿåˆ°æ„å¤–çš„æ˜¯ï¼Œæˆç†Ÿçš„å…³ç³»å‹æ•°æ®åº“å·²ç»å®æ–½äº†æŸ¥è¯¢ç¼“å­˜
    - åªéœ€è¦æ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚è¿›è¡Œè°ƒä¼˜ã€‚å®ƒå¿…é¡» [è¿›è¡Œè°ƒä¼˜](https://severalnines.com/blog/overview-caching-postgresql/)
    æ‰èƒ½è¾¾åˆ°æœ€ä½³æ•ˆæœã€‚
- en: Cache invalidation is hard. It adds more complexity and states of uncertainty
    to your system. It makes debugging more difficult. I received more emails from
    content teams than I care for throughout my career that wondered â€œwhy is the data
    not there, I updated it 30 minutes ago?!â€
  id: totrans-split-45
  prefs: []
  type: TYPE_NORMAL
  zh: ç¼“å­˜å¤±æ•ˆæ˜¯å›°éš¾çš„ã€‚å®ƒç»™ç³»ç»Ÿå¢åŠ äº†æ›´å¤šå¤æ‚æ€§å’Œä¸ç¡®å®šçŠ¶æ€ã€‚è¿™ä½¿å¾—è°ƒè¯•å˜å¾—æ›´åŠ å›°éš¾ã€‚åœ¨æˆ‘èŒä¸šç”Ÿæ¶¯ä¸­ï¼Œæˆ‘æ”¶åˆ°äº†è®¸å¤šæ¥è‡ªå†…å®¹å›¢é˜Ÿçš„ç”µå­é‚®ä»¶ï¼Œä»–ä»¬æƒ³çŸ¥é“â€œä¸ºä»€ä¹ˆæ•°æ®ä¸åœ¨é‚£é‡Œï¼Œæˆ‘30åˆ†é’Ÿå‰æ›´æ–°äº†å®ƒï¼Ÿâ€
- en: '*Caching should not act as a bandaid for bad architecture and non-performant
    code.*'
  id: totrans-split-46
  prefs: []
  type: TYPE_NORMAL
  zh: '*ç¼“å­˜ä¸åº”è¯¥ä½œä¸ºç³Ÿç³•æ¶æ„å’Œéé«˜æ•ˆä»£ç çš„ä¸€ç§ç´§æ€¥æªæ–½ã€‚*'
- en: '<photo-element source="database-skills/two-problems.png" aspect="original-size"
    alt="Caching">#### âŒ Anti-pattern #3\. Storing everything and a kitchen sink'
  id: totrans-split-47
  prefs: []
  type: TYPE_NORMAL
  zh: '<photo-element source="database-skills/two-problems.png" aspect="original-size"
    alt="ç¼“å­˜">#### âŒ åæ¨¡å¼ #3\. å­˜å‚¨ä¸€åˆ‡åŠå¨æˆ¿æ°´æ§½'
- en: As much punishment as an industry-standard database can take, itâ€™s probably
    not a good idea to not care at all about whatâ€™s going into it, treating it like
    a data landfill of sorts. Management, querying, backups, migrations - all becomes
    painful once the DB grows substantially. Even if that is of no concern as you
    are using a managed cloud DB - the costs should be. An RDBMS is a sophisticated
    piece of technology, and storing data in it is *expensive*.
  id: totrans-split-48
  prefs: []
  type: TYPE_NORMAL
  zh: å°½ç®¡è¡Œä¸šæ ‡å‡†æ•°æ®åº“å¯ä»¥æ‰¿å—å¦‚æ­¤å¤šçš„æƒ©ç½šï¼Œä½†å®Œå…¨ä¸å…³å¿ƒè¾“å…¥å†…å®¹ï¼Œå°†å…¶è§†ä¸ºæŸç§æ•°æ®åƒåœ¾åœºå¯èƒ½å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ç®¡ç†ã€æŸ¥è¯¢ã€å¤‡ä»½ã€è¿ç§» - ä¸€æ—¦æ•°æ®åº“è§„æ¨¡æ˜¾è‘—å¢é•¿ï¼Œæ‰€æœ‰è¿™äº›éƒ½ä¼šå˜å¾—ç—›è‹¦ã€‚å³ä½¿ä½ ä½¿ç”¨æ‰˜ç®¡äº‘æ•°æ®åº“ä¸å…³å¿ƒè¿™äº›ï¼Œæˆæœ¬ä¹Ÿæ˜¯ä¸ªé—®é¢˜ã€‚å…³ç³»å‹æ•°æ®åº“æ˜¯ä¸€ç§å¤æ‚çš„æŠ€æœ¯ï¼Œå­˜å‚¨æ•°æ®åœ¨å…¶ä¸­æ˜¯*æ˜‚è´µçš„*ã€‚
- en: Figure out common-scale first
  id: totrans-split-49
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: é¦–å…ˆè¦ç¡®å®šå¸¸è§è§„æ¨¡
- en: It is fairly easy to make a beefy Postgres or a MySQL database grind to a halt
    if you expect it to do magic without any extra work. *â€œItâ€™s not web-scale, boss.
    Our 2 million records seem to be too much of a lift. We need DynamoDB, Kafka,
    and event sourcing!â€*
  id: totrans-split-50
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨Postgresæˆ–MySQLæ•°æ®åº“ï¼Œå¦‚æœä½ æŒ‡æœ›å®ƒä»¬åœ¨ä¸åšé¢å¤–å·¥ä½œçš„æƒ…å†µä¸‹è‡ªåŠ¨ä¼˜åŒ–ï¼Œé‚£ä¹ˆè®©å®ƒä»¬å˜å¾—ä¸å ªé‡è´Ÿæ˜¯ç›¸å½“å®¹æ˜“çš„ã€‚*â€œè€æ¿ï¼Œå®ƒä¸é€‚åˆWebè§„æ¨¡ã€‚æˆ‘ä»¬çš„200ä¸‡æ¡è®°å½•ä¼¼ä¹å¤ªå¤šäº†ã€‚æˆ‘ä»¬éœ€è¦DynamoDBã€Kafkaå’Œäº‹ä»¶æºï¼â€*
- en: A relational database is not some antiquated technology that only us tech fossils
    choose to be experts in, a thing that can be waved off like an annoying insect.
    *â€œHere we React and GraphQL all the things, old manâ€*. In legal speak, a modern
    RDBMS is innocent until proven guilty, and the burden of proof should be extremely
    high - and almost entirely on you.
  id: totrans-split-51
  prefs: []
  type: TYPE_NORMAL
  zh: å…³ç³»å‹æ•°æ®åº“ä¸æ˜¯ä¸€ç§åªæœ‰æˆ‘ä»¬è¿™äº›æŠ€æœ¯åŒ–çŸ³æ‰é€‰æ‹©æˆä¸ºä¸“å®¶çš„å¤è€æŠ€æœ¯ï¼Œä¹Ÿä¸æ˜¯å¯ä»¥åƒè®¨åŒçš„æ˜†è™«ä¸€æ ·è½»æ˜“å¿½ç•¥çš„ä¸œè¥¿ã€‚*â€œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨Reactå’ŒGraphQLæå®šä¸€åˆ‡ï¼Œè€å¤´å­â€*ã€‚ä»æ³•å¾‹è§’åº¦æ¥çœ‹ï¼Œç°ä»£å…³ç³»å‹æ•°æ®åº“æ˜¯æ— è¾œçš„ï¼Œé™¤éè¢«è¯æ˜æœ‰ç½ªï¼Œå¹¶ä¸”è¯æ˜çš„è´Ÿæ‹…åº”è¯¥æå…¶ä¸¥æ ¼
    - å‡ ä¹å®Œå…¨ç”±ä½ æ‰¿æ‹…ã€‚
- en: 'Finally, if I have to figure out â€œwhy itâ€™s slowâ€, my approximate runbook is:'
  id: totrans-split-52
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œå¦‚æœæˆ‘å¿…é¡»å¼„æ¸…æ¥šâ€œä¸ºä»€ä¹ˆå¾ˆæ…¢â€ï¼Œæˆ‘çš„å¤§è‡´æ“ä½œæ­¥éª¤æ˜¯ï¼š
- en: Compile a list of unique queries, from logging, slow query log, etc.
  id: totrans-split-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ç¼–åˆ¶ä¸€ä¸ªç‹¬ç‰¹æŸ¥è¯¢åˆ—è¡¨ï¼ŒåŒ…æ‹¬æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰ã€‚
- en: Look at the most frequent queries first
  id: totrans-split-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é¦–å…ˆæŸ¥çœ‹æœ€é¢‘ç¹çš„æŸ¥è¯¢
- en: Use `EXPLAIN` to check slow query plans for index usage
  id: totrans-split-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ `EXPLAIN` æ¥æ£€æŸ¥ç´¢å¼•ä½¿ç”¨çš„æ…¢æŸ¥è¯¢è®¡åˆ’
- en: Select only the data that needs to travel across the wire
  id: totrans-split-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: åªé€‰æ‹©éœ€è¦é€šè¿‡ç½‘ç»œä¼ è¾“çš„æ•°æ®
- en: If an ORM is doing something silly without a workaround, pop the hood and get
    dirty with the raw SQL plumbing
  id: totrans-split-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¦‚æœ ORM åœ¨æ²¡æœ‰è§£å†³æ–¹æ³•çš„æƒ…å†µä¸‹åšäº†ä¸€äº›æ„šè ¢çš„äº‹æƒ…ï¼Œè¯·æ‰“å¼€å¼•æ“ç›–ï¼Œä¸åŸå§‹çš„ SQL ç®¡é“è¿›è¡Œæ·±å…¥äº¤æµ
- en: <photo-element source="database-skills/merry-xmas.gif" aspect="landscape" alt="Merry
    Xmas!">Most importantly, study your database (and SQL). Learn it, love it, use
    it, abuse it. Spending a couple of days just leafing through that Postgres manual
    to see what it *can* do will probably make you a better engineer than spending
    more time on the next flavor-of-the-month JavaScript framework hotness. Again.
  id: totrans-split-58
  prefs: []
  type: TYPE_NORMAL
  zh: <photo-element source="database-skills/merry-xmas.gif" aspect="landscape" alt="åœ£è¯å¿«ä¹ï¼">æœ€é‡è¦çš„æ˜¯ï¼Œå­¦ä¹ ä½ çš„æ•°æ®åº“ï¼ˆä»¥åŠ
    SQLï¼‰ã€‚å­¦ä¹ å®ƒï¼Œçƒ­çˆ±å®ƒï¼Œä½¿ç”¨å®ƒï¼Œç”šè‡³æ»¥ç”¨å®ƒã€‚èŠ±å‡ å¤©æ—¶é—´ç¿»é˜…ä¸€ä¸‹é‚£æœ¬ PostgreSQL æ‰‹å†Œï¼Œçœ‹çœ‹å®ƒ*èƒ½*åšä»€ä¹ˆï¼Œå¯èƒ½ä¼šæ¯”èŠ±æ›´å¤šæ—¶é—´åœ¨ä¸‹ä¸€ä¸ªé£é¡ä¸€æ—¶çš„
    JavaScript æ¡†æ¶ä¸Šæ›´èƒ½æˆä¸ºä¸€åä¼˜ç§€çš„å·¥ç¨‹å¸ˆã€‚å†è¯´ä¸€éã€‚
- en: Latest
  id: totrans-split-59
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: æœ€æ–°
- en: Related posts
  id: totrans-split-60
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ç›¸å…³æ–‡ç« 
- en: '[I am not your Cloud person](/2023/07/26/i-am-not-your-cloud-person.html)'
  id: totrans-split-61
  prefs: []
  type: TYPE_NORMAL
  zh: '[æˆ‘ä¸æ˜¯ä½ çš„äº‘è®¡ç®—äºº](/2023/07/26/i-am-not-your-cloud-person.html)'
- en: Further reading
  id: totrans-split-62
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: è¿›ä¸€æ­¥é˜…è¯»
- en: '[Use the index, Luke - SQL Indexing and Tuning e-Book](https://use-the-index-luke.com/)'
  id: totrans-split-63
  prefs: []
  type: TYPE_NORMAL
  zh: '[ä½¿ç”¨ç´¢å¼•ï¼Œå¢å…‹ - SQL ç´¢å¼•å’Œè°ƒä¼˜ç”µå­ä¹¦](https://use-the-index-luke.com/)'
- en: '[Donâ€™t do this - a Postgres WIKI](https://wiki.postgresql.org/wiki/Don''t_Do_This)</photo-element></photo-element></photo-element>'
  id: totrans-split-64
  prefs: []
  type: TYPE_NORMAL
  zh: '[ä¸è¦è¿™æ ·åš - ä¸€ä¸ª PostgreSQL ç»´åŸº](https://wiki.postgresql.org/wiki/Don''t_Do_This)</photo-element></photo-element></photo-element>'
