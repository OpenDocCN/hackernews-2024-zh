<!--yml

category: 未分类

date: 2024-05-27 12:49:53

-->

# 自由软件的不太卓越的冒险 [LWN.net]

> 来源：[https://lwn.net/SubscriberLink/967866/c38a847c932f0536/](https://lwn.net/SubscriberLink/967866/c38a847c932f0536/)

| **LWN订阅者的好处** [订阅LWN](/subscribe/)的主要好处是帮助我们继续出版，此外，订阅者可以立即访问所有站点内容，并使用许多额外的站点功能。请立即注册！ |
| --- |

由**Jonathan Corbet**撰写

2024年4月2日

在早期反对Linux的FUD中，一个常见的主题是，由于任何人都可以贡献代码，所以它是不可信的。两十多年后，很少再听到这种说法；经验表明，自由软件社区不倾向于发布公然敌意的代码。但是，正如

[XZ软件包的后门](/Articles/967180/)

已提醒我们，不幸的是，恶意代码的嵌入并不仅限于专有领域。我们的社区将忙于分析此事件，但可能很难得出明确结论。

攻击的技术细节在许多方面都很引人入胜。详见[配套文章](/Articles/967192/)以了解更多相关内容。

对于那些需要简短概述的人：XZ软件包用于数据压缩；它广泛分发并在许多不同地方使用。名为“贾坦”的某人设法获得了对该项目的维护者级别访问权限，并利用此权限插入了一个巧妙隐藏的后门。当XZ库加载到OpenSSH服务器进程时，该后门将允许攻击者在受影响的系统上运行任意代码。此代码已经植入了一些测试发行版和openSUSE Tumbleweed滚动发行版中，直到被Andres Freund发现。详见[此页面](https://research.swtch.com/xz-timeline)获取详细时间轴。

这段敌对代码很快被移除了，虽然现在确定还为时过早，但看起来被发现前已经阻止了其被利用的可能性。如果那次发现没有发生，这段恶意代码可能已经潜入大量系统。一旦成功，后果难以想象，也难以言喻。

#### 社会工程学

就像许多重要项目一样，XZ多年来一直由单一的维护者（Lasse Collin）负责，他一直在自己的空闲时间维护代码。这在某些时候导致开发进度缓慢，其他人发送的补丁通常被搁置。不幸的是，在我们的社区中这并不是不寻常的情况。

2022 年 5 月，Collin 在[这封电子邮件线程中](https://www.mail-archive.com/xz-devel@tukaani.org/msg00562.html)（和[其他线程](https://www.mail-archive.com/xz-devel@tukaani.org/msg00555.html)）因未能及时响应补丁而受到了广泛批评。在我们的社区中，这种情况也不罕见。不过现在回顾这段对话，情况显得更加阴暗；用来欺负维护者的账户被广泛认为是傀儡账户，专门为此目的创建并随后被抛弃。回顾来看，明显的意图是要逼迫 Collin 接受项目中的另一位维护者。

在这次对话期间，Collin [提到](https://www.mail-archive.com/xz-devel@tukaani.org/msg00567.html)（[不止一次](https://www.mail-archive.com/xz-devel@tukaani.org/msg00571.html)），他已经在私下得到了 Tan 的帮助，并且 Tan 可能会在未来扮演更重要的角色。这当然发生了，带来了毁灭性的影响。Tan 获得了将代码推送到代码库的能力，随后在较长的时间内滥用这一权力添加后门。除了添加后门，Tan 还[修改了发布的安全策略](https://git.tukaani.org/?p=xz.git;a=blobdiff;f=.github/SECURITY.md;h=9ddfe8e946cf1810f131bf4f56156626b7ca7e31;hp=e9b3458a2c377fea765483d51df5a33ebca8fd3e;hb=af071ef7702debef4f1d324616a0137a5001c14c;hpb=0b99783d63f27606936bb79a16c52d0d70c0b56f)，试图控制代码中发现的任何漏洞的披露，[修改了构建系统](https://git.tukaani.org/?p=xz.git;a=blobdiff;f=CMakeLists.txt;h=d2b1af7ab0ab759b6805ced3dff2555e2a4b3f8e;hp=76700591059711e3a4da5b45cf58474dac4e12a7;hb=328c52da8a2bbb81307644efdb58db2c422d9ba7;hpb=eb8ad59e9bab32a8d655796afd39597ea6dcc64d)，悄悄地禁用了[Landlock](https://docs.kernel.org/userspace-api/landlock.html)安全模块，[重定向了](https://github.com/google/oss-fuzz/commit/6403e93344476972e908ce17e8244f5c2b957dfd)来自[OSS-Fuzz](https://github.com/google/oss-fuzz)项目的报告，等等。

一旦恶意代码成为 XZ 发布版的一部分，Tan 就向分发商发起了运动，试图尽快将受损版本发送出去。还有[一系列补丁](/ml/linux-kernel/20240320183846.19475-1-lasse.collin@tukaani.org/)提交给内核，这些补丁将 Tan 命名为内核 XZ 代码的维护者。这些补丁在表面上看起来无害，但显然旨在鼓励用户尽快更新到恶意版本的 XZ。这些补丁进入了 linux-next，但从未进入主线。

关于 XZ 存在特别易受此类攻击的问题，人们纷纷谈论过，这可能是事实，而且对维护者的支持普遍存在严重问题，但这并非全貌。即便是薪水丰厚、压力不大的维护者也乐于接受外部帮助。毕竟，我们的开发模式之一的优势在于能够接受来自全球任何一个不相识的人的贡献，并将责任交给他们。一个愿意耐心等待的攻击者在许多重要项目中获得信任的机会是很大的。

这整个事件很可能会使维护者更难以信任有帮助的外部人员，即使是他们多年来一直与之合作的人。在某种程度上，这可能是必要的，但这也是适得其反的（我们*希望*我们的维护者得到更多帮助），并且令人悲伤。我们的社区建立在信任之上，几乎所有时候这种信任都是理所当然的。如果我们不能信任我们的合作者，我们将会变得不那么高效，也不会有那么多乐趣。

#### 关闭的门

不出所料，互联网上充满了如何防止或检测这种攻击的各种想法。有些更有帮助。

有很多关于我们系统过于复杂的评论。这些评论有一定道理，但很少有人会无缘无故增加复杂性；软件功能之所以存在，是因为有人需要。这同样适用于分发商应用的补丁，它们是这次攻击复杂网络的一部分。总体来说，分发商宁愿携带更少的补丁，而不是更多，并且不会无缘无故地修改他们发布的软件。因此，尽管复杂性和下游补丁应该尽可能地避免和审查，它们是我们不能忽视的现实。

最终，此次攻击所针对的具体软件组件并不是特别重要。如果这个攻击向量不可用，攻击者也会选择其他途径。简单的事实是，可以选择的攻击向量有很多。

毫无疑问，关于这次攻击，有很多技术和流程问题需要讨论。关键软件拉取的依赖关系是否合理？可以减少吗？为什么项目会发布与源代码库中找不到的内容的压缩包，分发商为什么要从这些压缩包构建？我们如何更好地整合持续可复制构建工作以捕捉微妙的变化？测试基础设施应该如何与用于部署的代码分离？在项目管理二进制对象时，哪些是最佳实践？为什么我们仍在使用几乎没有人理解的古老构建系统？如何使眼花缭乱的代码得到更好的审查？对于这类问题，应该有何种适当的禁止政策？

所有这些都是需要深入讨论的有用问题；希望能从中得出一些有益的结论。但重要的是不要在这次具体攻击的细节上纠缠不清；下一次攻击很可能看起来会有所不同。而且下一次攻击很可能已经在进行中。

在无助的一面，来自 OpenSSF 的[建议](https://openssf.org/blog/2024/03/30/xz-backdoor-cve-2024-3094/) ，即问题的一部分是缺乏“OpenSSF最佳实践徽章”，很可能不会对阻止下一次攻击有太大作用（注意该组织似乎已经想清楚了。请参考[the Wayback Machine](https://web.archive.org/web/20240331210703/https://openssf.org/blog/2024/03/30/xz-backdoor-cve-2024-3094/)查看原始帖子）。GitHub 封锁 XZ 仓库的行动 —— 当马很久之前已经离开了谷仓，搬到了一个新的国家，并成立了家庭之后才采取的，除了阻止问题的分析外，并没有保护任何人。

#### 来源

这次攻击是在至少两年的时间里以一种细心而耐心的方式进行的；这并不是一个脚本小子碰巧运气好的情况。某人 —— 或一群人 —— 花时间找到一种方式来妥协大量的系统，开发了一个复杂和隐秘的利用，并进行了大规模的社会工程运作，将这个利用引入 XZ 仓库，从而使其进入发行的 Linux 发行版中。所有这一切都是在几乎没有犯错的情况下进行的，直到快要结束时才出现一个小小的失误。

事情似乎很明显，相当多的资源被用于这个努力。推测这些资源来自何处完全是推测。但推测这可能是一个由国家支持的努力似乎并不算是太过离谱。毫无疑问，许多机构都希望获得对 Linux 系统的这种访问权。我们可能永远不会知道其中是否有一个机构是这次试图背后的推手。

还需要记住的另一件事是，这种复杂的攻击不太可能仅限于单个软件包的单个妥协矢量。很可能还存在其他触角，使用不同的身份和不同的方法。因此，尽管审查在较早阶段检测和防止这种攻击的做法是一种有价值的练习，但也存在分散我们注意力，转移到不遵循同一操作手册的下一次攻击（或已存在的、进行中的攻击）的风险。

多年来，插入这种后门的尝试并不多——至少我们检测到的并不多——进入核心自由软件项目。其中一个可能的解释是，我们的软件已经足够脆弱，以至于一个技能合适的攻击者总是能找到一个现有的漏洞来利用，而不用冒现在围绕XZ攻击发生的暴露的风险。一个有趣（也可能完全是一厢情愿的）想法是，长期以来我们对系统的加固、转向更好的语言，以及一般上更好地处理安全问题的努力，使得这条道路变得更难，至少在某些时候，推动一些攻击者进入风险的、多年的后门尝试。

#### 最后

在这次攻击引发的众多讨论中，可以轻易找到两种看似对立的观点：

+   XZ 事件展示了自由软件社区的实力。凭借我们的勤奋和测试，我们在这次复杂的攻击（可能）实现其目标之前就进行了侦测、分析并且禁用了它。（[例子](https://social.wildeboer.net/@jwildeboer/112184074379919145)）

+   运气极好地拯救了世界免受一场巨大的安全灾难。这样一次攻击能走得这么远，证明了我们社区的薄弱；考虑到我们长期存在的可持续性问题，这样的攻击迟早会发生。（[例子](https://cybervillains.com/@djm/112192731055910711)）

总之，这两种观点可以同时有效。是的，检测这次攻击确实需要相当大的运气，而且支持维护者（以及许多其他贡献者）还不够。但是，用 [路易·巴斯德](https://en.wikiquote.org/wiki/Louis_Pasteur) 的话来说，机会青睐于有准备的开发社区。我们有技能娴熟、好奇心强的开发者来调查异常行为，我们有一个软件环境来促进这种调查。我们永远不必接受某个给定的软件系统只是表现得奇怪；相反，我们已经竭尽全力确保可以深入挖掘并找出这种行为发生的原因——并加以修复。这确实是一个主要的优势；与运气和英雄般的工作一起，这拯救了我们。

我们必须希望我们能够提高自己的游戏水平，以便我们的优势也能在下次危机中拯救我们。我们社区的成员大多只是想完成某些事情，而且大多数人并不是安全专家，但我们刚刚被一个拥有广泛能力和资源的强大对手攻击。我们没有为这种战斗做好准备。但是，专有世界也没有。我们的社区在克服了许多挑战之后才走到今天；我们可能会再次克服这个挑战。

* * *

（

[登录](https://lwn.net/Login/?target=/Articles/967866/)

发表评论）
